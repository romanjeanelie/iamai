var Oi=Object.defineProperty;var Ni=(p,s,u)=>s in p?Oi(p,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):p[s]=u;var I0=(p,s,u)=>(Ni(p,typeof s!="symbol"?s+"":s,u),u);import"./index-06901edd.js";import{connect as Da}from"https://cdn.jsdelivr.net/npm/nats.ws@latest/esm/nats.js";function Hi({element:p,expression:s=" ",append:u=!0}){const b=Fi(p.innerHTML.toString().trim(),s);let w="";b.forEach(B=>{B.indexOf("<br>")>-1?B.split("<br>").forEach((D,T)=>{w+=T>0?"<br>"+_a(D):_a(D)}):w+=_a(B)}),p.innerHTML=w;const I=p.querySelectorAll("span");return u&&I.forEach(B=>{const k=B.textContent.length===1,D=B.innerHTML.trim()!=="",T=B.textContent!=="&",V=B.textContent!=="-";k&&D&&T&&V&&(B.innerHTML=`${B.textContent}&nbsp;`)}),I}function gi(p){const s=[];let u=[],b=p[0].offsetTop;return p.forEach((w,I)=>{w.offsetTop===b&&u.push(w),w.offsetTop!==b&&(s.push(u),u=[],u.push(w),b=w.offsetTop),I+1===p.length&&s.push(u)}),s}function Fi(p,s){const u=p.split("<br>");let b=[];return u.forEach((w,I)=>{I>0&&b.push("<br>"),b=b.concat(w.split(s));let B=!1,k="";const D=[];b.forEach(T=>{!B&&(T.includes("<a")||T.includes("<strong"))&&(k="",B=!0),B&&(k+=` ${T}`),B&&(T.includes("/a>")||T.includes("/strong>"))&&(D.push(k),k=""),!B&&k===""&&D.push(T),B&&(T.includes("/a>")||T.includes("/strong>"))&&(B=!1)}),b=D}),b}function _a(p){return p=p.trim(),p===""||p===" "?p:p==="<br>"?"<br>":`<span>${p}</span>`+(p.length>1?" ":"")}function Vi(p){let s=[],u=Math.floor(p.length/2);s.push(p[u]);for(let b=1;b<=u;b++)p[u+b]!==void 0?(s.push(p[u-b]),s.push(p[u+b])):p[u-b]!==void 0&&s.push(p[u-b]);return s}function Ie(p,s,u){return Array.isArray(p)?p.map(b=>b.animate(s,u)):p.animate(s,u)}const xa="#fff",Xa="#648ff2",Pi="#eaeced";const ha=["Book me a flight from Singapore to Kuala Lumpur on  flight from Singapore to Kuala Lumpur","Book me a flight from Paris to Kuala Lumpur on  flight from Singapore to Kuala Lumpur","Book me a flight from London to Kuala Lumpur on  flight from Singapore to Kuala Lumpur"];function V0(p,s,u){const b=u?"translateX(0%)":`translateX(${s})`,w=u?`translateX(${s})`:"translateX(0%)";return Ie(p,[{color:Xa,transform:b,offset:0},{color:xa,offset:.5},{color:xa,offset:.95},{color:Xa,transform:w,offset:1},{opacity:1}],{duration:500,fill:"forwards",ease:"ease-in-out"})}class qi{constructor(){this.carousselEl=document.querySelector(".caroussel__container"),this.carousselTextEl=this.carousselEl.querySelector(".caroussel__text"),this.nextBtn=this.carousselEl.querySelector("#btn-next"),this.prevBtn=this.carousselEl.querySelector("#btn-prev"),this.markerEl=this.carousselEl.querySelector(".caroussel__markers")}init(){this.currentIndex=0,this.startAnimIndex=0,this.isComplete=!1,this.addText(),this.createMarkers(),this.updateButtons(),this.createLines(),this.addListeners(),this.showLines()}createMarkers(){for(let s=0;s<ha.length;s++){let u=document.createElement("span");u.classList.add("marker"),s===this.currentIndex&&u.classList.add("active"),this.markerEl.appendChild(u)}}addText(){this.carousselTextEl.innerHTML="",this.carousselTextEl.textContent=ha[this.currentIndex]}createLines(){this.splitLines=gi(Hi({element:this.carousselTextEl})),this.nbLines=this.splitLines.length,this.middleLineIndex=this.nbLines%2===1?Math.floor(this.nbLines/2):null,this.carousselTextEl.innerHTML="",this.linesEls=this.getLines(this.splitLines),this.linesSorted=Vi(this.linesEls),this.addClasses(),this.addMasks()}getLines(s){return s.map((u,b)=>{const w=u.map(B=>B.outerHTML).join(" "),I=document.createElement("div");return I.innerHTML=w,this.carousselTextEl.appendChild(I),I})}addClasses(){this.linesEls.forEach((s,u)=>{if(this.middleLineIndex!==null&&u===this.middleLineIndex)s.classList.add("caroussel__line--middle");else{const w=(u-this.middleLineIndex)%2===0?"caroussel__line--even":"caroussel__line--odd";s.classList.add("caroussel__line"),s.classList.add(w)}})}addMasks(){for(let s=0;s<this.linesSorted.length;){const u=this.linesSorted[s];if(u.classList.contains("caroussel__line--middle")){const b=document.createElement("span"),w=document.createElement("span");b.classList.add("mask","mask-left"),w.classList.add("mask","mask-right"),b.textContent="/",w.textContent="/",u.appendChild(b),u.appendChild(w),s++}else{const b=this.linesSorted[s],w=this.linesSorted[s+1],I=document.createElement("span"),B=document.createElement("span");I.classList.add("mask","mask-left"),B.classList.add("mask","mask-right"),I.textContent="/",B.textContent="/",w.appendChild(I),b.appendChild(B),s+=2}}}onHideComplete(){this.isComplete||(this.isComplete=!0,this.carousselTextEl.style.opacity=0,this.addText(),this.createLines(),this.carousselTextEl.style.opacity=1,this.updateMarkers(),this.animLines(!0))}onShowComplete(){this.startAnimIndex=0,this.isAnimating=!1}animLines(s){if(this.startAnimIndex>this.nbLines-1){this.startAnimIndex=0,s?this.onShowComplete():(this.startAnimIndex=0,this.onHideComplete());return}if(this.middleLineIndex!==null&&this.startAnimIndex===0){const u=this.linesSorted[this.startAnimIndex],b=u.querySelector(".mask-left"),w=u.querySelector(".mask-right");V0(w,"100%",s);const I=V0(b,"-100%",s);I.onfinish=()=>{this.startAnimIndex=1,this.animLines(s)}}else{const u=this.linesSorted[this.startAnimIndex],b=this.linesSorted[this.startAnimIndex+1],w=u.querySelector(".mask"),I=b.querySelector(".mask");V0(w,"100%",s);const B=V0(I,"-100%",s);B.onfinish=()=>{this.startAnimIndex+=2,this.animLines(s)}}}showLines(){this.carousselTextEl.querySelectorAll(".mask").forEach(u=>{u.classList.contains("mask-left")?u.style.transform="translateX(-100%)":u.style.transform="translateX(100%)"})}updateMarkers(){const s=this.markerEl.querySelectorAll(".marker");s.forEach(u=>u.classList.remove("active")),s[this.currentIndex].classList.add("active")}updateButtons(){this.nextBtn.disabled=this.currentIndex===ha.length-1,this.prevBtn.disabled=this.currentIndex===0}prev(){this.isAnimating||(this.isAnimating=!0,this.isComplete=!1,this.currentIndex-=1,this.updateButtons(),this.animLines(!1))}next(){this.isAnimating||(this.isAnimating=!0,this.isComplete=!1,this.currentIndex+=1,this.updateButtons(),this.animLines(!1))}addListeners(){this.nextBtn.addEventListener("click",()=>{this.next()}),this.prevBtn.addEventListener("click",()=>{this.prev()})}}class Di{constructor(s,u,b){this.pageEl=b,this.imageDroppedContainer=this.pageEl.querySelector(".image-dropped__container"),this.dropImageOverlayEl=this.pageEl.querySelector(".image-drop-zone--overlay"),this.inputFileUploadEl=this.pageEl.querySelector(".input__file-upload"),this.closeBtn=this.pageEl.querySelector(".input__image--closeBtn"),this.anims=s,this.callbacks=u,this.analizingImageMinTime=1e3,this.isEnabled=!1,this.addListeners()}uploadFile(s){let u=/image.*/;if(s.type.match(u)){let b="HTTP/HTTPS URL TO SEND THE DATA TO",w=new FormData;w.append("file",s),fetch(b,{method:"put",body:w}).then(I=>I.json()).then(I=>{console.log("Success:",I)}).catch(I=>{console.error("Error:",I)})}else console.error("Only images are allowed!",s)}enable(){this.isEnabled=!0}disable(){this.inputFileUploadEl.value="",this.imageDroppedContainer.innerHTML="",this.isEnabled=!1}onDrop(s){this.anims.toImageDroped(),console.log("TODO: add end point to send the image file to the server",s),setTimeout(()=>{this.previewImage(s)},this.analizingImageMinTime)}previewImage(s){let u=/image.*/;if(s.type.match(u)){this.anims.toImageAnalyzed();let b=new FileReader;b.readAsDataURL(s),b.onloadend=()=>{let w=document.createElement("img");w.src=b.result,s.size/1e3+"",this.imageDroppedContainer.appendChild(w),this.callbacks.onImageUploaded(w)}}else this.anims.reset(),console.error("Only images are allowed!",s)}addListeners(){["dragenter","dragover","dragleave","drop"].forEach(u=>{this.pageEl.addEventListener(u,s)});function s(u){u.preventDefault(),u.stopPropagation()}["dragenter","dragover"].forEach(u=>{this.pageEl.addEventListener(u,()=>{this.isEnabled&&this.dropImageOverlayEl.classList.add("hovered")})}),["dragleave","drop"].forEach(u=>{this.pageEl.addEventListener(u,()=>{this.isEnabled&&this.dropImageOverlayEl.classList.remove("hovered")})}),this.pageEl.addEventListener("drop",u=>{if(!this.isEnabled)return;const I=u.dataTransfer.files[0];this.onDrop(I)}),this.inputFileUploadEl.addEventListener("change",u=>{if(this.inputFileUploadEl.files&&this.inputFileUploadEl.files[0]){const b=this.inputFileUploadEl.files[0];this.onDrop(b)}})}}const Ta=p=>new Promise((s,u)=>{var b=new XMLHttpRequest,w=new FormData;w.append("audio_file",p,crypto.randomUUID()+".wav"),w.append("type","audio/wav"),b.open("POST","https://ai.iamplus.services/speech/asr?task=transcribe&encode=true&output=json&word_timestamps=false",!0),b.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE&&this.status===200){var I=JSON.parse(this.responseText);s(I.text)}},b.addEventListener("error",function(I){console.log("error: "+I),s("error: text was not transcribed")}),b.send(w)});function wa(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var Ba={};function Xi(p){return new Int8Array(p)}function vi(p){return new Int16Array(p)}function mi(p){return new Int32Array(p)}function fi(p){return new Float32Array(p)}function Yi(p){return new Float64Array(p)}function pi(p){if(p.length==1)return fi(p[0]);var s=p[0];p=p.slice(1);for(var u=[],b=0;b<s;b++)u.push(pi(p));return u}function bi(p){if(p.length==1)return mi(p[0]);var s=p[0];p=p.slice(1);for(var u=[],b=0;b<s;b++)u.push(bi(p));return u}function Ai(p){if(p.length==1)return vi(p[0]);var s=p[0];p=p.slice(1);for(var u=[],b=0;b<s;b++)u.push(Ai(p));return u}function Ei(p){if(p.length==1)return new Array(p[0]);var s=p[0];p=p.slice(1);for(var u=[],b=0;b<s;b++)u.push(Ei(p));return u}var Si={};Si.fill=function(p,s,u,b){if(arguments.length==2)for(var w=0;w<p.length;w++)p[w]=arguments[1];else for(var w=s;w<u;w++)p[w]=b};var H0={};H0.arraycopy=function(p,s,u,b,w){for(var I=s+w;s<I;)u[b++]=p[s++]};H0.out={};H0.out.println=function(p){console.log(p)};H0.out.printf=function(){console.log.apply(console,arguments)};var Q0={};Q0.SQRT2=1.4142135623730951;Q0.FAST_LOG10=function(p){return Math.log10(p)};Q0.FAST_LOG10_X=function(p,s){return Math.log10(p)*s};function e0(p){this.ordinal=p}e0.short_block_allowed=new e0(0);e0.short_block_coupled=new e0(1);e0.short_block_dispensed=new e0(2);e0.short_block_forced=new e0(3);var yi={};yi.MAX_VALUE=34028235e31;function Ot(p){this.ordinal=p}Ot.vbr_off=new Ot(0);Ot.vbr_mt=new Ot(1);Ot.vbr_rh=new Ot(2);Ot.vbr_abr=new Ot(3);Ot.vbr_mtrh=new Ot(4);Ot.vbr_default=Ot.vbr_mtrh;var Gi=function(p){},ge={System:H0,VbrMode:Ot,Float:yi,ShortBlock:e0,Util:Q0,Arrays:Si,new_array_n:Ei,new_byte:Xi,new_double:Yi,new_float:fi,new_float_n:pi,new_int:mi,new_int_n:bi,new_short:vi,new_short_n:Ai,assert:Gi},ca,Ya;function $i(){if(Ya)return ca;Ya=1;var p=ge,s=p.System;p.VbrMode,p.Float,p.ShortBlock;var u=p.Util,b=p.Arrays;p.new_array_n,p.new_byte,p.new_double;var w=p.new_float;p.new_float_n,p.new_int,p.new_int_n,p.assert;var I=Qe();function B(){var k=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*u.SQRT2*.5/2384e-9,.017876148*u.SQRT2*.5/2384e-9,.003134727*u.SQRT2*.5/2384e-9,.002457142*u.SQRT2*.5/2384e-9,971317e-9*u.SQRT2*.5/2384e-9,218868e-9*u.SQRT2*.5/2384e-9,101566e-9*u.SQRT2*.5/2384e-9,13828e-9*u.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],D=12,T=36,V=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],y=V[I.SHORT_TYPE],G=V[I.SHORT_TYPE],Y=V[I.SHORT_TYPE],K=V[I.SHORT_TYPE],q=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function U(m,E,e){for(var v=10,f=E+238-14-286,x=-15;x<0;x++){var c,n,i;c=k[v+-10],n=m[f+-224]*c,i=m[E+224]*c,c=k[v+-9],n+=m[f+-160]*c,i+=m[E+160]*c,c=k[v+-8],n+=m[f+-96]*c,i+=m[E+96]*c,c=k[v+-7],n+=m[f+-32]*c,i+=m[E+32]*c,c=k[v+-6],n+=m[f+32]*c,i+=m[E+-32]*c,c=k[v+-5],n+=m[f+96]*c,i+=m[E+-96]*c,c=k[v+-4],n+=m[f+160]*c,i+=m[E+-160]*c,c=k[v+-3],n+=m[f+224]*c,i+=m[E+-224]*c,c=k[v+-2],n+=m[E+-256]*c,i-=m[f+256]*c,c=k[v+-1],n+=m[E+-192]*c,i-=m[f+192]*c,c=k[v+0],n+=m[E+-128]*c,i-=m[f+128]*c,c=k[v+1],n+=m[E+-64]*c,i-=m[f+64]*c,c=k[v+2],n+=m[E+0]*c,i-=m[f+0]*c,c=k[v+3],n+=m[E+64]*c,i-=m[f+-64]*c,c=k[v+4],n+=m[E+128]*c,i-=m[f+-128]*c,c=k[v+5],n+=m[E+192]*c,i-=m[f+-192]*c,n*=k[v+6],c=i-n,e[30+x*2]=i+n,e[31+x*2]=k[v+7]*c,v+=18,E--,f++}{var n,i,h,r;i=m[E+-16]*k[v+-10],n=m[E+-32]*k[v+-2],i+=(m[E+-48]-m[E+16])*k[v+-9],n+=m[E+-96]*k[v+-1],i+=(m[E+-80]+m[E+48])*k[v+-8],n+=m[E+-160]*k[v+0],i+=(m[E+-112]-m[E+80])*k[v+-7],n+=m[E+-224]*k[v+1],i+=(m[E+-144]+m[E+112])*k[v+-6],n-=m[E+32]*k[v+2],i+=(m[E+-176]-m[E+144])*k[v+-5],n-=m[E+96]*k[v+3],i+=(m[E+-208]+m[E+176])*k[v+-4],n-=m[E+160]*k[v+4],i+=(m[E+-240]-m[E+208])*k[v+-3],n-=m[E+224],h=n-i,r=n+i,i=e[14],n=e[15]-i,e[31]=r+i,e[30]=h+n,e[15]=h-n,e[14]=r-i}{var t;t=e[28]-e[0],e[0]+=e[28],e[28]=t*k[v+-2*18+7],t=e[29]-e[1],e[1]+=e[29],e[29]=t*k[v+-2*18+7],t=e[26]-e[2],e[2]+=e[26],e[26]=t*k[v+-4*18+7],t=e[27]-e[3],e[3]+=e[27],e[27]=t*k[v+-4*18+7],t=e[24]-e[4],e[4]+=e[24],e[24]=t*k[v+-6*18+7],t=e[25]-e[5],e[5]+=e[25],e[25]=t*k[v+-6*18+7],t=e[22]-e[6],e[6]+=e[22],e[22]=t*u.SQRT2,t=e[23]-e[7],e[7]+=e[23],e[23]=t*u.SQRT2-e[7],e[7]-=e[6],e[22]-=e[7],e[23]-=e[22],t=e[6],e[6]=e[31]-t,e[31]=e[31]+t,t=e[7],e[7]=e[30]-t,e[30]=e[30]+t,t=e[22],e[22]=e[15]-t,e[15]=e[15]+t,t=e[23],e[23]=e[14]-t,e[14]=e[14]+t,t=e[20]-e[8],e[8]+=e[20],e[20]=t*k[v+-10*18+7],t=e[21]-e[9],e[9]+=e[21],e[21]=t*k[v+-10*18+7],t=e[18]-e[10],e[10]+=e[18],e[18]=t*k[v+-12*18+7],t=e[19]-e[11],e[11]+=e[19],e[19]=t*k[v+-12*18+7],t=e[16]-e[12],e[12]+=e[16],e[16]=t*k[v+-14*18+7],t=e[17]-e[13],e[13]+=e[17],e[17]=t*k[v+-14*18+7],t=-e[20]+e[24],e[20]+=e[24],e[24]=t*k[v+-12*18+7],t=-e[21]+e[25],e[21]+=e[25],e[25]=t*k[v+-12*18+7],t=e[4]-e[8],e[4]+=e[8],e[8]=t*k[v+-12*18+7],t=e[5]-e[9],e[5]+=e[9],e[9]=t*k[v+-12*18+7],t=e[0]-e[12],e[0]+=e[12],e[12]=t*k[v+-4*18+7],t=e[1]-e[13],e[1]+=e[13],e[13]=t*k[v+-4*18+7],t=e[16]-e[28],e[16]+=e[28],e[28]=t*k[v+-4*18+7],t=-e[17]+e[29],e[17]+=e[29],e[29]=t*k[v+-4*18+7],t=u.SQRT2*(e[2]-e[10]),e[2]+=e[10],e[10]=t,t=u.SQRT2*(e[3]-e[11]),e[3]+=e[11],e[11]=t,t=u.SQRT2*(-e[18]+e[26]),e[18]+=e[26],e[26]=t-e[18],t=u.SQRT2*(-e[19]+e[27]),e[19]+=e[27],e[27]=t-e[19],t=e[2],e[19]-=e[3],e[3]-=t,e[2]=e[31]-t,e[31]+=t,t=e[3],e[11]-=e[19],e[18]-=t,e[3]=e[30]-t,e[30]+=t,t=e[18],e[27]-=e[11],e[19]-=t,e[18]=e[15]-t,e[15]+=t,t=e[19],e[10]-=t,e[19]=e[14]-t,e[14]+=t,t=e[10],e[11]-=t,e[10]=e[23]-t,e[23]+=t,t=e[11],e[26]-=t,e[11]=e[22]-t,e[22]+=t,t=e[26],e[27]-=t,e[26]=e[7]-t,e[7]+=t,t=e[27],e[27]=e[6]-t,e[6]+=t,t=u.SQRT2*(e[0]-e[4]),e[0]+=e[4],e[4]=t,t=u.SQRT2*(e[1]-e[5]),e[1]+=e[5],e[5]=t,t=u.SQRT2*(e[16]-e[20]),e[16]+=e[20],e[20]=t,t=u.SQRT2*(e[17]-e[21]),e[17]+=e[21],e[21]=t,t=-u.SQRT2*(e[8]-e[12]),e[8]+=e[12],e[12]=t-e[8],t=-u.SQRT2*(e[9]-e[13]),e[9]+=e[13],e[13]=t-e[9],t=-u.SQRT2*(e[25]-e[29]),e[25]+=e[29],e[29]=t-e[25],t=-u.SQRT2*(e[24]+e[28]),e[24]-=e[28],e[28]=t-e[24],t=e[24]-e[16],e[24]=t,t=e[20]-t,e[20]=t,t=e[28]-t,e[28]=t,t=e[25]-e[17],e[25]=t,t=e[21]-t,e[21]=t,t=e[29]-t,e[29]=t,t=e[17]-e[1],e[17]=t,t=e[9]-t,e[9]=t,t=e[25]-t,e[25]=t,t=e[5]-t,e[5]=t,t=e[21]-t,e[21]=t,t=e[13]-t,e[13]=t,t=e[29]-t,e[29]=t,t=e[1]-e[0],e[1]=t,t=e[16]-t,e[16]=t,t=e[17]-t,e[17]=t,t=e[8]-t,e[8]=t,t=e[9]-t,e[9]=t,t=e[24]-t,e[24]=t,t=e[25]-t,e[25]=t,t=e[4]-t,e[4]=t,t=e[5]-t,e[5]=t,t=e[20]-t,e[20]=t,t=e[21]-t,e[21]=t,t=e[12]-t,e[12]=t,t=e[13]-t,e[13]=t,t=e[28]-t,e[28]=t,t=e[29]-t,e[29]=t,t=e[0],e[0]+=e[31],e[31]-=t,t=e[1],e[1]+=e[30],e[30]-=t,t=e[16],e[16]+=e[15],e[15]-=t,t=e[17],e[17]+=e[14],e[14]-=t,t=e[8],e[8]+=e[23],e[23]-=t,t=e[9],e[9]+=e[22],e[22]-=t,t=e[24],e[24]+=e[7],e[7]-=t,t=e[25],e[25]+=e[6],e[6]-=t,t=e[4],e[4]+=e[27],e[27]-=t,t=e[5],e[5]+=e[26],e[26]-=t,t=e[20],e[20]+=e[11],e[11]-=t,t=e[21],e[21]+=e[10],e[10]-=t,t=e[12],e[12]+=e[19],e[19]-=t,t=e[13],e[13]+=e[18],e[18]-=t,t=e[28],e[28]+=e[3],e[3]-=t,t=e[29],e[29]+=e[2],e[2]-=t}}function L(m,E){for(var e=0;e<3;e++){var v,f,x,c,n,i;c=m[E+2*3]*V[I.SHORT_TYPE][0]-m[E+5*3],v=m[E+0*3]*V[I.SHORT_TYPE][2]-m[E+3*3],f=c+v,x=c-v,c=m[E+5*3]*V[I.SHORT_TYPE][0]+m[E+2*3],v=m[E+3*3]*V[I.SHORT_TYPE][2]+m[E+0*3],n=c+v,i=-c+v,v=(m[E+1*3]*V[I.SHORT_TYPE][1]-m[E+4*3])*2069978111953089e-26,c=(m[E+4*3]*V[I.SHORT_TYPE][1]+m[E+1*3])*2069978111953089e-26,m[E+3*0]=f*190752519173728e-25+v,m[E+3*5]=-n*190752519173728e-25+c,x=x*.8660254037844387*1907525191737281e-26,n=n*.5*1907525191737281e-26+c,m[E+3*1]=x-n,m[E+3*2]=x+n,f=f*.5*1907525191737281e-26-v,i=i*.8660254037844387*1907525191737281e-26,m[E+3*3]=f+i,m[E+3*4]=f-i,E++}}function _(m,E,e){var v,f;{var x,c,n,i,h,r,t,d;x=e[17]-e[9],n=e[15]-e[11],i=e[14]-e[12],h=e[0]+e[8],r=e[1]+e[7],t=e[2]+e[6],d=e[3]+e[5],m[E+17]=h+t-d-(r-e[4]),f=(h+t-d)*G[12+7]+(r-e[4]),v=(x-n-i)*G[12+6],m[E+5]=v+f,m[E+6]=v-f,c=(e[16]-e[10])*G[12+6],r=r*G[12+7]+e[4],v=x*G[12+0]+c+n*G[12+1]+i*G[12+2],f=-h*G[12+4]+r-t*G[12+5]+d*G[12+3],m[E+1]=v+f,m[E+2]=v-f,v=x*G[12+1]-c-n*G[12+2]+i*G[12+0],f=-h*G[12+5]+r-t*G[12+3]+d*G[12+4],m[E+9]=v+f,m[E+10]=v-f,v=x*G[12+2]-c+n*G[12+0]-i*G[12+1],f=h*G[12+3]-r+t*G[12+4]-d*G[12+5],m[E+13]=v+f,m[E+14]=v-f}{var l,F,R,O,a,o,H,g;l=e[8]-e[0],R=e[6]-e[2],O=e[5]-e[3],a=e[17]+e[9],o=e[16]+e[10],H=e[15]+e[11],g=e[14]+e[12],m[E+0]=a+H+g+(o+e[13]),v=(a+H+g)*G[12+7]-(o+e[13]),f=(l-R+O)*G[12+6],m[E+11]=v+f,m[E+12]=v-f,F=(e[7]-e[1])*G[12+6],o=e[13]-o*G[12+7],v=a*G[12+3]-o+H*G[12+4]+g*G[12+5],f=l*G[12+2]+F+R*G[12+0]+O*G[12+1],m[E+3]=v+f,m[E+4]=v-f,v=-a*G[12+5]+o-H*G[12+3]-g*G[12+4],f=l*G[12+1]+F-R*G[12+2]-O*G[12+0],m[E+7]=v+f,m[E+8]=v-f,v=-a*G[12+4]+o-H*G[12+5]-g*G[12+3],f=l*G[12+0]-F+R*G[12+1]-O*G[12+2],m[E+15]=v+f,m[E+16]=v-f}}this.mdct_sub48=function(m,E,e){for(var v=E,f=286,x=0;x<m.channels_out;x++){for(var c=0;c<m.mode_gr;c++){for(var n,i=m.l3_side.tt[c][x],h=i.xr,r=0,t=m.sb_sample[x][1-c],d=0,l=0;l<18/2;l++)for(U(v,f,t[d]),U(v,f+32,t[d+1]),d+=2,f+=64,n=1;n<32;n+=2)t[d-1][n]*=-1;for(n=0;n<32;n++,r+=18){var F=i.block_type,R=m.sb_sample[x][c],O=m.sb_sample[x][1-c];if(i.mixed_block_flag!=0&&n<2&&(F=0),m.amp_filter[n]<1e-12)b.fill(h,r+0,r+18,0);else{if(m.amp_filter[n]<1)for(var l=0;l<18;l++)O[l][q[n]]*=m.amp_filter[n];if(F==I.SHORT_TYPE){for(var l=-D/4;l<0;l++){var a=V[I.SHORT_TYPE][l+3];h[r+l*3+9]=R[9+l][q[n]]*a-R[8-l][q[n]],h[r+l*3+18]=R[14-l][q[n]]*a+R[15+l][q[n]],h[r+l*3+10]=R[15+l][q[n]]*a-R[14-l][q[n]],h[r+l*3+19]=O[2-l][q[n]]*a+O[3+l][q[n]],h[r+l*3+11]=O[3+l][q[n]]*a-O[2-l][q[n]],h[r+l*3+20]=O[8-l][q[n]]*a+O[9+l][q[n]]}L(h,r)}else{for(var o=w(18),l=-T/4;l<0;l++){var H,g;H=V[F][l+27]*O[l+9][q[n]]+V[F][l+36]*O[8-l][q[n]],g=V[F][l+9]*R[l+9][q[n]]-V[F][l+18]*R[8-l][q[n]],o[l+9]=H-g*y[3+l+9],o[l+18]=H*y[3+l+9]+g}_(h,r,o)}}if(F!=I.SHORT_TYPE&&n!=0)for(var l=7;l>=0;--l){var se,le;se=h[r+l]*Y[20+l]+h[r+-1-l]*K[28+l],le=h[r+l]*K[28+l]-h[r+-1-l]*Y[20+l],h[r+-1-l]=se,h[r+l]=le}}}if(v=e,f=286,m.mode_gr==1)for(var re=0;re<18;re++)s.arraycopy(m.sb_sample[x][1][re],0,m.sb_sample[x][0][re],0,32)}}}return ca=B,ca}var P0=Qe(),ot=ge,Ui=ot.System;ot.VbrMode;ot.Float;ot.ShortBlock;ot.Util;ot.Arrays;ot.new_array_n;ot.new_byte;ot.new_double;var Ki=ot.new_float,Zi=ot.new_float_n;ot.new_int;ot.new_int_n;ot.assert;function Wi(){this.l=Ki(P0.SBMAX_l),this.s=Zi([P0.SBMAX_s,3]);var p=this;this.assign=function(s){Ui.arraycopy(s.l,0,p.l,0,P0.SBMAX_l);for(var u=0;u<P0.SBMAX_s;u++)for(var b=0;b<3;b++)p.s[u][b]=s.s[u][b]}}var xi=Wi,ua,Ga;function ji(){if(Ga)return ua;Ga=1;var p=xi;function s(){this.thm=new p,this.en=new p}return ua=s,ua}var da,$a;function Qe(){if($a)return da;$a=1;var p=ge,s=p.System,u=p.VbrMode;p.Float,p.ShortBlock,p.Util,p.Arrays;var b=p.new_array_n;p.new_byte,p.new_double;var w=p.new_float,I=p.new_float_n,B=p.new_int;p.new_int_n;var k=p.assert;D.ENCDELAY=576,D.POSTDELAY=1152,D.MDCTDELAY=48,D.FFTOFFSET=224+D.MDCTDELAY,D.DECDELAY=528,D.SBLIMIT=32,D.CBANDS=64,D.SBPSY_l=21,D.SBPSY_s=12,D.SBMAX_l=22,D.SBMAX_s=13,D.PSFB21=6,D.PSFB12=6,D.BLKSIZE=1024,D.HBLKSIZE=D.BLKSIZE/2+1,D.BLKSIZE_s=256,D.HBLKSIZE_s=D.BLKSIZE_s/2+1,D.NORM_TYPE=0,D.START_TYPE=1,D.SHORT_TYPE=2,D.STOP_TYPE=3,D.MPG_MD_LR_LR=0,D.MPG_MD_LR_I=1,D.MPG_MD_MS_LR=2,D.MPG_MD_MS_I=3,D.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function D(){var T=$i(),V=ji(),y=D.FFTOFFSET,G=D.MPG_MD_MS_LR,Y=null;this.psy=null;var K=null,q=null,U=null;this.setModules=function(e,v,f,x){Y=e,this.psy=v,K=v,q=x,U=f};var L=new T;function _(e){var v,f;if(e.ATH.useAdjust==0){e.ATH.adjust=1;return}if(f=e.loudness_sq[0][0],v=e.loudness_sq[1][0],e.channels_out==2?(f+=e.loudness_sq[0][1],v+=e.loudness_sq[1][1]):(f+=f,v+=v),e.mode_gr==2&&(f=Math.max(f,v)),f*=.5,f*=e.ATH.aaSensitivityP,f>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var x=31.98*f+625e-6;e.ATH.adjust>=x?(e.ATH.adjust*=x*.075+.925,e.ATH.adjust<x&&(e.ATH.adjust=x)):e.ATH.adjustLimit>=x?e.ATH.adjust=x:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=x}}function m(e){var v,f;for(k(0<=e.bitrate_index&&e.bitrate_index<16),k(0<=e.mode_ext&&e.mode_ext<4),e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,e.channels_out==2&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),v=0;v<e.mode_gr;++v)for(f=0;f<e.channels_out;++f){var x=e.l3_side.tt[v][f].block_type|0;e.l3_side.tt[v][f].mixed_block_flag!=0&&(x=4),e.bitrate_blockType_Hist[e.bitrate_index][x]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][x]++,e.bitrate_blockType_Hist[15][5]++}}function E(e,v){var f=e.internal_flags,x,c;if(f.lame_encode_frame_init==0){var n,i,h=w(2014),r=w(286+1152+576);for(f.lame_encode_frame_init=1,n=0,i=0;n<286+576*(1+f.mode_gr);++n)n<576*f.mode_gr?(h[n]=0,f.channels_out==2&&(r[n]=0)):(h[n]=v[0][i],f.channels_out==2&&(r[n]=v[1][i]),++i);for(c=0;c<f.mode_gr;c++)for(x=0;x<f.channels_out;x++)f.l3_side.tt[c][x].block_type=D.SHORT_TYPE;L.mdct_sub48(f,h,r),k(576>=D.FFTOFFSET),k(f.mf_size>=D.BLKSIZE+e.framesize-D.FFTOFFSET),k(f.mf_size>=512+e.framesize-32)}}this.lame_encode_mp3_frame=function(e,v,f,x,c,n){var i,h=b([2,2]);h[0][0]=new V,h[0][1]=new V,h[1][0]=new V,h[1][1]=new V;var r=b([2,2]);r[0][0]=new V,r[0][1]=new V,r[1][0]=new V,r[1][1]=new V;var t,d=[null,null],l=e.internal_flags,F=I([2,4]),R=[.5,.5],O=[[0,0],[0,0]],a=[[0,0],[0,0]],o,H,g;if(d[0]=v,d[1]=f,l.lame_encode_frame_init==0&&E(e,d),l.padding=0,(l.slot_lag-=l.frac_SpF)<0&&(l.slot_lag+=e.out_samplerate,l.padding=1),l.psymodel!=0){var se,le=[null,null],re=0,oe=B(2);for(g=0;g<l.mode_gr;g++){for(H=0;H<l.channels_out;H++)le[H]=d[H],re=576+g*576-D.FFTOFFSET;if(e.VBR==u.vbr_mtrh||e.VBR==u.vbr_mt?se=K.L3psycho_anal_vbr(e,le,re,g,h,r,O[g],a[g],F[g],oe):se=K.L3psycho_anal_ns(e,le,re,g,h,r,O[g],a[g],F[g],oe),se!=0)return-4;for(e.mode==MPEGMode.JOINT_STEREO&&(R[g]=F[g][2]+F[g][3],R[g]>0&&(R[g]=F[g][3]/R[g])),H=0;H<l.channels_out;H++){var be=l.l3_side.tt[g][H];be.block_type=oe[H],be.mixed_block_flag=0}}}else for(g=0;g<l.mode_gr;g++)for(H=0;H<l.channels_out;H++)l.l3_side.tt[g][H].block_type=D.NORM_TYPE,l.l3_side.tt[g][H].mixed_block_flag=0,a[g][H]=O[g][H]=700;if(_(l),L.mdct_sub48(l,d[0],d[1]),l.mode_ext=D.MPG_MD_LR_LR,e.force_ms)l.mode_ext=D.MPG_MD_MS_LR;else if(e.mode==MPEGMode.JOINT_STEREO){var ce=0,ne=0;for(g=0;g<l.mode_gr;g++)for(H=0;H<l.channels_out;H++)ce+=a[g][H],ne+=O[g][H];if(ce<=1*ne){var Te=l.l3_side.tt[0],Fe=l.l3_side.tt[l.mode_gr-1];Te[0].block_type==Te[1].block_type&&Fe[0].block_type==Fe[1].block_type&&(l.mode_ext=D.MPG_MD_MS_LR)}}if(l.mode_ext==G?(t=r,o=a):(t=h,o=O),e.analysis&&l.pinfo!=null)for(g=0;g<l.mode_gr;g++)for(H=0;H<l.channels_out;H++)l.pinfo.ms_ratio[g]=l.ms_ratio[g],l.pinfo.ms_ener_ratio[g]=R[g],l.pinfo.blocktype[g][H]=l.l3_side.tt[g][H].block_type,l.pinfo.pe[g][H]=o[g][H],s.arraycopy(l.l3_side.tt[g][H].xr,0,l.pinfo.xr[g][H],0,576),l.mode_ext==G&&(l.pinfo.ers[g][H]=l.pinfo.ers[g][H+2],s.arraycopy(l.pinfo.energy[g][H+2],0,l.pinfo.energy[g][H],0,l.pinfo.energy[g][H].length));if(e.VBR==u.vbr_off||e.VBR==u.vbr_abr){var Ae,we;for(Ae=0;Ae<18;Ae++)l.nsPsy.pefirbuf[Ae]=l.nsPsy.pefirbuf[Ae+1];for(we=0,g=0;g<l.mode_gr;g++)for(H=0;H<l.channels_out;H++)we+=o[g][H];for(l.nsPsy.pefirbuf[18]=we,we=l.nsPsy.pefirbuf[9],Ae=0;Ae<9;Ae++)we+=(l.nsPsy.pefirbuf[Ae]+l.nsPsy.pefirbuf[18-Ae])*D.fircoef[Ae];for(we=670*5*l.mode_gr*l.channels_out/we,g=0;g<l.mode_gr;g++)for(H=0;H<l.channels_out;H++)o[g][H]*=we}if(l.iteration_loop.iteration_loop(e,o,R,t),Y.format_bitstream(e),i=Y.copy_buffer(l,x,c,n,1),e.bWriteVbrTag&&q.addVbrFrame(e),e.analysis&&l.pinfo!=null){for(H=0;H<l.channels_out;H++){var Me;for(Me=0;Me<y;Me++)l.pinfo.pcmdata[H][Me]=l.pinfo.pcmdata[H][Me+e.framesize];for(Me=y;Me<1600;Me++)l.pinfo.pcmdata[H][Me]=d[H][Me-y]}U.set_frame_pinfo(e,t)}return m(l),i}}return da=D,da}var lt=ge;lt.System;lt.VbrMode;lt.Float;lt.ShortBlock;var Ua=lt.Util;lt.Arrays;lt.new_array_n;lt.new_byte;lt.new_double;var Ka=lt.new_float;lt.new_float_n;lt.new_int;lt.new_int_n;lt.assert;var Ge=Qe();function Qi(){var p=Ka(Ge.BLKSIZE),s=Ka(Ge.BLKSIZE_s/2),u=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function b(I,B,k){var D=0,T,V,y;k<<=1;var G=B+k;T=4;do{var Y,K,q,U,L,_,m;m=T>>1,U=T,L=T<<1,_=L+U,T=L<<1,V=B,y=V+m;do{var E,e,v,f;e=I[V+0]-I[V+U],E=I[V+0]+I[V+U],f=I[V+L]-I[V+_],v=I[V+L]+I[V+_],I[V+L]=E-v,I[V+0]=E+v,I[V+_]=e-f,I[V+U]=e+f,e=I[y+0]-I[y+U],E=I[y+0]+I[y+U],f=Ua.SQRT2*I[y+_],v=Ua.SQRT2*I[y+L],I[y+L]=E-v,I[y+0]=E+v,I[y+_]=e-f,I[y+U]=e+f,y+=T,V+=T}while(V<G);for(K=u[D+0],Y=u[D+1],q=1;q<m;q++){var x,c;x=1-2*Y*Y,c=2*Y*K,V=B+q,y=B+U-q;do{var n,i,h,E,e,r,v,t,f,d;i=c*I[V+U]-x*I[y+U],n=x*I[V+U]+c*I[y+U],e=I[V+0]-n,E=I[V+0]+n,r=I[y+0]-i,h=I[y+0]+i,i=c*I[V+_]-x*I[y+_],n=x*I[V+_]+c*I[y+_],f=I[V+L]-n,v=I[V+L]+n,d=I[y+L]-i,t=I[y+L]+i,i=Y*v-K*d,n=K*v+Y*d,I[V+L]=E-n,I[V+0]=E+n,I[y+_]=r-i,I[y+U]=r+i,i=K*t-Y*f,n=Y*t+K*f,I[y+L]=h-n,I[y+0]=h+n,I[V+_]=e-i,I[V+U]=e+i,y+=T,V+=T}while(V<G);x=K,K=x*u[D+0]-Y*u[D+1],Y=x*u[D+1]+Y*u[D+0]}D+=2}while(T<k)}var w=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(I,B,k,D,T){for(var V=0;V<3;V++){var y=Ge.BLKSIZE_s/2,G=65535&576/3*(V+1),Y=Ge.BLKSIZE_s/8-1;do{var K,q,U,L,_,m=w[Y<<2]&255;K=s[m]*D[k][T+m+G],_=s[127-m]*D[k][T+m+G+128],q=K-_,K=K+_,U=s[m+64]*D[k][T+m+G+64],_=s[63-m]*D[k][T+m+G+192],L=U-_,U=U+_,y-=4,B[V][y+0]=K+U,B[V][y+2]=K-U,B[V][y+1]=q+L,B[V][y+3]=q-L,K=s[m+1]*D[k][T+m+G+1],_=s[126-m]*D[k][T+m+G+129],q=K-_,K=K+_,U=s[m+65]*D[k][T+m+G+65],_=s[62-m]*D[k][T+m+G+193],L=U-_,U=U+_,B[V][y+Ge.BLKSIZE_s/2+0]=K+U,B[V][y+Ge.BLKSIZE_s/2+2]=K-U,B[V][y+Ge.BLKSIZE_s/2+1]=q+L,B[V][y+Ge.BLKSIZE_s/2+3]=q-L}while(--Y>=0);b(B[V],y,Ge.BLKSIZE_s/2)}},this.fft_long=function(I,B,k,D,T){var V=Ge.BLKSIZE/8-1,y=Ge.BLKSIZE/2;do{var G,Y,K,q,U,L=w[V]&255;G=p[L]*D[k][T+L],U=p[L+512]*D[k][T+L+512],Y=G-U,G=G+U,K=p[L+256]*D[k][T+L+256],U=p[L+768]*D[k][T+L+768],q=K-U,K=K+U,y-=4,B[y+0]=G+K,B[y+2]=G-K,B[y+1]=Y+q,B[y+3]=Y-q,G=p[L+1]*D[k][T+L+1],U=p[L+513]*D[k][T+L+513],Y=G-U,G=G+U,K=p[L+257]*D[k][T+L+257],U=p[L+769]*D[k][T+L+769],q=K-U,K=K+U,B[y+Ge.BLKSIZE/2+0]=G+K,B[y+Ge.BLKSIZE/2+2]=G-K,B[y+Ge.BLKSIZE/2+1]=Y+q,B[y+Ge.BLKSIZE/2+3]=Y-q}while(--V>=0);b(B,y,Ge.BLKSIZE/2)},this.init_fft=function(I){for(var B=0;B<Ge.BLKSIZE;B++)p[B]=.42-.5*Math.cos(2*Math.PI*(B+.5)/Ge.BLKSIZE)+.08*Math.cos(4*Math.PI*(B+.5)/Ge.BLKSIZE);for(var B=0;B<Ge.BLKSIZE_s/2;B++)s[B]=.5*(1-Math.cos(2*Math.PI*(B+.5)/Ge.BLKSIZE_s))}}var zi=Qi,_t=ge;_t.System;var S0=_t.VbrMode,Za=_t.Float,y0=_t.ShortBlock,st=_t.Util,Ji=_t.Arrays;_t.new_array_n;_t.new_byte;_t.new_double;var $e=_t.new_float,Nt=_t.new_float_n,o0=_t.new_int;_t.new_int_n;var ue=_t.assert,es=zi,Q=Qe();function ts(){var p=new es,s=2.302585092994046,u=2,b=16,w=2,I=16,B=.34,k=1/(14752*14752)/(Q.BLKSIZE/2),D=.01,T=.8,V=.6,y=.3,G=3.5,Y=21,K=.2302585093;function q(A){return A}function U(A,S){for(var C=0,N=0;N<Q.BLKSIZE/2;++N)C+=A[N]*S.ATH.eql_w[N];return C*=k,C}function L(A,S,C,N,$,M,X,Z,P,z,W){var J=A.internal_flags;if(P<2)p.fft_long(J,N[$],P,z,W),p.fft_short(J,M[X],P,z,W);else if(P==2){for(var _e=Q.BLKSIZE-1;_e>=0;--_e){var fe=N[$+0][_e],te=N[$+1][_e];N[$+0][_e]=(fe+te)*st.SQRT2*.5,N[$+1][_e]=(fe-te)*st.SQRT2*.5}for(var me=2;me>=0;--me)for(var _e=Q.BLKSIZE_s-1;_e>=0;--_e){var fe=M[X+0][me][_e],te=M[X+1][me][_e];M[X+0][me][_e]=(fe+te)*st.SQRT2*.5,M[X+1][me][_e]=(fe-te)*st.SQRT2*.5}}S[0]=N[$+0][0],S[0]*=S[0];for(var _e=Q.BLKSIZE/2-1;_e>=0;--_e){var j=N[$+0][Q.BLKSIZE/2-_e],de=N[$+0][Q.BLKSIZE/2+_e];S[Q.BLKSIZE/2-_e]=(j*j+de*de)*.5}for(var me=2;me>=0;--me){C[me][0]=M[X+0][me][0],C[me][0]*=C[me][0];for(var _e=Q.BLKSIZE_s/2-1;_e>=0;--_e){var j=M[X+0][me][Q.BLKSIZE_s/2-_e],de=M[X+0][me][Q.BLKSIZE_s/2+_e];C[me][Q.BLKSIZE_s/2-_e]=(j*j+de*de)*.5}}{for(var ye=0,_e=11;_e<Q.HBLKSIZE;_e++)ye+=S[_e];J.tot_ener[P]=ye}if(A.analysis){for(var _e=0;_e<Q.HBLKSIZE;_e++)J.pinfo.energy[Z][P][_e]=J.pinfo.energy_save[P][_e],J.pinfo.energy_save[P][_e]=S[_e];J.pinfo.pe[Z][P]=J.pe[P]}A.athaa_loudapprox==2&&P<2&&(J.loudness_sq[Z][P]=J.loudness_sq_save[P],J.loudness_sq_save[P]=U(S,J))}var _=8,m=23,E=15,e,v,f,x=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function c(){e=Math.pow(10,(_+1)/16),v=Math.pow(10,(m+1)/16),f=Math.pow(10,E/10)}var n=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],i=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],h=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function r(A,S,C,N,$,M){var X;if(S>A)if(S<A*v)X=S/A;else return A+S;else{if(A>=S*v)return A+S;X=A/S}if(ue(A>=0),ue(S>=0),A+=S,N+3<=3+3){if(X>=e)return A;var Z=0|st.FAST_LOG10_X(X,16);return A*i[Z]}var Z=0|st.FAST_LOG10_X(X,16);if(M!=0?S=$.ATH.cb_s[C]*$.ATH.adjust:S=$.ATH.cb_l[C]*$.ATH.adjust,ue(S>=0),A<f*S){if(A>S){var P,z;return P=1,Z<=13&&(P=h[Z]),z=st.FAST_LOG10_X(A/S,10/15),A*((n[Z]-P)*z+P)}return Z>13?A:A*h[Z]}return A*n[Z]}var t=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function d(A,S,C){var N;if(A<0&&(A=0),S<0&&(S=0),A<=0)return S;if(S<=0)return A;if(S>A?N=S/A:N=A/S,-2<=C&&C<=2){if(N>=e)return A+S;var $=0|st.FAST_LOG10_X(N,16);return(A+S)*t[$]}return N<v?A+S:(A<S&&(A=S),A)}function l(A,S){var C=A.internal_flags;if(C.channels_out>1){for(var N=0;N<Q.SBMAX_l;N++){var $=C.thm[0].l[N],M=C.thm[1].l[N];C.thm[0].l[N]+=M*S,C.thm[1].l[N]+=$*S}for(var N=0;N<Q.SBMAX_s;N++)for(var X=0;X<3;X++){var $=C.thm[0].s[N][X],M=C.thm[1].s[N][X];C.thm[0].s[N][X]+=M*S,C.thm[1].s[N][X]+=$*S}}}function F(A){for(var S=0;S<Q.SBMAX_l;S++)if(!(A.thm[0].l[S]>1.58*A.thm[1].l[S]||A.thm[1].l[S]>1.58*A.thm[0].l[S])){var C=A.mld_l[S]*A.en[3].l[S],N=Math.max(A.thm[2].l[S],Math.min(A.thm[3].l[S],C));C=A.mld_l[S]*A.en[2].l[S];var $=Math.max(A.thm[3].l[S],Math.min(A.thm[2].l[S],C));A.thm[2].l[S]=N,A.thm[3].l[S]=$}for(var S=0;S<Q.SBMAX_s;S++)for(var M=0;M<3;M++)if(!(A.thm[0].s[S][M]>1.58*A.thm[1].s[S][M]||A.thm[1].s[S][M]>1.58*A.thm[0].s[S][M])){var C=A.mld_s[S]*A.en[3].s[S][M],N=Math.max(A.thm[2].s[S][M],Math.min(A.thm[3].s[S][M],C));C=A.mld_s[S]*A.en[2].s[S][M];var $=Math.max(A.thm[3].s[S][M],Math.min(A.thm[2].s[S][M],C));A.thm[2].s[S][M]=N,A.thm[3].s[S][M]=$}}function R(A,S,C){var N=S,$=Math.pow(10,C);S*=2,N*=2;for(var M=0;M<Q.SBMAX_l;M++){var X,Z,P,z;if(z=A.ATH.cb_l[A.bm_l[M]]*$,X=Math.min(Math.max(A.thm[0].l[M],z),Math.max(A.thm[1].l[M],z)),Z=Math.max(A.thm[2].l[M],z),P=Math.max(A.thm[3].l[M],z),X*S<Z+P){var W=X*N/(Z+P);Z*=W,P*=W,ue(Z+P>0)}A.thm[2].l[M]=Math.min(Z,A.thm[2].l[M]),A.thm[3].l[M]=Math.min(P,A.thm[3].l[M])}$*=Q.BLKSIZE_s/Q.BLKSIZE;for(var M=0;M<Q.SBMAX_s;M++)for(var J=0;J<3;J++){var X,Z,P,z;if(z=A.ATH.cb_s[A.bm_s[M]]*$,X=Math.min(Math.max(A.thm[0].s[M][J],z),Math.max(A.thm[1].s[M][J],z)),Z=Math.max(A.thm[2].s[M][J],z),P=Math.max(A.thm[3].s[M][J],z),X*S<Z+P){var W=X*S/(Z+P);Z*=W,P*=W,ue(Z+P>0)}A.thm[2].s[M][J]=Math.min(A.thm[2].s[M][J],Z),A.thm[3].s[M][J]=Math.min(A.thm[3].s[M][J],P)}}function O(A,S,C,N,$){var M,X,Z=0,P=0;for(M=X=0;M<Q.SBMAX_s;++X,++M){for(var z=A.bo_s[M],W=A.npart_s,J=z<W?z:W;X<J;)ue(S[X]>=0),ue(C[X]>=0),Z+=S[X],P+=C[X],X++;if(A.en[N].s[M][$]=Z,A.thm[N].s[M][$]=P,X>=W){++M;break}ue(S[X]>=0),ue(C[X]>=0);{var _e=A.PSY.bo_s_weight[M],fe=1-_e;Z=_e*S[X],P=_e*C[X],A.en[N].s[M][$]+=Z,A.thm[N].s[M][$]+=P,Z=fe*S[X],P=fe*C[X]}}for(;M<Q.SBMAX_s;++M)A.en[N].s[M][$]=0,A.thm[N].s[M][$]=0}function a(A,S,C,N){var $,M,X=0,Z=0;for($=M=0;$<Q.SBMAX_l;++M,++$){for(var P=A.bo_l[$],z=A.npart_l,W=P<z?P:z;M<W;)ue(S[M]>=0),ue(C[M]>=0),X+=S[M],Z+=C[M],M++;if(A.en[N].l[$]=X,A.thm[N].l[$]=Z,M>=z){++$;break}ue(S[M]>=0),ue(C[M]>=0);{var J=A.PSY.bo_l_weight[$],_e=1-J;X=J*S[M],Z=J*C[M],A.en[N].l[$]+=X,A.thm[N].l[$]+=Z,X=_e*S[M],Z=_e*C[M]}}for(;$<Q.SBMAX_l;++$)A.en[N].l[$]=0,A.thm[N].l[$]=0}function o(A,S,C,N,$,M){var X=A.internal_flags,Z,P;for(P=Z=0;P<X.npart_s;++P){for(var z=0,W=X.numlines_s[P],J=0;J<W;++J,++Z){var _e=S[M][Z];z+=_e}C[P]=z}for(ue(P==X.npart_s),ue(Z==129),Z=P=0;P<X.npart_s;P++){var fe=X.s3ind_s[P][0],te=X.s3_ss[Z++]*C[fe];for(++fe;fe<=X.s3ind_s[P][1];)te+=X.s3_ss[Z]*C[fe],++Z,++fe;{var me=w*X.nb_s1[$][P];N[P]=Math.min(te,me)}if(X.blocktype_old[$&1]==Q.SHORT_TYPE){var me=I*X.nb_s2[$][P],j=N[P];N[P]=Math.min(me,j)}X.nb_s2[$][P]=X.nb_s1[$][P],X.nb_s1[$][P]=te,ue(N[P]>=0)}for(;P<=Q.CBANDS;++P)C[P]=0,N[P]=0}function H(A,S,C,N){var $=A.internal_flags;A.short_blocks==y0.short_block_coupled&&!(S[0]!=0&&S[1]!=0)&&(S[0]=S[1]=0);for(var M=0;M<$.channels_out;M++)N[M]=Q.NORM_TYPE,A.short_blocks==y0.short_block_dispensed&&(S[M]=1),A.short_blocks==y0.short_block_forced&&(S[M]=0),S[M]!=0?(ue($.blocktype_old[M]!=Q.START_TYPE),$.blocktype_old[M]==Q.SHORT_TYPE&&(N[M]=Q.STOP_TYPE)):(N[M]=Q.SHORT_TYPE,$.blocktype_old[M]==Q.NORM_TYPE&&($.blocktype_old[M]=Q.START_TYPE),$.blocktype_old[M]==Q.STOP_TYPE&&($.blocktype_old[M]=Q.SHORT_TYPE)),C[M]=$.blocktype_old[M],$.blocktype_old[M]=N[M]}function g(A,S,C){return C>=1?A:C<=0?S:S>0?Math.pow(A/S,C)*S:0}var se=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function le(A,S){for(var C=309.07,N=0;N<Q.SBMAX_s-1;N++)for(var $=0;$<3;$++){var M=A.thm.s[N][$];if(ue(N<se.length),M>0){var X=M*S,Z=A.en.s[N][$];Z>X&&(Z>X*1e10?C+=se[N]*(10*s):(ue(X>0),C+=se[N]*st.FAST_LOG10(Z/X)))}}return C}var re=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function oe(A,S){for(var C=281.0575,N=0;N<Q.SBMAX_l-1;N++){var $=A.thm.l[N];if(ue(N<re.length),$>0){var M=$*S,X=A.en.l[N];X>M&&(X>M*1e10?C+=re[N]*(10*s):(ue(M>0),C+=re[N]*st.FAST_LOG10(X/M)))}}return C}function be(A,S,C,N,$){var M,X;for(M=X=0;M<A.npart_l;++M){var Z=0,P=0,z;for(z=0;z<A.numlines_l[M];++z,++X){var W=S[X];ue(W>=0),Z+=W,P<W&&(P=W)}C[M]=Z,N[M]=P,$[M]=Z*A.rnumlines_l[M],ue(A.rnumlines_l[M]>=0),ue(Z>=0),ue(C[M]>=0),ue(N[M]>=0),ue($[M]>=0)}}function ce(A,S,C,N){var $=x.length-1,M=0,X=C[M]+C[M+1];if(ue(X>=0),X>0){var Z=S[M];Z<S[M+1]&&(Z=S[M+1]),ue(A.numlines_l[M]+A.numlines_l[M+1]-1>0),X=20*(Z*2-X)/(X*(A.numlines_l[M]+A.numlines_l[M+1]-1));var P=0|X;P>$&&(P=$),N[M]=P}else N[M]=0;for(M=1;M<A.npart_l-1;M++)if(X=C[M-1]+C[M]+C[M+1],ue(X>=0),X>0){var Z=S[M-1];Z<S[M]&&(Z=S[M]),Z<S[M+1]&&(Z=S[M+1]),ue(A.numlines_l[M-1]+A.numlines_l[M]+A.numlines_l[M+1]-1>0),X=20*(Z*3-X)/(X*(A.numlines_l[M-1]+A.numlines_l[M]+A.numlines_l[M+1]-1));var P=0|X;P>$&&(P=$),N[M]=P}else N[M]=0;if(ue(M>0),ue(M==A.npart_l-1),X=C[M-1]+C[M],ue(X>=0),X>0){var Z=S[M-1];Z<S[M]&&(Z=S[M]),ue(A.numlines_l[M-1]+A.numlines_l[M]-1>0),X=20*(Z*2-X)/(X*(A.numlines_l[M-1]+A.numlines_l[M]-1));var P=0|X;P>$&&(P=$),N[M]=P}else N[M]=0;ue(M==A.npart_l-1)}var ne=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(A,S,C,N,$,M,X,Z,P,z){var W=A.internal_flags,J=Nt([2,Q.BLKSIZE]),_e=Nt([2,3,Q.BLKSIZE_s]),fe=$e(Q.CBANDS+1),te=$e(Q.CBANDS+1),me=$e(Q.CBANDS+2),j=o0(2),de=o0(2),ye,ae,ve,ee,pe,Le,he,Ee,xe=Nt([2,576]),Ne,Rt=o0(Q.CBANDS+2),Ye=o0(Q.CBANDS+2);for(Ji.fill(Ye,0),ye=W.channels_out,A.mode==MPEGMode.JOINT_STEREO&&(ye=4),A.VBR==S0.vbr_off?Ne=W.ResvMax==0?0:W.ResvSize/W.ResvMax*.5:A.VBR==S0.vbr_rh||A.VBR==S0.vbr_mtrh||A.VBR==S0.vbr_mt?Ne=.6:Ne=1,ae=0;ae<W.channels_out;ae++){var ke=S[ae],at=C+576-350-Y+192;for(ue(ne.length==(Y-1)/2),ee=0;ee<576;ee++){var It,Ct;for(It=ke[at+ee+10],Ct=0,pe=0;pe<(Y-1)/2-1;pe+=2)It+=ne[pe]*(ke[at+ee+pe]+ke[at+ee+Y-pe]),Ct+=ne[pe+1]*(ke[at+ee+pe+1]+ke[at+ee+Y-pe-1]);xe[ae][ee]=It+Ct}$[N][ae].en.assign(W.en[ae]),$[N][ae].thm.assign(W.thm[ae]),ye>2&&(M[N][ae].en.assign(W.en[ae+2]),M[N][ae].thm.assign(W.thm[ae+2]))}for(ae=0;ae<ye;ae++){var Pt,qt,je=$e(12),Ut=[0,0,0,0],E0=$e(12),ta=1,Ha,ga=$e(Q.CBANDS),Fa=$e(Q.CBANDS),He=[0,0,0,0],Va=$e(Q.HBLKSIZE),Pa=Nt([3,Q.HBLKSIZE_s]);for(ue(W.npart_s<=Q.CBANDS),ue(W.npart_l<=Q.CBANDS),ee=0;ee<3;ee++)je[ee]=W.nsPsy.last_en_subshort[ae][ee+6],ue(W.nsPsy.last_en_subshort[ae][ee+4]>0),E0[ee]=je[ee]/W.nsPsy.last_en_subshort[ae][ee+4],Ut[0]+=je[ee];if(ae==2)for(ee=0;ee<576;ee++){var aa,ia;aa=xe[0][ee],ia=xe[1][ee],xe[0][ee]=aa+ia,xe[1][ee]=aa-ia}{var qa=xe[ae&1],M0=0;for(ee=0;ee<9;ee++){for(var ki=M0+64,Ze=1;M0<ki;M0++)Ze<Math.abs(qa[M0])&&(Ze=Math.abs(qa[M0]));W.nsPsy.last_en_subshort[ae][ee]=je[ee+3]=Ze,Ut[1+ee/3]+=Ze,Ze>je[ee+3-2]?(ue(je[ee+3-2]>0),Ze=Ze/je[ee+3-2]):je[ee+3-2]>Ze*10?(ue(Ze>0),Ze=je[ee+3-2]/(Ze*10)):Ze=0,E0[ee+3]=Ze}}if(A.analysis){var sa=E0[0];for(ee=1;ee<12;ee++)sa<E0[ee]&&(sa=E0[ee]);W.pinfo.ers[N][ae]=W.pinfo.ers_save[ae],W.pinfo.ers_save[ae]=sa}for(Ha=ae==3?W.nsPsy.attackthre_s:W.nsPsy.attackthre,ee=0;ee<12;ee++)He[ee/3]==0&&E0[ee]>Ha&&(He[ee/3]=ee%3+1);for(ee=1;ee<4;ee++){var na;Ut[ee-1]>Ut[ee]?(ue(Ut[ee]>0),na=Ut[ee-1]/Ut[ee]):(ue(Ut[ee-1]>0),na=Ut[ee]/Ut[ee-1]),na<1.7&&(He[ee]=0,ee==1&&(He[0]=0))}for(He[0]!=0&&W.nsPsy.lastAttacks[ae]!=0&&(He[0]=0),(W.nsPsy.lastAttacks[ae]==3||He[0]+He[1]+He[2]+He[3]!=0)&&(ta=0,He[1]!=0&&He[0]!=0&&(He[1]=0),He[2]!=0&&He[1]!=0&&(He[2]=0),He[3]!=0&&He[2]!=0&&(He[3]=0)),ae<2?de[ae]=ta:ta==0&&(de[0]=de[1]=0),P[ae]=W.tot_ener[ae],qt=_e,Pt=J,L(A,Va,Pa,Pt,ae&1,qt,ae&1,N,ae,S,C),be(W,Va,fe,ga,Fa),ce(W,ga,Fa,Rt),Ee=0;Ee<3;Ee++){var ra,it;for(o(A,Pa,te,me,ae,Ee),O(W,te,me,ae,Ee),he=0;he<Q.SBMAX_s;he++){if(it=W.thm[ae].s[he][Ee],it*=T,He[Ee]>=2||He[Ee+1]==1){var w0=Ee!=0?Ee-1:2,Ze=g(W.thm[ae].s[he][w0],it,V*Ne);it=Math.min(it,Ze)}if(He[Ee]==1){var w0=Ee!=0?Ee-1:2,Ze=g(W.thm[ae].s[he][w0],it,y*Ne);it=Math.min(it,Ze)}else if(Ee!=0&&He[Ee-1]==3||Ee==0&&W.nsPsy.lastAttacks[ae]==3){var w0=Ee!=2?Ee+1:0,Ze=g(W.thm[ae].s[he][w0],it,y*Ne);it=Math.min(it,Ze)}ra=je[Ee*3+3]+je[Ee*3+4]+je[Ee*3+5],je[Ee*3+5]*6<ra&&(it*=.5,je[Ee*3+4]*6<ra&&(it*=.5)),W.thm[ae].s[he][Ee]=it}}for(W.nsPsy.lastAttacks[ae]=He[2],Le=0,ve=0;ve<W.npart_l;ve++){for(var n0=W.s3ind[ve][0],oa=fe[n0]*x[Rt[n0]],r0=W.s3_ll[Le++]*oa;++n0<=W.s3ind[ve][1];)oa=fe[n0]*x[Rt[n0]],r0=r(r0,W.s3_ll[Le++]*oa,n0,n0-ve,W,0);r0*=.158489319246111,W.blocktype_old[ae&1]==Q.SHORT_TYPE?me[ve]=r0:me[ve]=g(Math.min(r0,Math.min(u*W.nb_1[ae][ve],b*W.nb_2[ae][ve])),r0,Ne),W.nb_2[ae][ve]=W.nb_1[ae][ve],W.nb_1[ae][ve]=r0}for(;ve<=Q.CBANDS;++ve)fe[ve]=0,me[ve]=0;a(W,fe,me,ae)}if((A.mode==MPEGMode.STEREO||A.mode==MPEGMode.JOINT_STEREO)&&A.interChRatio>0&&l(A,A.interChRatio),A.mode==MPEGMode.JOINT_STEREO){var la;F(W),la=A.msfix,Math.abs(la)>0&&R(W,la,A.ATHlower*W.ATH.adjust)}for(H(A,de,z,j),ae=0;ae<ye;ae++){var B0,R0=0,g0,F0;ae>1?(B0=Z,R0=-2,g0=Q.NORM_TYPE,(z[0]==Q.SHORT_TYPE||z[1]==Q.SHORT_TYPE)&&(g0=Q.SHORT_TYPE),F0=M[N][ae-2]):(B0=X,R0=0,g0=z[ae],F0=$[N][ae]),g0==Q.SHORT_TYPE?B0[R0+ae]=le(F0,W.masking_lower):B0[R0+ae]=oe(F0,W.masking_lower),A.analysis&&(W.pinfo.pe[N][ae]=B0[R0+ae])}return 0};function Te(A,S,C,N,$,M,X,Z){var P=A.internal_flags;if(N<2)p.fft_long(P,X[Z],N,S,C);else if(N==2)for(var z=Q.BLKSIZE-1;z>=0;--z){var W=X[Z+0][z],J=X[Z+1][z];X[Z+0][z]=(W+J)*st.SQRT2*.5,X[Z+1][z]=(W-J)*st.SQRT2*.5}M[0]=X[Z+0][0],M[0]*=M[0];for(var z=Q.BLKSIZE/2-1;z>=0;--z){var _e=X[Z+0][Q.BLKSIZE/2-z],fe=X[Z+0][Q.BLKSIZE/2+z];M[Q.BLKSIZE/2-z]=(_e*_e+fe*fe)*.5}{for(var te=0,z=11;z<Q.HBLKSIZE;z++)te+=M[z];P.tot_ener[N]=te}if(A.analysis){for(var z=0;z<Q.HBLKSIZE;z++)P.pinfo.energy[$][N][z]=P.pinfo.energy_save[N][z],P.pinfo.energy_save[N][z]=M[z];P.pinfo.pe[$][N]=P.pe[N]}}function Fe(A,S,C,N,$,M,X,Z){var P=A.internal_flags;if($==0&&N<2&&p.fft_short(P,X[Z],N,S,C),N==2)for(var z=Q.BLKSIZE_s-1;z>=0;--z){var W=X[Z+0][$][z],J=X[Z+1][$][z];X[Z+0][$][z]=(W+J)*st.SQRT2*.5,X[Z+1][$][z]=(W-J)*st.SQRT2*.5}M[$][0]=X[Z+0][$][0],M[$][0]*=M[$][0];for(var z=Q.BLKSIZE_s/2-1;z>=0;--z){var _e=X[Z+0][$][Q.BLKSIZE_s/2-z],fe=X[Z+0][$][Q.BLKSIZE_s/2+z];M[$][Q.BLKSIZE_s/2-z]=(_e*_e+fe*fe)*.5}}function Ae(A,S,C,N){var $=A.internal_flags;A.athaa_loudapprox==2&&C<2&&($.loudness_sq[S][C]=$.loudness_sq_save[C],$.loudness_sq_save[C]=U(N,$))}var we=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function Me(A,S,C,N,$,M,X,Z,P,z){for(var W=Nt([2,576]),J=A.internal_flags,_e=J.channels_out,fe=A.mode==MPEGMode.JOINT_STEREO?4:_e,te=0;te<_e;te++){firbuf=S[te];var me=C+576-350-Y+192;ue(we.length==(Y-1)/2);for(var j=0;j<576;j++){var de,ye;de=firbuf[me+j+10],ye=0;for(var ae=0;ae<(Y-1)/2-1;ae+=2)de+=we[ae]*(firbuf[me+j+ae]+firbuf[me+j+Y-ae]),ye+=we[ae+1]*(firbuf[me+j+ae+1]+firbuf[me+j+Y-ae-1]);W[te][j]=de+ye}$[N][te].en.assign(J.en[te]),$[N][te].thm.assign(J.thm[te]),fe>2&&(M[N][te].en.assign(J.en[te+2]),M[N][te].thm.assign(J.thm[te+2]))}for(var te=0;te<fe;te++){var ve=$e(12),ee=$e(12),pe=[0,0,0,0],Le=W[te&1],he=0,Ee=te==3?J.nsPsy.attackthre_s:J.nsPsy.attackthre,xe=1;if(te==2)for(var j=0,ae=576;ae>0;++j,--ae){var Ne=W[0][j],Rt=W[1][j];W[0][j]=Ne+Rt,W[1][j]=Ne-Rt}for(var j=0;j<3;j++)ee[j]=J.nsPsy.last_en_subshort[te][j+6],ue(J.nsPsy.last_en_subshort[te][j+4]>0),ve[j]=ee[j]/J.nsPsy.last_en_subshort[te][j+4],pe[0]+=ee[j];for(var j=0;j<9;j++){for(var Ye=he+64,ke=1;he<Ye;he++)ke<Math.abs(Le[he])&&(ke=Math.abs(Le[he]));J.nsPsy.last_en_subshort[te][j]=ee[j+3]=ke,pe[1+j/3]+=ke,ke>ee[j+3-2]?(ue(ee[j+3-2]>0),ke=ke/ee[j+3-2]):ee[j+3-2]>ke*10?(ue(ke>0),ke=ee[j+3-2]/(ke*10)):ke=0,ve[j+3]=ke}for(var j=0;j<3;++j){var at=ee[j*3+3]+ee[j*3+4]+ee[j*3+5],It=1;ee[j*3+5]*6<at&&(It*=.5,ee[j*3+4]*6<at&&(It*=.5)),Z[te][j]=It}if(A.analysis){for(var Ct=ve[0],j=1;j<12;j++)Ct<ve[j]&&(Ct=ve[j]);J.pinfo.ers[N][te]=J.pinfo.ers_save[te],J.pinfo.ers_save[te]=Ct}for(var j=0;j<12;j++)P[te][j/3]==0&&ve[j]>Ee&&(P[te][j/3]=j%3+1);for(var j=1;j<4;j++){var Pt=pe[j-1],qt=pe[j],je=Math.max(Pt,qt);je<4e4&&Pt<1.7*qt&&qt<1.7*Pt&&(j==1&&P[te][0]<=P[te][j]&&(P[te][0]=0),P[te][j]=0)}P[te][0]<=J.nsPsy.lastAttacks[te]&&(P[te][0]=0),(J.nsPsy.lastAttacks[te]==3||P[te][0]+P[te][1]+P[te][2]+P[te][3]!=0)&&(xe=0,P[te][1]!=0&&P[te][0]!=0&&(P[te][1]=0),P[te][2]!=0&&P[te][1]!=0&&(P[te][2]=0),P[te][3]!=0&&P[te][2]!=0&&(P[te][3]=0)),te<2?z[te]=xe:xe==0&&(z[0]=z[1]=0),X[te]=J.tot_ener[te]}}function qe(A,S,C){if(C==0)for(var N=0;N<A.npart_s;N++)A.nb_s2[S][N]=A.nb_s1[S][N],A.nb_s1[S][N]=0}function Ke(A,S){for(var C=0;C<A.npart_l;C++)A.nb_2[S][C]=A.nb_1[S][C],A.nb_1[S][C]=0}function $t(A,S,C,N){var $=x.length-1,M=0,X=C[M]+C[M+1];if(ue(X>=0),X>0){var Z=S[M];Z<S[M+1]&&(Z=S[M+1]),ue(A.numlines_s[M]+A.numlines_s[M+1]-1>0),X=20*(Z*2-X)/(X*(A.numlines_s[M]+A.numlines_s[M+1]-1));var P=0|X;P>$&&(P=$),N[M]=P}else N[M]=0;for(M=1;M<A.npart_s-1;M++)if(X=C[M-1]+C[M]+C[M+1],ue(M+1<A.npart_s),ue(X>=0),X>0){var Z=S[M-1];Z<S[M]&&(Z=S[M]),Z<S[M+1]&&(Z=S[M+1]),ue(A.numlines_s[M-1]+A.numlines_s[M]+A.numlines_s[M+1]-1>0),X=20*(Z*3-X)/(X*(A.numlines_s[M-1]+A.numlines_s[M]+A.numlines_s[M+1]-1));var P=0|X;P>$&&(P=$),N[M]=P}else N[M]=0;if(ue(M>0),ue(M==A.npart_s-1),X=C[M-1]+C[M],ue(X>=0),X>0){var Z=S[M-1];Z<S[M]&&(Z=S[M]),ue(A.numlines_s[M-1]+A.numlines_s[M]-1>0),X=20*(Z*2-X)/(X*(A.numlines_s[M-1]+A.numlines_s[M]-1));var P=0|X;P>$&&(P=$),N[M]=P}else N[M]=0;ue(M==A.npart_s-1)}function wt(A,S,C,N,$,M){var X=A.internal_flags,Z=new float[Q.CBANDS],P=$e(Q.CBANDS),z,W,J,_e=new int[Q.CBANDS];for(J=W=0;J<X.npart_s;++J){var fe=0,te=0,me=X.numlines_s[J];for(z=0;z<me;++z,++W){var j=S[M][W];fe+=j,te<j&&(te=j)}C[J]=fe,ue(fe>=0),Z[J]=te,ue(me>0),P[J]=fe/me,ue(P[J]>=0)}for(ue(J==X.npart_s),ue(W==129);J<Q.CBANDS;++J)Z[J]=0,P[J]=0;for($t(X,Z,P,_e),W=J=0;J<X.npart_s;J++){var de=X.s3ind_s[J][0],ye=X.s3ind_s[J][1],ae,ve,ee,pe,Le;for(ae=_e[de],ve=1,pe=X.s3_ss[W]*C[de]*x[_e[de]],++W,++de;de<=ye;)ae+=_e[de],ve+=1,ee=X.s3_ss[W]*C[de]*x[_e[de]],pe=d(pe,ee,de-J),++W,++de;ae=(1+2*ae)/(2*ve),Le=x[ae]*.5,pe*=Le,N[J]=pe,X.nb_s2[$][J]=X.nb_s1[$][J],X.nb_s1[$][J]=pe,ee=Z[J],ee*=X.minval_s[J],ee*=Le,N[J]>ee&&(N[J]=ee),X.masking_lower>1&&(N[J]*=X.masking_lower),N[J]>C[J]&&(N[J]=C[J]),X.masking_lower<1&&(N[J]*=X.masking_lower),ue(N[J]>=0)}for(;J<Q.CBANDS;++J)C[J]=0,N[J]=0}function tt(A,S,C,N,$){var M=$e(Q.CBANDS),X=$e(Q.CBANDS),Z=o0(Q.CBANDS+2),P;be(A,S,C,M,X),ce(A,M,X,Z);var z=0;for(P=0;P<A.npart_l;P++){var W,J,_e,fe,te=A.s3ind[P][0],me=A.s3ind[P][1],j=0,de=0;for(j=Z[te],de+=1,J=A.s3_ll[z]*C[te]*x[Z[te]],++z,++te;te<=me;)j+=Z[te],de+=1,W=A.s3_ll[z]*C[te]*x[Z[te]],fe=d(J,W,te-P),J=fe,++z,++te;if(j=(1+2*j)/(2*de),_e=x[j]*.5,J*=_e,A.blocktype_old[$&1]==Q.SHORT_TYPE){var ye=u*A.nb_1[$][P];ye>0?N[P]=Math.min(J,ye):N[P]=Math.min(J,C[P]*y)}else{var ae=b*A.nb_2[$][P],ve=u*A.nb_1[$][P],ye;ae<=0&&(ae=J),ve<=0&&(ve=J),A.blocktype_old[$&1]==Q.NORM_TYPE?ye=Math.min(ve,ae):ye=ve,N[P]=Math.min(J,ye)}A.nb_2[$][P]=A.nb_1[$][P],A.nb_1[$][P]=J,W=M[P],W*=A.minval_l[P],W*=_e,N[P]>W&&(N[P]=W),A.masking_lower>1&&(N[P]*=A.masking_lower),N[P]>C[P]&&(N[P]=C[P]),A.masking_lower<1&&(N[P]*=A.masking_lower),ue(N[P]>=0)}for(;P<Q.CBANDS;++P)C[P]=0,N[P]=0}function Vt(A,S){var C=A.internal_flags;A.short_blocks==y0.short_block_coupled&&!(S[0]!=0&&S[1]!=0)&&(S[0]=S[1]=0);for(var N=0;N<C.channels_out;N++)A.short_blocks==y0.short_block_dispensed&&(S[N]=1),A.short_blocks==y0.short_block_forced&&(S[N]=0)}function i0(A,S,C){for(var N=A.internal_flags,$=0;$<N.channels_out;$++){var M=Q.NORM_TYPE;S[$]!=0?(ue(N.blocktype_old[$]!=Q.START_TYPE),N.blocktype_old[$]==Q.SHORT_TYPE&&(M=Q.STOP_TYPE)):(M=Q.SHORT_TYPE,N.blocktype_old[$]==Q.NORM_TYPE&&(N.blocktype_old[$]=Q.START_TYPE),N.blocktype_old[$]==Q.STOP_TYPE&&(N.blocktype_old[$]=Q.SHORT_TYPE)),C[$]=N.blocktype_old[$],N.blocktype_old[$]=M}}function t0(A,S,C,N,$,M,X){for(var Z=M*2,P=M>0?Math.pow(10,$):1,z,W,J=0;J<X;++J){var _e=A[2][J],fe=A[3][J],te=S[0][J],me=S[1][J],j=S[2][J],de=S[3][J];if(te<=1.58*me&&me<=1.58*te){var ye=C[J]*fe,ae=C[J]*_e;W=Math.max(j,Math.min(de,ye)),z=Math.max(de,Math.min(j,ae))}else W=j,z=de;if(M>0){var ve,ee,pe=N[J]*P;if(ve=Math.min(Math.max(te,pe),Math.max(me,pe)),j=Math.max(W,pe),de=Math.max(z,pe),ee=j+de,ee>0&&ve*Z<ee){var Le=ve*Z/ee;j*=Le,de*=Le,ue(ee>0)}W=Math.min(j,W),z=Math.min(de,z)}W>_e&&(W=_e),z>fe&&(z=fe),S[2][J]=W,S[3][J]=z}}this.L3psycho_anal_vbr=function(A,S,C,N,$,M,X,Z,P,z){var W=A.internal_flags,J,_e,fe=$e(Q.HBLKSIZE),te=Nt([3,Q.HBLKSIZE_s]),me=Nt([2,Q.BLKSIZE]),j=Nt([2,3,Q.BLKSIZE_s]),de=Nt([4,Q.CBANDS]),ye=Nt([4,Q.CBANDS]),ae=Nt([4,3]),ve=.6,ee=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],pe=o0(2),Le=A.mode==MPEGMode.JOINT_STEREO?4:W.channels_out;Me(A,S,C,N,$,M,P,ae,ee,pe),Vt(A,pe);{for(var he=0;he<Le;he++){var Ee=he&1;J=me,Te(A,S,C,he,N,fe,J,Ee),Ae(A,N,he,fe),pe[Ee]!=0?tt(W,fe,de[he],ye[he],he):Ke(W,he)}pe[0]+pe[1]==2&&A.mode==MPEGMode.JOINT_STEREO&&t0(de,ye,W.mld_cb_l,W.ATH.cb_l,A.ATHlower*W.ATH.adjust,A.msfix,W.npart_l);for(var he=0;he<Le;he++){var Ee=he&1;pe[Ee]!=0&&a(W,de[he],ye[he],he)}}{for(var xe=0;xe<3;xe++){for(var he=0;he<Le;++he){var Ee=he&1;pe[Ee]!=0?qe(W,he,xe):(_e=j,Fe(A,S,C,he,xe,te,_e,Ee),wt(A,te,de[he],ye[he],he,xe))}pe[0]+pe[1]==0&&A.mode==MPEGMode.JOINT_STEREO&&t0(de,ye,W.mld_cb_s,W.ATH.cb_s,A.ATHlower*W.ATH.adjust,A.msfix,W.npart_s);for(var he=0;he<Le;++he){var Ee=he&1;pe[Ee]==0&&O(W,de[he],ye[he],he,xe)}}for(var he=0;he<Le;he++){var Ee=he&1;if(pe[Ee]==0)for(var Ne=0;Ne<Q.SBMAX_s;Ne++){for(var Rt=$e(3),xe=0;xe<3;xe++){var Ye=W.thm[he].s[Ne][xe];if(Ye*=T,ee[he][xe]>=2||ee[he][xe+1]==1){var ke=xe!=0?xe-1:2,at=g(W.thm[he].s[Ne][ke],Ye,V*ve);Ye=Math.min(Ye,at)}else if(ee[he][xe]==1){var ke=xe!=0?xe-1:2,at=g(W.thm[he].s[Ne][ke],Ye,y*ve);Ye=Math.min(Ye,at)}else if(xe!=0&&ee[he][xe-1]==3||xe==0&&W.nsPsy.lastAttacks[he]==3){var ke=xe!=2?xe+1:0,at=g(W.thm[he].s[Ne][ke],Ye,y*ve);Ye=Math.min(Ye,at)}Ye*=ae[he][xe],Rt[xe]=Ye}for(var xe=0;xe<3;xe++)W.thm[he].s[Ne][xe]=Rt[xe]}}}for(var he=0;he<Le;he++)W.nsPsy.lastAttacks[he]=ee[he][2];i0(A,pe,z);for(var he=0;he<Le;he++){var It,Ct,Pt,qt;he>1?(It=Z,Ct=-2,Pt=Q.NORM_TYPE,(z[0]==Q.SHORT_TYPE||z[1]==Q.SHORT_TYPE)&&(Pt=Q.SHORT_TYPE),qt=M[N][he-2]):(It=X,Ct=0,Pt=z[he],qt=$[N][he]),Pt==Q.SHORT_TYPE?It[Ct+he]=le(qt,W.masking_lower):It[Ct+he]=oe(qt,W.masking_lower),A.analysis&&(W.pinfo.pe[N][he]=It[Ct+he])}return 0};function ze(A,S){var C=A,N;return C>=0?N=-C*27:N=C*S,N<=-72?0:Math.exp(N*K)}function s0(A){var S=0,C=0;{var N=0,$,M;for(N=0;ze(N,A)>1e-20;N-=1);for($=N,M=0;Math.abs(M-$)>1e-12;)N=(M+$)/2,ze(N,A)>0?M=N:$=N;S=$}{var N=0,$,M;for(N=0;ze(N,A)>1e-20;N+=1);for($=0,M=N;Math.abs(M-$)>1e-12;)N=(M+$)/2,ze(N,A)>0?$=N:M=N;C=M}{var X=0,Z=1e3,P;for(P=0;P<=Z;++P){var N=S+P*(C-S)/Z,z=ze(N,A);X+=z}{var W=(Z+1)/(X*(C-S));return W}}}function jt(A){var S,C,N,$;return S=A,S>=0?S*=3:S*=1.5,S>=.5&&S<=2.5?($=S-.5,C=8*($*$-2*$)):C=0,S+=.474,N=15.811389+7.5*S-17.5*Math.sqrt(1+S*S),N<=-60?0:(S=Math.exp((C+N)*K),S/=.6609193,S)}function Bt(A){return A<0&&(A=0),A=A*.001,13*Math.atan(.76*A)+3.5*Math.atan(A*A/(7.5*7.5))}function b0(A,S,C,N,$,M,X,Z,P,z,W,J){var _e=$e(Q.CBANDS+1),fe=Z/(J>15?2*576:2*192),te=o0(Q.HBLKSIZE),me;Z/=P;var j=0,de=0;for(me=0;me<Q.CBANDS;me++){var ye,ae;for(ye=Bt(Z*j),_e[me]=Z*j,ae=j;Bt(Z*ae)-ye<B&&ae<=P/2;ae++);for(A[me]=ae-j,de=me+1;j<ae;)ue(j<Q.HBLKSIZE),te[j++]=me;if(j>P/2){j=P/2,++me;break}}ue(me<Q.CBANDS),_e[me]=Z*j;for(var ve=0;ve<J;ve++){var ee,pe,Le,he,Ee;Le=z[ve],he=z[ve+1],ee=0|Math.floor(.5+W*(Le-.5)),ee<0&&(ee=0),pe=0|Math.floor(.5+W*(he-.5)),pe>P/2&&(pe=P/2),C[ve]=(te[ee]+te[pe])/2,S[ve]=te[pe];var xe=fe*he;X[ve]=(xe-_e[S[ve]])/(_e[S[ve]+1]-_e[S[ve]]),X[ve]<0?X[ve]=0:X[ve]>1&&(X[ve]=1),Ee=Bt(Z*z[ve]*W),Ee=Math.min(Ee,15.5)/15.5,M[ve]=Math.pow(10,1.25*(1-Math.cos(Math.PI*Ee))-2.5)}j=0;for(var Ne=0;Ne<de;Ne++){var Rt=A[Ne],ye,Ye;ye=Bt(Z*j),Ye=Bt(Z*(j+Rt-1)),N[Ne]=.5*(ye+Ye),ye=Bt(Z*(j-.5)),Ye=Bt(Z*(j+Rt-.5)),$[Ne]=Ye-ye,j+=Rt}return de}function Oa(A,S,C,N,$,M){var X=Nt([Q.CBANDS,Q.CBANDS]),Z,P=0;if(M)for(var z=0;z<S;z++)for(Z=0;Z<S;Z++){var W=jt(C[z]-C[Z])*N[Z];X[z][Z]=W*$[z]}else for(Z=0;Z<S;Z++)for(var J=15+Math.min(21/C[Z],12),_e=s0(J),z=0;z<S;z++){var W=_e*ze(C[z]-C[Z],J)*N[Z];X[z][Z]=W*$[z]}for(var z=0;z<S;z++){for(Z=0;Z<S&&!(X[z][Z]>0);Z++);for(A[z][0]=Z,Z=S-1;Z>0&&!(X[z][Z]>0);Z--);A[z][1]=Z,P+=A[z][1]-A[z][0]+1}for(var fe=$e(P),te=0,z=0;z<S;z++)for(Z=A[z][0];Z<=A[z][1];Z++)fe[te++]=X[z][Z];return fe}function Na(A){var S=Bt(A);return S=Math.min(S,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*S))-2.5)}this.psymodel_init=function(A){var S=A.internal_flags,C,N=!0,$=13,M=24,X=0,Z=0,P=-8.25,z=-4.5,W=$e(Q.CBANDS),J=$e(Q.CBANDS),_e=$e(Q.CBANDS),fe=A.out_samplerate;switch(A.experimentalZ){default:case 0:N=!0;break;case 1:N=!(A.VBR==S0.vbr_mtrh||A.VBR==S0.vbr_mt);break;case 2:N=!1;break;case 3:$=8,X=-1.75,Z=-.0125,P=-8.25,z=-2.25;break}for(S.ms_ener_ratio_old=.25,S.blocktype_old[0]=S.blocktype_old[1]=Q.NORM_TYPE,C=0;C<4;++C){for(var j=0;j<Q.CBANDS;++j)S.nb_1[C][j]=1e20,S.nb_2[C][j]=1e20,S.nb_s1[C][j]=S.nb_s2[C][j]=1;for(var te=0;te<Q.SBMAX_l;te++)S.en[C].l[te]=1e20,S.thm[C].l[te]=1e20;for(var j=0;j<3;++j){for(var te=0;te<Q.SBMAX_s;te++)S.en[C].s[te][j]=1e20,S.thm[C].s[te][j]=1e20;S.nsPsy.lastAttacks[C]=0}for(var j=0;j<9;j++)S.nsPsy.last_en_subshort[C][j]=10}for(S.loudness_sq_save[0]=S.loudness_sq_save[1]=0,S.npart_l=b0(S.numlines_l,S.bo_l,S.bm_l,W,J,S.mld_l,S.PSY.bo_l_weight,fe,Q.BLKSIZE,S.scalefac_band.l,Q.BLKSIZE/(2*576),Q.SBMAX_l),ue(S.npart_l<Q.CBANDS),C=0;C<S.npart_l;C++){var me=X;W[C]>=$&&(me=Z*(W[C]-$)/(M-$)+X*(M-W[C])/(M-$)),_e[C]=Math.pow(10,me/10),S.numlines_l[C]>0?S.rnumlines_l[C]=1/S.numlines_l[C]:S.rnumlines_l[C]=0}S.s3_ll=Oa(S.s3ind,S.npart_l,W,J,_e,N);var j=0;for(C=0;C<S.npart_l;C++){var de;de=Za.MAX_VALUE;for(var ye=0;ye<S.numlines_l[C];ye++,j++){var ae=fe*j/(1e3*Q.BLKSIZE),ve;ve=this.ATHformula(ae*1e3,A)-20,ve=Math.pow(10,.1*ve),ve*=S.numlines_l[C],de>ve&&(de=ve)}S.ATH.cb_l[C]=de,de=-20+W[C]*20/10,de>6&&(de=100),de<-15&&(de=-15),de-=8,S.minval_l[C]=Math.pow(10,de/10)*S.numlines_l[C]}for(S.npart_s=b0(S.numlines_s,S.bo_s,S.bm_s,W,J,S.mld_s,S.PSY.bo_s_weight,fe,Q.BLKSIZE_s,S.scalefac_band.s,Q.BLKSIZE_s/(2*192),Q.SBMAX_s),ue(S.npart_s<Q.CBANDS),j=0,C=0;C<S.npart_s;C++){var de,me=P;W[C]>=$&&(me=z*(W[C]-$)/(M-$)+P*(M-W[C])/(M-$)),_e[C]=Math.pow(10,me/10),de=Za.MAX_VALUE;for(var ye=0;ye<S.numlines_s[C];ye++,j++){var ae=fe*j/(1e3*Q.BLKSIZE_s),ve;ve=this.ATHformula(ae*1e3,A)-20,ve=Math.pow(10,.1*ve),ve*=S.numlines_s[C],de>ve&&(de=ve)}S.ATH.cb_s[C]=de,de=-7+W[C]*7/12,W[C]>12&&(de*=1+Math.log(1+de)*3.1),W[C]<12&&(de*=1+Math.log(1-de)*2.3),de<-15&&(de=-15),de-=8,S.minval_s[C]=Math.pow(10,de/10)*S.numlines_s[C]}S.s3_ss=Oa(S.s3ind_s,S.npart_s,W,J,_e,N),c(),p.init_fft(S),S.decay=Math.exp(-1*s/(D*fe/192));{var ee;ee=G,A.exp_nspsytune&2&&(ee=1),Math.abs(A.msfix)>0&&(ee=A.msfix),A.msfix=ee;for(var pe=0;pe<S.npart_l;pe++)S.s3ind[pe][1]>S.npart_l-1&&(S.s3ind[pe][1]=S.npart_l-1)}var Le=576*S.mode_gr/fe;if(S.ATH.decay=Math.pow(10,-12/10*Le),S.ATH.adjust=.01,S.ATH.adjustLimit=1,ue(S.bo_l[Q.SBMAX_l-1]<=S.npart_l),ue(S.bo_s[Q.SBMAX_s-1]<=S.npart_s),A.ATHtype!=-1){var ae,he=A.out_samplerate/Q.BLKSIZE,Ee=0;for(ae=0,C=0;C<Q.BLKSIZE/2;++C)ae+=he,S.ATH.eql_w[C]=1/Math.pow(10,this.ATHformula(ae,A)/10),Ee+=S.ATH.eql_w[C];for(Ee=1/Ee,C=Q.BLKSIZE/2;--C>=0;)S.ATH.eql_w[C]*=Ee}{for(var pe=j=0;pe<S.npart_s;++pe)for(C=0;C<S.numlines_s[pe];++C)++j;ue(j==129);for(var pe=j=0;pe<S.npart_l;++pe)for(C=0;C<S.numlines_l[pe];++C)++j;ue(j==513)}for(j=0,C=0;C<S.npart_l;C++){var ae=fe*(j+S.numlines_l[C]/2)/(1*Q.BLKSIZE);S.mld_cb_l[C]=Na(ae),j+=S.numlines_l[C]}for(;C<Q.CBANDS;++C)S.mld_cb_l[C]=1;for(j=0,C=0;C<S.npart_s;C++){var ae=fe*(j+S.numlines_s[C]/2)/(1*Q.BLKSIZE_s);S.mld_cb_s[C]=Na(ae),j+=S.numlines_s[C]}for(;C<Q.CBANDS;++C)S.mld_cb_s[C]=1;return 0};function A0(A,S){A<-.3&&(A=3410),A/=1e3,A=Math.max(.1,A);var C=3.64*Math.pow(A,-.8)-6.8*Math.exp(-.6*Math.pow(A-3.4,2))+6*Math.exp(-.15*Math.pow(A-8.7,2))+(.6+.04*S)*.001*Math.pow(A,4);return C}this.ATHformula=function(A,S){var C;switch(S.ATHtype){case 0:C=A0(A,9);break;case 1:C=A0(A,-1);break;case 2:C=A0(A,0);break;case 3:C=A0(A,1)+6;break;case 4:C=A0(A,S.ATHcurve);break;default:C=A0(A,0);break}return C}}var as=ts;function Gt(p){var s=p;this.ordinal=function(){return s}}Gt.STEREO=new Gt(0);Gt.JOINT_STEREO=new Gt(1);Gt.DUAL_CHANNEL=new Gt(2);Gt.MONO=new Gt(3);Gt.NOT_SET=new Gt(4);var Ra=Gt;const is=wa(Ra);var ss=Ra;function ns(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=ss.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var rs=ns,os=Qe(),Ti={};Ti.SFBMAX=os.SBMAX_s*3;var z0=Ti,ht=ge;ht.System;ht.VbrMode;ht.Float;ht.ShortBlock;ht.Util;ht.Arrays;ht.new_array_n;ht.new_byte;ht.new_double;var ls=ht.new_float;ht.new_float_n;var l0=ht.new_int;ht.new_int_n;ht.assert;var va=z0;function _s(){this.xr=ls(576),this.l3_enc=l0(576),this.scalefac=l0(va.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=l0(3),this.subblock_gain=l0(3+1),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=l0(va.SFBMAX),this.window=l0(va.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=l0(4),this.max_nonzero_coeff=0;var p=this;function s(b){return new Int32Array(b)}function u(b){return new Float32Array(b)}this.assign=function(b){p.xr=u(b.xr),p.l3_enc=s(b.l3_enc),p.scalefac=s(b.scalefac),p.xrpow_max=b.xrpow_max,p.part2_3_length=b.part2_3_length,p.big_values=b.big_values,p.count1=b.count1,p.global_gain=b.global_gain,p.scalefac_compress=b.scalefac_compress,p.block_type=b.block_type,p.mixed_block_flag=b.mixed_block_flag,p.table_select=s(b.table_select),p.subblock_gain=s(b.subblock_gain),p.region0_count=b.region0_count,p.region1_count=b.region1_count,p.preflag=b.preflag,p.scalefac_scale=b.scalefac_scale,p.count1table_select=b.count1table_select,p.part2_length=b.part2_length,p.sfb_lmax=b.sfb_lmax,p.sfb_smin=b.sfb_smin,p.psy_lmax=b.psy_lmax,p.sfbmax=b.sfbmax,p.psymax=b.psymax,p.sfbdivide=b.sfbdivide,p.width=s(b.width),p.window=s(b.window),p.count1bits=b.count1bits,p.sfb_partition_table=b.sfb_partition_table.slice(0),p.slen=s(b.slen),p.max_nonzero_coeff=b.max_nonzero_coeff}}var Ia=_s,ct=ge;ct.System;ct.VbrMode;ct.Float;ct.ShortBlock;ct.Util;ct.Arrays;ct.new_array_n;ct.new_byte;ct.new_double;ct.new_float;ct.new_float_n;var Wa=ct.new_int;ct.new_int_n;ct.assert;var hs=Ia;function cs(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[Wa(4),Wa(4)];for(var p=0;p<2;p++)for(var s=0;s<2;s++)this.tt[p][s]=new hs}var us=cs,ut=ge,q0=ut.System;ut.VbrMode;ut.Float;ut.ShortBlock;ut.Util;ut.Arrays;ut.new_array_n;ut.new_byte;ut.new_double;ut.new_float;ut.new_float_n;var D0=ut.new_int;ut.new_int_n;ut.assert;var X0=Qe();function ds(p,s,u,b){this.l=D0(1+X0.SBMAX_l),this.s=D0(1+X0.SBMAX_s),this.psfb21=D0(1+X0.PSFB21),this.psfb12=D0(1+X0.PSFB12);var w=this.l,I=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],q0.arraycopy(this.arrL,0,w,0,Math.min(this.arrL.length,this.l.length)),q0.arraycopy(this.arrS,0,I,0,Math.min(this.arrS.length,this.s.length)),q0.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),q0.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var Mi=ds,dt=ge;dt.System;dt.VbrMode;dt.Float;dt.ShortBlock;dt.Util;dt.Arrays;dt.new_array_n;dt.new_byte;dt.new_double;var ma=dt.new_float,vs=dt.new_float_n,ms=dt.new_int;dt.new_int_n;dt.assert;var ja=Qe();function fs(){this.last_en_subshort=vs([4,9]),this.lastAttacks=ms(4),this.pefirbuf=ma(19),this.longfact=ma(ja.SBMAX_l),this.shortfact=ma(ja.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var ps=fs;function bs(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var As=bs,vt=ge;vt.System;vt.VbrMode;vt.Float;vt.ShortBlock;vt.Util;vt.Arrays;vt.new_array_n;var Es=vt.new_byte,Ss=vt.new_double,Ht=vt.new_float,_0=vt.new_float_n,Dt=vt.new_int,Y0=vt.new_int_n;vt.assert;var ys=us,xs=Mi,Ts=ps,Ms=As,Qa=xi,Xe=Qe(),Bs=z0;Jt.MFSIZE=3*1152+Xe.ENCDELAY-Xe.MDCTDELAY;Jt.MAX_HEADER_BUF=256;Jt.MAX_BITS_PER_CHANNEL=4095;Jt.MAX_BITS_PER_GRANULE=7680;Jt.BPC=320;function Jt(){var p=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=_0([2,Jt.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new ys,this.ms_ratio=Ht(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Dt(2),this.CurrentStep=Dt(2),this.masking_lower=0,this.bv_scf=Dt(576),this.pseudohalf=Dt(Bs.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*Jt.BPC+1),this.itime=Ss(2),this.sideinfo_len=0,this.sb_sample=_0([2,2,18,Xe.SBLIMIT]),this.amp_filter=Ht(32);function s(){this.write_timing=0,this.ptr=0,this.buf=Es(p)}this.header=new Array(Jt.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new xs,this.minval_l=Ht(Xe.CBANDS),this.minval_s=Ht(Xe.CBANDS),this.nb_1=_0([4,Xe.CBANDS]),this.nb_2=_0([4,Xe.CBANDS]),this.nb_s1=_0([4,Xe.CBANDS]),this.nb_s2=_0([4,Xe.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Ht(4),this.loudness_sq=_0([2,2]),this.loudness_sq_save=Ht(2),this.mld_l=Ht(Xe.SBMAX_l),this.mld_s=Ht(Xe.SBMAX_s),this.bm_l=Dt(Xe.SBMAX_l),this.bo_l=Dt(Xe.SBMAX_l),this.bm_s=Dt(Xe.SBMAX_s),this.bo_s=Dt(Xe.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=Y0([Xe.CBANDS,2]),this.s3ind_s=Y0([Xe.CBANDS,2]),this.numlines_s=Dt(Xe.CBANDS),this.numlines_l=Dt(Xe.CBANDS),this.rnumlines_l=Ht(Xe.CBANDS),this.mld_cb_l=Ht(Xe.CBANDS),this.mld_cb_s=Ht(Xe.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Ht(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Dt(2),this.nsPsy=new Ts,this.VBR_seek_table=new Ms,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=Y0([16,4+1]),this.bitrate_blockType_Hist=Y0([16,4+1+1]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var u=0;u<this.en.length;u++)this.en[u]=new Qa;for(var u=0;u<this.thm.length;u++)this.thm[u]=new Qa;for(var u=0;u<this.header.length;u++)this.header[u]=new s}var J0=Jt,mt=ge;mt.System;mt.VbrMode;mt.Float;mt.ShortBlock;mt.Util;mt.Arrays;mt.new_array_n;mt.new_byte;mt.new_double;var h0=mt.new_float;mt.new_float_n;mt.new_int;mt.new_int_n;mt.assert;var c0=Qe();function Rs(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=h0(c0.SBMAX_l),this.s=h0(c0.SBMAX_s),this.psfb21=h0(c0.PSFB21),this.psfb12=h0(c0.PSFB12),this.cb_l=h0(c0.CBANDS),this.cb_s=h0(c0.CBANDS),this.eql_w=h0(c0.BLKSIZE/2)}var Is=Rs,ft=ge,nt=ft.System;ft.VbrMode;ft.Float;ft.ShortBlock;ft.Util;var za=ft.Arrays;ft.new_array_n;ft.new_byte;ft.new_double;ft.new_float;ft.new_float_n;ft.new_int;ft.new_int_n;ft.assert;Oe.STEPS_per_dB=100;Oe.MAX_dB=120;Oe.GAIN_NOT_ENOUGH_SAMPLES=-24601;Oe.GAIN_ANALYSIS_ERROR=0;Oe.GAIN_ANALYSIS_OK=1;Oe.INIT_GAIN_ANALYSIS_ERROR=0;Oe.INIT_GAIN_ANALYSIS_OK=1;Oe.YULE_ORDER=10;Oe.MAX_ORDER=Oe.YULE_ORDER;Oe.MAX_SAMP_FREQ=48e3;Oe.RMS_WINDOW_TIME_NUMERATOR=1;Oe.RMS_WINDOW_TIME_DENOMINATOR=20;Oe.MAX_SAMPLES_PER_WINDOW=Oe.MAX_SAMP_FREQ*Oe.RMS_WINDOW_TIME_NUMERATOR/Oe.RMS_WINDOW_TIME_DENOMINATOR+1;function Oe(){var p=64.82;Oe.YULE_ORDER;var s=.95;Oe.MAX_SAMP_FREQ;var u=Oe.RMS_WINDOW_TIME_NUMERATOR,b=Oe.RMS_WINDOW_TIME_DENOMINATOR;Oe.MAX_SAMPLES_PER_WINDOW;var w=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],I=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function B(y,G,Y,K,q,U){for(;q--!=0;)Y[K]=1e-10+y[G+0]*U[0]-Y[K-1]*U[1]+y[G-1]*U[2]-Y[K-2]*U[3]+y[G-2]*U[4]-Y[K-3]*U[5]+y[G-3]*U[6]-Y[K-4]*U[7]+y[G-4]*U[8]-Y[K-5]*U[9]+y[G-5]*U[10]-Y[K-6]*U[11]+y[G-6]*U[12]-Y[K-7]*U[13]+y[G-7]*U[14]-Y[K-8]*U[15]+y[G-8]*U[16]-Y[K-9]*U[17]+y[G-9]*U[18]-Y[K-10]*U[19]+y[G-10]*U[20],++K,++G}function k(y,G,Y,K,q,U){for(;q--!=0;)Y[K]=y[G+0]*U[0]-Y[K-1]*U[1]+y[G-1]*U[2]-Y[K-2]*U[3]+y[G-2]*U[4],++K,++G}function D(y,G){for(var Y=0;Y<MAX_ORDER;Y++)y.linprebuf[Y]=y.lstepbuf[Y]=y.loutbuf[Y]=y.rinprebuf[Y]=y.rstepbuf[Y]=y.routbuf[Y]=0;switch(0|G){case 48e3:y.reqindex=0;break;case 44100:y.reqindex=1;break;case 32e3:y.reqindex=2;break;case 24e3:y.reqindex=3;break;case 22050:y.reqindex=4;break;case 16e3:y.reqindex=5;break;case 12e3:y.reqindex=6;break;case 11025:y.reqindex=7;break;case 8e3:y.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return y.sampleWindow=0|(G*u+b-1)/b,y.lsum=0,y.rsum=0,y.totsamp=0,za.ill(y.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(y,G){return D(y,G)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(y.linpre=MAX_ORDER,y.rinpre=MAX_ORDER,y.lstep=MAX_ORDER,y.rstep=MAX_ORDER,y.lout=MAX_ORDER,y.rout=MAX_ORDER,za.fill(y.B,0),INIT_GAIN_ANALYSIS_OK)};function T(y){return y*y}this.AnalyzeSamples=function(y,G,Y,K,q,U,L){var _,m,E,e,v,f,x;if(U==0)return GAIN_ANALYSIS_OK;switch(x=0,v=U,L){case 1:K=G,q=Y;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(U<MAX_ORDER?(nt.arraycopy(G,Y,y.linprebuf,MAX_ORDER,U),nt.arraycopy(K,q,y.rinprebuf,MAX_ORDER,U)):(nt.arraycopy(G,Y,y.linprebuf,MAX_ORDER,MAX_ORDER),nt.arraycopy(K,q,y.rinprebuf,MAX_ORDER,MAX_ORDER));v>0;){f=v>y.sampleWindow-y.totsamp?y.sampleWindow-y.totsamp:v,x<MAX_ORDER?(_=y.linpre+x,m=y.linprebuf,E=y.rinpre+x,e=y.rinprebuf,f>MAX_ORDER-x&&(f=MAX_ORDER-x)):(_=Y+x,m=G,E=q+x,e=K),B(m,_,y.lstepbuf,y.lstep+y.totsamp,f,w[y.reqindex]),B(e,E,y.rstepbuf,y.rstep+y.totsamp,f,w[y.reqindex]),k(y.lstepbuf,y.lstep+y.totsamp,y.loutbuf,y.lout+y.totsamp,f,I[y.reqindex]),k(y.rstepbuf,y.rstep+y.totsamp,y.routbuf,y.rout+y.totsamp,f,I[y.reqindex]),_=y.lout+y.totsamp,m=y.loutbuf,E=y.rout+y.totsamp,e=y.routbuf;for(var c=f%8;c--!=0;)y.lsum+=T(m[_++]),y.rsum+=T(e[E++]);for(c=f/8;c--!=0;)y.lsum+=T(m[_+0])+T(m[_+1])+T(m[_+2])+T(m[_+3])+T(m[_+4])+T(m[_+5])+T(m[_+6])+T(m[_+7]),_+=8,y.rsum+=T(e[E+0])+T(e[E+1])+T(e[E+2])+T(e[E+3])+T(e[E+4])+T(e[E+5])+T(e[E+6])+T(e[E+7]),E+=8;if(v-=f,x+=f,y.totsamp+=f,y.totsamp==y.sampleWindow){var n=Oe.STEPS_per_dB*10*Math.log10((y.lsum+y.rsum)/y.totsamp*.5+1e-37),i=n<=0?0:0|n;i>=y.A.length&&(i=y.A.length-1),y.A[i]++,y.lsum=y.rsum=0,nt.arraycopy(y.loutbuf,y.totsamp,y.loutbuf,0,MAX_ORDER),nt.arraycopy(y.routbuf,y.totsamp,y.routbuf,0,MAX_ORDER),nt.arraycopy(y.lstepbuf,y.totsamp,y.lstepbuf,0,MAX_ORDER),nt.arraycopy(y.rstepbuf,y.totsamp,y.rstepbuf,0,MAX_ORDER),y.totsamp=0}if(y.totsamp>y.sampleWindow)return GAIN_ANALYSIS_ERROR}return U<MAX_ORDER?(nt.arraycopy(y.linprebuf,U,y.linprebuf,0,MAX_ORDER-U),nt.arraycopy(y.rinprebuf,U,y.rinprebuf,0,MAX_ORDER-U),nt.arraycopy(G,Y,y.linprebuf,MAX_ORDER-U,U),nt.arraycopy(K,q,y.rinprebuf,MAX_ORDER-U,U)):(nt.arraycopy(G,Y+U-MAX_ORDER,y.linprebuf,0,MAX_ORDER),nt.arraycopy(K,q+U-MAX_ORDER,y.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function V(y,G){var Y,K=0;for(Y=0;Y<G;Y++)K+=y[Y];if(K==0)return GAIN_NOT_ENOUGH_SAMPLES;var q=0|Math.ceil(K*(1-s));for(Y=G;Y-- >0&&!((q-=y[Y])<=0););return p-Y/Oe.STEPS_per_dB}this.GetTitleGain=function(y){for(var G=V(y.A,y.A.length),Y=0;Y<y.A.length;Y++)y.B[Y]+=y.A[Y],y.A[Y]=0;for(var Y=0;Y<MAX_ORDER;Y++)y.linprebuf[Y]=y.lstepbuf[Y]=y.loutbuf[Y]=y.rinprebuf[Y]=y.rstepbuf[Y]=y.routbuf[Y]=0;return y.totsamp=0,y.lsum=y.rsum=0,G}}var wi=Oe,pt=ge;pt.System;pt.VbrMode;pt.Float;pt.ShortBlock;pt.Util;pt.Arrays;pt.new_array_n;pt.new_byte;pt.new_double;var x0=pt.new_float;pt.new_float_n;var Ja=pt.new_int;pt.new_int_n;pt.assert;var rt=wi;function Cs(){this.linprebuf=x0(rt.MAX_ORDER*2),this.linpre=0,this.lstepbuf=x0(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.lstep=0,this.loutbuf=x0(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.lout=0,this.rinprebuf=x0(rt.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=x0(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.rstep=0,this.routbuf=x0(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=Ja(0|rt.STEPS_per_dB*rt.MAX_dB),this.B=Ja(0|rt.STEPS_per_dB*rt.MAX_dB)}var Ls=Cs;function ks(p){this.bits=p}var Bi=ks,bt=ge;bt.System;bt.VbrMode;bt.Float;bt.ShortBlock;bt.Util;bt.Arrays;bt.new_array_n;bt.new_byte;bt.new_double;var ei=bt.new_float;bt.new_float_n;var Os=bt.new_int;bt.new_int_n;var ti=bt.assert,Ns=Bi,ai=Qe(),Hs=z0,gs=J0;function Fs(p){var s=p;this.quantize=s,this.iteration_loop=function(u,b,w,I){var B=u.internal_flags,k=ei(Hs.SFBMAX),D=ei(576),T=Os(2),V=0,y,G=B.l3_side,Y=new Ns(V);this.quantize.rv.ResvFrameBegin(u,Y),V=Y.bits;for(var K=0;K<B.mode_gr;K++){y=this.quantize.qupvt.on_pe(u,b,T,V,K,K),B.mode_ext==ai.MPG_MD_MS_LR&&(this.quantize.ms_convert(B.l3_side,K),this.quantize.qupvt.reduce_side(T,w[K],V,y));for(var q=0;q<B.channels_out;q++){var U,L,_=G.tt[K][q];_.block_type!=ai.SHORT_TYPE?(U=0,L=B.PSY.mask_adjust-U):(U=0,L=B.PSY.mask_adjust_short-U),B.masking_lower=Math.pow(10,L*.1),this.quantize.init_outer_loop(B,_),this.quantize.init_xrpow(B,_,D)&&(this.quantize.qupvt.calc_xmin(u,I[K][q],_,k),this.quantize.outer_loop(u,_,k,D,q,T[q])),this.quantize.iteration_finish_one(B,K,q),ti(_.part2_3_length<=gs.MAX_BITS_PER_CHANNEL),ti(_.part2_3_length<=T[q])}}this.quantize.rv.ResvFrameEnd(B,V)}}var Vs=Fs;function Be(p,s,u,b){this.xlen=p,this.linmax=s,this.table=u,this.hlen=b}var ie={};ie.t1HB=[1,1,1,0];ie.t2HB=[1,2,1,3,1,1,3,2,0];ie.t3HB=[3,2,1,1,1,1,3,2,0];ie.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];ie.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];ie.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];ie.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];ie.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];ie.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];ie.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];ie.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];ie.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];ie.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];ie.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];ie.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];ie.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];ie.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];ie.t1l=[1,4,3,5];ie.t2l=[1,4,7,4,5,7,6,7,8];ie.t3l=[2,3,7,4,4,7,6,7,8];ie.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];ie.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];ie.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];ie.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];ie.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];ie.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];ie.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];ie.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];ie.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];ie.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];ie.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];ie.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];ie.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];ie.t32l=[1+0,4+1,4+1,5+2,4+1,6+2,5+2,6+3,4+1,5+2,5+2,6+3,5+2,6+3,6+3,6+4];ie.t33l=[4+0,4+1,4+1,4+2,4+1,4+2,4+2,4+3,4+1,4+2,4+2,4+3,4+2,4+3,4+3,4+4];ie.ht=[new Be(0,0,null,null),new Be(2,0,ie.t1HB,ie.t1l),new Be(3,0,ie.t2HB,ie.t2l),new Be(3,0,ie.t3HB,ie.t3l),new Be(0,0,null,null),new Be(4,0,ie.t5HB,ie.t5l),new Be(4,0,ie.t6HB,ie.t6l),new Be(6,0,ie.t7HB,ie.t7l),new Be(6,0,ie.t8HB,ie.t8l),new Be(6,0,ie.t9HB,ie.t9l),new Be(8,0,ie.t10HB,ie.t10l),new Be(8,0,ie.t11HB,ie.t11l),new Be(8,0,ie.t12HB,ie.t12l),new Be(16,0,ie.t13HB,ie.t13l),new Be(0,0,null,ie.t16_5l),new Be(16,0,ie.t15HB,ie.t15l),new Be(1,1,ie.t16HB,ie.t16l),new Be(2,3,ie.t16HB,ie.t16l),new Be(3,7,ie.t16HB,ie.t16l),new Be(4,15,ie.t16HB,ie.t16l),new Be(6,63,ie.t16HB,ie.t16l),new Be(8,255,ie.t16HB,ie.t16l),new Be(10,1023,ie.t16HB,ie.t16l),new Be(13,8191,ie.t16HB,ie.t16l),new Be(4,15,ie.t24HB,ie.t24l),new Be(5,31,ie.t24HB,ie.t24l),new Be(6,63,ie.t24HB,ie.t24l),new Be(7,127,ie.t24HB,ie.t24l),new Be(8,255,ie.t24HB,ie.t24l),new Be(9,511,ie.t24HB,ie.t24l),new Be(11,2047,ie.t24HB,ie.t24l),new Be(13,8191,ie.t24HB,ie.t24l),new Be(0,0,ie.t32HB,ie.t32l),new Be(0,0,ie.t33HB,ie.t33l)];ie.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];ie.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];ie.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];ie.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];ie.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]];ie.scfsi_band=[0,6,11,16,21];var Ca=ie,Qt=Mi,At=ge;At.System;var u0=At.VbrMode,G0=At.Float;At.ShortBlock;var fa=At.Util;At.Arrays;At.new_array_n;At.new_byte;At.new_double;var d0=At.new_float;At.new_float_n;var Ps=At.new_int;At.new_int_n;var zt=At.assert,We=Qe(),qs=Bi,Je=J0;kt.Q_MAX=256+1;kt.Q_MAX2=116;kt.LARGE_BITS=1e5;kt.IXMAX_VAL=8206;function kt(){var p=null,s=null,u=null;this.setModules=function(_,m,E){p=_,s=m,u=E};function b(_){return zt(0<=_+kt.Q_MAX2&&_<kt.Q_MAX),y[_+kt.Q_MAX2]}this.IPOW20=function(_){return zt(0<=_&&_<kt.Q_MAX),G[_]};var w=2220446049250313e-31,I=kt.IXMAX_VAL,B=I+2,k=kt.Q_MAX,D=kt.Q_MAX2;kt.LARGE_BITS;var T=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var V=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=V,this.sfBandIndex=[new Qt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var y=d0(k+D+1),G=d0(k),Y=d0(B),K=d0(B);this.adj43=K;function q(_,m){var E=u.ATHformula(m,_);return E-=T,E=Math.pow(10,E/10+_.ATHlower),E}function U(_){for(var m=_.internal_flags.ATH.l,E=_.internal_flags.ATH.psfb21,e=_.internal_flags.ATH.s,v=_.internal_flags.ATH.psfb12,f=_.internal_flags,x=_.out_samplerate,c=0;c<We.SBMAX_l;c++){var n=f.scalefac_band.l[c],i=f.scalefac_band.l[c+1];m[c]=G0.MAX_VALUE;for(var h=n;h<i;h++){var r=h*x/1152,t=q(_,r);m[c]=Math.min(m[c],t)}}for(var c=0;c<We.PSFB21;c++){var n=f.scalefac_band.psfb21[c],i=f.scalefac_band.psfb21[c+1];E[c]=G0.MAX_VALUE;for(var h=n;h<i;h++){var r=h*x/1152,t=q(_,r);E[c]=Math.min(E[c],t)}}for(var c=0;c<We.SBMAX_s;c++){var n=f.scalefac_band.s[c],i=f.scalefac_band.s[c+1];e[c]=G0.MAX_VALUE;for(var h=n;h<i;h++){var r=h*x/384,t=q(_,r);e[c]=Math.min(e[c],t)}e[c]*=f.scalefac_band.s[c+1]-f.scalefac_band.s[c]}for(var c=0;c<We.PSFB12;c++){var n=f.scalefac_band.psfb12[c],i=f.scalefac_band.psfb12[c+1];v[c]=G0.MAX_VALUE;for(var h=n;h<i;h++){var r=h*x/384,t=q(_,r);v[c]=Math.min(v[c],t)}v[c]*=f.scalefac_band.s[13]-f.scalefac_band.s[12]}if(_.noATH){for(var c=0;c<We.SBMAX_l;c++)m[c]=1e-20;for(var c=0;c<We.PSFB21;c++)E[c]=1e-20;for(var c=0;c<We.SBMAX_s;c++)e[c]=1e-20;for(var c=0;c<We.PSFB12;c++)v[c]=1e-20}f.ATH.floor=10*Math.log10(q(_,-1))}this.iteration_init=function(_){var m=_.internal_flags,E=m.l3_side,e;if(m.iteration_init_init==0){for(m.iteration_init_init=1,E.main_data_begin=0,U(_),Y[0]=0,e=1;e<B;e++)Y[e]=Math.pow(e,4/3);for(e=0;e<B-1;e++)K[e]=e+1-Math.pow(.5*(Y[e]+Y[e+1]),.75);for(K[e]=.5,e=0;e<k;e++)G[e]=Math.pow(2,(e-210)*-.1875);for(e=0;e<=k+D;e++)y[e]=Math.pow(2,(e-210-D)*.25);p.huffman_init(m);{var v,f,x,c;for(e=_.exp_nspsytune>>2&63,e>=32&&(e-=64),v=Math.pow(10,e/4/10),e=_.exp_nspsytune>>8&63,e>=32&&(e-=64),f=Math.pow(10,e/4/10),e=_.exp_nspsytune>>14&63,e>=32&&(e-=64),x=Math.pow(10,e/4/10),e=_.exp_nspsytune>>20&63,e>=32&&(e-=64),c=x*Math.pow(10,e/4/10),e=0;e<We.SBMAX_l;e++){var n;e<=6?n=v:e<=13?n=f:e<=20?n=x:n=c,m.nsPsy.longfact[e]=n}for(e=0;e<We.SBMAX_s;e++){var n;e<=5?n=v:e<=10?n=f:e<=11?n=x:n=c,m.nsPsy.shortfact[e]=n}}}},this.on_pe=function(_,m,E,e,v,f){var x=_.internal_flags,c=0,n,i=Ps(2),h,r=new qs(c),t=s.ResvMaxBits(_,e,r,f);c=r.bits;var d=c+t;for(d>Je.MAX_BITS_PER_GRANULE&&(d=Je.MAX_BITS_PER_GRANULE),n=0,h=0;h<x.channels_out;++h)E[h]=Math.min(Je.MAX_BITS_PER_CHANNEL,c/x.channels_out),i[h]=0|E[h]*m[v][h]/700-E[h],i[h]>e*3/4&&(i[h]=e*3/4),i[h]<0&&(i[h]=0),i[h]+E[h]>Je.MAX_BITS_PER_CHANNEL&&(i[h]=Math.max(0,Je.MAX_BITS_PER_CHANNEL-E[h])),n+=i[h];if(n>t)for(h=0;h<x.channels_out;++h)i[h]=t*i[h]/n;for(h=0;h<x.channels_out;++h)E[h]+=i[h],t-=i[h];for(n=0,h=0;h<x.channels_out;++h)n+=E[h];if(n>Je.MAX_BITS_PER_GRANULE){var l=0;for(h=0;h<x.channels_out;++h)E[h]*=Je.MAX_BITS_PER_GRANULE,E[h]/=n,l+=E[h];zt(l<=Je.MAX_BITS_PER_GRANULE)}return d},this.reduce_side=function(_,m,E,e){zt(e<=Je.MAX_BITS_PER_GRANULE),zt(_[0]+_[1]<=Je.MAX_BITS_PER_GRANULE);var v=.33*(.5-m)/.5;v<0&&(v=0),v>.5&&(v=.5);var f=0|v*.5*(_[0]+_[1]);f>Je.MAX_BITS_PER_CHANNEL-_[0]&&(f=Je.MAX_BITS_PER_CHANNEL-_[0]),f<0&&(f=0),_[1]>=125&&(_[1]-f>125?(_[0]<E&&(_[0]+=f),_[1]-=f):(_[0]+=_[1]-125,_[1]=125)),f=_[0]+_[1],f>e&&(_[0]=e*_[0]/f,_[1]=e*_[1]/f),zt(_[0]<=Je.MAX_BITS_PER_CHANNEL),zt(_[1]<=Je.MAX_BITS_PER_CHANNEL),zt(_[0]+_[1]<=Je.MAX_BITS_PER_GRANULE)},this.athAdjust=function(_,m,E){var e=90.30873362,v=94.82444863,f=fa.FAST_LOG10_X(m,10),x=_*_,c=0;return f-=E,x>1e-20&&(c=1+fa.FAST_LOG10_X(x,10/e)),c<0&&(c=0),f*=c,f+=E+e-v,Math.pow(10,.1*f)},this.calc_xmin=function(_,m,E,e){var v=0,f=_.internal_flags,x,c=0,n=0,i=f.ATH,h=E.xr,r=_.VBR==u0.vbr_mtrh?1:0,t=f.masking_lower;for((_.VBR==u0.vbr_mtrh||_.VBR==u0.vbr_mt)&&(t=1),x=0;x<E.psy_lmax;x++){var d,l,F,R,O,a;_.VBR==u0.vbr_rh||_.VBR==u0.vbr_mtrh?l=athAdjust(i.adjust,i.l[x],i.floor):l=i.adjust*i.l[x],O=E.width[x],F=l/O,R=w,a=O>>1,d=0;do{var o,H;o=h[c]*h[c],d+=o,R+=o<F?o:F,c++,H=h[c]*h[c],d+=H,R+=H<F?H:F,c++}while(--a>0);if(d>l&&n++,x==We.SBPSY_l){var g=l*f.nsPsy.longfact[x];R<g&&(R=g)}if(r!=0&&(l=R),!_.ATHonly){var se=m.en.l[x];if(se>0){var g;g=d*m.thm.l[x]*t/se,r!=0&&(g*=f.nsPsy.longfact[x]),l<g&&(l=g)}}r!=0?e[v++]=l:e[v++]=l*f.nsPsy.longfact[x]}var le=575;if(E.block_type!=We.SHORT_TYPE)for(var re=576;re--!=0&&BitStream.EQ(h[re],0);)le=re;E.max_nonzero_coeff=le;for(var oe=E.sfb_smin;x<E.psymax;oe++,x+=3){var O,be,ce;for(_.VBR==u0.vbr_rh||_.VBR==u0.vbr_mtrh?ce=athAdjust(i.adjust,i.s[oe],i.floor):ce=i.adjust*i.s[oe],O=E.width[x],be=0;be<3;be++){var d=0,l,F,R,a=O>>1;F=ce/O,R=w;do{var o,H;o=h[c]*h[c],d+=o,R+=o<F?o:F,c++,H=h[c]*h[c],d+=H,R+=H<F?H:F,c++}while(--a>0);if(d>ce&&n++,oe==We.SBPSY_s){var g=ce*f.nsPsy.shortfact[oe];R<g&&(R=g)}if(r!=0?l=R:l=ce,!_.ATHonly&&!_.ATHshort){var se=m.en.s[oe][be];if(se>0){var g;g=d*m.thm.s[oe][be]*t/se,r!=0&&(g*=f.nsPsy.shortfact[oe]),l<g&&(l=g)}}r!=0?e[v++]=l:e[v++]=l*f.nsPsy.shortfact[oe]}_.useTemporal&&(e[v-3]>e[v-3+1]&&(e[v-3+1]+=(e[v-3]-e[v-3+1])*f.decay),e[v-3+1]>e[v-3+2]&&(e[v-3+2]+=(e[v-3+1]-e[v-3+2])*f.decay))}return n};function L(_){this.s=_}this.calc_noise_core=function(_,m,E,e){var v=0,f=m.s,x=_.l3_enc;if(f>_.count1)for(;E--!=0;){var c;c=_.xr[f],f++,v+=c*c,c=_.xr[f],f++,v+=c*c}else if(f>_.big_values){var n=d0(2);for(n[0]=0,n[1]=e;E--!=0;){var c;c=Math.abs(_.xr[f])-n[x[f]],f++,v+=c*c,c=Math.abs(_.xr[f])-n[x[f]],f++,v+=c*c}}else for(;E--!=0;){var c;c=Math.abs(_.xr[f])-Y[x[f]]*e,f++,v+=c*c,c=Math.abs(_.xr[f])-Y[x[f]]*e,f++,v+=c*c}return m.s=f,v},this.calc_noise=function(_,m,E,e,v){var f=0,x=0,c,n,i=0,h=0,r=0,t=-20,d=0,l=_.scalefac,F=0;for(e.over_SSD=0,c=0;c<_.psymax;c++){var R=_.global_gain-(l[F++]+(_.preflag!=0?V[c]:0)<<_.scalefac_scale+1)-_.subblock_gain[_.window[c]]*8,O=0;if(v!=null&&v.step[c]==R)O=v.noise[c],d+=_.width[c],E[f++]=O/m[x++],O=v.noise_log[c];else{var a=b(R);if(n=_.width[c]>>1,d+_.width[c]>_.max_nonzero_coeff){var o;o=_.max_nonzero_coeff-d+1,o>0?n=o>>1:n=0}var H=new L(d);O=this.calc_noise_core(_,H,n,a),d=H.s,v!=null&&(v.step[c]=R,v.noise[c]=O),O=E[f++]=O/m[x++],O=fa.FAST_LOG10(Math.max(O,1e-20)),v!=null&&(v.noise_log[c]=O)}if(v!=null&&(v.global_gain=_.global_gain),r+=O,O>0){var g;g=Math.max(0|O*10+.5,1),e.over_SSD+=g*g,i++,h+=O}t=Math.max(t,O)}return e.over_count=i,e.tot_noise=r,e.over_noise=h,e.max_noise=t,i},this.set_pinfo=function(_,m,E,e,v){var f=_.internal_flags,x,c,n,i,h,r=m.scalefac_scale==0?.5:1,t=m.scalefac,d=d0(L3Side.SFBMAX),l=d0(L3Side.SFBMAX),F=new CalcNoiseResult;calc_xmin(_,E,m,d),calc_noise(m,d,l,F,null);var R=0;for(c=m.sfb_lmax,m.block_type!=We.SHORT_TYPE&&m.mixed_block_flag==0&&(c=22),x=0;x<c;x++){var O=f.scalefac_band.l[x],a=f.scalefac_band.l[x+1],o=a-O;for(i=0;R<a;R++)i+=m.xr[R]*m.xr[R];i/=o,h=1e15,f.pinfo.en[e][v][x]=h*i,f.pinfo.xfsf[e][v][x]=h*d[x]*l[x]/o,E.en.l[x]>0&&!_.ATHonly?i=i/E.en.l[x]:i=0,f.pinfo.thr[e][v][x]=h*Math.max(i*E.thm.l[x],f.ATH.l[x]),f.pinfo.LAMEsfb[e][v][x]=0,m.preflag!=0&&x>=11&&(f.pinfo.LAMEsfb[e][v][x]=-r*V[x]),x<We.SBPSY_l&&(zt(t[x]>=0),f.pinfo.LAMEsfb[e][v][x]-=r*t[x])}if(m.block_type==We.SHORT_TYPE)for(c=x,x=m.sfb_smin;x<We.SBMAX_s;x++)for(var O=f.scalefac_band.s[x],a=f.scalefac_band.s[x+1],o=a-O,H=0;H<3;H++){for(i=0,n=O;n<a;n++)i+=m.xr[R]*m.xr[R],R++;i=Math.max(i/o,1e-20),h=1e15,f.pinfo.en_s[e][v][3*x+H]=h*i,f.pinfo.xfsf_s[e][v][3*x+H]=h*d[c]*l[c]/o,E.en.s[x][H]>0?i=i/E.en.s[x][H]:i=0,(_.ATHonly||_.ATHshort)&&(i=0),f.pinfo.thr_s[e][v][3*x+H]=h*Math.max(i*E.thm.s[x][H],f.ATH.s[x]),f.pinfo.LAMEsfb_s[e][v][3*x+H]=-2*m.subblock_gain[H],x<We.SBPSY_s&&(f.pinfo.LAMEsfb_s[e][v][3*x+H]-=r*t[c]),c++}f.pinfo.LAMEqss[e][v]=m.global_gain,f.pinfo.LAMEmainbits[e][v]=m.part2_3_length+m.part2_length,f.pinfo.LAMEsfbits[e][v]=m.part2_length,f.pinfo.over[e][v]=F.over_count,f.pinfo.max_noise[e][v]=F.max_noise*10,f.pinfo.over_noise[e][v]=F.over_noise*10,f.pinfo.tot_noise[e][v]=F.tot_noise*10,f.pinfo.over_SSD[e][v]=F.over_SSD}}var Ri=kt,Et=ge,Ds=Et.System;Et.VbrMode;Et.Float;Et.ShortBlock;Et.Util;var Xs=Et.Arrays;Et.new_array_n;Et.new_byte;Et.new_double;Et.new_float;Et.new_float_n;var C0=Et.new_int;Et.new_int_n;var gt=Et.assert,Ve=Qe(),Pe=Ca,Ys=Ia,v0=Ri;function Ma(){var p=null;this.qupvt=null,this.setModules=function(n){this.qupvt=n,p=n};function s(n){this.bits=0|n}var u=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function b(n,i,h,r,t,d){var l=.5946/i;for(gt(n>0),n=n>>1;n--!=0;)t[d++]=l>h[r++]?0:1,t[d++]=l>h[r++]?0:1}function w(n,i,h,r,t,d){gt(n>0),n=n>>1;var l=n%2;for(n=n>>1;n--!=0;){var F,R,O,a,o,H,g,se;F=h[r++]*i,R=h[r++]*i,o=0|F,O=h[r++]*i,H=0|R,a=h[r++]*i,g=0|O,F+=p.adj43[o],se=0|a,R+=p.adj43[H],t[d++]=0|F,O+=p.adj43[g],t[d++]=0|R,a+=p.adj43[se],t[d++]=0|O,t[d++]=0|a}if(l!=0){var F,R,o,H;F=h[r++]*i,R=h[r++]*i,o=0|F,H=0|R,F+=p.adj43[o],R+=p.adj43[H],t[d++]=0|F,t[d++]=0|R}}function I(n,i,h,r,t){var d,l,F=0,R,O=0,a=0,o=0,H=i,g=0,se=H,le=0,re=n,oe=0;for(R=t!=null&&r.global_gain==t.global_gain,r.block_type==Ve.SHORT_TYPE?l=38:l=21,d=0;d<=l;d++){var be=-1;if((R||r.block_type==Ve.NORM_TYPE)&&(be=r.global_gain-(r.scalefac[d]+(r.preflag!=0?p.pretab[d]:0)<<r.scalefac_scale+1)-r.subblock_gain[r.window[d]]*8),gt(r.width[d]>=0),R&&t.step[d]==be)O!=0&&(w(O,h,re,oe,se,le),O=0),a!=0&&(b(a,h,re,oe,se,le),a=0);else{var ce=r.width[d];if(F+r.width[d]>r.max_nonzero_coeff){var ne;ne=r.max_nonzero_coeff-F+1,Xs.fill(i,r.max_nonzero_coeff,576,0),ce=ne,ce<0&&(ce=0),d=l+1}if(O==0&&a==0&&(se=H,le=g,re=n,oe=o),t!=null&&t.sfb_count1>0&&d>=t.sfb_count1&&t.step[d]>0&&be>=t.step[d]?(O!=0&&(w(O,h,re,oe,se,le),O=0,se=H,le=g,re=n,oe=o),a+=ce):(a!=0&&(b(a,h,re,oe,se,le),a=0,se=H,le=g,re=n,oe=o),O+=ce),ce<=0){a!=0&&(b(a,h,re,oe,se,le),a=0),O!=0&&(w(O,h,re,oe,se,le),O=0);break}}d<=l&&(g+=r.width[d],o+=r.width[d],F+=r.width[d])}O!=0&&(w(O,h,re,oe,se,le),O=0),a!=0&&(b(a,h,re,oe,se,le),a=0)}function B(n,i,h){var r=0,t=0;do{var d=n[i++],l=n[i++];r<d&&(r=d),t<l&&(t=l)}while(i<h);return r<t&&(r=t),r}function k(n,i,h,r,t,d){var l=Pe.ht[r].xlen*65536+Pe.ht[t].xlen,F=0,R;do{var O=n[i++],a=n[i++];O!=0&&(O>14&&(O=15,F+=l),O*=16),a!=0&&(a>14&&(a=15,F+=l),O+=a),F+=Pe.largetbl[O]}while(i<h);return R=F&65535,F>>=16,F>R&&(F=R,r=t),d.bits+=F,r}function D(n,i,h,r){var t=0,d=Pe.ht[1].hlen;do{var l=n[i+0]*2+n[i+1];i+=2,t+=d[l]}while(i<h);return r.bits+=t,1}function T(n,i,h,r,t){var d=0,l,F=Pe.ht[r].xlen,R;r==2?R=Pe.table23:R=Pe.table56;do{var O=n[i+0]*F+n[i+1];i+=2,d+=R[O]}while(i<h);return l=d&65535,d>>=16,d>l&&(d=l,r++),t.bits+=d,r}function V(n,i,h,r,t){var d=0,l=0,F=0,R=Pe.ht[r].xlen,O=Pe.ht[r].hlen,a=Pe.ht[r+1].hlen,o=Pe.ht[r+2].hlen;do{var H=n[i+0]*R+n[i+1];i+=2,d+=O[H],l+=a[H],F+=o[H]}while(i<h);var g=r;return d>l&&(d=l,g++),d>F&&(d=F,g=r+2),t.bits+=d,g}var y=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function G(n,i,h,r){var t=B(n,i,h);switch(t){case 0:return t;case 1:return D(n,i,h,r);case 2:case 3:return T(n,i,h,y[t-1],r);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return V(n,i,h,y[t-1],r);default:if(t>v0.IXMAX_VAL)return r.bits=v0.LARGE_BITS,-1;t-=15;var d;for(d=24;d<32&&!(Pe.ht[d].linmax>=t);d++);var l;for(l=d-8;l<24&&!(Pe.ht[l].linmax>=t);l++);return k(n,i,h,l,d,r)}}this.noquant_count_bits=function(n,i,h){var r=i.l3_enc,t=Math.min(576,i.max_nonzero_coeff+2>>1<<1);for(h!=null&&(h.sfb_count1=0);t>1&&!(r[t-1]|r[t-2]);t-=2);i.count1=t;for(var d=0,l=0;t>3;t-=4){var F;if(((r[t-1]|r[t-2]|r[t-3]|r[t-4])&2147483647)>1)break;F=((r[t-4]*2+r[t-3])*2+r[t-2])*2+r[t-1],d+=Pe.t32l[F],l+=Pe.t33l[F]}var R=d;if(i.count1table_select=0,d>l&&(R=l,i.count1table_select=1),i.count1bits=R,i.big_values=t,t==0)return R;if(i.block_type==Ve.SHORT_TYPE)d=3*n.scalefac_band.s[3],d>i.big_values&&(d=i.big_values),l=i.big_values;else if(i.block_type==Ve.NORM_TYPE){if(gt(t<=576),d=i.region0_count=n.bv_scf[t-2],l=i.region1_count=n.bv_scf[t-1],gt(d+l+2<Ve.SBPSY_l),l=n.scalefac_band.l[d+l+2],d=n.scalefac_band.l[d+1],l<t){var O=new s(R);i.table_select[2]=G(r,l,t,O),R=O.bits}}else i.region0_count=7,i.region1_count=Ve.SBMAX_l-1-7-1,d=n.scalefac_band.l[7+1],l=t,d>l&&(d=l);if(d=Math.min(d,t),l=Math.min(l,t),gt(d>=0),gt(l>=0),0<d){var O=new s(R);i.table_select[0]=G(r,0,d,O),R=O.bits}if(d<l){var O=new s(R);i.table_select[1]=G(r,d,l,O),R=O.bits}if(n.use_best_huffman==2&&(i.part2_3_length=R,best_huffman_divide(n,i),R=i.part2_3_length),h!=null&&i.block_type==Ve.NORM_TYPE){for(var a=0;n.scalefac_band.l[a]<i.big_values;)a++;h.sfb_count1=a}return R},this.count_bits=function(n,i,h,r){var t=h.l3_enc,d=v0.IXMAX_VAL/p.IPOW20(h.global_gain);if(h.xrpow_max>d)return v0.LARGE_BITS;if(I(i,t,p.IPOW20(h.global_gain),h,r),n.substep_shaping&2)for(var l=0,F=h.global_gain+h.scalefac_scale,R=.634521682242439/p.IPOW20(F),O=0;O<h.sfbmax;O++){var a=h.width[O];if(gt(a>=0),n.pseudohalf[O]==0)l+=a;else{var o;for(o=l,l+=a;o<l;++o)t[o]=i[o]>=R?t[o]:0}}return this.noquant_count_bits(n,h,r)};function Y(n,i,h,r,t,d,l){for(var F=i.big_values,R=0;R<=7+15;R++)r[R]=v0.LARGE_BITS;for(var R=0;R<16;R++){var O=n.scalefac_band.l[R+1];if(O>=F)break;var a=0,o=new s(a),H=G(h,0,O,o);a=o.bits;for(var g=0;g<8;g++){var se=n.scalefac_band.l[R+g+2];if(se>=F)break;var le=a;o=new s(le);var re=G(h,O,se,o);le=o.bits,r[R+g]>le&&(r[R+g]=le,t[R+g]=R,d[R+g]=H,l[R+g]=re)}}}function K(n,i,h,r,t,d,l,F){for(var R=i.big_values,O=2;O<Ve.SBMAX_l+1;O++){var a=n.scalefac_band.l[O];if(a>=R)break;var o=t[O-2]+i.count1bits;if(h.part2_3_length<=o)break;var H=new s(o),g=G(r,a,R,H);o=H.bits,!(h.part2_3_length<=o)&&(h.assign(i),h.part2_3_length=o,h.region0_count=d[O-2],h.region1_count=O-2-d[O-2],h.table_select[0]=l[O-2],h.table_select[1]=F[O-2],h.table_select[2]=g)}}this.best_huffman_divide=function(n,i){var h=new Ys,r=i.l3_enc,t=C0(7+15+1),d=C0(7+15+1),l=C0(7+15+1),F=C0(7+15+1);if(!(i.block_type==Ve.SHORT_TYPE&&n.mode_gr==1)){h.assign(i),i.block_type==Ve.NORM_TYPE&&(Y(n,i,r,t,d,l,F),K(n,h,i,r,t,d,l,F));var R=h.big_values;if(!(R==0||(r[R-2]|r[R-1])>1)&&(R=i.count1+2,!(R>576))){h.assign(i),h.count1=R;var O=0,a=0;for(gt(R<=576);R>h.big_values;R-=4){var o=((r[R-4]*2+r[R-3])*2+r[R-2])*2+r[R-1];O+=Pe.t32l[o],a+=Pe.t33l[o]}if(h.big_values=R,h.count1table_select=0,O>a&&(O=a,h.count1table_select=1),h.count1bits=O,h.block_type==Ve.NORM_TYPE)K(n,h,i,r,t,d,l,F);else{if(h.part2_3_length=O,O=n.scalefac_band.l[7+1],O>R&&(O=R),O>0){var H=new s(h.part2_3_length);h.table_select[0]=G(r,0,O,H),h.part2_3_length=H.bits}if(R>O){var H=new s(h.part2_3_length);h.table_select[1]=G(r,O,R,H),h.part2_3_length=H.bits}i.part2_3_length>h.part2_3_length&&i.assign(h)}}}};var q=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],U=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],L=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],_=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];Ma.slen1_tab=L,Ma.slen2_tab=_;function m(n,i){for(var h,r=i.tt[1][n],t=i.tt[0][n],d=0;d<Pe.scfsi_band.length-1;d++){for(h=Pe.scfsi_band[d];h<Pe.scfsi_band[d+1]&&!(t.scalefac[h]!=r.scalefac[h]&&r.scalefac[h]>=0);h++);if(h==Pe.scfsi_band[d+1]){for(h=Pe.scfsi_band[d];h<Pe.scfsi_band[d+1];h++)r.scalefac[h]=-1;i.scfsi[n][d]=1}}var l=0,F=0;for(h=0;h<11;h++)r.scalefac[h]!=-1&&(F++,l<r.scalefac[h]&&(l=r.scalefac[h]));for(var R=0,O=0;h<Ve.SBPSY_l;h++)r.scalefac[h]!=-1&&(O++,R<r.scalefac[h]&&(R=r.scalefac[h]));for(var d=0;d<16;d++)if(l<q[d]&&R<U[d]){var a=L[d]*F+_[d]*O;r.part2_length>a&&(r.part2_length=a,r.scalefac_compress=d)}}this.best_scalefac_store=function(n,i,h,r){var t=r.tt[i][h],d,l,F,R,O=0;for(F=0,d=0;d<t.sfbmax;d++){var a=t.width[d];for(gt(a>=0),F+=a,R=-a;R<0&&t.l3_enc[R+F]==0;R++);R==0&&(t.scalefac[d]=O=-2)}if(t.scalefac_scale==0&&t.preflag==0){var o=0;for(d=0;d<t.sfbmax;d++)t.scalefac[d]>0&&(o|=t.scalefac[d]);if(!(o&1)&&o!=0){for(d=0;d<t.sfbmax;d++)t.scalefac[d]>0&&(t.scalefac[d]>>=1);t.scalefac_scale=O=1}}if(t.preflag==0&&t.block_type!=Ve.SHORT_TYPE&&n.mode_gr==2){for(d=11;d<Ve.SBPSY_l&&!(t.scalefac[d]<p.pretab[d]&&t.scalefac[d]!=-2);d++);if(d==Ve.SBPSY_l){for(d=11;d<Ve.SBPSY_l;d++)t.scalefac[d]>0&&(t.scalefac[d]-=p.pretab[d]);t.preflag=O=1}}for(l=0;l<4;l++)r.scfsi[h][l]=0;for(n.mode_gr==2&&i==1&&r.tt[0][h].block_type!=Ve.SHORT_TYPE&&r.tt[1][h].block_type!=Ve.SHORT_TYPE&&(m(h,r),O=0),d=0;d<t.sfbmax;d++)t.scalefac[d]==-2&&(t.scalefac[d]=0);O!=0&&(n.mode_gr==2?this.scale_bitcount(t):this.scale_bitcount_lsf(n,t))};function E(n,i){for(var h=0;h<i;++h)if(n[h]<0)return!1;return!0}var e=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],v=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],f=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(n){var i,h,r=0,t=0,d,l=n.scalefac;if(gt(E(l,n.sfbmax)),n.block_type==Ve.SHORT_TYPE)d=e,n.mixed_block_flag!=0&&(d=v);else if(d=f,n.preflag==0){for(h=11;h<Ve.SBPSY_l&&!(l[h]<p.pretab[h]);h++);if(h==Ve.SBPSY_l)for(n.preflag=1,h=11;h<Ve.SBPSY_l;h++)l[h]-=p.pretab[h]}for(h=0;h<n.sfbdivide;h++)r<l[h]&&(r=l[h]);for(;h<n.sfbmax;h++)t<l[h]&&(t=l[h]);for(n.part2_length=v0.LARGE_BITS,i=0;i<16;i++)r<q[i]&&t<U[i]&&n.part2_length>d[i]&&(n.part2_length=d[i],n.scalefac_compress=i);return n.part2_length==v0.LARGE_BITS};var x=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(n,i){var h,r,t,d,l,F,R,O,a=C0(4),o=i.scalefac;for(i.preflag!=0?h=2:h=0,R=0;R<4;R++)a[R]=0;if(i.block_type==Ve.SHORT_TYPE){r=1;var H=p.nr_of_sfb_block[h][r];for(O=0,t=0;t<4;t++)for(d=H[t]/3,R=0;R<d;R++,O++)for(l=0;l<3;l++)o[O*3+l]>a[t]&&(a[t]=o[O*3+l])}else{r=0;var H=p.nr_of_sfb_block[h][r];for(O=0,t=0;t<4;t++)for(d=H[t],R=0;R<d;R++,O++)o[O]>a[t]&&(a[t]=o[O])}for(F=!1,t=0;t<4;t++)a[t]>x[h][t]&&(F=!0);if(!F){var g,se,le,re;for(i.sfb_partition_table=p.nr_of_sfb_block[h][r],t=0;t<4;t++)i.slen[t]=c[a[t]];switch(g=i.slen[0],se=i.slen[1],le=i.slen[2],re=i.slen[3],h){case 0:i.scalefac_compress=(g*5+se<<4)+(le<<2)+re;break;case 1:i.scalefac_compress=400+(g*5+se<<2)+le;break;case 2:i.scalefac_compress=500+g*3+se;break;default:Ds.err.printf(`intensity stereo not implemented yet
`);break}}if(!F)for(gt(i.sfb_partition_table!=null),i.part2_length=0,t=0;t<4;t++)i.part2_length+=i.slen[t]*i.sfb_partition_table[t];return F};var c=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(n){for(var i=2;i<=576;i+=2){for(var h=0,r;n.scalefac_band.l[++h]<i;);for(r=u[h][0];n.scalefac_band.l[r+1]>i;)r--;for(r<0&&(r=u[h][0]),n.bv_scf[i-2]=r,r=u[h][1];n.scalefac_band.l[r+n.bv_scf[i-2]+2]>i;)r--;r<0&&(r=u[h][1]),n.bv_scf[i-1]=r}}}var Ii=Ma,St=ge,Kt=St.System;St.VbrMode;St.Float;St.ShortBlock;St.Util;var Gs=St.Arrays;St.new_array_n;var $s=St.new_byte;St.new_double;St.new_float;var Us=St.new_float_n,Ks=St.new_int;St.new_int_n;var Se=St.assert,ii=Ii,pa=Ca,$0=Qe(),m0=J0;W0.EQ=function(p,s){return Math.abs(p)>Math.abs(s)?Math.abs(p-s)<=Math.abs(p)*1e-6:Math.abs(p-s)<=Math.abs(s)*1e-6};W0.NEQ=function(p,s){return!W0.EQ(p,s)};function W0(){var p=this,s=32773,u=32,b=null,w=null,I=null,B=null;this.setModules=function(c,n,i,h){b=c,w=n,I=i,B=h};var k=null,D=0,T=0,V=0;this.getframebits=function(c){var n=c.internal_flags,i;n.bitrate_index!=0?i=pa.bitrate_table[c.version][n.bitrate_index]:i=c.brate,Se(8<=i&&i<=640);var h=0|(c.version+1)*72e3*i/c.out_samplerate+n.padding;return 8*h};function y(c){Kt.arraycopy(c.header[c.w_ptr].buf,0,k,T,c.sideinfo_len),T+=c.sideinfo_len,D+=c.sideinfo_len*8,c.w_ptr=c.w_ptr+1&m0.MAX_HEADER_BUF-1}function G(c,n,i){for(Se(i<u-2);i>0;){var h;V==0&&(V=8,T++,Se(T<Lame.LAME_MAXMP3BUFFER),Se(c.header[c.w_ptr].write_timing>=D),c.header[c.w_ptr].write_timing==D&&y(c),k[T]=0),h=Math.min(i,V),i-=h,V-=h,Se(i<u),Se(V<u),k[T]|=n>>i<<V,D+=h}}function Y(c,n,i){for(Se(i<u-2);i>0;){var h;V==0&&(V=8,T++,Se(T<Lame.LAME_MAXMP3BUFFER),k[T]=0),h=Math.min(i,V),i-=h,V-=h,Se(i<u),Se(V<u),k[T]|=n>>i<<V,D+=h}}function K(c,n){var i=c.internal_flags,h;if(Se(n>=0),n>=8&&(G(i,76,8),n-=8),n>=8&&(G(i,65,8),n-=8),n>=8&&(G(i,77,8),n-=8),n>=8&&(G(i,69,8),n-=8),n>=32){var r=I.getLameShortVersion();if(n>=32)for(h=0;h<r.length&&n>=8;++h)n-=8,G(i,r.charAt(h),8)}for(;n>=1;n-=1)G(i,i.ancillary_flag,1),i.ancillary_flag^=c.disable_reservoir?0:1;Se(n==0)}function q(c,n,i){for(var h=c.header[c.h_ptr].ptr;i>0;){var r=Math.min(i,8-(h&7));i-=r,Se(i<u),c.header[c.h_ptr].buf[h>>3]|=n>>i<<8-(h&7)-r,h+=r}c.header[c.h_ptr].ptr=h}function U(c,n){c<<=8;for(var i=0;i<8;i++)c<<=1,n<<=1,(n^c)&65536&&(n^=s);return n}this.CRC_writeheader=function(c,n){var i=65535;i=U(n[2]&255,i),i=U(n[3]&255,i);for(var h=6;h<c.sideinfo_len;h++)i=U(n[h]&255,i);n[4]=byte(i>>8),n[5]=byte(i&255)};function L(c,n){var i=c.internal_flags,h,r,t;if(h=i.l3_side,i.header[i.h_ptr].ptr=0,Gs.fill(i.header[i.h_ptr].buf,0,i.sideinfo_len,0),c.out_samplerate<16e3?q(i,4094,12):q(i,4095,12),q(i,c.version,1),q(i,4-3,2),q(i,c.error_protection?0:1,1),q(i,i.bitrate_index,4),q(i,i.samplerate_index,2),q(i,i.padding,1),q(i,c.extension,1),q(i,c.mode.ordinal(),2),q(i,i.mode_ext,2),q(i,c.copyright,1),q(i,c.original,1),q(i,c.emphasis,2),c.error_protection&&q(i,0,16),c.version==1){for(Se(h.main_data_begin>=0),q(i,h.main_data_begin,9),i.channels_out==2?q(i,h.private_bits,3):q(i,h.private_bits,5),t=0;t<i.channels_out;t++){var d;for(d=0;d<4;d++)q(i,h.scfsi[t][d],1)}for(r=0;r<2;r++)for(t=0;t<i.channels_out;t++){var l=h.tt[r][t];q(i,l.part2_3_length+l.part2_length,12),q(i,l.big_values/2,9),q(i,l.global_gain,8),q(i,l.scalefac_compress,4),l.block_type!=$0.NORM_TYPE?(q(i,1,1),q(i,l.block_type,2),q(i,l.mixed_block_flag,1),l.table_select[0]==14&&(l.table_select[0]=16),q(i,l.table_select[0],5),l.table_select[1]==14&&(l.table_select[1]=16),q(i,l.table_select[1],5),q(i,l.subblock_gain[0],3),q(i,l.subblock_gain[1],3),q(i,l.subblock_gain[2],3)):(q(i,0,1),l.table_select[0]==14&&(l.table_select[0]=16),q(i,l.table_select[0],5),l.table_select[1]==14&&(l.table_select[1]=16),q(i,l.table_select[1],5),l.table_select[2]==14&&(l.table_select[2]=16),q(i,l.table_select[2],5),Se(0<=l.region0_count&&l.region0_count<16),Se(0<=l.region1_count&&l.region1_count<8),q(i,l.region0_count,4),q(i,l.region1_count,3)),q(i,l.preflag,1),q(i,l.scalefac_scale,1),q(i,l.count1table_select,1)}}else for(Se(h.main_data_begin>=0),q(i,h.main_data_begin,8),q(i,h.private_bits,i.channels_out),r=0,t=0;t<i.channels_out;t++){var l=h.tt[r][t];q(i,l.part2_3_length+l.part2_length,12),q(i,l.big_values/2,9),q(i,l.global_gain,8),q(i,l.scalefac_compress,9),l.block_type!=$0.NORM_TYPE?(q(i,1,1),q(i,l.block_type,2),q(i,l.mixed_block_flag,1),l.table_select[0]==14&&(l.table_select[0]=16),q(i,l.table_select[0],5),l.table_select[1]==14&&(l.table_select[1]=16),q(i,l.table_select[1],5),q(i,l.subblock_gain[0],3),q(i,l.subblock_gain[1],3),q(i,l.subblock_gain[2],3)):(q(i,0,1),l.table_select[0]==14&&(l.table_select[0]=16),q(i,l.table_select[0],5),l.table_select[1]==14&&(l.table_select[1]=16),q(i,l.table_select[1],5),l.table_select[2]==14&&(l.table_select[2]=16),q(i,l.table_select[2],5),Se(0<=l.region0_count&&l.region0_count<16),Se(0<=l.region1_count&&l.region1_count<8),q(i,l.region0_count,4),q(i,l.region1_count,3)),q(i,l.scalefac_scale,1),q(i,l.count1table_select,1)}c.error_protection&&CRC_writeheader(i,i.header[i.h_ptr].buf);{var F=i.h_ptr;Se(i.header[F].ptr==i.sideinfo_len*8),i.h_ptr=F+1&m0.MAX_HEADER_BUF-1,i.header[i.h_ptr].write_timing=i.header[F].write_timing+n,i.h_ptr==i.w_ptr&&Kt.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function _(c,n){var i=pa.ht[n.count1table_select+32],h,r=0,t=n.big_values,d=n.big_values;for(Se(n.count1table_select<2),h=(n.count1-n.big_values)/4;h>0;--h){var l=0,F=0,R;R=n.l3_enc[t+0],R!=0&&(F+=8,n.xr[d+0]<0&&l++,Se(R<=1)),R=n.l3_enc[t+1],R!=0&&(F+=4,l*=2,n.xr[d+1]<0&&l++,Se(R<=1)),R=n.l3_enc[t+2],R!=0&&(F+=2,l*=2,n.xr[d+2]<0&&l++,Se(R<=1)),R=n.l3_enc[t+3],R!=0&&(F++,l*=2,n.xr[d+3]<0&&l++,Se(R<=1)),t+=4,d+=4,G(c,l+i.table[F],i.hlen[F]),r+=i.hlen[F]}return r}function m(c,n,i,h,r){var t=pa.ht[n],d=0;if(Se(n<32),n==0)return d;for(var l=i;l<h;l+=2){var F=0,R=0,O=t.xlen,a=t.xlen,o=0,H=r.l3_enc[l],g=r.l3_enc[l+1];if(H!=0&&(r.xr[l]<0&&o++,F--),n>15){if(H>14){var se=H-15;Se(se<=t.linmax),o|=se<<1,R=O,H=15}if(g>14){var le=g-15;Se(le<=t.linmax),o<<=O,o|=le,R+=O,g=15}a=16}g!=0&&(o<<=1,r.xr[l+1]<0&&o++,F--),Se((H|g)<16),H=H*a+g,R-=F,F+=t.hlen[H],Se(F<=u),Se(R<=u),G(c,t.table[H],F),G(c,o,R),d+=F+R}return d}function E(c,n){var i=3*c.scalefac_band.s[3];i>n.big_values&&(i=n.big_values);var h=m(c,n.table_select[0],0,i,n);return h+=m(c,n.table_select[1],i,n.big_values,n),h}function e(c,n){var i,h,r,t;i=n.big_values,Se(0<=i&&i<=576);var d=n.region0_count+1;return Se(0<=d),Se(d<c.scalefac_band.l.length),r=c.scalefac_band.l[d],d+=n.region1_count+1,Se(0<=d),Se(d<c.scalefac_band.l.length),t=c.scalefac_band.l[d],r>i&&(r=i),t>i&&(t=i),h=m(c,n.table_select[0],0,r,n),h+=m(c,n.table_select[1],r,t,n),h+=m(c,n.table_select[2],t,i,n),h}function v(c){var n,i,h,r,t=0,d=c.internal_flags,l=d.l3_side;if(c.version==1)for(n=0;n<2;n++)for(i=0;i<d.channels_out;i++){var F=l.tt[n][i],R=ii.slen1_tab[F.scalefac_compress],O=ii.slen2_tab[F.scalefac_compress];for(r=0,h=0;h<F.sfbdivide;h++)F.scalefac[h]!=-1&&(G(d,F.scalefac[h],R),r+=R);for(;h<F.sfbmax;h++)F.scalefac[h]!=-1&&(G(d,F.scalefac[h],O),r+=O);Se(r==F.part2_length),F.block_type==$0.SHORT_TYPE?r+=E(d,F):r+=e(d,F),r+=_(d,F),Se(r==F.part2_3_length+F.part2_length),t+=r}else for(n=0,i=0;i<d.channels_out;i++){var F=l.tt[n][i],a,o,H=0;if(Se(F.sfb_partition_table!=null),r=0,h=0,o=0,F.block_type==$0.SHORT_TYPE){for(;o<4;o++){var g=F.sfb_partition_table[o]/3,se=F.slen[o];for(a=0;a<g;a++,h++)G(d,Math.max(F.scalefac[h*3+0],0),se),G(d,Math.max(F.scalefac[h*3+1],0),se),G(d,Math.max(F.scalefac[h*3+2],0),se),H+=3*se}r+=E(d,F)}else{for(;o<4;o++){var g=F.sfb_partition_table[o],se=F.slen[o];for(a=0;a<g;a++,h++)G(d,Math.max(F.scalefac[h],0),se),H+=se}r+=e(d,F)}r+=_(d,F),Se(r==F.part2_3_length),Se(H==F.part2_length),t+=H+r}return t}function f(){this.total=0}function x(c,n){var i=c.internal_flags,h,r,t,d,l;return l=i.w_ptr,d=i.h_ptr-1,d==-1&&(d=m0.MAX_HEADER_BUF-1),h=i.header[d].write_timing-D,n.total=h,h>=0&&(r=1+d-l,d<l&&(r=1+d-l+m0.MAX_HEADER_BUF),h-=r*8*i.sideinfo_len),t=p.getframebits(c),h+=t,n.total+=t,n.total%8!=0?n.total=1+n.total/8:n.total=n.total/8,n.total+=T+1,h<0&&Kt.err.println(`strange error flushing buffer ... 
`),h}this.flush_bitstream=function(c){var n=c.internal_flags,i,h,r=n.h_ptr-1;if(r==-1&&(r=m0.MAX_HEADER_BUF-1),i=n.l3_side,!((h=x(c,new f))<0)){if(K(c,h),Se(n.header[r].write_timing+this.getframebits(c)==D),n.ResvSize=0,i.main_data_begin=0,n.findReplayGain){var t=b.GetTitleGain(n.rgdata);Se(NEQ(t,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),n.RadioGain=Math.floor(t*10+.5)|0}n.findPeakSample&&(n.noclipGainChange=Math.ceil(Math.log10(n.PeakSample/32767)*20*10)|0,n.noclipGainChange>0&&(EQ(c.scale,1)||EQ(c.scale,0))?n.noclipScale=Math.floor(32767/n.PeakSample*100)/100:n.noclipScale=-1)}},this.add_dummy_byte=function(c,n,i){for(var h=c.internal_flags,r;i-- >0;)for(Y(h,n,8),r=0;r<m0.MAX_HEADER_BUF;++r)h.header[r].write_timing+=8},this.format_bitstream=function(c){var n=c.internal_flags,i;i=n.l3_side;var h=this.getframebits(c);K(c,i.resvDrain_pre),L(c,h);var r=8*n.sideinfo_len;if(r+=v(c),K(c,i.resvDrain_post),r+=i.resvDrain_post,i.main_data_begin+=(h-r)/8,x(c,new f)!=n.ResvSize&&Kt.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),i.main_data_begin*8!=n.ResvSize&&(Kt.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*i.main_data_begin,n.ResvSize,i.resvDrain_post,i.resvDrain_pre,8*n.sideinfo_len,r-i.resvDrain_post-8*n.sideinfo_len,r,r%8,h),Kt.err.println("This is a fatal error.  It has several possible causes:"),Kt.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),Kt.err.println(" 9%%  Your system is overclocked"),Kt.err.println(" 1%%  bug in LAME encoding library"),n.ResvSize=i.main_data_begin*8),Se(D%8==0),D>1e9){var t;for(t=0;t<m0.MAX_HEADER_BUF;++t)n.header[t].write_timing-=D;D=0}return 0},this.copy_buffer=function(c,n,i,h,r){var t=T+1;if(t<=0)return 0;if(h!=0&&t>h)return-1;if(Kt.arraycopy(k,0,n,i,t),T=-1,V=0,r!=0){var d=Ks(1);if(d[0]=c.nMusicCRC,B.updateMusicCRC(d,n,i,t),c.nMusicCRC=d[0],t>0&&(c.VBR_seek_table.nBytesWritten+=t),c.decode_on_the_fly){for(var l=Us([2,1152]),F=t,R=-1,O;R!=0;)if(R=w.hip_decode1_unclipped(c.hip,n,i,F,l[0],l[1]),F=0,R==-1&&(R=0),R>0){if(Se(R<=1152),c.findPeakSample){for(O=0;O<R;O++)l[0][O]>c.PeakSample?c.PeakSample=l[0][O]:-l[0][O]>c.PeakSample&&(c.PeakSample=-l[0][O]);if(c.channels_out>1)for(O=0;O<R;O++)l[1][O]>c.PeakSample?c.PeakSample=l[1][O]:-l[1][O]>c.PeakSample&&(c.PeakSample=-l[1][O])}if(c.findReplayGain&&b.AnalyzeSamples(c.rgdata,l[0],0,l[1],0,R,c.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return t},this.init_bit_stream_w=function(c){k=$s(Lame.LAME_MAXMP3BUFFER),c.h_ptr=c.w_ptr=0,c.header[c.h_ptr].write_timing=0,T=-1,V=0,D=0}}var La=W0;const Zs=wa(La);var et=ge,Ws=et.System,Ce=et.VbrMode;et.Float;var ba=et.ShortBlock;et.Util;et.Arrays;et.new_array_n;et.new_byte;et.new_double;var f0=et.new_float;et.new_float_n;et.new_int;var si=et.new_int_n,js=et.new_short_n,Lt=et.assert,Aa=as,Qs=rs,L0=J0,zs=Is,Js=Ls,en=Vs,p0=La,Zt=Ca,De=Qe();function Ue(){var p=this,s=128*1024;Ue.V9=410,Ue.V8=420,Ue.V7=430,Ue.V6=440,Ue.V5=450,Ue.V4=460,Ue.V3=470,Ue.V2=480,Ue.V1=490,Ue.V0=500,Ue.R3MIX=1e3,Ue.STANDARD=1001,Ue.EXTREME=1002,Ue.INSANE=1003,Ue.STANDARD_FAST=1004,Ue.EXTREME_FAST=1005,Ue.MEDIUM=1006,Ue.MEDIUM_FAST=1007;var u=16384+s;Ue.LAME_MAXMP3BUFFER=u;var b,w,I,B,k,D=new Aa,T,V,y;this.enc=new De,this.setModules=function(a,o,H,g,se,le,re,oe,be){b=a,w=o,I=H,B=g,k=se,T=le,V=oe,y=be,this.enc.setModules(w,D,B,T)};function G(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=f0(De.SBMAX_l),this.bo_s_weight=f0(De.SBMAX_s)}function Y(){this.lowerlimit=0}function K(a,o){this.lowpass=o}var q=4294479419;function U(a){var o;return a.class_id=q,o=a.internal_flags=new L0,a.mode=MPEGMode.NOT_SET,a.original=1,a.in_samplerate=44100,a.num_channels=2,a.num_samples=-1,a.bWriteVbrTag=!0,a.quality=-1,a.short_blocks=null,o.subblock_gain=-1,a.lowpassfreq=0,a.highpassfreq=0,a.lowpasswidth=-1,a.highpasswidth=-1,a.VBR=Ce.vbr_off,a.VBR_q=4,a.ATHcurve=-1,a.VBR_mean_bitrate_kbps=128,a.VBR_min_bitrate_kbps=0,a.VBR_max_bitrate_kbps=0,a.VBR_hard_min=0,o.VBR_min_bitrate=1,o.VBR_max_bitrate=13,a.quant_comp=-1,a.quant_comp_short=-1,a.msfix=-1,o.resample_ratio=1,o.OldValue[0]=180,o.OldValue[1]=180,o.CurrentStep[0]=4,o.CurrentStep[1]=4,o.masking_lower=1,o.nsPsy.attackthre=-1,o.nsPsy.attackthre_s=-1,a.scale=-1,a.athaa_type=-1,a.ATHtype=-1,a.athaa_loudapprox=-1,a.athaa_sensitivity=0,a.useTemporal=null,a.interChRatio=-1,o.mf_samples_to_encode=De.ENCDELAY+De.POSTDELAY,a.encoder_padding=0,o.mf_size=De.ENCDELAY-De.MDCTDELAY,a.findReplayGain=!1,a.decode_on_the_fly=!1,o.decode_on_the_fly=!1,o.findReplayGain=!1,o.findPeakSample=!1,o.RadioGain=0,o.AudiophileGain=0,o.noclipGainChange=0,o.noclipScale=-1,a.preset=0,a.write_id3tag_automatic=!0,0}this.lame_init=function(){var a=new Qs;return U(a),a.lame_allocated_gfp=1,a};function L(a){return a>1?0:a<=0?1:Math.cos(Math.PI/2*a)}this.nearestBitrateFullIndex=function(a){var o=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],H=0,g=0,se=0,le=0;le=o[16],se=16,g=o[16],H=16;for(var re=0;re<16;re++)if(Math.max(a,o[re+1])!=a){le=o[re+1],se=re+1,g=o[re],H=re;break}return le-a>a-g?H:se};function _(a,o){var H=44100;return o>=48e3?H=48e3:o>=44100?H=44100:o>=32e3?H=32e3:o>=24e3?H=24e3:o>=22050?H=22050:o>=16e3?H=16e3:o>=12e3?H=12e3:o>=11025?H=11025:o>=8e3&&(H=8e3),a==-1?H:(a<=15960&&(H=44100),a<=15250&&(H=32e3),a<=11220&&(H=24e3),a<=9970&&(H=22050),a<=7230&&(H=16e3),a<=5420&&(H=12e3),a<=4510&&(H=11025),a<=3970&&(H=8e3),o<H?o>44100?48e3:o>32e3?44100:o>24e3?32e3:o>22050?24e3:o>16e3?22050:o>12e3?16e3:o>11025?12e3:o>8e3?11025:8e3:H)}function m(a,o){switch(a){case 44100:return o.version=1,0;case 48e3:return o.version=1,1;case 32e3:return o.version=1,2;case 22050:return o.version=0,0;case 24e3:return o.version=0,1;case 16e3:return o.version=0,2;case 11025:return o.version=0,0;case 12e3:return o.version=0,1;case 8e3:return o.version=0,2;default:return o.version=0,-1}}function E(a,o,H){H<16e3&&(o=2);for(var g=Zt.bitrate_table[o][1],se=2;se<=14;se++)Zt.bitrate_table[o][se]>0&&Math.abs(Zt.bitrate_table[o][se]-a)<Math.abs(g-a)&&(g=Zt.bitrate_table[o][se]);return g}function e(a,o,H){H<16e3&&(o=2);for(var g=0;g<=14;g++)if(Zt.bitrate_table[o][g]>0&&Zt.bitrate_table[o][g]==a)return g;return-1}function v(a,o){var H=[new K(8,2e3),new K(16,3700),new K(24,3900),new K(32,5500),new K(40,7e3),new K(48,7500),new K(56,1e4),new K(64,11e3),new K(80,13500),new K(96,15100),new K(112,15600),new K(128,17e3),new K(160,17500),new K(192,18600),new K(224,19400),new K(256,19700),new K(320,20500)],g=p.nearestBitrateFullIndex(o);a.lowerlimit=H[g].lowpass}function f(a){var o=a.internal_flags,H=32,g=-1;if(o.lowpass1>0){for(var se=999,le=0;le<=31;le++){var re=le/31;re>=o.lowpass2&&(H=Math.min(H,le)),o.lowpass1<re&&re<o.lowpass2&&(se=Math.min(se,le))}se==999?o.lowpass1=(H-.75)/31:o.lowpass1=(se-.75)/31,o.lowpass2=H/31}if(o.highpass2>0&&o.highpass2<.9*(.75/31)&&(o.highpass1=0,o.highpass2=0,Ws.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),o.highpass2>0){for(var oe=-1,le=0;le<=31;le++){var re=le/31;re<=o.highpass1&&(g=Math.max(g,le)),o.highpass1<re&&re<o.highpass2&&(oe=Math.max(oe,le))}o.highpass1=g/31,oe==-1?o.highpass2=(g+.75)/31:o.highpass2=(oe+.75)/31}for(var le=0;le<32;le++){var be,ce,re=le/31;o.highpass2>o.highpass1?be=L((o.highpass2-re)/(o.highpass2-o.highpass1+1e-20)):be=1,o.lowpass2>o.lowpass1?ce=L((re-o.lowpass1)/(o.lowpass2-o.lowpass1+1e-20)):ce=1,o.amp_filter[le]=be*ce}}function x(a){var o=a.internal_flags;switch(a.quality){default:case 9:o.psymodel=0,o.noise_shaping=0,o.noise_shaping_amp=0,o.noise_shaping_stop=0,o.use_best_huffman=0,o.full_outer_loop=0;break;case 8:a.quality=7;case 7:o.psymodel=1,o.noise_shaping=0,o.noise_shaping_amp=0,o.noise_shaping_stop=0,o.use_best_huffman=0,o.full_outer_loop=0;break;case 6:o.psymodel=1,o.noise_shaping==0&&(o.noise_shaping=1),o.noise_shaping_amp=0,o.noise_shaping_stop=0,o.subblock_gain==-1&&(o.subblock_gain=1),o.use_best_huffman=0,o.full_outer_loop=0;break;case 5:o.psymodel=1,o.noise_shaping==0&&(o.noise_shaping=1),o.noise_shaping_amp=0,o.noise_shaping_stop=0,o.subblock_gain==-1&&(o.subblock_gain=1),o.use_best_huffman=0,o.full_outer_loop=0;break;case 4:o.psymodel=1,o.noise_shaping==0&&(o.noise_shaping=1),o.noise_shaping_amp=0,o.noise_shaping_stop=0,o.subblock_gain==-1&&(o.subblock_gain=1),o.use_best_huffman=1,o.full_outer_loop=0;break;case 3:o.psymodel=1,o.noise_shaping==0&&(o.noise_shaping=1),o.noise_shaping_amp=1,o.noise_shaping_stop=1,o.subblock_gain==-1&&(o.subblock_gain=1),o.use_best_huffman=1,o.full_outer_loop=0;break;case 2:o.psymodel=1,o.noise_shaping==0&&(o.noise_shaping=1),o.substep_shaping==0&&(o.substep_shaping=2),o.noise_shaping_amp=1,o.noise_shaping_stop=1,o.subblock_gain==-1&&(o.subblock_gain=1),o.use_best_huffman=1,o.full_outer_loop=0;break;case 1:o.psymodel=1,o.noise_shaping==0&&(o.noise_shaping=1),o.substep_shaping==0&&(o.substep_shaping=2),o.noise_shaping_amp=2,o.noise_shaping_stop=1,o.subblock_gain==-1&&(o.subblock_gain=1),o.use_best_huffman=1,o.full_outer_loop=0;break;case 0:o.psymodel=1,o.noise_shaping==0&&(o.noise_shaping=1),o.substep_shaping==0&&(o.substep_shaping=2),o.noise_shaping_amp=2,o.noise_shaping_stop=1,o.subblock_gain==-1&&(o.subblock_gain=1),o.use_best_huffman=1,o.full_outer_loop=0;break}}function c(a){var o=a.internal_flags;a.frameNum=0,a.write_id3tag_automatic&&V.id3tag_write_v2(a),o.bitrate_stereoMode_Hist=si([16,4+1]),o.bitrate_blockType_Hist=si([16,4+1+1]),o.PeakSample=0,a.bWriteVbrTag&&T.InitVbrTag(a)}this.lame_init_params=function(a){var o=a.internal_flags;if(o.Class_ID=0,o.ATH==null&&(o.ATH=new zs),o.PSY==null&&(o.PSY=new G),o.rgdata==null&&(o.rgdata=new Js),o.channels_in=a.num_channels,o.channels_in==1&&(a.mode=MPEGMode.MONO),o.channels_out=a.mode==MPEGMode.MONO?1:2,o.mode_ext=De.MPG_MD_MS_LR,a.mode==MPEGMode.MONO&&(a.force_ms=!1),a.VBR==Ce.vbr_off&&a.VBR_mean_bitrate_kbps!=128&&a.brate==0&&(a.brate=a.VBR_mean_bitrate_kbps),a.VBR==Ce.vbr_off||a.VBR==Ce.vbr_mtrh||a.VBR==Ce.vbr_mt||(a.free_format=!1),a.VBR==Ce.vbr_off&&a.brate==0&&p0.EQ(a.compression_ratio,0)&&(a.compression_ratio=11.025),a.VBR==Ce.vbr_off&&a.compression_ratio>0&&(a.out_samplerate==0&&(a.out_samplerate=map2MP3Frequency(int(.97*a.in_samplerate))),a.brate=0|a.out_samplerate*16*o.channels_out/(1e3*a.compression_ratio),o.samplerate_index=m(a.out_samplerate,a),a.free_format||(a.brate=E(a.brate,a.version,a.out_samplerate))),a.out_samplerate!=0&&(a.out_samplerate<16e3?(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,8),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,64)):a.out_samplerate<32e3?(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,8),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,160)):(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,32),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,320))),a.lowpassfreq==0){var H=16e3;switch(a.VBR){case Ce.vbr_off:{var g=new Y;v(g,a.brate),H=g.lowerlimit;break}case Ce.vbr_abr:{var g=new Y;v(g,a.VBR_mean_bitrate_kbps),H=g.lowerlimit;break}case Ce.vbr_rh:{var se=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=a.VBR_q&&a.VBR_q<=9){var le=se[a.VBR_q],re=se[a.VBR_q+1],oe=a.VBR_q_frac;H=linear_int(le,re,oe)}else H=19500;break}default:{var se=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=a.VBR_q&&a.VBR_q<=9){var le=se[a.VBR_q],re=se[a.VBR_q+1],oe=a.VBR_q_frac;H=linear_int(le,re,oe)}else H=19500}}a.mode==MPEGMode.MONO&&(a.VBR==Ce.vbr_off||a.VBR==Ce.vbr_abr)&&(H*=1.5),a.lowpassfreq=H|0}if(a.out_samplerate==0&&(2*a.lowpassfreq>a.in_samplerate&&(a.lowpassfreq=a.in_samplerate/2),a.out_samplerate=_(a.lowpassfreq|0,a.in_samplerate)),a.lowpassfreq=Math.min(20500,a.lowpassfreq),a.lowpassfreq=Math.min(a.out_samplerate/2,a.lowpassfreq),a.VBR==Ce.vbr_off&&(a.compression_ratio=a.out_samplerate*16*o.channels_out/(1e3*a.brate)),a.VBR==Ce.vbr_abr&&(a.compression_ratio=a.out_samplerate*16*o.channels_out/(1e3*a.VBR_mean_bitrate_kbps)),a.bWriteVbrTag||(a.findReplayGain=!1,a.decode_on_the_fly=!1,o.findPeakSample=!1),o.findReplayGain=a.findReplayGain,o.decode_on_the_fly=a.decode_on_the_fly,o.decode_on_the_fly&&(o.findPeakSample=!0),o.findReplayGain&&b.InitGainAnalysis(o.rgdata,a.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return a.internal_flags=null,-6;switch(o.decode_on_the_fly&&!a.decode_only&&(o.hip!=null&&y.hip_decode_exit(o.hip),o.hip=y.hip_decode_init()),o.mode_gr=a.out_samplerate<=24e3?1:2,a.framesize=576*o.mode_gr,a.encoder_delay=De.ENCDELAY,o.resample_ratio=a.in_samplerate/a.out_samplerate,a.VBR){case Ce.vbr_mt:case Ce.vbr_rh:case Ce.vbr_mtrh:{var be=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];a.compression_ratio=be[a.VBR_q]}break;case Ce.vbr_abr:a.compression_ratio=a.out_samplerate*16*o.channels_out/(1e3*a.VBR_mean_bitrate_kbps);break;default:a.compression_ratio=a.out_samplerate*16*o.channels_out/(1e3*a.brate);break}if(a.mode==MPEGMode.NOT_SET&&(a.mode=MPEGMode.JOINT_STEREO),a.highpassfreq>0?(o.highpass1=2*a.highpassfreq,a.highpasswidth>=0?o.highpass2=2*(a.highpassfreq+a.highpasswidth):o.highpass2=(1+0)*2*a.highpassfreq,o.highpass1/=a.out_samplerate,o.highpass2/=a.out_samplerate):(o.highpass1=0,o.highpass2=0),a.lowpassfreq>0?(o.lowpass2=2*a.lowpassfreq,a.lowpasswidth>=0?(o.lowpass1=2*(a.lowpassfreq-a.lowpasswidth),o.lowpass1<0&&(o.lowpass1=0)):o.lowpass1=(1-0)*2*a.lowpassfreq,o.lowpass1/=a.out_samplerate,o.lowpass2/=a.out_samplerate):(o.lowpass1=0,o.lowpass2=0),f(a),o.samplerate_index=m(a.out_samplerate,a),o.samplerate_index<0)return a.internal_flags=null,-1;if(a.VBR==Ce.vbr_off){if(a.free_format)o.bitrate_index=0;else if(a.brate=E(a.brate,a.version,a.out_samplerate),o.bitrate_index=e(a.brate,a.version,a.out_samplerate),o.bitrate_index<=0)return a.internal_flags=null,-1}else o.bitrate_index=1;a.analysis&&(a.bWriteVbrTag=!1),o.pinfo!=null&&(a.bWriteVbrTag=!1),w.init_bit_stream_w(o);for(var ce=o.samplerate_index+3*a.version+6*(a.out_samplerate<16e3?1:0),ne=0;ne<De.SBMAX_l+1;ne++)o.scalefac_band.l[ne]=B.sfBandIndex[ce].l[ne];for(var ne=0;ne<De.PSFB21+1;ne++){var Te=(o.scalefac_band.l[22]-o.scalefac_band.l[21])/De.PSFB21,Fe=o.scalefac_band.l[21]+ne*Te;o.scalefac_band.psfb21[ne]=Fe}o.scalefac_band.psfb21[De.PSFB21]=576;for(var ne=0;ne<De.SBMAX_s+1;ne++)o.scalefac_band.s[ne]=B.sfBandIndex[ce].s[ne];for(var ne=0;ne<De.PSFB12+1;ne++){var Te=(o.scalefac_band.s[13]-o.scalefac_band.s[12])/De.PSFB12,Fe=o.scalefac_band.s[12]+ne*Te;o.scalefac_band.psfb12[ne]=Fe}o.scalefac_band.psfb12[De.PSFB12]=192,a.version==1?o.sideinfo_len=o.channels_out==1?4+17:4+32:o.sideinfo_len=o.channels_out==1?4+9:4+17,a.error_protection&&(o.sideinfo_len+=2),c(a),o.Class_ID=q;{var Ae;for(Ae=0;Ae<19;Ae++)o.nsPsy.pefirbuf[Ae]=700*o.mode_gr*o.channels_out;a.ATHtype==-1&&(a.ATHtype=4)}switch(Lt(a.VBR_q<=9),Lt(a.VBR_q>=0),a.VBR){case Ce.vbr_mt:a.VBR=Ce.vbr_mtrh;case Ce.vbr_mtrh:{a.useTemporal==null&&(a.useTemporal=!1),I.apply_preset(a,500-a.VBR_q*10,0),a.quality<0&&(a.quality=LAME_DEFAULT_QUALITY),a.quality<5&&(a.quality=0),a.quality>5&&(a.quality=5),o.PSY.mask_adjust=a.maskingadjust,o.PSY.mask_adjust_short=a.maskingadjust_short,a.experimentalY?o.sfb21_extra=!1:o.sfb21_extra=a.out_samplerate>44e3,o.iteration_loop=new VBRNewIterationLoop(k);break}case Ce.vbr_rh:{I.apply_preset(a,500-a.VBR_q*10,0),o.PSY.mask_adjust=a.maskingadjust,o.PSY.mask_adjust_short=a.maskingadjust_short,a.experimentalY?o.sfb21_extra=!1:o.sfb21_extra=a.out_samplerate>44e3,a.quality>6&&(a.quality=6),a.quality<0&&(a.quality=LAME_DEFAULT_QUALITY),o.iteration_loop=new VBROldIterationLoop(k);break}default:{var we;o.sfb21_extra=!1,a.quality<0&&(a.quality=LAME_DEFAULT_QUALITY),we=a.VBR,we==Ce.vbr_off&&(a.VBR_mean_bitrate_kbps=a.brate),I.apply_preset(a,a.VBR_mean_bitrate_kbps,0),a.VBR=we,o.PSY.mask_adjust=a.maskingadjust,o.PSY.mask_adjust_short=a.maskingadjust_short,we==Ce.vbr_off?o.iteration_loop=new en(k):o.iteration_loop=new ABRIterationLoop(k);break}}if(Lt(a.scale>=0),a.VBR!=Ce.vbr_off){if(o.VBR_min_bitrate=1,o.VBR_max_bitrate=14,a.out_samplerate<16e3&&(o.VBR_max_bitrate=8),a.VBR_min_bitrate_kbps!=0&&(a.VBR_min_bitrate_kbps=E(a.VBR_min_bitrate_kbps,a.version,a.out_samplerate),o.VBR_min_bitrate=e(a.VBR_min_bitrate_kbps,a.version,a.out_samplerate),o.VBR_min_bitrate<0)||a.VBR_max_bitrate_kbps!=0&&(a.VBR_max_bitrate_kbps=E(a.VBR_max_bitrate_kbps,a.version,a.out_samplerate),o.VBR_max_bitrate=e(a.VBR_max_bitrate_kbps,a.version,a.out_samplerate),o.VBR_max_bitrate<0))return-1;a.VBR_min_bitrate_kbps=Zt.bitrate_table[a.version][o.VBR_min_bitrate],a.VBR_max_bitrate_kbps=Zt.bitrate_table[a.version][o.VBR_max_bitrate],a.VBR_mean_bitrate_kbps=Math.min(Zt.bitrate_table[a.version][o.VBR_max_bitrate],a.VBR_mean_bitrate_kbps),a.VBR_mean_bitrate_kbps=Math.max(Zt.bitrate_table[a.version][o.VBR_min_bitrate],a.VBR_mean_bitrate_kbps)}return a.tune&&(o.PSY.mask_adjust+=a.tune_value_a,o.PSY.mask_adjust_short+=a.tune_value_a),x(a),Lt(a.scale>=0),a.athaa_type<0?o.ATH.useAdjust=3:o.ATH.useAdjust=a.athaa_type,o.ATH.aaSensitivityP=Math.pow(10,a.athaa_sensitivity/-10),a.short_blocks==null&&(a.short_blocks=ba.short_block_allowed),a.short_blocks==ba.short_block_allowed&&(a.mode==MPEGMode.JOINT_STEREO||a.mode==MPEGMode.STEREO)&&(a.short_blocks=ba.short_block_coupled),a.quant_comp<0&&(a.quant_comp=1),a.quant_comp_short<0&&(a.quant_comp_short=0),a.msfix<0&&(a.msfix=0),a.exp_nspsytune=a.exp_nspsytune|1,a.internal_flags.nsPsy.attackthre<0&&(a.internal_flags.nsPsy.attackthre=Aa.NSATTACKTHRE),a.internal_flags.nsPsy.attackthre_s<0&&(a.internal_flags.nsPsy.attackthre_s=Aa.NSATTACKTHRE_S),Lt(a.scale>=0),a.scale<0&&(a.scale=1),a.ATHtype<0&&(a.ATHtype=4),a.ATHcurve<0&&(a.ATHcurve=4),a.athaa_loudapprox<0&&(a.athaa_loudapprox=2),a.interChRatio<0&&(a.interChRatio=0),a.useTemporal==null&&(a.useTemporal=!0),o.slot_lag=o.frac_SpF=0,a.VBR==Ce.vbr_off&&(o.slot_lag=o.frac_SpF=(a.version+1)*72e3*a.brate%a.out_samplerate|0),B.iteration_init(a),D.psymodel_init(a),Lt(a.scale>=0),0};function n(a,o){(a.in_buffer_0==null||a.in_buffer_nsamples<o)&&(a.in_buffer_0=f0(o),a.in_buffer_1=f0(o),a.in_buffer_nsamples=o)}this.lame_encode_flush=function(a,o,H,g){var se=a.internal_flags,le=js([2,1152]),re=0,oe,be,ce,ne,Te=se.mf_samples_to_encode-De.POSTDELAY,Fe=i(a);if(se.mf_samples_to_encode<1)return 0;for(oe=0,a.in_samplerate!=a.out_samplerate&&(Te+=16*a.out_samplerate/a.in_samplerate),ce=a.framesize-Te%a.framesize,ce<576&&(ce+=a.framesize),a.encoder_padding=ce,ne=(Te+ce)/a.framesize;ne>0&&re>=0;){var Ae=Fe-se.mf_size,we=a.frameNum;Ae*=a.in_samplerate,Ae/=a.out_samplerate,Ae>1152&&(Ae=1152),Ae<1&&(Ae=1),be=g-oe,g==0&&(be=0),re=this.lame_encode_buffer(a,le[0],le[1],Ae,o,H,be),H+=re,oe+=re,ne-=we!=a.frameNum?1:0}if(se.mf_samples_to_encode=0,re<0||(be=g-oe,g==0&&(be=0),w.flush_bitstream(a),re=w.copy_buffer(se,o,H,be,1),re<0))return re;if(H+=re,oe+=re,be=g-oe,g==0&&(be=0),a.write_id3tag_automatic){if(V.id3tag_write_v1(a),re=w.copy_buffer(se,o,H,be,0),re<0)return re;oe+=re}return oe},this.lame_encode_buffer=function(a,o,H,g,se,le,re){var oe=a.internal_flags,be=[null,null];if(oe.Class_ID!=q)return-3;if(g==0)return 0;n(oe,g),be[0]=oe.in_buffer_0,be[1]=oe.in_buffer_1;for(var ce=0;ce<g;ce++)be[0][ce]=o[ce],oe.channels_in>1&&(be[1][ce]=H[ce]);return h(a,be[0],be[1],g,se,le,re)};function i(a){var o=De.BLKSIZE+a.framesize-De.FFTOFFSET;return o=Math.max(o,512+a.framesize-32),Lt(L0.MFSIZE>=o),o}function h(a,o,H,g,se,le,re){var oe=a.internal_flags,be=0,ce,ne,Te,Fe,Ae,we=[null,null],Me=[null,null];if(oe.Class_ID!=q)return-3;if(g==0)return 0;if(Ae=w.copy_buffer(oe,se,le,re,0),Ae<0)return Ae;if(le+=Ae,be+=Ae,Me[0]=o,Me[1]=H,p0.NEQ(a.scale,0)&&p0.NEQ(a.scale,1))for(ne=0;ne<g;++ne)Me[0][ne]*=a.scale,oe.channels_out==2&&(Me[1][ne]*=a.scale);if(p0.NEQ(a.scale_left,0)&&p0.NEQ(a.scale_left,1))for(ne=0;ne<g;++ne)Me[0][ne]*=a.scale_left;if(p0.NEQ(a.scale_right,0)&&p0.NEQ(a.scale_right,1))for(ne=0;ne<g;++ne)Me[1][ne]*=a.scale_right;if(a.num_channels==2&&oe.channels_out==1)for(ne=0;ne<g;++ne)Me[0][ne]=.5*(Me[0][ne]+Me[1][ne]),Me[1][ne]=0;Fe=i(a),we[0]=oe.mfbuf[0],we[1]=oe.mfbuf[1];for(var qe=0;g>0;){var Ke=[null,null],$t=0,wt=0;Ke[0]=Me[0],Ke[1]=Me[1];var tt=new t;if(O(a,we,Ke,qe,g,tt),$t=tt.n_in,wt=tt.n_out,oe.findReplayGain&&!oe.decode_on_the_fly&&b.AnalyzeSamples(oe.rgdata,we[0],oe.mf_size,we[1],oe.mf_size,wt,oe.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(g-=$t,qe+=$t,oe.channels_out==2,oe.mf_size+=wt,Lt(oe.mf_size<=L0.MFSIZE),oe.mf_samples_to_encode<1&&(oe.mf_samples_to_encode=De.ENCDELAY+De.POSTDELAY),oe.mf_samples_to_encode+=wt,oe.mf_size>=Fe){var Vt=re-be;if(re==0&&(Vt=0),ce=r(a,we[0],we[1],se,le,Vt),ce<0)return ce;for(le+=ce,be+=ce,oe.mf_size-=a.framesize,oe.mf_samples_to_encode-=a.framesize,Te=0;Te<oe.channels_out;Te++)for(ne=0;ne<oe.mf_size;ne++)we[Te][ne]=we[Te][ne+a.framesize]}}return Lt(g==0),be}function r(a,o,H,g,se,le){var re=p.enc.lame_encode_mp3_frame(a,o,H,g,se,le);return a.frameNum++,re}function t(){this.n_in=0,this.n_out=0}function d(){this.num_used=0}function l(a,o){return o!=0?l(o,a%o):a}function F(a,o,H){var g=Math.PI*o;a/=H,a<0&&(a=0),a>1&&(a=1);var se=a-.5,le=.42-.5*Math.cos(2*a*Math.PI)+.08*Math.cos(4*a*Math.PI);return Math.abs(se)<1e-9?g/Math.PI:le*Math.sin(H*g*se)/(Math.PI*H*se)}function R(a,o,H,g,se,le,re,oe,be){var ce=a.internal_flags,ne,Te=0,Fe,Ae=a.out_samplerate/l(a.out_samplerate,a.in_samplerate);Ae>L0.BPC&&(Ae=L0.BPC);var we=Math.abs(ce.resample_ratio-Math.floor(.5+ce.resample_ratio))<1e-4?1:0,Me=1/ce.resample_ratio;Me>1&&(Me=1);var qe=31;qe%2==0&&--qe,qe+=we;var Ke=qe+1;if(ce.fill_buffer_resample_init==0){for(ce.inbuf_old[0]=f0(Ke),ce.inbuf_old[1]=f0(Ke),ne=0;ne<=2*Ae;++ne)ce.blackfilt[ne]=f0(Ke);for(ce.itime[0]=0,ce.itime[1]=0,Te=0;Te<=2*Ae;Te++){var $t=0,wt=(Te-Ae)/(2*Ae);for(ne=0;ne<=qe;ne++)$t+=ce.blackfilt[Te][ne]=F(ne-wt,Me,qe);for(ne=0;ne<=qe;ne++)ce.blackfilt[Te][ne]/=$t}ce.fill_buffer_resample_init=1}var tt=ce.inbuf_old[be];for(Fe=0;Fe<g;Fe++){var Vt,i0;if(Vt=Fe*ce.resample_ratio,Te=0|Math.floor(Vt-ce.itime[be]),qe+Te-qe/2>=re)break;var wt=Vt-ce.itime[be]-(Te+.5*(qe%2));Lt(Math.abs(wt)<=.501),i0=0|Math.floor(wt*2*Ae+Ae+.5);var t0=0;for(ne=0;ne<=qe;++ne){var ze=0|ne+Te-qe/2,s0;Lt(ze<re),Lt(ze+Ke>=0),s0=ze<0?tt[Ke+ze]:se[le+ze],t0+=s0*ce.blackfilt[i0][ne]}o[H+Fe]=t0}if(oe.num_used=Math.min(re,qe+Te-qe/2),ce.itime[be]+=oe.num_used-Fe*ce.resample_ratio,oe.num_used>=Ke)for(ne=0;ne<Ke;ne++)tt[ne]=se[le+oe.num_used+ne-Ke];else{var jt=Ke-oe.num_used;for(ne=0;ne<jt;++ne)tt[ne]=tt[ne+oe.num_used];for(Te=0;ne<Ke;++ne,++Te)tt[ne]=se[le+Te];Lt(Te==oe.num_used)}return Fe}function O(a,o,H,g,se,le){var re=a.internal_flags;if(re.resample_ratio<.9999||re.resample_ratio>1.0001)for(var oe=0;oe<re.channels_out;oe++){var be=new d;le.n_out=R(a,o[oe],re.mf_size,a.framesize,H[oe],g,se,be,oe),le.n_in=be.num_used}else{le.n_out=Math.min(a.framesize,se),le.n_in=le.n_out;for(var ce=0;ce<le.n_out;++ce)o[0][re.mf_size+ce]=H[0][g+ce],re.channels_out==2&&(o[1][re.mf_size+ce]=H[1][g+ce])}}}var Ci=Ue;const tn=wa(Ci);var yt=ge;yt.System;var Wt=yt.VbrMode;yt.Float;yt.ShortBlock;yt.Util;yt.Arrays;yt.new_array_n;yt.new_byte;yt.new_double;yt.new_float;yt.new_float_n;yt.new_int;yt.new_int_n;yt.assert;function an(){function p(T,V,y,G,Y,K,q,U,L,_,m,E,e,v,f){this.vbr_q=T,this.quant_comp=V,this.quant_comp_s=y,this.expY=G,this.st_lrm=Y,this.st_s=K,this.masking_adj=q,this.masking_adj_short=U,this.ath_lower=L,this.ath_curve=_,this.ath_sensitivity=m,this.interch=E,this.safejoint=e,this.sfb21mod=v,this.msfix=f}function s(T,V,y,G,Y,K,q,U,L,_,m,E,e,v){this.quant_comp=V,this.quant_comp_s=y,this.safejoint=G,this.nsmsfix=Y,this.st_lrm=K,this.st_s=q,this.nsbass=U,this.scale=L,this.masking_adj=_,this.ath_lower=m,this.ath_curve=E,this.interch=e,this.sfscale=v}var u;this.setModules=function(T){u=T};var b=[new p(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new p(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new p(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new p(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new p(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new p(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new p(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new p(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new p(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new p(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new p(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],w=[new p(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new p(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new p(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new p(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new p(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new p(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new p(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new p(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new p(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new p(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new p(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function I(T,V,y){var G=T.VBR==Wt.vbr_rh?b:w,Y=T.VBR_q_frac,K=G[V],q=G[V+1],U=K;K.st_lrm=K.st_lrm+Y*(q.st_lrm-K.st_lrm),K.st_s=K.st_s+Y*(q.st_s-K.st_s),K.masking_adj=K.masking_adj+Y*(q.masking_adj-K.masking_adj),K.masking_adj_short=K.masking_adj_short+Y*(q.masking_adj_short-K.masking_adj_short),K.ath_lower=K.ath_lower+Y*(q.ath_lower-K.ath_lower),K.ath_curve=K.ath_curve+Y*(q.ath_curve-K.ath_curve),K.ath_sensitivity=K.ath_sensitivity+Y*(q.ath_sensitivity-K.ath_sensitivity),K.interch=K.interch+Y*(q.interch-K.interch),K.msfix=K.msfix+Y*(q.msfix-K.msfix),D(T,U.vbr_q),y!=0?T.quant_comp=U.quant_comp:Math.abs(T.quant_comp- -1)>0||(T.quant_comp=U.quant_comp),y!=0?T.quant_comp_short=U.quant_comp_s:Math.abs(T.quant_comp_short- -1)>0||(T.quant_comp_short=U.quant_comp_s),U.expY!=0&&(T.experimentalY=U.expY!=0),y!=0?T.internal_flags.nsPsy.attackthre=U.st_lrm:Math.abs(T.internal_flags.nsPsy.attackthre- -1)>0||(T.internal_flags.nsPsy.attackthre=U.st_lrm),y!=0?T.internal_flags.nsPsy.attackthre_s=U.st_s:Math.abs(T.internal_flags.nsPsy.attackthre_s- -1)>0||(T.internal_flags.nsPsy.attackthre_s=U.st_s),y!=0?T.maskingadjust=U.masking_adj:Math.abs(T.maskingadjust-0)>0||(T.maskingadjust=U.masking_adj),y!=0?T.maskingadjust_short=U.masking_adj_short:Math.abs(T.maskingadjust_short-0)>0||(T.maskingadjust_short=U.masking_adj_short),y!=0?T.ATHlower=-U.ath_lower/10:Math.abs(-T.ATHlower*10-0)>0||(T.ATHlower=-U.ath_lower/10),y!=0?T.ATHcurve=U.ath_curve:Math.abs(T.ATHcurve- -1)>0||(T.ATHcurve=U.ath_curve),y!=0?T.athaa_sensitivity=U.ath_sensitivity:Math.abs(T.athaa_sensitivity- -1)>0||(T.athaa_sensitivity=U.ath_sensitivity),U.interch>0&&(y!=0?T.interChRatio=U.interch:Math.abs(T.interChRatio- -1)>0||(T.interChRatio=U.interch)),U.safejoint>0&&(T.exp_nspsytune=T.exp_nspsytune|U.safejoint),U.sfb21mod>0&&(T.exp_nspsytune=T.exp_nspsytune|U.sfb21mod<<20),y!=0?T.msfix=U.msfix:Math.abs(T.msfix- -1)>0||(T.msfix=U.msfix),y==0&&(T.VBR_q=V,T.VBR_q_frac=Y)}var B=[new s(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new s(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new s(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new s(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new s(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new s(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new s(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new s(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new s(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new s(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new s(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new s(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new s(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new s(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new s(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new s(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new s(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function k(T,V,y){var G=V,Y=u.nearestBitrateFullIndex(V);if(T.VBR=Wt.vbr_abr,T.VBR_mean_bitrate_kbps=G,T.VBR_mean_bitrate_kbps=Math.min(T.VBR_mean_bitrate_kbps,320),T.VBR_mean_bitrate_kbps=Math.max(T.VBR_mean_bitrate_kbps,8),T.brate=T.VBR_mean_bitrate_kbps,T.VBR_mean_bitrate_kbps>320&&(T.disable_reservoir=!0),B[Y].safejoint>0&&(T.exp_nspsytune=T.exp_nspsytune|2),B[Y].sfscale>0&&(T.internal_flags.noise_shaping=2),Math.abs(B[Y].nsbass)>0){var K=int(B[Y].nsbass*4);K<0&&(K+=64),T.exp_nspsytune=T.exp_nspsytune|K<<2}return y!=0?T.quant_comp=B[Y].quant_comp:Math.abs(T.quant_comp- -1)>0||(T.quant_comp=B[Y].quant_comp),y!=0?T.quant_comp_short=B[Y].quant_comp_s:Math.abs(T.quant_comp_short- -1)>0||(T.quant_comp_short=B[Y].quant_comp_s),y!=0?T.msfix=B[Y].nsmsfix:Math.abs(T.msfix- -1)>0||(T.msfix=B[Y].nsmsfix),y!=0?T.internal_flags.nsPsy.attackthre=B[Y].st_lrm:Math.abs(T.internal_flags.nsPsy.attackthre- -1)>0||(T.internal_flags.nsPsy.attackthre=B[Y].st_lrm),y!=0?T.internal_flags.nsPsy.attackthre_s=B[Y].st_s:Math.abs(T.internal_flags.nsPsy.attackthre_s- -1)>0||(T.internal_flags.nsPsy.attackthre_s=B[Y].st_s),y!=0?T.scale=B[Y].scale:Math.abs(T.scale- -1)>0||(T.scale=B[Y].scale),y!=0?T.maskingadjust=B[Y].masking_adj:Math.abs(T.maskingadjust-0)>0||(T.maskingadjust=B[Y].masking_adj),B[Y].masking_adj>0?y!=0?T.maskingadjust_short=B[Y].masking_adj*.9:Math.abs(T.maskingadjust_short-0)>0||(T.maskingadjust_short=B[Y].masking_adj*.9):y!=0?T.maskingadjust_short=B[Y].masking_adj*1.1:Math.abs(T.maskingadjust_short-0)>0||(T.maskingadjust_short=B[Y].masking_adj*1.1),y!=0?T.ATHlower=-B[Y].ath_lower/10:Math.abs(-T.ATHlower*10-0)>0||(T.ATHlower=-B[Y].ath_lower/10),y!=0?T.ATHcurve=B[Y].ath_curve:Math.abs(T.ATHcurve- -1)>0||(T.ATHcurve=B[Y].ath_curve),y!=0?T.interChRatio=B[Y].interch:Math.abs(T.interChRatio- -1)>0||(T.interChRatio=B[Y].interch),V}this.apply_preset=function(T,V,y){switch(V){case Lame.R3MIX:{V=Lame.V3,T.VBR=Wt.vbr_mtrh;break}case Lame.MEDIUM:{V=Lame.V4,T.VBR=Wt.vbr_rh;break}case Lame.MEDIUM_FAST:{V=Lame.V4,T.VBR=Wt.vbr_mtrh;break}case Lame.STANDARD:{V=Lame.V2,T.VBR=Wt.vbr_rh;break}case Lame.STANDARD_FAST:{V=Lame.V2,T.VBR=Wt.vbr_mtrh;break}case Lame.EXTREME:{V=Lame.V0,T.VBR=Wt.vbr_rh;break}case Lame.EXTREME_FAST:{V=Lame.V0,T.VBR=Wt.vbr_mtrh;break}case Lame.INSANE:return V=320,T.preset=V,k(T,V,y),T.VBR=Wt.vbr_off,V}switch(T.preset=V,V){case Lame.V9:return I(T,9,y),V;case Lame.V8:return I(T,8,y),V;case Lame.V7:return I(T,7,y),V;case Lame.V6:return I(T,6,y),V;case Lame.V5:return I(T,5,y),V;case Lame.V4:return I(T,4,y),V;case Lame.V3:return I(T,3,y),V;case Lame.V2:return I(T,2,y),V;case Lame.V1:return I(T,1,y),V;case Lame.V0:return I(T,0,y),V}return 8<=V&&V<=320?k(T,V,y):(T.preset=0,V)};function D(T,V){var y=0;return 0>V&&(y=-1,V=0),9<V&&(y=-1,V=9),T.VBR_q=V,T.VBR_q_frac=0,y}}var sn=an;function nn(){this.setModules=function(p,s){}}var rn=nn;function on(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var ln=on,ka=ge,ni=ka.new_float,_n=ka.new_int;ka.assert;function hn(){this.global_gain=0,this.sfb_count1=0,this.step=_n(39),this.noise=ni(39),this.noise_log=ni(39)}var cn=hn,xt=ge,a0=xt.System,ri=xt.VbrMode;xt.Float;xt.ShortBlock;var Ea=xt.Util,T0=xt.Arrays;xt.new_array_n;xt.new_byte;xt.new_double;var k0=xt.new_float;xt.new_float_n;xt.new_int;xt.new_int_n;var Ft=xt.assert,un=rn,Sa=ln,dn=cn,Re=Qe(),oi=Ia,li=z0;function vn(){var p;this.rv=null;var s;this.qupvt=null;var u,b=new un,w;this.setModules=function(L,_,m,E){p=L,s=_,this.rv=_,u=m,this.qupvt=m,w=E,b.setModules(u,w)},this.ms_convert=function(L,_){for(var m=0;m<576;++m){var E=L.tt[_][0].xr[m],e=L.tt[_][1].xr[m];L.tt[_][0].xr[m]=(E+e)*(Ea.SQRT2*.5),L.tt[_][1].xr[m]=(E-e)*(Ea.SQRT2*.5)}};function I(L,_,m,E){E=0;for(var e=0;e<=m;++e){var v=Math.abs(L.xr[e]);E+=v,_[e]=Math.sqrt(v*Math.sqrt(v)),_[e]>L.xrpow_max&&(L.xrpow_max=_[e])}return E}this.init_xrpow=function(L,_,m){var E=0,e=0|_.max_nonzero_coeff;if(Ft(m!=null),_.xrpow_max=0,Ft(0<=e&&e<=575),T0.fill(m,e,576,0),E=I(_,m,e,E),E>1e-20){var v=0;L.substep_shaping&2&&(v=1);for(var f=0;f<_.psymax;f++)L.pseudohalf[f]=v;return!0}return T0.fill(_.l3_enc,0,576,0),!1};function B(L,_){var m=L.ATH,E=_.xr;if(_.block_type!=Re.SHORT_TYPE)for(var e=!1,v=Re.PSFB21-1;v>=0&&!e;v--){var f=L.scalefac_band.psfb21[v],x=L.scalefac_band.psfb21[v+1],c=u.athAdjust(m.adjust,m.psfb21[v],m.floor);L.nsPsy.longfact[21]>1e-12&&(c*=L.nsPsy.longfact[21]);for(var n=x-1;n>=f;n--)if(Math.abs(E[n])<c)E[n]=0;else{e=!0;break}}else for(var i=0;i<3;i++)for(var e=!1,v=Re.PSFB12-1;v>=0&&!e;v--){var f=L.scalefac_band.s[12]*3+(L.scalefac_band.s[13]-L.scalefac_band.s[12])*i+(L.scalefac_band.psfb12[v]-L.scalefac_band.psfb12[0]),x=f+(L.scalefac_band.psfb12[v+1]-L.scalefac_band.psfb12[v]),h=u.athAdjust(m.adjust,m.psfb12[v],m.floor);L.nsPsy.shortfact[12]>1e-12&&(h*=L.nsPsy.shortfact[12]);for(var n=x-1;n>=f;n--)if(Math.abs(E[n])<h)E[n]=0;else{e=!0;break}}}this.init_outer_loop=function(L,_){_.part2_3_length=0,_.big_values=0,_.count1=0,_.global_gain=210,_.scalefac_compress=0,_.table_select[0]=0,_.table_select[1]=0,_.table_select[2]=0,_.subblock_gain[0]=0,_.subblock_gain[1]=0,_.subblock_gain[2]=0,_.subblock_gain[3]=0,_.region0_count=0,_.region1_count=0,_.preflag=0,_.scalefac_scale=0,_.count1table_select=0,_.part2_length=0,_.sfb_lmax=Re.SBPSY_l,_.sfb_smin=Re.SBPSY_s,_.psy_lmax=L.sfb21_extra?Re.SBMAX_l:Re.SBPSY_l,_.psymax=_.psy_lmax,_.sfbmax=_.sfb_lmax,_.sfbdivide=11;for(var m=0;m<Re.SBMAX_l;m++)_.width[m]=L.scalefac_band.l[m+1]-L.scalefac_band.l[m],_.window[m]=3;if(_.block_type==Re.SHORT_TYPE){var E=k0(576);_.sfb_smin=0,_.sfb_lmax=0,_.mixed_block_flag!=0&&(_.sfb_smin=3,_.sfb_lmax=L.mode_gr*2+4),_.psymax=_.sfb_lmax+3*((L.sfb21_extra?Re.SBMAX_s:Re.SBPSY_s)-_.sfb_smin),_.sfbmax=_.sfb_lmax+3*(Re.SBPSY_s-_.sfb_smin),_.sfbdivide=_.sfbmax-18,_.psy_lmax=_.sfb_lmax;var e=L.scalefac_band.l[_.sfb_lmax];a0.arraycopy(_.xr,0,E,0,576);for(var m=_.sfb_smin;m<Re.SBMAX_s;m++)for(var v=L.scalefac_band.s[m],f=L.scalefac_band.s[m+1],x=0;x<3;x++)for(var c=v;c<f;c++)_.xr[e++]=E[3*c+x];for(var n=_.sfb_lmax,m=_.sfb_smin;m<Re.SBMAX_s;m++)_.width[n]=_.width[n+1]=_.width[n+2]=L.scalefac_band.s[m+1]-L.scalefac_band.s[m],_.window[n]=0,_.window[n+1]=1,_.window[n+2]=2,n+=3}_.count1bits=0,_.sfb_partition_table=u.nr_of_sfb_block[0][0],_.slen[0]=0,_.slen[1]=0,_.slen[2]=0,_.slen[3]=0,_.max_nonzero_coeff=575,T0.fill(_.scalefac,0),B(L,_)};function k(L){this.ordinal=L}k.BINSEARCH_NONE=new k(0),k.BINSEARCH_UP=new k(1),k.BINSEARCH_DOWN=new k(2);function D(L,_,m,E,e){var v,f=L.CurrentStep[E],x=!1,c=L.OldValue[E],n=k.BINSEARCH_NONE;for(_.global_gain=c,m-=_.part2_length,Ft(f!=0);;){var i;if(v=w.count_bits(L,e,_,null),f==1||v==m)break;v>m?(n==k.BINSEARCH_DOWN&&(x=!0),x&&(f/=2),n=k.BINSEARCH_UP,i=f):(n==k.BINSEARCH_UP&&(x=!0),x&&(f/=2),n=k.BINSEARCH_DOWN,i=-f),_.global_gain+=i,_.global_gain<0&&(_.global_gain=0,x=!0),_.global_gain>255&&(_.global_gain=255,x=!0)}for(Ft(_.global_gain>=0),Ft(_.global_gain<256);v>m&&_.global_gain<255;)_.global_gain++,v=w.count_bits(L,e,_,null);return L.CurrentStep[E]=c-_.global_gain>=4?4:2,L.OldValue[E]=_.global_gain,_.part2_3_length=v,v}this.trancate_smallspectrums=function(L,_,m,E){var e=k0(li.SFBMAX);if(!(!(L.substep_shaping&4)&&_.block_type==Re.SHORT_TYPE||L.substep_shaping&128)){u.calc_noise(_,m,e,new Sa,null);for(var f=0;f<576;f++){var v=0;_.l3_enc[f]!=0&&(v=Math.abs(_.xr[f])),E[f]=v}var f=0,x=8;_.block_type==Re.SHORT_TYPE&&(x=6);do{var c,n,i,h,r=_.width[x];if(f+=r,!(e[x]>=1)&&(T0.sort(E,f-r,r),!BitStream.EQ(E[f-1],0))){c=(1-e[x])*m[x],n=0,h=0;do{var t;for(i=1;h+i<r&&!BitStream.NEQ(E[h+f-r],E[h+f+i-r]);i++);if(t=E[h+f-r]*E[h+f-r]*i,c<t){h!=0&&(n=E[h+f-r-1]);break}c-=t,h+=i}while(h<r);if(!BitStream.EQ(n,0))do Math.abs(_.xr[f-r])<=n&&(_.l3_enc[f-r]=0);while(--r>0)}}while(++x<_.psymax);_.part2_3_length=w.noquant_count_bits(L,_,null)}};function T(L){for(var _=0;_<L.sfbmax;_++)if(L.scalefac[_]+L.subblock_gain[L.window[_]]==0)return!1;return!0}function V(L){return Ea.FAST_LOG10(.368+.632*L*L*L)}function y(L,_){for(var m=1e-37,E=0;E<_.psymax;E++)m+=V(L[E]);return Math.max(1e-20,m)}function G(L,_,m,E,e){var v;switch(L){default:case 9:{_.over_count>0?(v=m.over_SSD<=_.over_SSD,m.over_SSD==_.over_SSD&&(v=m.bits<_.bits)):v=m.max_noise<0&&m.max_noise*10+m.bits<=_.max_noise*10+_.bits;break}case 0:v=m.over_count<_.over_count||m.over_count==_.over_count&&m.over_noise<_.over_noise||m.over_count==_.over_count&&BitStream.EQ(m.over_noise,_.over_noise)&&m.tot_noise<_.tot_noise;break;case 8:m.max_noise=y(e,E);case 1:v=m.max_noise<_.max_noise;break;case 2:v=m.tot_noise<_.tot_noise;break;case 3:v=m.tot_noise<_.tot_noise&&m.max_noise<_.max_noise;break;case 4:v=m.max_noise<=0&&_.max_noise>.2||m.max_noise<=0&&_.max_noise<0&&_.max_noise>m.max_noise-.2&&m.tot_noise<_.tot_noise||m.max_noise<=0&&_.max_noise>0&&_.max_noise>m.max_noise-.2&&m.tot_noise<_.tot_noise+_.over_noise||m.max_noise>0&&_.max_noise>-.05&&_.max_noise>m.max_noise-.1&&m.tot_noise+m.over_noise<_.tot_noise+_.over_noise||m.max_noise>0&&_.max_noise>-.1&&_.max_noise>m.max_noise-.15&&m.tot_noise+m.over_noise+m.over_noise<_.tot_noise+_.over_noise+_.over_noise;break;case 5:v=m.over_noise<_.over_noise||BitStream.EQ(m.over_noise,_.over_noise)&&m.tot_noise<_.tot_noise;break;case 6:v=m.over_noise<_.over_noise||BitStream.EQ(m.over_noise,_.over_noise)&&(m.max_noise<_.max_noise||BitStream.EQ(m.max_noise,_.max_noise)&&m.tot_noise<=_.tot_noise);break;case 7:v=m.over_count<_.over_count||m.over_noise<_.over_noise;break}return _.over_count==0&&(v=v&&m.bits<_.bits),v}function Y(L,_,m,E,e){var v=L.internal_flags,f;_.scalefac_scale==0?f=1.2968395546510096:f=1.6817928305074292;for(var x=0,c=0;c<_.sfbmax;c++)x<m[c]&&(x=m[c]);var n=v.noise_shaping_amp;switch(n==3&&(e?n=2:n=1),n){case 2:break;case 1:x>1?x=Math.pow(x,.5):x*=.95;break;case 0:default:x>1?x=1:x*=.95;break}for(var i=0,c=0;c<_.sfbmax;c++){var h=_.width[c],r;if(i+=h,!(m[c]<x)){if(v.substep_shaping&2&&(v.pseudohalf[c]=v.pseudohalf[c]==0?1:0,v.pseudohalf[c]==0&&v.noise_shaping_amp==2))return;for(_.scalefac[c]++,r=-h;r<0;r++)E[i+r]*=f,E[i+r]>_.xrpow_max&&(_.xrpow_max=E[i+r]);if(v.noise_shaping_amp==2)return}}}function K(L,_){for(var m=1.2968395546510096,E=0,e=0;e<L.sfbmax;e++){var v=L.width[e],f=L.scalefac[e];if(L.preflag!=0&&(f+=u.pretab[e]),E+=v,f&1){f++;for(var x=-v;x<0;x++)_[E+x]*=m,_[E+x]>L.xrpow_max&&(L.xrpow_max=_[E+x])}L.scalefac[e]=f>>1}L.preflag=0,L.scalefac_scale=1}function q(L,_,m){var E,e=_.scalefac;for(E=0;E<_.sfb_lmax;E++)if(e[E]>=16)return!0;for(var v=0;v<3;v++){var f=0,x=0;for(E=_.sfb_lmax+v;E<_.sfbdivide;E+=3)f<e[E]&&(f=e[E]);for(;E<_.sfbmax;E+=3)x<e[E]&&(x=e[E]);if(!(f<16&&x<8)){if(_.subblock_gain[v]>=7)return!0;_.subblock_gain[v]++;var c=L.scalefac_band.l[_.sfb_lmax];for(E=_.sfb_lmax+v;E<_.sfbmax;E+=3){var n,i=_.width[E],h=e[E];if(Ft(h>=0),h=h-(4>>_.scalefac_scale),h>=0){e[E]=h,c+=i*3;continue}e[E]=0;{var r=210+(h<<_.scalefac_scale+1);n=u.IPOW20(r)}c+=i*(v+1);for(var t=-i;t<0;t++)m[c+t]*=n,m[c+t]>_.xrpow_max&&(_.xrpow_max=m[c+t]);c+=i*(3-v-1)}{var n=u.IPOW20(202);c+=_.width[E]*(v+1);for(var t=-_.width[E];t<0;t++)m[c+t]*=n,m[c+t]>_.xrpow_max&&(_.xrpow_max=m[c+t])}}}return!1}function U(L,_,m,E,e){var v=L.internal_flags;Y(L,_,m,E,e);var f=T(_);return f?!1:(v.mode_gr==2?f=w.scale_bitcount(_):f=w.scale_bitcount_lsf(v,_),f?(v.noise_shaping>1&&(T0.fill(v.pseudohalf,0),_.scalefac_scale==0?(K(_,E),f=!1):_.block_type==Re.SHORT_TYPE&&v.subblock_gain>0&&(f=q(v,_,E)||T(_))),f||(v.mode_gr==2?f=w.scale_bitcount(_):f=w.scale_bitcount_lsf(v,_)),!f):!0)}this.outer_loop=function(L,_,m,E,e,v){var f=L.internal_flags,x=new oi,c=k0(576),n=k0(li.SFBMAX),i=new Sa,h,r=new dn,t=9999999,d=!1,l=!1,F=0;if(D(f,_,v,e,E),f.noise_shaping==0)return 100;u.calc_noise(_,m,n,i,r),i.bits=_.part2_3_length,x.assign(_);var R=0;for(a0.arraycopy(E,0,c,0,576);!d;){do{var O=new Sa,a,o=255;if(f.substep_shaping&2?a=20:a=3,f.sfb21_extra&&(n[x.sfbmax]>1||x.block_type==Re.SHORT_TYPE&&(n[x.sfbmax+1]>1||n[x.sfbmax+2]>1))||!U(L,x,n,E,l))break;x.scalefac_scale!=0&&(o=254);var H=v-x.part2_length;if(H<=0)break;for(;(x.part2_3_length=w.count_bits(f,E,x,r))>H&&x.global_gain<=o;)x.global_gain++;if(x.global_gain>o)break;if(i.over_count==0){for(;(x.part2_3_length=w.count_bits(f,E,x,r))>t&&x.global_gain<=o;)x.global_gain++;if(x.global_gain>o)break}if(u.calc_noise(x,m,n,O,r),O.bits=x.part2_3_length,_.block_type!=Re.SHORT_TYPE?h=L.quant_comp:h=L.quant_comp_short,h=G(h,i,O,x,n)?1:0,h!=0)t=_.part2_3_length,i=O,_.assign(x),R=0,a0.arraycopy(E,0,c,0,576);else if(f.full_outer_loop==0&&(++R>a&&i.over_count==0||f.noise_shaping_amp==3&&l&&R>30||f.noise_shaping_amp==3&&l&&x.global_gain-F>15))break}while(x.global_gain+x.scalefac_scale<255);f.noise_shaping_amp==3?l?d=!0:(x.assign(_),a0.arraycopy(c,0,E,0,576),R=0,F=x.global_gain,l=!0):d=!0}return Ft(_.global_gain+_.scalefac_scale<=255),L.VBR==ri.vbr_rh||L.VBR==ri.vbr_mtrh?a0.arraycopy(c,0,E,0,576):f.substep_shaping&1&&trancate_smallspectrums(f,_,m,E),i.over_count},this.iteration_finish_one=function(L,_,m){var E=L.l3_side,e=E.tt[_][m];w.best_scalefac_store(L,_,m,E),L.use_best_huffman==1&&w.best_huffman_divide(L,e),s.ResvAdjust(L,e)},this.VBR_encode_granule=function(L,_,m,E,e,v,f){var x=L.internal_flags,c=new oi,n=k0(576),i=f,h=f+1,r=(f+v)/2,t,d,l=0,F=x.sfb21_extra;Ft(i<=LameInternalFlags.MAX_BITS_PER_CHANNEL),T0.fill(c.l3_enc,0);do Ft(r>=v),Ft(r<=f),Ft(v<=f),r>i-42?x.sfb21_extra=!1:x.sfb21_extra=F,d=outer_loop(L,_,m,E,e,r),d<=0?(l=1,h=_.part2_3_length,c.assign(_),a0.arraycopy(E,0,n,0,576),f=h-32,t=f-v,r=(f+v)/2):(v=r+32,t=f-v,r=(f+v)/2,l!=0&&(l=2,_.assign(c),a0.arraycopy(n,0,E,0,576)));while(t>12);x.sfb21_extra=F,l==2&&a0.arraycopy(c.l3_enc,0,_.l3_enc,0,576),Ft(_.part2_3_length<=i)},this.get_framebits=function(L,_){var m=L.internal_flags;m.bitrate_index=m.VBR_min_bitrate;var E=p.getframebits(L);m.bitrate_index=1,E=p.getframebits(L);for(var e=1;e<=m.VBR_max_bitrate;e++){m.bitrate_index=e;var v=new MeanBits(E);_[e]=s.ResvFrameBegin(L,v),E=v.bits}},this.VBR_old_prepare=function(L,_,m,E,e,v,f,x,c){var n=L.internal_flags,i,h=0,r=1,t=0;n.bitrate_index=n.VBR_max_bitrate;var d=s.ResvFrameBegin(L,new MeanBits(0))/n.mode_gr;get_framebits(L,v);for(var l=0;l<n.mode_gr;l++){var F=u.on_pe(L,_,x[l],d,l,0);n.mode_ext==Re.MPG_MD_MS_LR&&(ms_convert(n.l3_side,l),u.reduce_side(x[l],m[l],d,F));for(var R=0;R<n.channels_out;++R){var O=n.l3_side.tt[l][R];O.block_type!=Re.SHORT_TYPE?(h=1.28/(1+Math.exp(3.5-_[l][R]/300))-.05,i=n.PSY.mask_adjust-h):(h=2.56/(1+Math.exp(3.5-_[l][R]/300))-.14,i=n.PSY.mask_adjust_short-h),n.masking_lower=Math.pow(10,i*.1),init_outer_loop(n,O),c[l][R]=u.calc_xmin(L,E[l][R],O,e[l][R]),c[l][R]!=0&&(r=0),f[l][R]=126,t+=x[l][R]}}for(var l=0;l<n.mode_gr;l++)for(var R=0;R<n.channels_out;R++)t>v[n.VBR_max_bitrate]&&(x[l][R]*=v[n.VBR_max_bitrate],x[l][R]/=t),f[l][R]>x[l][R]&&(f[l][R]=x[l][R]);return r},this.bitpressure_strategy=function(L,_,m,E){for(var e=0;e<L.mode_gr;e++)for(var v=0;v<L.channels_out;v++){for(var f=L.l3_side.tt[e][v],x=_[e][v],c=0,n=0;n<f.psy_lmax;n++)x[c++]*=1+.029*n*n/Re.SBMAX_l/Re.SBMAX_l;if(f.block_type==Re.SHORT_TYPE)for(var n=f.sfb_smin;n<Re.SBMAX_s;n++)x[c++]*=1+.029*n*n/Re.SBMAX_s/Re.SBMAX_s,x[c++]*=1+.029*n*n/Re.SBMAX_s/Re.SBMAX_s,x[c++]*=1+.029*n*n/Re.SBMAX_s/Re.SBMAX_s;E[e][v]=0|Math.max(m[e][v],.9*E[e][v])}},this.VBR_new_prepare=function(L,_,m,E,e,v){var f=L.internal_flags,x=1,c=0,n=0,i;if(L.free_format){f.bitrate_index=0;var h=new MeanBits(c);i=s.ResvFrameBegin(L,h),c=h.bits,e[0]=i}else{f.bitrate_index=f.VBR_max_bitrate;var h=new MeanBits(c);s.ResvFrameBegin(L,h),c=h.bits,get_framebits(L,e),i=e[f.VBR_max_bitrate]}for(var r=0;r<f.mode_gr;r++){u.on_pe(L,_,v[r],c,r,0),f.mode_ext==Re.MPG_MD_MS_LR&&ms_convert(f.l3_side,r);for(var t=0;t<f.channels_out;++t){var d=f.l3_side.tt[r][t];f.masking_lower=Math.pow(10,f.PSY.mask_adjust*.1),init_outer_loop(f,d),u.calc_xmin(L,m[r][t],d,E[r][t])!=0&&(x=0),n+=v[r][t]}}for(var r=0;r<f.mode_gr;r++)for(var t=0;t<f.channels_out;t++)n>i&&(v[r][t]*=i,v[r][t]/=n);return x},this.calc_target_bits=function(L,_,m,E,e,v){var f=L.internal_flags,x=f.l3_side,c,n,i,h,r=0;f.bitrate_index=f.VBR_max_bitrate;var t=new MeanBits(r);for(v[0]=s.ResvFrameBegin(L,t),r=t.bits,f.bitrate_index=1,r=p.getframebits(L)-f.sideinfo_len*8,e[0]=r/(f.mode_gr*f.channels_out),r=L.VBR_mean_bitrate_kbps*L.framesize*1e3,f.substep_shaping&1&&(r*=1.09),r/=L.out_samplerate,r-=f.sideinfo_len*8,r/=f.mode_gr*f.channels_out,c=.93+.07*(11-L.compression_ratio)/(11-5.5),c<.9&&(c=.9),c>1&&(c=1),n=0;n<f.mode_gr;n++){var d=0;for(i=0;i<f.channels_out;i++){if(E[n][i]=int(c*r),_[n][i]>700){var l=int((_[n][i]-700)/1.4),F=x.tt[n][i];E[n][i]=int(c*r),F.block_type==Re.SHORT_TYPE&&l<r/2&&(l=r/2),l>r*3/2?l=r*3/2:l<0&&(l=0),E[n][i]+=l}E[n][i]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(E[n][i]=LameInternalFlags.MAX_BITS_PER_CHANNEL),d+=E[n][i]}if(d>LameInternalFlags.MAX_BITS_PER_GRANULE)for(i=0;i<f.channels_out;++i)E[n][i]*=LameInternalFlags.MAX_BITS_PER_GRANULE,E[n][i]/=d}if(f.mode_ext==Re.MPG_MD_MS_LR)for(n=0;n<f.mode_gr;n++)u.reduce_side(E[n],m[n],r*f.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(h=0,n=0;n<f.mode_gr;n++)for(i=0;i<f.channels_out;i++)E[n][i]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(E[n][i]=LameInternalFlags.MAX_BITS_PER_CHANNEL),h+=E[n][i];if(h>v[0])for(n=0;n<f.mode_gr;n++)for(i=0;i<f.channels_out;i++)E[n][i]*=v[0],E[n][i]/=h}}var mn=vn,fn=ge,U0=fn.assert;function pn(){var p;this.setModules=function(s){p=s},this.ResvFrameBegin=function(s,u){var b=s.internal_flags,w,I=b.l3_side,B=p.getframebits(s);u.bits=(B-b.sideinfo_len*8)/b.mode_gr;var k=8*256*b.mode_gr-8;s.brate>320?w=8*int(s.brate*1e3/(s.out_samplerate/1152)/8+.5):(w=8*1440,s.strict_ISO&&(w=8*int(32e4/(s.out_samplerate/1152)/8+.5))),b.ResvMax=w-B,b.ResvMax>k&&(b.ResvMax=k),(b.ResvMax<0||s.disable_reservoir)&&(b.ResvMax=0);var D=u.bits*b.mode_gr+Math.min(b.ResvSize,b.ResvMax);return D>w&&(D=w),U0(b.ResvMax%8==0),U0(b.ResvMax>=0),I.resvDrain_pre=0,b.pinfo!=null&&(b.pinfo.mean_bits=u.bits/2,b.pinfo.resvsize=b.ResvSize),D},this.ResvMaxBits=function(s,u,b,w){var I=s.internal_flags,B,k=I.ResvSize,D=I.ResvMax;w!=0&&(k+=u),I.substep_shaping&1&&(D*=.9),b.bits=u,k*10>D*9?(B=k-D*9/10,b.bits+=B,I.substep_shaping|=128):(B=0,I.substep_shaping&=127,!s.disable_reservoir&&!(I.substep_shaping&1)&&(b.bits-=.1*u));var T=k<I.ResvMax*6/10?k:I.ResvMax*6/10;return T-=B,T<0&&(T=0),T},this.ResvAdjust=function(s,u){s.ResvSize-=u.part2_3_length+u.part2_length},this.ResvFrameEnd=function(s,u){var b,w=s.l3_side;s.ResvSize+=u*s.mode_gr;var I=0;w.resvDrain_post=0,w.resvDrain_pre=0,(b=s.ResvSize%8)!=0&&(I+=b),b=s.ResvSize-I-s.ResvMax,b>0&&(U0(b%8==0),U0(b>=0),I+=b);{var B=Math.min(w.main_data_begin*8,I)/8;w.resvDrain_pre+=8*B,I-=8*B,s.ResvSize-=8*B,w.main_data_begin-=B}w.resvDrain_post+=I,s.ResvSize-=I}}var bn=pn;function An(){var p="http://www.mp3dev.org/",s=3,u=98,b=4,w=0,I=93;this.getLameVersion=function(){return s+"."+u+"."+b},this.getLameShortVersion=function(){return s+"."+u+"."+b},this.getLameVeryShortVersion=function(){return"LAME"+s+"."+u+"r"},this.getPsyVersion=function(){return w+"."+I},this.getLameUrl=function(){return p},this.getLameOsBitness=function(){return"32bits"}}var En=An,Tt=ge,Sn=Tt.System,ya=Tt.VbrMode;Tt.Float;var _i=Tt.ShortBlock;Tt.Util;var yn=Tt.Arrays;Tt.new_array_n;var K0=Tt.new_byte;Tt.new_double;Tt.new_float;Tt.new_float_n;Tt.new_int;Tt.new_int_n;var xn=Tt.assert;N0.NUMTOCENTRIES=100;N0.MAXFRAMESIZE=2880;function N0(){var p,s,u;this.setModules=function(r,t,d){p=r,s=t,u=d};var b=1,w=2,I=4,B=8,k=N0.NUMTOCENTRIES,D=N0.MAXFRAMESIZE,T=k+4+4+4+4+4,V=T+9+1+1+8+1+1+3+1+1+2+4+2+2,y=128,G=64,Y=32,K=null,q="Xing",U="Info",L=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function _(r,t){if(r.nVbrNumFrames++,r.sum+=t,r.seen++,!(r.seen<r.want)&&(r.pos<r.size&&(r.bag[r.pos]=r.sum,r.pos++,r.seen=0),r.pos==r.size)){for(var d=1;d<r.size;d+=2)r.bag[d/2]=r.bag[d];r.want*=2,r.pos/=2}}function m(r,t){if(!(r.pos<=0))for(var d=1;d<k;++d){var l=d/k,F,R,O=0|Math.floor(l*r.pos);O>r.pos-1&&(O=r.pos-1),F=r.bag[O],R=r.sum;var a=0|256*F/R;a>255&&(a=255),t[d]=255&a}}this.addVbrFrame=function(r){var t=r.internal_flags,d=Tables.bitrate_table[r.version][t.bitrate_index];xn(t.VBR_seek_table.bag!=null),_(t.VBR_seek_table,d)};function E(r,t){var d=r[t+0]&255;return d<<=8,d|=r[t+1]&255,d<<=8,d|=r[t+2]&255,d<<=8,d|=r[t+3]&255,d}function e(r,t,d){r[t+0]=255&(d>>24&255),r[t+1]=255&(d>>16&255),r[t+2]=255&(d>>8&255),r[t+3]=255&(d&255)}function v(r,t,d){r[t+0]=255&(d>>8&255),r[t+1]=255&(d&255)}function f(r,t){return new String(r,t,q.length(),K).equals(q)||new String(r,t,U.length(),K).equals(U)}function x(r,t,d){return 255&(r<<t|d&~(-1<<t))}function c(r,t){var d=r.internal_flags;t[0]=x(t[0],8,255),t[1]=x(t[1],3,7),t[1]=x(t[1],1,r.out_samplerate<16e3?0:1),t[1]=x(t[1],1,r.version),t[1]=x(t[1],2,4-3),t[1]=x(t[1],1,r.error_protection?0:1),t[2]=x(t[2],4,d.bitrate_index),t[2]=x(t[2],2,d.samplerate_index),t[2]=x(t[2],1,0),t[2]=x(t[2],1,r.extension),t[3]=x(t[3],2,r.mode.ordinal()),t[3]=x(t[3],2,d.mode_ext),t[3]=x(t[3],1,r.copyright),t[3]=x(t[3],1,r.original),t[3]=x(t[3],2,r.emphasis),t[0]=255;var l=255&(t[1]&241),F;r.version==1?F=y:r.out_samplerate<16e3?F=Y:F=G,r.VBR==ya.vbr_off&&(F=r.brate);var R;r.free_format?R=0:R=255&16*p.BitrateIndex(F,r.version,r.out_samplerate),r.version==1?(t[1]=255&(l|10),l=255&(t[2]&13),t[2]=255&(R|l)):(t[1]=255&(l|2),l=255&(t[2]&13),t[2]=255&(R|l))}this.getVbrTag=function(r){var t=new VBRTagData,d=0;t.flags=0;var l=r[d+1]>>3&1,F=r[d+2]>>2&3,R=r[d+3]>>6&3,O=r[d+2]>>4&15;if(O=Tables.bitrate_table[l][O],r[d+1]>>4==14?t.samprate=Tables.samplerate_table[2][F]:t.samprate=Tables.samplerate_table[l][F],l!=0?R!=3?d+=32+4:d+=17+4:R!=3?d+=17+4:d+=9+4,!f(r,d))return null;d+=4,t.hId=l;var a=t.flags=E(r,d);if(d+=4,a&b&&(t.frames=E(r,d),d+=4),a&w&&(t.bytes=E(r,d),d+=4),a&I){if(t.toc!=null)for(var o=0;o<k;o++)t.toc[o]=r[d+o];d+=k}t.vbrScale=-1,a&B&&(t.vbrScale=E(r,d),d+=4),t.headersize=(l+1)*72e3*O/t.samprate,d+=21;var H=r[d+0]<<4;H+=r[d+1]>>4;var g=(r[d+1]&15)<<8;return g+=r[d+2]&255,(H<0||H>3e3)&&(H=-1),(g<0||g>3e3)&&(g=-1),t.encDelay=H,t.encPadding=g,t},this.InitVbrTag=function(r){var t=r.internal_flags,d;r.version==1?d=y:r.out_samplerate<16e3?d=Y:d=G,r.VBR==ya.vbr_off&&(d=r.brate);var l=(r.version+1)*72e3*d/r.out_samplerate,F=t.sideinfo_len+V;if(t.VBR_seek_table.TotalFrameSize=l,l<F||l>D){r.bWriteVbrTag=!1;return}t.VBR_seek_table.nVbrNumFrames=0,t.VBR_seek_table.nBytesWritten=0,t.VBR_seek_table.sum=0,t.VBR_seek_table.seen=0,t.VBR_seek_table.want=1,t.VBR_seek_table.pos=0,t.VBR_seek_table.bag==null&&(t.VBR_seek_table.bag=new int[400],t.VBR_seek_table.size=400);var R=K0(D);c(r,R);for(var O=t.VBR_seek_table.TotalFrameSize,a=0;a<O;++a)s.add_dummy_byte(r,R[a]&255,1)};function n(r,t){var d=t^r;return t=t>>8^L[d&255],t}this.updateMusicCRC=function(r,t,d,l){for(var F=0;F<l;++F)r[0]=n(t[d+F],r[0])};function i(r,t,d,l,F){var R=r.internal_flags,O=0,a=r.encoder_delay,o=r.encoder_padding,H=100-10*r.VBR_q-r.quality,g=u.getLameVeryShortVersion(),se,le=0,re,oe=[1,5,3,2,4,0,3],be=0|(r.lowpassfreq/100+.5>255?255:r.lowpassfreq/100+.5),ce=0,ne=0,Te=0,Fe=r.internal_flags.noise_shaping,Ae=0,we=0,Me=0,qe=0,Ke=0,$t=(r.exp_nspsytune&1)!=0,wt=(r.exp_nspsytune&2)!=0,tt=!1,Vt=!1,i0=r.internal_flags.nogap_total,t0=r.internal_flags.nogap_current,ze=r.ATHtype,s0=0,jt;switch(r.VBR){case vbr_abr:jt=r.VBR_mean_bitrate_kbps;break;case vbr_off:jt=r.brate;break;default:jt=r.VBR_min_bitrate_kbps}switch(r.VBR.ordinal()<oe.length?se=oe[r.VBR.ordinal()]:se=0,re=16*le+se,R.findReplayGain&&(R.RadioGain>510&&(R.RadioGain=510),R.RadioGain<-510&&(R.RadioGain=-510),ne=8192,ne|=3072,R.RadioGain>=0?ne|=R.RadioGain:(ne|=512,ne|=-R.RadioGain)),R.findPeakSample&&(ce=Math.abs(0|R.PeakSample/32767*Math.pow(2,23)+.5)),i0!=-1&&(t0>0&&(Vt=!0),t0<i0-1&&(tt=!0)),s0=ze+(($t?1:0)<<4)+((wt?1:0)<<5)+((tt?1:0)<<6)+((Vt?1:0)<<7),H<0&&(H=0),r.mode){case MONO:Ae=0;break;case STEREO:Ae=1;break;case DUAL_CHANNEL:Ae=2;break;case JOINT_STEREO:r.force_ms?Ae=4:Ae=3;break;case NOT_SET:default:Ae=7;break}r.in_samplerate<=32e3?Me=0:r.in_samplerate==48e3?Me=2:r.in_samplerate>48e3?Me=3:Me=1,(r.short_blocks==_i.short_block_forced||r.short_blocks==_i.short_block_dispensed||r.lowpassfreq==-1&&r.highpassfreq==-1||r.scale_left<r.scale_right||r.scale_left>r.scale_right||r.disable_reservoir&&r.brate<320||r.noATH||r.ATHonly||ze==0||r.in_samplerate<=32e3)&&(we=1),qe=Fe+(Ae<<2)+(we<<5)+(Me<<6),Ke=R.nMusicCRC,e(d,l+O,H),O+=4;for(var Bt=0;Bt<9;Bt++)d[l+O+Bt]=255&g.charAt(Bt);O+=9,d[l+O]=255&re,O++,d[l+O]=255&be,O++,e(d,l+O,ce),O+=4,v(d,l+O,ne),O+=2,v(d,l+O,Te),O+=2,d[l+O]=255&s0,O++,jt>=255?d[l+O]=255:d[l+O]=255&jt,O++,d[l+O]=255&a>>4,d[l+O+1]=255&(a<<4)+(o>>8),d[l+O+2]=255&o,O+=3,d[l+O]=255&qe,O++,d[l+O++]=0,v(d,l+O,r.preset),O+=2,e(d,l+O,t),O+=4,v(d,l+O,Ke),O+=2;for(var b0=0;b0<O;b0++)F=n(d[l+b0],F);return v(d,l+O,F),O+=2,O}function h(r){r.seek(0);var t=K0(10);r.readFully(t);var d;return new String(t,"ISO-8859-1").startsWith("ID3")?d=0:d=((t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127)+t.length,d}this.getLameTagFrame=function(r,t){var d=r.internal_flags;if(!r.bWriteVbrTag||d.Class_ID!=Lame.LAME_ID||d.VBR_seek_table.pos<=0)return 0;if(t.length<d.VBR_seek_table.TotalFrameSize)return d.VBR_seek_table.TotalFrameSize;yn.fill(t,0,d.VBR_seek_table.TotalFrameSize,0),c(r,t);var l=K0(k);if(r.free_format)for(var F=1;F<k;++F)l[F]=255&255*F/100;else m(d.VBR_seek_table,l);var R=d.sideinfo_len;r.error_protection&&(R-=2),r.VBR==ya.vbr_off?(t[R++]=255&U.charAt(0),t[R++]=255&U.charAt(1),t[R++]=255&U.charAt(2),t[R++]=255&U.charAt(3)):(t[R++]=255&q.charAt(0),t[R++]=255&q.charAt(1),t[R++]=255&q.charAt(2),t[R++]=255&q.charAt(3)),e(t,R,b+w+I+B),R+=4,e(t,R,d.VBR_seek_table.nVbrNumFrames),R+=4;var O=d.VBR_seek_table.nBytesWritten+d.VBR_seek_table.TotalFrameSize;e(t,R,0|O),R+=4,Sn.arraycopy(l,0,t,R,l.length),R+=l.length,r.error_protection&&s.CRC_writeheader(d,t);for(var a=0,F=0;F<R;F++)a=n(t[F],a);return R+=i(r,O,t,R,a),d.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(r,t){var d=r.internal_flags;if(d.VBR_seek_table.pos<=0||(t.seek(t.length()),t.length()==0))return-1;var l=h(t);t.seek(l);var F=K0(D),R=getLameTagFrame(r,F);return R>F.length?-1:(R<1||t.write(F,0,R),0)}}var Tn=N0,Mt=ge;Mt.System;Mt.VbrMode;Mt.Float;Mt.ShortBlock;Mt.Util;Mt.Arrays;Mt.new_array_n;var hi=Mt.new_byte;Mt.new_double;Mt.new_float;Mt.new_float_n;Mt.new_int;Mt.new_int_n;var ci=Mt.assert,Mn=Ci,wn=sn,Bn=wi,Rn=Ri,In=mn,Cn=Ii,Ln=bn,kn=Ra,On=La;Qe();var Nn=En,Hn=Tn;function gn(){this.setModules=function(p,s){}}function Fn(){this.setModules=function(p,s,u){}}function Vn(){}function Pn(){this.setModules=function(p,s){}}function qn(p,s,u){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),p=1,s=44100,u=128);var b=new Mn,w=new gn,I=new Bn,B=new On,k=new wn,D=new Rn,T=new In,V=new Hn,y=new Nn,G=new Pn,Y=new Ln,K=new Cn,q=new Fn,U=new Vn;b.setModules(I,B,k,D,T,V,y,G,U),B.setModules(I,U,y,V),G.setModules(B,y),k.setModules(b),T.setModules(B,Y,D,K),D.setModules(K,Y,b.enc.psy),Y.setModules(B),K.setModules(D),V.setModules(b,B,y),w.setModules(q,U),q.setModules(y,G,k);var L=b.lame_init();L.num_channels=p,L.in_samplerate=s,L.brate=u,L.mode=kn.STEREO,L.quality=3,L.bWriteVbrTag=!1,L.disable_reservoir=!0,L.write_id3tag_automatic=!1;var _=b.lame_init_params(L);ci(_==0);var m=1152,E=0|1.25*m+7200,e=hi(E);this.encodeBuffer=function(v,f){p==1&&(f=v),ci(v.length==f.length),v.length>m&&(m=v.length,E=0|1.25*m+7200,e=hi(E));var x=b.lame_encode_buffer(L,v,f,v.length,e,0,E);return new Int8Array(e.subarray(0,x))},this.flush=function(){var v=b.lame_encode_flush(L,e,0,E);return new Int8Array(e.subarray(0,v))}}function Yt(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function ea(p){return p.charCodeAt(0)<<24|p.charCodeAt(1)<<16|p.charCodeAt(2)<<8|p.charCodeAt(3)}Yt.RIFF=ea("RIFF");Yt.WAVE=ea("WAVE");Yt.fmt_=ea("fmt ");Yt.data=ea("data");Yt.readHeader=function(p){var s=new Yt,u=p.getUint32(0,!1);if(Yt.RIFF==u&&(p.getUint32(4,!0),Yt.WAVE==p.getUint32(8,!1)&&Yt.fmt_==p.getUint32(12,!1))){var b=p.getUint32(16,!0),w=16+4;switch(b){case 16:case 18:s.channels=p.getUint16(w+2,!0),s.sampleRate=p.getUint32(w+4,!0);break;default:throw"extended fmt chunk not implemented"}w+=b;for(var I=Yt.data,B=0;I!=u&&(u=p.getUint32(w,!1),B=p.getUint32(w+4,!0),I!=u);)w+=B+8;return s.dataLen=B,s.dataOffset=w+8,s}};Ba.Mp3Encoder=qn;Ba.WavHeader=Yt;window.MPEGMode=is;window.Lame=tn;window.BitStream=Zs;function Dn(p,s){const u=new Int16Array(p.length);for(let D=0;D<p.length;D++)u[D]=p[D]*32767;const b=new Ba.Mp3Encoder(1,s,128),w=[],I=b.encodeBuffer(u);I.length>0&&w.push(I);const B=b.flush();return B.length>0&&w.push(B),new Blob(w,{type:"audio/mpeg"})}function Xn(p){return new DOMParser().parseFromString(p,"text/html").body.textContent||""}function Yn(p){const s=URL.createObjectURL(p);return new Audio(s)}function Gn(p){const s="https://api.elevenlabs.io/v1/text-to-speech/21m00Tcm4TlvDq8ikWAM/stream?optimize_streaming_latency=4",u={accept:"audio/mpeg","xi-api-key":"bddfcabff8951ebb9e925d506452df93","Content-Type":"application/json"},b=JSON.stringify({text:p,model_id:"eleven_turbo_v2",voice_settings:{stability:.5,similarity_boost:.5}});return fetch(s,{method:"POST",headers:u,body:b}).then(w=>w.blob()).then(w=>Yn(w)).catch(w=>console.error("Error:",w))}class $n{constructor({pageEl:s}){I0(this,"keyframes",{fadeOutPhoneBarAI:[{transform:"translateY(0px)",opacity:1},{transform:"translateY(-100%)",opacity:0}],fadeOutPhoneContainer:[{transform:"translateY(0px)",opacity:1},{transform:"translateY(-100%)",opacity:0}],fadeInPhoneBarUser:[{transform:"translateY(200%)",opacity:0},{transform:"translateY(0px)",opacity:1}],phoneBarYoyo:[{width:"32px"},{width:"8px"},{width:"32px"}],phoneBarListeningYoyo:[{width:"32px"},{width:"132px"},{width:"32px"}],reducePhoneBarOne:[{width:"32px"},{width:"8px"}],expandPhoneBarProcessing:[{width:"8px"},{width:"132px"}],dotsYoyo:[{width:"8px",offset:0},{width:"8px",offset:.1},{width:"34px",offset:.3},{width:"34px",offset:.7},{width:"8px",offset:1}],backgroundBarProcessingYoyo:[{background:"unset",offset:0},{background:"unset",offset:.29},{background:"#ff3e33",offset:.3},{background:"#ff3e33",offset:.7},{background:"unset",offset:.71},{background:"unset",offset:1}],reducePhoneBarProcessing:[{width:"132px"},{width:"8px"}],expandPhoneBarAI:[{width:"8px"},{width:"132px"}],phoneBarAIYoyo:[{width:"132px"},{width:"32px"},{width:"132px"}]});this.pageEl=s,this.phoneContainer=this.pageEl.querySelector(".phone__container"),this.phoneBarContainer=this.phoneContainer.querySelector(".phone-bar__container"),this.phoneBarOne=this.phoneBarContainer.querySelector(".phone-bar__one"),this.phoneBarOneDots=this.phoneBarOne.querySelectorAll(".dot"),this.phoneBarProcessing=this.phoneBarContainer.querySelector(".phone-bar__processing"),this.phoneBarProcessingDots=this.phoneBarProcessing.querySelectorAll(".dot"),this.phoneBarAI=this.phoneBarContainer.querySelector(".phone-bar__AI"),this.phoneBarPause=this.phoneBarContainer.querySelector(".phone-bar__pause"),this.isConnected=!1,this.colors={talkToMe:"#2B41EE"},this.animations=[]}animateTextTransition(s,u,b,w){b.textContent=s;const I=Ie(u,w.hide,{duration:300,ease:"ease-in-out",fill:"forwards"}),B=Ie(b,w.show,{duration:300,ease:"ease-in-out",fill:"forwards"});I.onfinish=()=>u.classList.remove("active"),B.onfinish=()=>b.classList.add("active")}createAnimation(s,u,b){const w=Ie(s,u,b);return this.animations.push(w),w}cancelAllAnimations(){this.isConnected=!1,this.animations.flat().forEach(u=>{u.cancel()}),this.animations=[]}newInfoText(s){const u=this.phoneContainer.querySelector(".phone__info.active"),b=this.phoneContainer.querySelector(".phone__info:not(.active)"),w={hide:[{opacity:1,transform:"translateX(-50%) translateY(0px)"},{opacity:0,transform:"translateX(-50%) translateY(-100%)"}],show:[{opacity:0,transform:"translateX(-50%) translateY(100%)"},{opacity:1,transform:" translateX(-50%)translateY(0px)"}]};this.animateTextTransition(s,u,b,w)}toConnecting(){this.dotsYoyoAnimations=this.createAnimation([this.phoneBarOneDots[0],this.phoneBarOneDots[1]],[{width:"30px"},{width:"8px"},{width:"30px"}],{duration:900,ease:"ease-out",iterations:1/0})}toConnected(){this.isConnected=!0,this.dotsYoyoAnimations.forEach(s=>s.cancel()),this.phoneBarOneDots.forEach(s=>s.classList.add("expand")),this.phoneBarOne.classList.add("active"),this.createAnimation([this.phoneBarOneDots[0],this.phoneBarOneDots[1]],[{opacity:1},{opacity:0}],{duration:100,ease:"ease-out",fill:"forwards"})}toTalkToMe(){if(this.isConnected||this.toConnected(),this.phoneBarAIYoyoAnimations){this.phoneBarAIYoyoAnimations.cancel();const s=this.createAnimation(this.phoneBarAI,this.keyframes.fadeOutPhoneBarAI,{duration:300,ease:"ease-out",fill:"forwards"});this.phoneBarOne.classList.add("active"),this.phoneBarOne.classList.add("talkToMe");const u=this.createAnimation(this.phoneBarOne,this.keyframes.fadeInPhoneBarUser,{duration:300,ease:"ease-out",fill:"forwards"});u.onfinish=()=>{this.expandPhoneBarAI.cancel(),this.phoneBarAI.classList.remove("active"),s.cancel()}}this.phoneBarOne.classList.add("talkToMe"),this.phoneBarYoyoAnimations=this.createAnimation(this.phoneBarOne,this.keyframes.phoneBarYoyo,{duration:900,ease:"ease-out",iterations:1/0})}toListening(){var s;(s=this.phoneBarYoyoAnimations)==null||s.cancel(),this.phoneBarYoyoAnimations=this.createAnimation(this.phoneBarOne,this.keyframes.phoneBarListeningYoyo,{duration:900,ease:"ease-out",iterations:1/0})}resetUserBar(){this.phoneBarOne.classList.remove("active"),this.phoneBarOne.classList.remove("talkToMe"),this.phoneBarOneDots.forEach(s=>s.classList.remove("expand"))}toProcessing(){this.phoneBarYoyoAnimations.cancel();const s=this.createAnimation(this.phoneBarOne,this.keyframes.reducePhoneBarOne,{duration:400,ease:"ease-out",fill:"forwards"});s.onfinish=()=>{this.phoneBarOne.classList.remove("active"),this.phoneBarOne.classList.remove("talkToMe"),this.phoneBarProcessing.classList.add("active"),this.createAnimation(this.phoneBarProcessing,this.keyframes.expandPhoneBarProcessing,{duration:400,ease:"ease-out",fill:"forwards"}),this.dotsYoyoAnimations=Array.from(this.phoneBarProcessingDots).map(u=>this.createAnimation(u,this.keyframes.dotsYoyo,{delay:500,duration:1500,ease:"ease-out",iterations:1/0})),this.backgroundBarProcessingYoyo=this.createAnimation(this.phoneBarProcessing,this.keyframes.backgroundBarProcessingYoyo,{delay:500,duration:1500,ease:"ease-out",iterations:1/0})}}resetProcessingBar(){this.phoneBarProcessing.classList.remove("active"),this.phoneBarProcessingDots.forEach(s=>s.classList.remove("expand"))}toAITalking(){this.dotsYoyoAnimations.forEach(u=>u.cancel()),this.backgroundBarProcessingYoyo.cancel();const s=this.createAnimation(this.phoneBarProcessing,this.keyframes.reducePhoneBarProcessing,{duration:400,ease:"ease-out",fill:"forwards"});s.onfinish=()=>{this.phoneBarProcessing.classList.remove("active"),this.phoneBarAI.classList.add("active"),this.expandPhoneBarAI=this.createAnimation(this.phoneBarAI,this.keyframes.expandPhoneBarAI,{delay:300,duration:400,ease:"ease-out",fill:"forwards"}),this.phoneBarAIYoyoAnimations=this.createAnimation(this.phoneBarAI,this.keyframes.phoneBarAIYoyo,{delay:300+this.expandPhoneBarAI.effect.getComputedTiming().duration,duration:900,ease:"ease-out",iterations:1/0})}}resetAIBar(){var s;this.phoneBarAI.classList.remove("active"),(s=this.phoneBarAIYoyoAnimations)==null||s.cancel(),this.phoneBarAIYoyoAnimations=null}toPause(s){this.phoneBarPause.classList.add("active"),s==="user"&&(this.phoneBarOne.classList.remove("active"),this.phoneBarOne.classList.remove("talkToMe")),s==="AI"&&this.phoneBarAI.classList.remove("active")}toResume(s){this.phoneBarPause.classList.remove("active"),s==="user"&&(this.phoneBarOne.classList.add("active"),this.phoneBarOne.classList.add("talkToMe")),s==="AI"&&this.phoneBarAI.classList.add("active")}leave(){this.cancelAllAnimations(),this.resetUserBar(),this.resetProcessingBar(),this.resetAIBar()}}function Un(){const p=new(window.AudioContext||window.webkitAudioContext);let s=p.createBuffer(1,1,22050),u=p.createBufferSource();return u.buffer=s,u.connect(p.destination),u.start(0),p}class Z0{constructor({audioContext:s,audioUrl:u,onPlay:b,onEnded:w,loop:I=!1}){this.audioContext=s,this.audioUrl=u,this.onPlay=b,this.onEnded=w,this.loop=I,this.currentAudioPlaying=null,this.startTime=0,this.startOffset=0,this.isPaused=!1,this.playAudio()}async playAudio(){let u=await(await fetch(this.audioUrl)).arrayBuffer(),b=await this.audioContext.decodeAudioData(u);this.currentAudioPlaying=this.audioContext.createBufferSource(),this.currentAudioPlaying.buffer=b,this.currentAudioPlaying.connect(this.audioContext.destination),this.currentAudioPlaying.loop=this.loop,this.startTime=this.audioContext.currentTime,this.currentAudioPlaying.start(0,this.startOffset%b.duration),typeof this.onPlay=="function"&&this.onPlay(),this.currentAudioPlaying.onended=()=>{if(typeof this.onEnded=="function"){if(this.isPaused)return;this.onEnded()}}}pauseAudio(){this.isPaused=!0,this.currentAudioPlaying&&(console.log("pause"),this.currentAudioPlaying.stop(),this.startOffset+=this.audioContext.currentTime-this.startTime,this.currentAudioPlaying=null)}resumeAudio(){this.isPaused=!1,this.playAudio()}stopAudio(){this.currentAudioPlaying&&(this.currentAudioPlaying.stop(),this.currentAudioPlaying=null)}}class Kn{constructor({anims:s,pageEl:u,discussion:b,emitter:w}){this.unbindEvent=null,this.emitter=w,this.pageEl=u,this.discussion=b,this.phoneContainer=this.pageEl.querySelector(".phone__container"),this.phoneBtn=this.pageEl.querySelector(".phone-btn"),this.infoText=this.phoneContainer.querySelector(".phone__info.active"),this.pauseBtn=this.phoneContainer.querySelector(".phone__pause"),this.closeBtn=this.phoneContainer.querySelector(".phone__close"),this.phoneDebugContainer=this.pageEl.querySelector(".phone__debug"),this.btnToConnected=this.pageEl.querySelector("#btn-toConnected"),this.btnToTalkToMe=this.pageEl.querySelector("#btn-toTalkToMe"),this.btnToListening=this.pageEl.querySelector("#btn-toListening"),this.btnFinishTalk=this.pageEl.querySelector("#btn-finishTalk"),this.btnFinishProcessing=this.pageEl.querySelector("#btn-finishProcessing"),this.anims=s,this.isActive=!1,this.audioContext=null,this.audioConnected=null,this.audioProcessing=null,this.currentAudioAIPlaying=null,this.currentIndexAudioAI=null,this.audiosAI=[],this.isAITalking=!1,this.isAIPaused=!1,this.isConnected=!1,this.myvad=null,this.isListening=!1,this.isMicMuted=!1,this.micAccessConfirmed=!1,this.phoneAnimations=new $n({pageEl:this.pageEl}),this.onClickOutside={interrupt:!1,resumeAI:!1,unmuteMic:!1},this.addListeners(),this.debug=!1,this.debug&&(this.phoneDebugContainer.classList.add("show"),this.anims.toStartPhoneRecording(),this.startConnecting())}startConnecting(){this.phoneAnimations.toConnecting(),console.log("connecting"),this.phoneAnimations.newInfoText("connecting")}connected(){this.phoneAnimations.toConnected(),this.phoneAnimations.newInfoText("connected"),console.log("connected"),this.audioConnected=new Z0({audioUrl:"/sounds/connected.mp3",audioContext:this.audioContext}),!this.debug&&setTimeout(()=>{this.isConnected=!0,this.toTalkToMe()},1500)}leave(){var s;console.log("leave"),(s=this.audioProcessing)==null||s.stopAudio(),this.unbindEvent(),this.unbindEvent=null,this.isActive=!1,this.phoneAnimations.leave(),this.stopRecording(),this.stopAITalking()}toTalkToMe(){this.isActive&&(console.log("Talk to me"),this.unbindEvent||(this.unbindEvent=this.emitter.on("addAITextTest",s=>this.startAITalking(s))),this.phoneAnimations.toTalkToMe(),this.phoneAnimations.newInfoText("Talk to me"),this.myvad&&this.myvad.start())}toListening(){this.isListening||this.phoneAnimations.toListening(),this.isListening=!0,console.log("I'm listening"),this.phoneAnimations.newInfoText("I'm listening")}async toProcessing(s){this.phoneAnimations.newInfoText("processing"),this.phoneAnimations.toProcessing(),this.myvad.pause(),console.log("processing"),this.audioProcessing=new Z0({audioUrl:"/sounds/processing.mp3",audioContext:this.audioContext,loop:!0});const u=Dn(s,16e3);this.textRecorded=await Ta(u),this.discussion.addUserElement({text:this.textRecorded})}onPlay(){this.isAITalking||(this.phoneAnimations.newInfoText("Click to interrupt"),this.phoneAnimations.toAITalking()),this.isAITalking=!0,this.onClickOutside.interrupt=!0}async startAITalking(s){var b;if(!this.isActive)return;console.log("new AIAnswer");const u=await Gn(Xn(s));this.audiosAI.push(u),this.currentIndexAudioAI===null&&(console.log("first sound"),(b=this.audioProcessing)==null||b.stopAudio(),this.currentIndexAudioAI=0,this.currentAudioAIPlaying=new Z0({audioUrl:this.audiosAI[this.currentIndexAudioAI].src,audioContext:this.audioContext,onPlay:this.onPlay.bind(this),onEnded:this.checkIfNextAudio.bind(this)})),this.audiosAI[this.currentIndexAudioAI].onplay=()=>{}}async checkIfNextAudio(){if(this.isActive)if(this.currentIndexAudioAI++,this.audiosAI[this.currentIndexAudioAI])console.log("Stil one sound"),this.currentAudioAIPlaying=new Z0({audioUrl:this.audiosAI[this.currentIndexAudioAI].src,audioContext:this.audioContext,onPlay:this.onPlay.bind(this),onEnded:this.checkIfNextAudio.bind(this)});else{if(console.log("all sounds plaid"),this.clearAIAudios(),this.debug)return;this.toTalkToMe()}}clearAIAudios(){this.currentIndexAudioAI=null,this.audiosAI=[],this.isAITalking=!1,this.onClickOutside.interrupt=!1}stopAITalking(){var s;console.log("stop talking"),(s=this.currentAudioAIPlaying)==null||s.pauseAudio(),this.currentAudioAIPlaying=null,this.clearAIAudios()}interrupt(){this.stopAITalking(),this.toTalkToMe()}async startRecording(){if(this.isActive=!0,this.micAccessConfirmed?this.toTalkToMe():this.startConnecting(),this.myvad||(this.myvad=await vad.MicVAD.new({onFrameProcessed:s=>{this.micAccessConfirmed||(this.micAccessConfirmed=!0,this.connected())},onSpeechStart:()=>{this.isConnected&&this.toListening()},onSpeechEnd:s=>{this.toProcessing(s),this.isListening=!1}})),this.debug){this.myvad.pause();return}this.myvad.start()}stopRecording(){this.myvad.pause(),this.myvad.stream.getTracks().forEach(s=>{s.stop()}),this.myvad=null}async onCompleteRecording(s){this.isRecordCanceled||(this.textRecorded=await Ta(s),this.timeoutTranscripting=setTimeout(()=>{this.onCompleteTranscripting()},this.minTranscriptingTime))}pauseAI(){var s;this.isAIPaused=!0,this.phoneAnimations.newInfoText("Click to resume"),this.phoneAnimations.toPause("AI"),this.pauseBtn.classList.add("active"),this.onClickOutside.interrupt=!1,this.onClickOutside.resumeAI=!0,!this.debug&&((s=this.currentAudioAIPlaying)==null||s.pauseAudio())}resumeAI(){var s;this.isAIPaused=!1,this.phoneAnimations.toResume("AI"),this.pauseBtn.classList.remove("active"),(s=this.currentAudioAIPlaying)==null||s.resumeAudio(),this.onClickOutside.resumeAI=!1}muteMic(){this.isMicMuted=!0,this.phoneAnimations.toPause("user"),this.phoneAnimations.newInfoText("Click to resume"),console.log("mute mic"),this.pauseBtn.classList.add("active"),this.onClickOutside.unmuteMic=!0,!this.debug&&this.myvad.pause()}unmuteMic(){this.isMicMuted=!1,console.log("unmute mic"),this.phoneAnimations.toResume("user"),this.phoneAnimations.newInfoText("Start talking"),this.pauseBtn.classList.remove("active"),this.onClickOutside.unmuteMic=!1,!this.debug&&this.myvad.start()}addListeners(){this.phoneBtn.addEventListener("click",async()=>{if(this.audioContext=Un(),this.anims.toStartPhoneRecording(),this.debug){this.startConnecting();return}this.startRecording()}),this.closeBtn.addEventListener("click",async()=>{this.anims.toStopPhoneRecording(),this.leave()}),this.pauseBtn.addEventListener("click",async()=>{this.isAITalking?this.isAIPaused?this.resumeAI():this.pauseAI():this.isMicMuted?this.unmuteMic():this.muteMic()}),this.pageEl.addEventListener("click",s=>{this.pauseBtn.contains(s.target)||this.closeBtn.contains(s.target)||(this.onClickOutside.resumeAI&&this.resumeAI(),this.onClickOutside.unmuteMic&&this.unmuteMic(),this.onClickOutside.interrupt&&(console.log("interrupt"),this.interrupt()))},{capture:!0}),this.btnToConnected.addEventListener("click",()=>{this.connected()}),this.btnToTalkToMe.addEventListener("click",()=>{this.toTalkToMe()}),this.btnToListening.addEventListener("click",()=>{this.toListening()}),this.btnFinishTalk.addEventListener("click",()=>{this.toProcessing()}),this.btnFinishProcessing.addEventListener("click",()=>{this.isActive=!0,this.startAITalking("Bonjour je suis un test")})}}class Li{constructor({text:s,container:u,backgroundColor:b,marginLeft:w}){this.text=s,this.container=u,this.backgroundColor=b,this.marginLeft=w,this.init()}init(){this.typingContainer=document.createElement("div"),this.maskEl=document.createElement("div"),this.cursorEl=document.createElement("span"),this.textEl=document.createElement("p"),this.typingContainer.classList.add("typing__container"),this.maskEl.classList.add("typing__mask"),this.cursorEl.classList.add("typing__cursor"),this.textEl.classList.add("typing__text"),this.textEl.textContent=this.text,this.maskEl.style.backgroundColor=this.backgroundColor,this.typingContainer.style.left=`${this.marginLeft}px`,this.maskEl.appendChild(this.cursorEl),this.textEl.appendChild(this.maskEl),this.typingContainer.appendChild(this.textEl),this.container.appendChild(this.typingContainer)}blink(){this.typingContainer.style.visibility="visible",this.typingContainer.style.opacity=1,this.blinkCursor=Ie(this.cursorEl,[{opacity:1},{opacity:0},{opacity:1}],{duration:300,iterations:1/0,ease:"ease-in-out"})}fadeOut(){this.blinkCursor&&this.blinkCursor.cancel(),this.cursorEl.classList.add("hidden")}writing(s){this.blinkCursor&&this.blinkCursor.cancel(),this.animShowtyping=Ie(this.typingContainer,[{opacity:0,visibility:"visible"},{opacity:1,visibility:"visible"}],{duration:700,fill:"forwards",ease:"ease-in-out"}),this.translateCursor=Ie(this.maskEl,[{transform:"translateX(0%)"},{transform:"translateX(105%)"}],{delay:this.animShowtyping.effect.getComputedTiming().duration,duration:400,fill:"forwards",ease:"ease-in-out"}),s!=null&&s.onComplete&&(this.translateCursor.onfinish=s.onComplete.bind(this))}reverse(){this.blinkCursor&&this.blinkCursor.cancel(),this.translateCursor.reverse(),Ie(this.typingContainer,[{opacity:1,visibility:"visible"},{opacity:0,visibility:"hidden"}],{delay:500,duration:700,fill:"forwards",ease:"ease-in-out"})}}function ui(p){return(p<10?"0":"")+p}const Zn="820px";function j0(){return window.innerWidth<=parseInt(Zn)}class Wn{constructor(s){this.callbacks=s,this.gumStream=null,this.recorder=null,this.input=null,this.audioContext=null,this.encodingType="mp3"}startRecording(){const s={audio:!0,video:!1};this.audioContext=new(window.AudioContext||window.webkitAudioContext),navigator.mediaDevices.getUserMedia(s).then(u=>{this.gumStream=u,this.input=this.audioContext.createMediaStreamSource(u),this.recorder=new WebAudioRecorder(this.input,{workerDir:"./libAudioRecorder/",encoding:this.encodingType,numChannels:2,onEncoderLoading:(b,w)=>{},onEncoderLoaded:(b,w)=>{}}),this.recorder.onComplete=(b,w)=>{console.log("Encoding complete"),this.blob=w,this.callbacks.onComplete(w)},this.recorder.setOptions({timeLimit:120,encodeAfterRecord:!0,ogg:{quality:.5},mp3:{bitRate:160}}),this.recorder.startRecording(),console.log("Recording started")}).catch(u=>{console.log(u)})}onUpdate(s){function u(){var w;const b=((w=this.recorder)==null?void 0:w.recordingTime())|0;s(b)}this.timeInterval=window.setInterval(u.bind(this),200)}stopRecording(){this.gumStream.getAudioTracks()[0].stop(),this.recorder.finishRecording(),clearInterval(this.timeInterval),console.log("Recording stopped")}}class jn{constructor({pageEl:s}){this.pageEl=s,this.isPageBlue=this.pageEl.classList.contains("page-blue"),this.inputEl=this.pageEl.querySelector(".input__container"),this.inputFrontEl=this.inputEl.querySelector(".input__front"),this.inputBackEl=this.inputEl.querySelector(".input__back"),this.centerBtn=this.inputFrontEl.querySelector(".center-btn"),this.frontCameraBtn=this.inputFrontEl.querySelector(".camera-btn"),this.frontMicBtn=this.inputFrontEl.querySelector(".mic-btn")||this.inputFrontEl.querySelector(".phone-btn"),this.frontCenterBtn=this.inputFrontEl.querySelector(".center-btn"),this.inputFrontHeight=this.inputFrontEl.offsetHeight,this.isPageBlue?(this.recordCounter=this.inputEl.querySelector(".record-counter"),this.infoTextEl=document.querySelector(".info-text")):(this.overlayRecordingEl=this.pageEl.querySelector(".overlay__recording"),this.recordCircle=this.overlayRecordingEl.querySelector(".circle"),this.recordCounter=this.overlayRecordingEl.querySelector(".record-counter"),this.infoTextEl=this.overlayRecordingEl.querySelector(".info-text")),this.inputText=this.inputBackEl.querySelector(".input-text"),this.inputImageContainer=this.inputEl.querySelector(".input__image--container"),this.imageDroppedContainer=this.pageEl.querySelector(".image-dropped__container"),this.phoneContainer=this.pageEl.querySelector(".phone__container"),this.pageBlue=document.querySelector(".page-blue"),this.pageGrey=document.querySelector(".page-grey"),this.cancelBtn=document.querySelector(".cancel-btn"),this.logoEl=document.querySelector(".logo__main"),this.logoMobileEl=document.querySelector(".logo__mobile"),this.categoriesListEl=document.querySelector(".categories__list--container"),this.carousselEl=document.querySelector(".caroussel__container"),this.navbarEl=document.querySelector(".nav")}fadeInButtons(s=0,u=500){Ie([this.frontMicBtn,this.frontCameraBtn,this.frontCenterBtn],[{opacity:0},{opacity:1}],{delay:s,duration:u,fill:"forwards",ease:"ease-in-out"})}fadeOutButtons(s=0,u=500){Ie([this.frontMicBtn,this.frontCameraBtn,this.frontCenterBtn],[{opacity:1},{opacity:0}],{delay:s,duration:u,fill:"forwards",ease:"ease-in-out"})}fadeInCategoriesAndCaroussel(s=0){Ie([this.categoriesListEl,this.carousselEl],[{opacity:0},{opacity:1}],{delay:s,duration:500,fill:"forwards",ease:"ease-in-out"})}fadeOutCategoriesAndCaroussel(s=0){Ie([this.categoriesListEl,this.carousselEl],[{opacity:1},{opacity:0}],{delay:s,duration:500,fill:"forwards",ease:"ease-in-out"})}fadeOutLogo(s=0){Ie(this.logoEl,[{opacity:1},{opacity:0}],{duration:s+300,fill:"forwards",ease:"ease-in-out"}),Ie(this.logoMobileEl,[{opacity:0},{opacity:1}],{delay:s+300,duration:300,fill:"forwards",ease:"ease-in-out"})}fadeInLogo(s=0){Ie(this.logoEl,[{opacity:0},{opacity:1}],{delay:s,duration:300,fill:"forwards",ease:"ease-in-out"}),Ie(this.logoMobileEl,[{opacity:1},{opacity:0}],{delay:s,duration:300,fill:"forwards",ease:"ease-in-out"})}collapseHeightInputFront({delay:s=0,duration:u=400}={}){return Ie(this.inputFrontEl,[{height:"110px"},{height:`${this.inputFrontHeight}px`}],{delay:s,duration:u,fill:"forwards",ease:"ease-in-out"})}expandHeightInputFront({delay:s=0,duration:u=250,heighTarget:b=110}={}){return Ie(this.inputFrontEl,[{height:`${this.inputFrontHeight}px`},{height:`${b}px`}],{delay:s,duration:u,fill:"forwards",ease:"ease-in-out"})}expandWidthInputFront({delay:s=0,duration:u=400}={}){return Ie(this.inputFrontEl,[{width:`${this.inputFrontHeight}px`},{width:"100%"}],{delay:s,duration:u,ease:"ease-in-out",fill:"forwards"})}fadeInInputFront({delay:s=0,duration:u=400}={}){return Ie(this.inputFrontEl,[{opacity:0},{opacity:1}],{delay:s,duration:u,ease:"ease-in-out",fill:"forwards"})}toInitial({delay:s=0,animButtons:u=!0,animBottom:b=!0,animLogo:w=!0}={}){this.inputFrontEl.style.pointerEvents="auto",this.inputBackEl.style.pointerEvents="none",this.collapseHeightInputFront({duration:250}),Ie(this.inputBackEl,[{opacity:1},{opacity:0}],{delay:s,duration:100,fill:"forwards",ease:"ease-in-out"}),u&&this.fadeInButtons(s),b&&this.fadeInCategoriesAndCaroussel(s),w&&this.fadeInLogo(s+300)}fromRecordAudioToInitial(){this.inputFrontEl.style.pointerEvents="auto",this.inputBackEl.style.pointerEvents="none",this.fadeInButtons(1e3),this.fadeInCategoriesAndCaroussel(1e3),this.fadeInLogo(1e3)}toWrite({delay:s=0,animButtons:u=!0,animLogos:b=!0,placeholder:w=""}={}){this.inputText.placeholder=w,this.inputFrontEl.style.pointerEvents="none",this.inputBackEl.style.pointerEvents="auto",this.inputEl.style.overflow="hidden",b&&this.fadeOutLogo(),this.expandHeightInputFront({delay:s,duration:250}),u&&(this.fadeOutButtons(s,100),this.fadeOutCategoriesAndCaroussel(s)),Ie(this.inputBackEl,[{opacity:0},{opacity:1}],{delay:s,duration:500,delay:s?s+400:400,fill:"forwards",ease:"ease-in-out"}),j0()&&!this.isPageBlue?this.inputText.click():(this.inputText.focus(),this.inputText.setSelectionRange(this.inputText.value.length,this.inputText.value.length))}toStartRecorginBluePage(){this.inputEl.style.overflow="unset",this.fadeOutLogo(),this.fadeOutCategoriesAndCaroussel();const s=Ie(this.inputFrontEl,[{width:`${this.inputFrontHeight}px`,offset:.45},{width:`${this.inputFrontHeight}px`,offset:1}],{duration:600,fill:"forwards",ease:"ease-out"}),u=Ie(this.inputFrontEl,[{transform:"translate3d(-50%, -50%, 0) scale(1)",offset:0},{transform:"translate3d(-50%, -50%, 0) scale(3.5)",offset:1}],{delay:s.effect.getComputedTiming().duration-300,duration:400,fill:"forwards",ease:"ease-in"});this.animCircleYoyo=Ie(this.inputFrontEl,[{transform:"translate3d(-50%, -50%, 0) scale(3.5)"},{transform:"translate3d(-50%, -50%, 0) scale(2.4)"},{transform:"translate3d(-50%, -50%, 0) scale(3.5)"}],{delay:s.effect.getComputedTiming().duration+u.effect.getComputedTiming().duration-300,duration:800,iterations:1/0,ease:"ease-in-out"}),Ie([this.recordCounter,this.infoTextEl],[{opacity:0,visibility:"visible"},{opacity:1,visibility:"visible"}],{delay:s.effect.getComputedTiming().duration,duration:700,fill:"forwards",ease:"ease-in-out"})}toStartRecordingGreyPage(){this.overlayRecordingEl.classList.add("show"),this.inputEl.classList.add("hidden"),this.animCircleYoyo=Ie(this.recordCircle,[{transform:"translate3d(-50%, -50%, 0) scale(1.3)"},{transform:"translate3d(-50%, -50%, 0) scale(1)"},{transform:"translate3d(-50%, -50%, 0) scale(1.3)"}],{duration:800,iterations:1/0,ease:"ease-in-out"}),Ie([this.recordCounter,this.infoTextEl],[{opacity:0,visibility:"visible"},{opacity:1,visibility:"visible"}],{duration:700,fill:"forwards",ease:"ease-in-out"})}toStartRecording(){this.cancelBtn.classList.add("show"),this.navbarEl.classList.add("hidden"),this.fadeOutButtons(0,100),this.inputEl.style.pointerEvents="none",this.isPageBlue?this.toStartRecorginBluePage():this.toStartRecordingGreyPage()}toStopRecording(s){if(this.cancelBtn.classList.remove("show"),this.navbarEl.classList.remove("hidden"),this.inputEl.style.pointerEvents="unset",this.animCircleYoyo.cancel(),this.isPageBlue){Ie([this.recordCounter,this.infoTextEl],[{opacity:1,visibility:"visible"},{opacity:0,visibility:"visible"}],{duration:300,fill:"forwards",ease:"ease-in-out"});const u=Ie(this.inputFrontEl,[{transform:"translate3d(-50%, -50%, 0) scale(3)"},{transform:"translate3d(-50%, -50%, 0) scale(1)"}],{duration:300,ease:"ease-in-out",fill:"forwards"}),b=this.expandWidthInputFront({delay:u.effect.getComputedTiming().duration+500,duration:250});s!=null&&s.onComplete&&(b.onfinish=s.onComplete)}else this.overlayRecordingEl.classList.remove("show"),this.inputEl.classList.remove("hidden"),s!=null&&s.onComplete&&s.onComplete()}toStartPhoneRecording(){this.inputEl.classList.add("hidden"),this.phoneContainer.classList.add("show")}toStopPhoneRecording(){const s=Ie(this.phoneContainer,[{opacity:1,transform:"translateY(0px)"},{topacity:0,transform:"translateY(100%)"}],{duration:300,ease:"ease-in-out",fill:"forwards"});s.onfinish=()=>{const u=Ie(this.inputEl,[{opacity:0,transform:"translateY(100%)"},{topacity:1,transform:"translateY(0)"}],{duration:300,ease:"ease-in-out",fill:"forwards"});s.cancel(),this.inputEl.classList.remove("hidden"),this.phoneContainer.classList.remove("show"),u.onfinish=()=>{u.cancel()}}}toDragImage({animBottom:s=!0,delay:u=0}={}){this.imageDroppedContainer.classList.remove("visible"),setTimeout(()=>{this.frontCameraBtn.classList.add("active-imagedrop"),this.inputImageContainer.classList.add("show")},u),s&&this.fadeOutCategoriesAndCaroussel(0,500)}leaveDragImage({animBottom:s=!0}={}){this.frontCameraBtn.classList.remove("active-imagedrop"),this.inputImageContainer.classList.remove("show"),this.fadeInButtons(),s&&this.fadeInCategoriesAndCaroussel(0,500)}toImageDroped(){this.inputImageContainer.classList.remove("show"),this.fadeOutButtons(0,0);const s=Ie(this.inputFrontEl,[{width:`${this.inputFrontHeight}px`,offset:.45},{width:`${this.inputFrontHeight}px`,offset:1}],{duration:800,fill:"forwards",ease:"ease-out"});this.animCircleYoyo=Ie(this.inputFrontEl,[{opacity:1},{opacity:0},{opacity:1}],{delay:s.effect.getComputedTiming().duration,duration:400,iterations:1/0,ease:"ease-in-out"})}toImageAnalyzed(){this.cancelBtn.classList.add("show"),this.navbarEl.classList.add("hidden"),this.animCircleYoyo.cancel();const s=this.fadeInInputFront({delay:0,duration:300});this.expandWidthInputFront({delay:s.effect.getComputedTiming().duration+500,duration:250}),this.toWrite({delay:1200,animButtons:!1,animLogos:!1,placeholder:"Ask a question about the image"}),this.imageDroppedContainer.classList.add("visible")}toRemoveImage(){this.imageDroppedContainer.classList.remove("visible"),this.cancelBtn.classList.remove("show"),this.navbarEl.classList.remove("hidden"),this.toInitial({animLogo:!1})}toImageReset(){this.animCircleYoyo.cancel(),this.fadeInButtons(300,delay);const s=this.fadeInInputFront({delay:0,duration:300}),u=this.expandWidthInputFront({delay:s.effect.getComputedTiming().duration+500,duration:250});this.fadeInButtons(s.effect.getComputedTiming().duration+u.effect.getComputedTiming().duration+500,0)}}const Xt={INITIAL:"INITIAL",RECORD_AUDIO:"RECORD_AUDIO",UPLOAD_IMAGE:"UPLOAD_IMAGE",WRITE:"WRITE"};class di{constructor({pageEl:s,toPageGrey:u,discussion:b,emitter:w}){this.toPageGrey=u,this.discussion=b,this.emitter=w,this.pageEl=s,this.inputEl=this.pageEl.querySelector(".input__container"),this.inputFrontEl=this.inputEl.querySelector(".input__front"),this.inputBackEl=this.inputEl.querySelector(".input__back"),this.submitBtn=this.inputBackEl.querySelector(".submit"),this.centerBtn=this.inputFrontEl.querySelector(".center-btn"),this.frontCameraBtn=this.inputFrontEl.querySelector(".camera-btn"),this.frontMicBtn=this.inputFrontEl.querySelector(".mic-btn"),this.frontCenterBtn=this.inputFrontEl.querySelector(".center-btn"),this.backCameraBtn=this.inputBackEl.querySelector(".camera-btn"),this.closeInputImageBtn=this.pageEl.querySelector(".input__image--closeBtn"),this.currentImage=null,this.inputImageEl=this.pageEl.querySelector(".input__image"),this.audioRecorder=new Wn({onComplete:this.onCompleteRecording.bind(this)}),this.isRecordCanceled=!1,this.recordCounter=this.pageEl.querySelector(".record-counter"),this.backMicBtnContainer=this.inputBackEl.querySelector(".mic-btn__container"),this.backMicBtn=this.backMicBtnContainer.querySelector(".mic-btn"),this.backMicText=this.backMicBtnContainer.querySelector("p"),this.isSmallRecording=!1,this.inputText=this.inputBackEl.querySelector(".input-text"),this.cancelBtn=document.body.querySelector(".cancel-btn"),this.navbarEl=document.querySelector(".nav"),this.onClickOutside={stopAudio:!1,animInitial:!1},this.currentStatus=Xt.INITIAL,this.isPageBlue=this.pageEl.classList.contains("page-blue"),this.anims=new jn({pageEl:this.pageEl}),this.inputImage=new Di({reset:()=>this.anims.toImageReset(),toImageDroped:()=>this.anims.toImageDroped(),toImageAnalyzed:()=>this.anims.toImageAnalyzed()},{onImageUploaded:I=>{this.currentImage=I}},this.pageEl),this.isPageBlue||(this.phone=new Kn({pageEl:this.pageEl,discussion:this.discussion,emitter:this.emitter,anims:{toStartPhoneRecording:()=>this.anims.toStartPhoneRecording(),toStopPhoneRecording:()=>this.anims.toStopPhoneRecording()}})),this.addListeners(),this.minTranscriptingTime=1400,this.textRecorded="text recorded",this.isPageBlue&&this.toPageGrey()}toWrite({delay:s=0,animButtons:u=!0,animLogos:b=!0}={}){this.currentStatus=Xt.WRITE,this.anims.toWrite({delay:s,animButtons:u,animLogos:b}),this.onClickOutside.animInitial=!0}startRecording(){this.isRecordCanceled=!1,this.inputText.disabled=!0,this.audioRecorder.startRecording(),this.timecodeAudioEl=this.isSmallRecording?this.backMicText:this.recordCounter,this.audioRecorder.onUpdate(s=>{const u=ui(s/60|0)+":"+ui(s%60);this.timecodeAudioEl.textContent=u})}stopRecording(){this.audioRecorder.stopRecording()}onTranscripting(){this.typingText=new Li({text:"Converting to text",container:this.inputFrontEl,backgroundColor:xa,marginLeft:16}),this.typingText.writing({onComplete:this.typingText.blink})}onCompleteTranscripting(){if(this.inputText.disabled=!1,this.timecodeAudioEl.textContent="00:00",this.inputText.value+=this.textRecorded,this.updateInputHeight(),this.isSmallRecording){this.isSmallRecording=!1,this.inputText.focus(),this.inputText.setSelectionRange(this.inputText.value.length,this.inputText.value.length);return}this.typingText&&this.typingText.reverse(),this.toWrite({delay:1200,animButtons:!1,animLogos:!1})}async onCompleteRecording(s){this.isRecordCanceled||(this.textRecorded=await Ta(s),this.timeoutTranscripting=setTimeout(()=>{this.onCompleteTranscripting()},this.minTranscriptingTime))}cancelRecord(){this.isRecordCanceled=!0,this.onClickOutside.stopAudio=!1,this.stopRecording(),this.anims.toStopRecording(),this.anims.fromRecordAudioToInitial()}onSubmit(s){s.preventDefault(),this.isPageBlue&&this.toPageGrey({duration:1200}),this.discussion.addUserElement({text:this.inputText.value,img:this.currentImage}),this.inputText.value="",this.currentImage=null,this.updateInputHeight(),this.cancelBtn.classList.remove("show"),this.navbarEl.classList.remove("hidden"),this.goToInitial()}updateInputHeight(){const s=new Event("input",{bubbles:!0,cancelable:!0});this.inputText.dispatchEvent(s)}goToInitial(){this.currentStatus=Xt.INITIAL,this.anims.toInitial(),this.onClickOutside.animInitial=!1,this.inputText.disabled=!1}addListeners(){this.centerBtn.addEventListener("click",()=>{this.toWrite()}),this.frontMicBtn&&this.frontMicBtn.addEventListener("click",()=>{this.currentStatus=Xt.RECORD_AUDIO,this.startRecording(),this.anims.toStartRecording(),this.onClickOutside.stopAudio=!0}),this.cancelBtn.addEventListener("click",()=>{this.currentStatus===Xt.RECORD_AUDIO&&this.cancelRecord(),this.currentStatus===Xt.UPLOAD_IMAGE&&(this.anims.toRemoveImage(),this.inputImage.disable(),this.currentImage=null),this.currentStatus=Xt.INITIAL}),this.backMicBtn.addEventListener("click",()=>{this.isSmallRecording?(this.stopRecording(),this.backMicBtnContainer.classList.remove("active")):(this.isSmallRecording=!0,this.startRecording(),this.backMicBtnContainer.classList.add("active"))}),this.frontCameraBtn.addEventListener("click",()=>{this.currentStatus=Xt.UPLOAD_IMAGE,this.inputImage.enable(),this.anims.toDragImage()}),this.backCameraBtn.addEventListener("click",()=>{this.isSmallRecording||(this.currentStatus=Xt.UPLOAD_IMAGE,this.inputImage.enable(),this.anims.toInitial({animBottom:!1,animButtons:!1}),this.anims.toDragImage({animBottom:!1,delay:300}),this.onClickOutside.animInitial=!1)}),this.closeInputImageBtn.addEventListener("click",()=>{this.currentStatus=Xt.INITIAL,this.inputImage.disable(),this.anims.leaveDragImage()}),this.inputImageEl.addEventListener("focus",s=>{document.documentElement.style.overflow="unset",window.scrollTo(0,document.body.scrollHeight)}),this.inputImageEl.addEventListener("blur",s=>{document.documentElement.style.overflow="hidden",window.scrollTo(0,0)}),this.pageEl.addEventListener("click",s=>{if(!this.isSmallRecording&&!this.inputEl.contains(s.target)&&!this.cancelBtn.contains(s.target)&&(this.onClickOutside.stopAudio&&(this.stopRecording(),this.anims.toStopRecording({onComplete:this.onTranscripting.bind(this)}),this.onClickOutside.stopAudio=!1),this.onClickOutside.animInitial)){if(this.inputText.value)return;this.goToInitial()}},{capture:!0}),document.addEventListener("keydown",()=>{this.isPageBlue||this.currentStatus!==Xt.WRITE&&!this.inputText.disabled&&this.toWrite()},{capture:!0}),this.inputText.addEventListener("focus",()=>{this.submitBtn.disabled=!this.inputText.value.trim().length>0}),this.inputText.addEventListener("keyup",s=>{this.submitBtn.disabled=!this.inputText.value.trim().length>0}),this.inputText.addEventListener("keydown",s=>{this.inputText.value.trim().length>0&&s.key==="Enter"&&!s.shiftKey&&this.onSubmit(s)}),this.submitBtn.addEventListener("click",s=>this.onSubmit(s))}}class Qn{constructor(){this.navEl=document.querySelector(".nav"),this.navBtn=this.navEl.querySelector(".nav__btn"),this.navList=this.navEl.querySelector(".nav__list"),this.addListeners()}addListeners(){this.navBtn.addEventListener("click",()=>{this.navList.classList.toggle("show")}),this.navEl.addEventListener("mouseenter",()=>{j0()||this.navList.classList.add("show")}),this.navEl.addEventListener("mouseleave",()=>{j0()||this.navList.classList.remove("show")})}}let O0=0;function zn(p,s){return new Promise(u=>{function b(){O0<s.length?(s.charAt(O0)===`
`?p.innerHTML+="<br>":p.innerHTML+=s.charAt(O0),O0++,setTimeout(b,10)):(O0=0,u())}b()})}function Jn(p){var s=p.split(".")[1],u=s.replace(/-/g,"+").replace(/_/g,"/"),b=decodeURIComponent(window.atob(u).split("").map(function(w){return"%"+("00"+w.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(b)}let er=class{constructor(s,u,b,w){this.uuid=s,this.name=u,this.picture=b,this.email=w}};class tr{constructor(s){I0(this,"callsubmit",async(s,u,b)=>{this.container=b;var w=s;if(this.sourcelang!=this.targetlang){var I=await this.googletranslate(w,this.targetlang,this.sourcelang);w=I.data.translations[0].translatedText,I.data.translations[0].detectedSourceLanguage&&(this.sourcelang=I.data.translations[0].detectedSourceLanguage)}if(this.awaiting&&this.workflowID!="")this.submituserreply(w,this.workflowID,u);else{var B=new XMLHttpRequest;B.onreadystatechange=async()=>{if(B.readyState==4){console.log(B.response);let y=JSON.parse(B.response);console.log(y.stream_id);let G=await Da({servers:["wss://ai.iamplus.services/tasks:8443"],user:"acc",pass:"user@123"});const Y=y.stream_id;console.log(Y);let U=await(await G.jetstream().consumers.get(Y,Y)).consume();G.onclose=function(L){console.log("Socket is closed. Reconnect will be attempted in 1 second.",L.reason),setTimeout(async function(){console.log("Socket is closed. Reconnect will be attempted in 1 second.",L.reason),G=await Da({servers:["wss://ai.iamplus.services/tasks:8443"],user:"acc",pass:"user@123"})},1e3)},G.onerror=function(L){console.error("Socket encountered error: ",L.message,"Closing socket"),ws.close()};for await(const L of U){var k=L.json();console.log(k);var D=k.data;if((k.message_type=="ui"||k.message_type=="conversation_question")&&(this.domain=k.ui_params.domain,console.log("domain:"+this.domain),this.domain=="MovieSearch"?(this.MovieSearch=JSON.parse(k.ui_params.MovieSearch),this.MovieSearchResults=JSON.parse(k.ui_params.MovieSearchResults)):this.domain=="TaxiSearch"?(this.TaxiSearch=JSON.parse(k.ui_params.TaxiSearch),this.TaxiSearchResults=JSON.parse(k.ui_params.TaxiSearchResults)):this.domain=="RAG_CHAT"?(this.RAG_CHAT=JSON.parse(k.ui_params.RAG_CHAT),console.log("domain RAG_CHAT:"+this.RAG_CHAT)):this.domain=="FlightSearch"&&(this.FlightSearch=JSON.parse(k.ui_params.FlightSearch),this.FlightSearchResults=JSON.parse(k.ui_params.FlightSearchResults))),k.awaiting&&(this.workflowID=k.session_id,this.awaiting=!0),k.awaiting&&k.message_type=="user_question"&&(this.agentawaiting=!0),k.streaming&&k.streaming==!0){var T=await this.toTitleCase2(D);if(this.sourcelang!="en"){var V=await this.googletranslate(await this.toTitleCase2(D),this.sourcelang,this.targetlang);T=V.data.translations[0].translatedText}await this.callbacks.addAIText({text:T,container:this.container}),k.stream_status&&k.stream_status=="ended"&&(this.callbacks.enableInput(),await this.callbacks.addAIText({text:`

`,container:this.container}))}else if(k.status=="Agent ended"){this.workflowID="",this.awaiting=!1,this.callbacks.enableInput();return}else if(k.awaiting){console.log("awaiting:"+k.message_type),console.log("mtext:"+D),this.workflowID=k.session_id,this.awaiting=!0;var T=await this.toTitleCase2(D);if(console.log("AIAnswer:"+T),this.sourcelang!="en"){var V=await this.googletranslate(await this.toTitleCase2(D),this.sourcelang,this.targetlang);T=V.data.translations[0].translatedText}await this.callbacks.addAIText({text:T,container:this.container}),this.domain=="RAG_CHAT"?(console.log("here RAG_CHAT:"+this.RAG_CHAT),this.getGucciUI(),this.domain="",this.RAG_CHAT=""):this.domain=="MovieSearch"&&(this.getMovies(),this.domain="",this.MovieSearchResults="",this.MovieSearch=""),this.callbacks.enableInput()}else if(k.status=="central finished")this.domain=="MovieSearch"?(this.getMovies(),this.domain="",this.MovieSearchResults="",this.MovieSearch=""):this.domain=="TaxiSearch"?(this.getTaxiUI(),this.TaxiSearchResults="",this.TaxiSearch="",this.domain=""):this.domain=="FlightSearch"&&(this.getFlightUI(),this.FlightSearch="",this.domain="",this.FlightSearchResults="");else if(k.message_type=="status"&&D!=""){var T=await this.toTitleCase2(D);if(this.sourcelang!="en"){var V=await this.googletranslate(T,this.sourcelang,this.targetlang);T=V.data.translations[0].translatedText}T+=`

`,await this.callbacks.addAIText({text:T,container:this.container})}L.ack()}G.drain()}},B.addEventListener("error",async function(k){console.log("error: "+k);var D="An error occurred while attempting to connect.";await this.callbacks.addAIText({text:D,container:this.container}),this.callbacks.enableInput()}),this.sessionID&&this.sessionID!=""?(B.open("POST","https://ai.iamplus.services/workflow/conversation",!0),B.setRequestHeader("Content-Type","application/json"),B.send(JSON.stringify({session_id:this.sessionID,uuid:this.deploy_ID}))):(B.open("POST","https://ai.iamplus.services/workflow/tasks",!0),B.setRequestHeader("Content-Type","application/json"),B.send(JSON.stringify({query:w,uuid:this.user.uuid})))}});I0(this,"translate",(s,u)=>new Promise(async(b,w)=>{var I=JSON.stringify([{text:s}]);console.log("text:"+s);var B=new XMLHttpRequest;B.addEventListener("readystatechange",function(){if(this.readyState===4){console.log(this.responseText);var k=JSON.parse(this.responseText);b(k)}}),B.open("POST","https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to="+u),B.setRequestHeader("Ocp-Apim-Subscription-Key","dd0450eaa72d4b628c901af99e551c8a"),B.setRequestHeader("Ocp-Apim-Subscription-Region","centralindia"),B.setRequestHeader("Content-Type","application/json"),B.addEventListener("error",function(k){console.log("error: "+k),w(k)}),B.send(I)}));I0(this,"googletranslate",(s,u,b)=>new Promise(async(w,I)=>{var B=new XMLHttpRequest,k="https://translation.googleapis.com/language/translate/v2",D="AIzaSyC1I58b1AR5z5V0b32ROnw55iFUjVso5dY";B.open("POST",`${k}?key=${D}`,!0),B.setRequestHeader("Content-Type","application/json"),B.onreadystatechange=function(){if(B.readyState===4&&B.status===200){console.log("google:"+B.responseText);var V=JSON.parse(B.responseText);V.data&&V.data.translations&&w(V)}else B.readyState===4&&B.status!==200&&console.error("Error:",B.responseText)};var T=JSON.stringify({q:s,target:u,source:b});B.send(T)}));this.callbacks=s,this.autodetect=null,this.targetlang="en",this.sourcelang="en",this.location="US",this.sessionID="",this.workflowID="",this.awaiting=!1,this.agentawaiting=!1,this.domain="",this.FlightSearch="",this.FlightSearchResults="",this.TaxiSearch="",this.TaxiSearchResults="",this.container=null,this.RAG_CHAT="",this.MovieSearch="",this.MovieSearchResults="",this.user=this.getUser(),this.deploy_ID=""}getUser(){if(localStorage.getItem("googleToken")){const s=Jn(localStorage.getItem("googleToken"));return new er(s.sub,s.name,s.picture,s.email)}else return null}toTitleCase(s){return s=s.replace(/\w\S*/g,function(u){return u.charAt(0).toUpperCase()+u.substr(1).toLowerCase()}),s=s.replaceAll(`
`,"<br>"),s}toTitleCase2(s){return s=s.replaceAll(`
`,"<br>"),s}truncate(s){var u=200;return s&&s.length>u?s.slice(0,u-1)+"&hellip;":s}submituserreply(s,u,b){var w="";b&&b.length>0?w=JSON.stringify({message_type:"user_reply",user:"User",message:{type:"text",json:{},text:s},user_data:{type:"image",url:b[0]}}):w=JSON.stringify({message_type:"user_reply",user:"User",message:{type:"text",json:{},text:s}});var I=new XMLHttpRequest;I.addEventListener("readystatechange",function(){this.readyState===4&&console.log(this.responseText)}),I.open("POST","https://ai.iamplus.services/workflow/message/"+u),I.setRequestHeader("Content-Type","application/json"),I.send(w)}getMovies(){const s=document.createElement("div"),u=document.createElement("div");u.className="moviescard-container",this.MovieSearchResults.forEach(w=>{const I=document.createElement("div");I.className="movies-card",I.setAttribute("data-info","movies-details"),I.setAttribute("data-details",JSON.stringify(w).replace(/'/g,"&#39;")),I.addEventListener("click",D=>this.showMovieDetail(D));const B=document.createElement("img");B.className="movies-image",B.setAttribute("alt",w.MovieTitle.replace(/'/g,"&#39;")),B.setAttribute("src",w.MoviePoster),I.appendChild(B);const k=document.createElement("p");k.className="movies-title",k.innerText=w.MovieTitle,I.appendChild(k),u.appendChild(I)}),s.appendChild(u);const b=document.createElement("div");b.setAttribute("id","movie-details"),s.appendChild(b),this.container.appendChild(s)}showMovieDetail(s){let u=s.target,b=u.parentElement.parentElement.parentElement.querySelector("#movie-details"),w=JSON.parse(u.parentElement.getAttribute("data-details").replace("&#39;",/'/g));w.Theatre.forEach(I=>{const B=document.createElement("div");B.className="movie-details-card";const k=document.createElement("div");k.className="movie-details-theater-header",k.innerHTML=I.Name,B.appendChild(k);const D=document.createElement("div");D.className="movie-details-dates",D.setAttribute("data-details",JSON.stringify(I).replace(/'/g,"&#39;")),this.getMoviesDateShowtime(w.MovieTitle,I,I.DateTime[0].Date,D),console.log(w.MovieTitle),B.appendChild(D),b.innerHTML="",b.appendChild(B)})}getMoviesDateShowtime(s,u,b,w){const I=document.createElement("div");I.className="movie-details-date-selector";const B=document.createElement("button");B.className="arrow left-arrow",B.innerHTML="&lt;&nbsp;&nbsp;",B.addEventListener("click",T=>this.getmovieshowtimes(T,-1,s)),u.DateTime[0].Date==b&&(B.disabled=!0),I.appendChild(B);const k=document.createElement("span");k.innerText=b,I.appendChild(k);const D=document.createElement("button");D.className="arrow right-arrow",D.innerHTML="&nbsp;&nbsp;&gt;",D.addEventListener("click",T=>this.getmovieshowtimes(T,1,s)),u.DateTime[u.DateTime.length-1].Date==b&&(D.disabled=!0),I.appendChild(D),w.appendChild(I),u.DateTime.forEach(T=>{if(T.Date==b){const V=document.createElement("div");V.className="movie-details-showtimes",T.Time.forEach(y=>{const G=document.createElement("button");G.className="movie-details-showtime",G.innerHTML=y.slice(0,-3),G.addEventListener("click",Y=>this.submitmovieselection(s,u.Name,T.Date,y.slice(0,-3))),V.appendChild(G)}),w.appendChild(V)}})}getmovieshowtimes(s,u,b){let w=s.target,I=w.parentElement.parentElement.parentElement.querySelector(".movie-details-dates"),B=JSON.parse(I.getAttribute("data-details").replace("&#39;",/'/g));if(u==1){const k=w.previousElementSibling.tagName==="SPAN"?w.previousElementSibling:null;let D=new Date(k.innerHTML);D.setDate(D.getDate()+1),I.innerHTML="",this.getMoviesDateShowtime(b,B,D.toISOString().slice(0,10),I)}else{const k=w.nextElementSibling.tagName==="SPAN"?w.nextElementSibling:null;let D=new Date(k.innerHTML);D.setDate(D.getDate()-1),I.innerHTML="",this.getMoviesDateShowtime(b,B,D.toISOString().slice(0,10),I)}}async submitmovieselection(s,u,b,w){if(s=s.replace("","'"),this.agentawaiting){var I="book movie ticket for "+JSON.stringify({movie_name:s,theatre_name:u,movie_date:b,movie_time:w}),B=JSON.stringify({message_type:"user_reply",user:"User",message:{type:"text",json:{},text:I}}),k=new XMLHttpRequest;k.withCredentials=!0,k.addEventListener("readystatechange",function(){this.readyState===4&&console.log(this.responseText)}),k.open("POST","https://ai.iamplus.services/workflow/message/"+this.workflowID),k.setRequestHeader("Content-Type","application/json"),k.send(B),this.agentawaiting=!1}else{var I="book movie ticket for "+JSON.stringify({movie_name:s,theatre_name:u,movie_date:b,movie_time:w});console.log("texttosend:"+I),this.callsubmit(I,"",this.container)}}getTaxiUI(){const s=document.createElement("div");s.className="rides-list-wrapper";let u=this.TaxiSearchResults;for(let b=0;b<u.services.length;b++){let w=u.services[b];if(w){const I=document.createElement("div");I.className="rides-list-item",s.appendChild(I);const B=document.createElement("div");B.className="rides-list-item-header",I.appendChild(B);const k=document.createElement("figure");k.className="rides-list-item-header-logo",B.appendChild(k);const D=document.createElement("img");D.setAttribute("src","./images/logo/"+w.provider+"-logo.svg"),D.setAttribute("alt",w.provider),k.appendChild(D);const T=document.createElement("div");T.className="rides-list-item-header-info";const V=document.createElement("p");w.name.includes("TAXI_HAILING")?V.innerHTML="Taxi Hailing":V.innerHTML=w.name,T.appendChild(V);const y=document.createElement("p");y.innerHTML=w.description,T.appendChild(y);const G=document.createElement("p");if(G.innerHTML=w.seats,T.appendChild(G),w.deeplink){const q=document.createElement("a");q.setAttribute("href",w.deeplink),q.setAttribute("target","_blank"),q.innerHTML="Link",T.appendChild(q)}B.appendChild(T);const Y=document.createElement("div");Y.className="rides-list-item-content";const K=document.createElement("div");if(K.className="rides-list-item-content-prices",w.price)if(w.price.length>1){const q=document.createElement("span");q.innerText="$",K.appendChild(q);const U=document.createElement("span");if(U.innerText=w.price[0]+"-"+w.price[1],K.appendChild(U),b==0){const L=document.createElement("span");L.className="rides-list-item-content-sticker",L.innerText="cheapest",Y.appendChild(L)}}else{const q=document.createElement("span");q.innerText="$",K.appendChild(q);const U=document.createElement("span");if(U.innerText=w.price,K.appendChild(U),b==0){const L=document.createElement("span");L.className="rides-list-item-content-sticker",L.innerText="cheapest",Y.appendChild(L)}}else{const q=document.createElement("span"),U=document.createElement("span");K.appendChild(q),K.appendChild(U)}Y.appendChild(K),I.appendChild(Y),s.appendChild(I),this.container.appendChild(s)}}}getFlightUI(){const s=document.createElement("div");if(s.className="FlightContainer Flight-Container",s.setAttribute("name","flightResult"),this.FlightSearch.departure_end_date.length>0&&this.FlightSearch.return_end_date.length>0){const b=document.createElement("div");b.className="flight-toggle-button-container",s.appendChild(b);const w=document.createElement("button");w.className="flight-toggle-button active",w.addEventListener("click",B=>this.toggleflights(B)),w.innerHTML="Outbound",w.id="Outbound",b.appendChild(w);const I=document.createElement("button");I.className="flight-toggle-button",I.addEventListener("click",B=>this.toggleflights(B)),I.id="Return",I.innerHTML="Return",b.appendChild(I)}let u=this.FlightSearchResults.Outbound;for(let b=0;b<2;b++)if(b==1&&(u=this.FlightSearchResults.Return),u.length>0){const w=document.createElement("div");w.className="flightResult",b==0&&(w.className="flightResult",w.setAttribute("id","flightResultOutbound"),s.appendChild(w)),b==1&&(w.setAttribute("id","flightResultReturn"),w.setAttribute("style","display:None"),s.appendChild(w));let I=0;u.forEach(B=>{const k=document.createElement("div");k.className="flightCard",w.appendChild(k);const D=document.createElement("div");D.className="rowFlightCard",k.appendChild(D);const T=document.createElement("div");T.className="logoFight",D.appendChild(T);const V=document.createElement("div");T.appendChild(V);const y=document.createElement("img");y.setAttribute("src",B.travel.airlines_logo),y.setAttribute("style","height: 40px;mix-blend-mode: multiply;"),V.appendChild(y);const G=document.createElement("div");G.className="flghtCost",D.appendChild(G);const Y=document.createElement("span");Y.className="currency",Y.innerHTML="USD",G.appendChild(Y);const K=document.createElement("p");K.className="big",K.innerHTML=B.price.split("$")[1],G.appendChild(K);const q=document.createElement("div");q.className="rowFlightCard",k.appendChild(q);const U=document.createElement("div");U.className="start",q.appendChild(U);const L=document.createElement("span");L.innerHTML=B.airport1_code,U.appendChild(L);const _=document.createElement("p");_.className="big",_.innerHTML=B.travel.start_time.split(`
`)[0]+(B.travel.start_time.split(`
`)[1]?'<span class="small">'+B.travel.start_time.split(`
`)[1]+"</span>":""),U.appendChild(_);const m=document.createElement("div");m.className="duration",q.appendChild(m);const E=document.createElement("p");E.className="timeHourMin",E.innerHTML=B.travel.duration.split("h")[0]+'<span style="color: rgba(0, 0, 0, 0.40);">h</span> '+B.travel.duration.substring(B.travel.duration.indexOf(" "),B.travel.duration.indexOf("m"))+'<span style="color: rgba(0, 0, 0, 0.40);">m</span>',m.appendChild(E);const e=document.createElement("div");e.className="dDirection",m.appendChild(e);let v='<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.053 15.5789L12 24L10 24L12.526 15.5789L7.166 15.5789L5.5 18.7368L4 18.7368L5 14L4 9.26316L5.5 9.26316L7.167 12.4211L12.527 12.4211L10 4L12 4L17.053 12.4211L22.5 12.4211C22.8978 12.4211 23.2794 12.5874 23.5607 12.8835C23.842 13.1796 24 13.5812 24 14C24 14.4188 23.842 14.8204 23.5607 15.1165C23.2794 15.4126 22.8978 15.5789 22.5 15.5789L17.053 15.5789Z" fill="black" fill-opacity="0.4"/></svg>';B.travel.stops==0?(v+='<svg xmlns="http://www.w3.org/2000/svg" width="152" height="28" viewBox="0 0 152 28" fill="none">',v+='<line x1="0.6" y1="13.4" x2="151.4" y2="13.4" stroke="black" stroke-opacity="0.4" stroke-width="1.2"',v+='stroke-linecap="round" stroke-dasharray="0.1 4" />',v+="</svg>"):(v+='<svg width="136" height="28" viewBox="0 0 136 28" fill="none" xmlns="http://www.w3.org/2000/svg">',v+='<line x1="0.6" y1="13.4" x2="58.4" y2="13.4" stroke="black" stroke-opacity="0.4" stroke-width="1.2" stroke-linecap="round" stroke-dasharray="0.1 4"/>',v+='<g clip-path="url(#clip0_10855_133720)">',v+='<circle cx="68" cy="14" r="3.00002" stroke="black" stroke-opacity="0.4" stroke-width="1.50001"/>',v+="</g>",v+='<line x1="77.1" y1="13.4" x2="134.9" y2="13.4" stroke="black" stroke-opacity="0.4" stroke-width="1.2" stroke-linecap="round" stroke-dasharray="0.1 4"/>',v+="<defs>",v+='<clipPath id="clip0_10855_133720">',v+='<rect width="18" height="28" fill="white" transform="translate(58.5)"/>',v+="</clipPath>",v+="</defs>",v+="</svg>"),v+='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="20" viewBox="0 0 18 20" fill="none">',v+='<circle cx="9.50002" cy="10.0001" r="3.75002" fill="black" fill-opacity="0.4" />',v+="</svg>",m.innerHTML=v;const f=document.createElement("p");f.className="dDirection",B.travel.stops==0?f.innerHTML="Direct":B.travel.stops==1?f.innerHTML=B.travel.stops+" connection":f.innerHTML=B.travel.stops+" connections",m.appendChild(f);const x=document.createElement("div");x.className="destination",q.appendChild(x);const c=document.createElement("span");c.innerHTML=B.airport2_code,x.appendChild(c);const n=document.createElement("p");if(n.className="big",n.innerHTML=B.travel.end_time.split(`
`)[0]+(B.travel.end_time.split(`
`)[1]?'<span class="small">'+B.travel.end_time.split(`
`)[1]+"</span>":""),x.appendChild(n),I==0){const h=document.createElement("div");h.className="recommand",h.innerHTML="CHEAPEST",k.appendChild(h)}const i=document.createElement("div");i.className="site",i.innerHTML=B.website,k.appendChild(i),I++})}this.container.appendChild(s)}toggleflights(s){let u=s.target;u.id=="Outbound"?(u.classList.add("active"),u.parentElement.querySelector("#Return").classList.remove("active"),u.parentElement.parentElement.querySelector("#flightResultOutbound").style.display="flex",u.parentElement.parentElement.querySelector("#flightResultReturn").style.display="none"):(u.classList.add("active"),u.parentElement.querySelector("#Outbound").classList.remove("active"),u.parentElement.parentElement.querySelector("#flightResultOutbound").style.display="none",u.parentElement.parentElement.querySelector("#flightResultReturn").style.display="flex")}getGucciUI(){const s=document.createElement("div"),u=document.createElement("div");u.className="productcard-container",s.appendChild(u),this.RAG_CHAT.forEach(w=>{const I=document.createElement("div");I.className="product-card",I.setAttribute("data-info","product-details"),I.setAttribute("data-details",JSON.stringify(w).replace(/'/g,"&#39;")),I.addEventListener("click",V=>this.showProductDetail(V)),u.appendChild(I);const B=document.createElement("img");B.className="product-image",B.setAttribute("src",w.image_url),B.setAttribute("alt",w.name),I.appendChild(B);const k=document.createElement("h3");k.className="product-name",k.innerHTML=w.name,I.appendChild(k);const D=document.createElement("p");D.className="product-price",D.innerHTML=w.price,I.appendChild(D);const T=document.createElement("div");T.className="product-overlay",I.appendChild(T)});const b=document.createElement("div");b.id="product-details",s.appendChild(b),this.container.appendChild(s)}showProductDetail(s){let u=s.target;var b=JSON.parse(u.parentElement.getAttribute("data-details")),w=u.parentElement.parentElement.parentElement.querySelector("#product-details");const I=document.createElement("div");I.className="product-details-card";const B=document.createElement("div");B.className="product-details-image",I.appendChild(B);const k=document.createElement("div");k.className="carousel",B.appendChild(k),b.image_urls.forEach(q=>{const U=document.createElement("div");U.className="carouselitem";const L=document.createElement("img");L.setAttribute("src",q),L.setAttribute("alt",b.name),U.appendChild(L),k.appendChild(U)});const D=document.createElement("div");D.className="product-details",I.appendChild(D);const T=document.createElement("h1");T.className="product-details-title",T.innerHTML=b.name,D.appendChild(T);const V=document.createElement("div");V.className="product-details-price",V.innerHTML=b.price,D.appendChild(V);const y=document.createElement("button");y.className="product-details-add-btn",D.appendChild(y);const G=document.createElement("a");G.setAttribute("href",b.link_url),G.setAttribute("target","_blank"),y.appendChild(G);const Y=document.createElement("img");Y.setAttribute("src","./images/buy.svg"),G.appendChild(Y);const K=document.createElement("p");K.className="product-details-description",K.innerHTML=b.desc.replaceAll(`
`,"<br>"),D.appendChild(K),w.innerHTML="",w.appendChild(I)}formatDateToString(s){const u=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];s=new Date(s);const w=u[s.getDay()],I=s.getDate(),B=b[s.getMonth()];return`${w}, ${I} ${B}`}}class ar{constructor({toPageGrey:s,emitter:u}){this.emitter=u,this.toPageGrey=s,this.page=document.querySelector(".page-grey"),this.mainEl=this.page.querySelector("main"),this.inputText=this.page.querySelector(".input-text"),this.discussionContainer=document.querySelector(".discussion__container"),this.addUserElement=this.addUserElement.bind(this),this.Chat=new tr({addAIText:this.addAIText.bind(this),disableInput:this.disableInput.bind(this),enableInput:this.enableInput.bind(this)}),this.addListeners()}disableInput(){this.inputText.disabled=!0}enableInput(){this.inputText.disabled=!1,this.inputText.focus()}getAiAnswer({text:s,img:u}){const b=document.createElement("div");b.classList.add("discussion__ai"),this.discussionContainer.appendChild(b),this.scrollToBottom(),this.typingText=new Li({text:"",container:b,backgroundColor:Pi,marginLeft:16}),this.typingText.blink(),this.Chat.callsubmit(s,u,b)}addUserElement({text:s,img:u}){if(u){const w=document.createElement("div");w.classList.add("discussion__user"),w.appendChild(u),this.discussionContainer.appendChild(w)}const b=document.createElement("div");b.classList.add("discussion__user"),b.innerHTML=s.replace(/\n/g,"<br>"),this.discussionContainer.appendChild(b),this.scrollToBottom(),this.disableInput(),this.getAiAnswer({text:s,img:u})}async addAIText({text:s,container:u}){this.emitter.emit("addAITextTest",s),this.typingText.fadeOut();const b=document.createElement("span");return u.appendChild(b),s=s.replace(/<br\/?>\s*/g,`
`),j0()?b.innerHTML=s:(s=s.replace(/<br\/?>\s*/g,`
`),zn(b,s))}scrollToBottom(){this.mainEl.scrollTo({top:this.discussionContainer.scrollHeight,behavior:"smooth"})}async onLoad(){var s=window.location.search,u=new URLSearchParams(s),b=u.get("q");const w=u.get("session_id"),I=u.get("deploy_id");u.get("location")&&u.get("location")!=""&&(this.Chat.location=u.get("location")),u.get("lang")&&u.get("lang")!=""&&(this.Chat.sourcelang=u.get("lang"),this.Chat.sourcelang=="ad"&&(this.Chat.sourcelang=""),this.Chat.autodetect=!0),b&&b!=""&&this.getAiAnswer({text:""}),w&&w!=""&&(this.toPageGrey(),this.Chat.sessionID=w,this.Chat.deploy_ID=I,this.getAiAnswer({text:""}))}addListeners(){window.addEventListener("load",this.onLoad()),new ResizeObserver(this.scrollToBottom.bind(this)).observe(this.discussionContainer)}}let ir=()=>({emit(p,...s){for(let u=0,b=this.events[p]||[],w=b.length;u<w;u++)b[u](...s)},events:{},on(p,s){var u;return((u=this.events)[p]||(u[p]=[])).push(s),()=>{var b;this.events[p]=(b=this.events[p])==null?void 0:b.filter(w=>s!==w)}}});function sr(p){var s=p.split(".")[1],u=s.replace(/-/g,"+").replace(/_/g,"/"),b=decodeURIComponent(window.atob(u).split("").map(function(w){return"%"+("00"+w.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(b)}class nr{constructor(s,u,b,w){this.uuid=s,this.name=u,this.picture=b,this.email=w}}class rr{constructor(){this.pageBlue=document.querySelector(".page-blue"),this.pageGrey=document.querySelector(".page-grey"),this.navbarEl=document.querySelector(".nav"),this.cancelBtn=document.querySelector(".cancel-btn"),this.emitter=ir(),this.user=this.getUser(),this.addListeners(),this.resetScroll(),this.user||this.redirectToLogin()}getUser(){if(localStorage.getItem("googleToken")){const s=sr(localStorage.getItem("googleToken"));return new nr(s.sub,s.name,s.picture,s.email)}else return null}redirectToLogin(){console.log("notloggedin"),window.location.href="./login/index.html"}toPageGrey({duration:s=0}={}){this.pageBlue.style.transitionDuration=s+"ms",this.pageGrey.style.transitionDuration=s+"ms",this.pageBlue.classList.add("hidden"),this.pageGrey.classList.add("show"),this.navbarEl.classList.add("dark"),this.cancelBtn.classList.add("dark")}initApp(){this.initNavbar(),this.initCaroussel(),this.initDiscussion(),this.initInput()}initNavbar(){new Qn}initCaroussel(){this.caroussel=new qi,this.caroussel.init()}initDiscussion(){this.discussion=new ar({emitter:this.emitter,toPageGrey:this.toPageGrey.bind(this)})}initInput(){const s={discussion:this.discussion,toPageGrey:this.toPageGrey.bind(this),emitter:this.emitter};new di({pageEl:this.pageBlue,...s}),new di({pageEl:this.pageGrey,...s})}resetScroll(){window.scrollTo(0,0)}addListeners(){window.addEventListener("load",()=>{document.body.classList.remove("preload")}),document.fonts.ready.then(()=>{this.initApp()})}}new rr;
