var Oi=Object.defineProperty;var Ni=(p,i,u)=>i in p?Oi(p,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):p[i]=u;var R0=(p,i,u)=>(Ni(p,typeof i!="symbol"?i+"":i,u),u);import"./index-cca9f430.js";import{connect as qa}from"https://cdn.jsdelivr.net/npm/nats.ws@latest/esm/nats.js";function gi({element:p,expression:i=" ",append:u=!0}){const A=Fi(p.innerHTML.toString().trim(),i);let w="";A.forEach(B=>{B.indexOf("<br>")>-1?B.split("<br>").forEach((V,T)=>{w+=T>0?"<br>"+la(V):la(V)}):w+=la(B)}),p.innerHTML=w;const I=p.querySelectorAll("span");return u&&I.forEach(B=>{const L=B.textContent.length===1,V=B.innerHTML.trim()!=="",T=B.textContent!=="&",P=B.textContent!=="-";L&&V&&T&&P&&(B.innerHTML=`${B.textContent}&nbsp;`)}),I}function Hi(p){const i=[];let u=[],A=p[0].offsetTop;return p.forEach((w,I)=>{w.offsetTop===A&&u.push(w),w.offsetTop!==A&&(i.push(u),u=[],u.push(w),A=w.offsetTop),I+1===p.length&&i.push(u)}),i}function Fi(p,i){const u=p.split("<br>");let A=[];return u.forEach((w,I)=>{I>0&&A.push("<br>"),A=A.concat(w.split(i));let B=!1,L="";const V=[];A.forEach(T=>{!B&&(T.includes("<a")||T.includes("<strong"))&&(L="",B=!0),B&&(L+=` ${T}`),B&&(T.includes("/a>")||T.includes("/strong>"))&&(V.push(L),L=""),!B&&L===""&&V.push(T),B&&(T.includes("/a>")||T.includes("/strong>"))&&(B=!1)}),A=V}),A}function la(p){return p=p.trim(),p===""||p===" "?p:p==="<br>"?"<br>":`<span>${p}</span>`+(p.length>1?" ":"")}function Vi(p){let i=[],u=Math.floor(p.length/2);i.push(p[u]);for(let A=1;A<=u;A++)p[u+A]!==void 0?(i.push(p[u-A]),i.push(p[u+A])):p[u-A]!==void 0&&i.push(p[u-A]);return i}function Ie(p,i,u){return Array.isArray(p)?p.map(A=>A.animate(i,u)):p.animate(i,u)}const ya="#fff",Da="#648ff2",Pi="#eaeced";const oa=["Book me a flight from Singapore to Kuala Lumpur on  flight from Singapore to Kuala Lumpur","Book me a flight from Paris to Kuala Lumpur on  flight from Singapore to Kuala Lumpur","Book me a flight from London to Kuala Lumpur on  flight from Singapore to Kuala Lumpur"];function F0(p,i,u){const A=u?"translateX(0%)":`translateX(${i})`,w=u?`translateX(${i})`:"translateX(0%)";return Ie(p,[{color:Da,transform:A,offset:0},{color:ya,offset:.5},{color:ya,offset:.95},{color:Da,transform:w,offset:1},{opacity:1}],{duration:500,fill:"forwards",ease:"ease-in-out"})}class qi{constructor(){this.carousselEl=document.querySelector(".caroussel__container"),this.carousselTextEl=this.carousselEl.querySelector(".caroussel__text"),this.nextBtn=this.carousselEl.querySelector("#btn-next"),this.prevBtn=this.carousselEl.querySelector("#btn-prev"),this.markerEl=this.carousselEl.querySelector(".caroussel__markers")}init(){this.currentIndex=0,this.startAnimIndex=0,this.isComplete=!1,this.addText(),this.createMarkers(),this.updateButtons(),this.createLines(),this.addListeners(),this.showLines()}createMarkers(){for(let i=0;i<oa.length;i++){let u=document.createElement("span");u.classList.add("marker"),i===this.currentIndex&&u.classList.add("active"),this.markerEl.appendChild(u)}}addText(){this.carousselTextEl.innerHTML="",this.carousselTextEl.textContent=oa[this.currentIndex]}createLines(){this.splitLines=Hi(gi({element:this.carousselTextEl})),this.nbLines=this.splitLines.length,this.middleLineIndex=this.nbLines%2===1?Math.floor(this.nbLines/2):null,this.carousselTextEl.innerHTML="",this.linesEls=this.getLines(this.splitLines),this.linesSorted=Vi(this.linesEls),this.addClasses(),this.addMasks()}getLines(i){return i.map((u,A)=>{const w=u.map(B=>B.outerHTML).join(" "),I=document.createElement("div");return I.innerHTML=w,this.carousselTextEl.appendChild(I),I})}addClasses(){this.linesEls.forEach((i,u)=>{if(this.middleLineIndex!==null&&u===this.middleLineIndex)i.classList.add("caroussel__line--middle");else{const w=(u-this.middleLineIndex)%2===0?"caroussel__line--even":"caroussel__line--odd";i.classList.add("caroussel__line"),i.classList.add(w)}})}addMasks(){for(let i=0;i<this.linesSorted.length;){const u=this.linesSorted[i];if(u.classList.contains("caroussel__line--middle")){const A=document.createElement("span"),w=document.createElement("span");A.classList.add("mask","mask-left"),w.classList.add("mask","mask-right"),A.textContent="/",w.textContent="/",u.appendChild(A),u.appendChild(w),i++}else{const A=this.linesSorted[i],w=this.linesSorted[i+1],I=document.createElement("span"),B=document.createElement("span");I.classList.add("mask","mask-left"),B.classList.add("mask","mask-right"),I.textContent="/",B.textContent="/",w.appendChild(I),A.appendChild(B),i+=2}}}onHideComplete(){this.isComplete||(this.isComplete=!0,this.carousselTextEl.style.opacity=0,this.addText(),this.createLines(),this.carousselTextEl.style.opacity=1,this.updateMarkers(),this.animLines(!0))}onShowComplete(){this.startAnimIndex=0,this.isAnimating=!1}animLines(i){if(this.startAnimIndex>this.nbLines-1){this.startAnimIndex=0,i?this.onShowComplete():(this.startAnimIndex=0,this.onHideComplete());return}if(this.middleLineIndex!==null&&this.startAnimIndex===0){const u=this.linesSorted[this.startAnimIndex],A=u.querySelector(".mask-left"),w=u.querySelector(".mask-right");F0(w,"100%",i);const I=F0(A,"-100%",i);I.onfinish=()=>{this.startAnimIndex=1,this.animLines(i)}}else{const u=this.linesSorted[this.startAnimIndex],A=this.linesSorted[this.startAnimIndex+1],w=u.querySelector(".mask"),I=A.querySelector(".mask");F0(w,"100%",i);const B=F0(I,"-100%",i);B.onfinish=()=>{this.startAnimIndex+=2,this.animLines(i)}}}showLines(){this.carousselTextEl.querySelectorAll(".mask").forEach(u=>{u.classList.contains("mask-left")?u.style.transform="translateX(-100%)":u.style.transform="translateX(100%)"})}updateMarkers(){const i=this.markerEl.querySelectorAll(".marker");i.forEach(u=>u.classList.remove("active")),i[this.currentIndex].classList.add("active")}updateButtons(){this.nextBtn.disabled=this.currentIndex===oa.length-1,this.prevBtn.disabled=this.currentIndex===0}prev(){this.isAnimating||(this.isAnimating=!0,this.isComplete=!1,this.currentIndex-=1,this.updateButtons(),this.animLines(!1))}next(){this.isAnimating||(this.isAnimating=!0,this.isComplete=!1,this.currentIndex+=1,this.updateButtons(),this.animLines(!1))}addListeners(){this.nextBtn.addEventListener("click",()=>{this.next()}),this.prevBtn.addEventListener("click",()=>{this.prev()})}}class Di{constructor(i,u,A){this.pageEl=A,this.imageDroppedContainer=this.pageEl.querySelector(".image-dropped__container"),this.dropImageOverlayEl=this.pageEl.querySelector(".image-drop-zone--overlay"),this.inputFileUploadEl=this.pageEl.querySelector(".input__file-upload"),this.closeBtn=this.pageEl.querySelector(".input__image--closeBtn"),this.anims=i,this.callbacks=u,this.analizingImageMinTime=1e3,this.isEnabled=!1,this.addListeners()}uploadFile(i){let u=/image.*/;if(i.type.match(u)){let A="HTTP/HTTPS URL TO SEND THE DATA TO",w=new FormData;w.append("file",i),fetch(A,{method:"put",body:w}).then(I=>I.json()).then(I=>{console.log("Success:",I)}).catch(I=>{console.error("Error:",I)})}else console.error("Only images are allowed!",i)}enable(){this.isEnabled=!0}disable(){this.inputFileUploadEl.value="",this.imageDroppedContainer.innerHTML="",this.isEnabled=!1}onDrop(i){this.anims.toImageDroped(),console.log("TODO: add end point to send the image file to the server",i),setTimeout(()=>{this.previewImage(i)},this.analizingImageMinTime)}previewImage(i){let u=/image.*/;if(i.type.match(u)){this.anims.toImageAnalyzed();let A=new FileReader;A.readAsDataURL(i),A.onloadend=()=>{let w=document.createElement("img");w.src=A.result,i.size/1e3+"",this.imageDroppedContainer.appendChild(w),this.callbacks.onImageUploaded(w)}}else this.anims.reset(),console.error("Only images are allowed!",i)}addListeners(){["dragenter","dragover","dragleave","drop"].forEach(u=>{this.pageEl.addEventListener(u,i)});function i(u){u.preventDefault(),u.stopPropagation()}["dragenter","dragover"].forEach(u=>{this.pageEl.addEventListener(u,()=>{this.isEnabled&&this.dropImageOverlayEl.classList.add("hovered")})}),["dragleave","drop"].forEach(u=>{this.pageEl.addEventListener(u,()=>{this.isEnabled&&this.dropImageOverlayEl.classList.remove("hovered")})}),this.pageEl.addEventListener("drop",u=>{if(!this.isEnabled)return;const I=u.dataTransfer.files[0];this.onDrop(I)}),this.inputFileUploadEl.addEventListener("change",u=>{if(this.inputFileUploadEl.files&&this.inputFileUploadEl.files[0]){const A=this.inputFileUploadEl.files[0];this.onDrop(A)}})}}const xa=p=>new Promise((i,u)=>{var A=new XMLHttpRequest,w=new FormData;w.append("audio_file",p,crypto.randomUUID()+".wav"),w.append("type","audio/wav"),A.open("POST","https://ai.iamplus.services/speech/asr?task=transcribe&encode=true&output=json&word_timestamps=false",!0),A.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE&&this.status===200){var I=JSON.parse(this.responseText);i(I.text)}},A.addEventListener("error",function(I){console.log("error: "+I),i("error: text was not transcribed")}),A.send(w)});function Ma(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var wa={};function Xi(p){return new Int8Array(p)}function vi(p){return new Int16Array(p)}function mi(p){return new Int32Array(p)}function fi(p){return new Float32Array(p)}function Yi(p){return new Float64Array(p)}function pi(p){if(p.length==1)return fi(p[0]);var i=p[0];p=p.slice(1);for(var u=[],A=0;A<i;A++)u.push(pi(p));return u}function bi(p){if(p.length==1)return mi(p[0]);var i=p[0];p=p.slice(1);for(var u=[],A=0;A<i;A++)u.push(bi(p));return u}function Ai(p){if(p.length==1)return vi(p[0]);var i=p[0];p=p.slice(1);for(var u=[],A=0;A<i;A++)u.push(Ai(p));return u}function Ei(p){if(p.length==1)return new Array(p[0]);var i=p[0];p=p.slice(1);for(var u=[],A=0;A<i;A++)u.push(Ei(p));return u}var Si={};Si.fill=function(p,i,u,A){if(arguments.length==2)for(var w=0;w<p.length;w++)p[w]=arguments[1];else for(var w=i;w<u;w++)p[w]=A};var N0={};N0.arraycopy=function(p,i,u,A,w){for(var I=i+w;i<I;)u[A++]=p[i++]};N0.out={};N0.out.println=function(p){console.log(p)};N0.out.printf=function(){console.log.apply(console,arguments)};var j0={};j0.SQRT2=1.4142135623730951;j0.FAST_LOG10=function(p){return Math.log10(p)};j0.FAST_LOG10_X=function(p,i){return Math.log10(p)*i};function Jt(p){this.ordinal=p}Jt.short_block_allowed=new Jt(0);Jt.short_block_coupled=new Jt(1);Jt.short_block_dispensed=new Jt(2);Jt.short_block_forced=new Jt(3);var yi={};yi.MAX_VALUE=34028235e31;function kt(p){this.ordinal=p}kt.vbr_off=new kt(0);kt.vbr_mt=new kt(1);kt.vbr_rh=new kt(2);kt.vbr_abr=new kt(3);kt.vbr_mtrh=new kt(4);kt.vbr_default=kt.vbr_mtrh;var Gi=function(p){},He={System:N0,VbrMode:kt,Float:yi,ShortBlock:Jt,Util:j0,Arrays:Si,new_array_n:Ei,new_byte:Xi,new_double:Yi,new_float:fi,new_float_n:pi,new_int:mi,new_int_n:bi,new_short:vi,new_short_n:Ai,assert:Gi},_a,Xa;function $i(){if(Xa)return _a;Xa=1;var p=He,i=p.System;p.VbrMode,p.Float,p.ShortBlock;var u=p.Util,A=p.Arrays;p.new_array_n,p.new_byte,p.new_double;var w=p.new_float;p.new_float_n,p.new_int,p.new_int_n,p.assert;var I=Qe();function B(){var L=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*u.SQRT2*.5/2384e-9,.017876148*u.SQRT2*.5/2384e-9,.003134727*u.SQRT2*.5/2384e-9,.002457142*u.SQRT2*.5/2384e-9,971317e-9*u.SQRT2*.5/2384e-9,218868e-9*u.SQRT2*.5/2384e-9,101566e-9*u.SQRT2*.5/2384e-9,13828e-9*u.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],V=12,T=36,P=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],y=P[I.SHORT_TYPE],G=P[I.SHORT_TYPE],Y=P[I.SHORT_TYPE],K=P[I.SHORT_TYPE],D=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function U(m,E,e){for(var v=10,f=E+238-14-286,x=-15;x<0;x++){var c,n,s;c=L[v+-10],n=m[f+-224]*c,s=m[E+224]*c,c=L[v+-9],n+=m[f+-160]*c,s+=m[E+160]*c,c=L[v+-8],n+=m[f+-96]*c,s+=m[E+96]*c,c=L[v+-7],n+=m[f+-32]*c,s+=m[E+32]*c,c=L[v+-6],n+=m[f+32]*c,s+=m[E+-32]*c,c=L[v+-5],n+=m[f+96]*c,s+=m[E+-96]*c,c=L[v+-4],n+=m[f+160]*c,s+=m[E+-160]*c,c=L[v+-3],n+=m[f+224]*c,s+=m[E+-224]*c,c=L[v+-2],n+=m[E+-256]*c,s-=m[f+256]*c,c=L[v+-1],n+=m[E+-192]*c,s-=m[f+192]*c,c=L[v+0],n+=m[E+-128]*c,s-=m[f+128]*c,c=L[v+1],n+=m[E+-64]*c,s-=m[f+64]*c,c=L[v+2],n+=m[E+0]*c,s-=m[f+0]*c,c=L[v+3],n+=m[E+64]*c,s-=m[f+-64]*c,c=L[v+4],n+=m[E+128]*c,s-=m[f+-128]*c,c=L[v+5],n+=m[E+192]*c,s-=m[f+-192]*c,n*=L[v+6],c=s-n,e[30+x*2]=s+n,e[31+x*2]=L[v+7]*c,v+=18,E--,f++}{var n,s,h,r;s=m[E+-16]*L[v+-10],n=m[E+-32]*L[v+-2],s+=(m[E+-48]-m[E+16])*L[v+-9],n+=m[E+-96]*L[v+-1],s+=(m[E+-80]+m[E+48])*L[v+-8],n+=m[E+-160]*L[v+0],s+=(m[E+-112]-m[E+80])*L[v+-7],n+=m[E+-224]*L[v+1],s+=(m[E+-144]+m[E+112])*L[v+-6],n-=m[E+32]*L[v+2],s+=(m[E+-176]-m[E+144])*L[v+-5],n-=m[E+96]*L[v+3],s+=(m[E+-208]+m[E+176])*L[v+-4],n-=m[E+160]*L[v+4],s+=(m[E+-240]-m[E+208])*L[v+-3],n-=m[E+224],h=n-s,r=n+s,s=e[14],n=e[15]-s,e[31]=r+s,e[30]=h+n,e[15]=h-n,e[14]=r-s}{var t;t=e[28]-e[0],e[0]+=e[28],e[28]=t*L[v+-2*18+7],t=e[29]-e[1],e[1]+=e[29],e[29]=t*L[v+-2*18+7],t=e[26]-e[2],e[2]+=e[26],e[26]=t*L[v+-4*18+7],t=e[27]-e[3],e[3]+=e[27],e[27]=t*L[v+-4*18+7],t=e[24]-e[4],e[4]+=e[24],e[24]=t*L[v+-6*18+7],t=e[25]-e[5],e[5]+=e[25],e[25]=t*L[v+-6*18+7],t=e[22]-e[6],e[6]+=e[22],e[22]=t*u.SQRT2,t=e[23]-e[7],e[7]+=e[23],e[23]=t*u.SQRT2-e[7],e[7]-=e[6],e[22]-=e[7],e[23]-=e[22],t=e[6],e[6]=e[31]-t,e[31]=e[31]+t,t=e[7],e[7]=e[30]-t,e[30]=e[30]+t,t=e[22],e[22]=e[15]-t,e[15]=e[15]+t,t=e[23],e[23]=e[14]-t,e[14]=e[14]+t,t=e[20]-e[8],e[8]+=e[20],e[20]=t*L[v+-10*18+7],t=e[21]-e[9],e[9]+=e[21],e[21]=t*L[v+-10*18+7],t=e[18]-e[10],e[10]+=e[18],e[18]=t*L[v+-12*18+7],t=e[19]-e[11],e[11]+=e[19],e[19]=t*L[v+-12*18+7],t=e[16]-e[12],e[12]+=e[16],e[16]=t*L[v+-14*18+7],t=e[17]-e[13],e[13]+=e[17],e[17]=t*L[v+-14*18+7],t=-e[20]+e[24],e[20]+=e[24],e[24]=t*L[v+-12*18+7],t=-e[21]+e[25],e[21]+=e[25],e[25]=t*L[v+-12*18+7],t=e[4]-e[8],e[4]+=e[8],e[8]=t*L[v+-12*18+7],t=e[5]-e[9],e[5]+=e[9],e[9]=t*L[v+-12*18+7],t=e[0]-e[12],e[0]+=e[12],e[12]=t*L[v+-4*18+7],t=e[1]-e[13],e[1]+=e[13],e[13]=t*L[v+-4*18+7],t=e[16]-e[28],e[16]+=e[28],e[28]=t*L[v+-4*18+7],t=-e[17]+e[29],e[17]+=e[29],e[29]=t*L[v+-4*18+7],t=u.SQRT2*(e[2]-e[10]),e[2]+=e[10],e[10]=t,t=u.SQRT2*(e[3]-e[11]),e[3]+=e[11],e[11]=t,t=u.SQRT2*(-e[18]+e[26]),e[18]+=e[26],e[26]=t-e[18],t=u.SQRT2*(-e[19]+e[27]),e[19]+=e[27],e[27]=t-e[19],t=e[2],e[19]-=e[3],e[3]-=t,e[2]=e[31]-t,e[31]+=t,t=e[3],e[11]-=e[19],e[18]-=t,e[3]=e[30]-t,e[30]+=t,t=e[18],e[27]-=e[11],e[19]-=t,e[18]=e[15]-t,e[15]+=t,t=e[19],e[10]-=t,e[19]=e[14]-t,e[14]+=t,t=e[10],e[11]-=t,e[10]=e[23]-t,e[23]+=t,t=e[11],e[26]-=t,e[11]=e[22]-t,e[22]+=t,t=e[26],e[27]-=t,e[26]=e[7]-t,e[7]+=t,t=e[27],e[27]=e[6]-t,e[6]+=t,t=u.SQRT2*(e[0]-e[4]),e[0]+=e[4],e[4]=t,t=u.SQRT2*(e[1]-e[5]),e[1]+=e[5],e[5]=t,t=u.SQRT2*(e[16]-e[20]),e[16]+=e[20],e[20]=t,t=u.SQRT2*(e[17]-e[21]),e[17]+=e[21],e[21]=t,t=-u.SQRT2*(e[8]-e[12]),e[8]+=e[12],e[12]=t-e[8],t=-u.SQRT2*(e[9]-e[13]),e[9]+=e[13],e[13]=t-e[9],t=-u.SQRT2*(e[25]-e[29]),e[25]+=e[29],e[29]=t-e[25],t=-u.SQRT2*(e[24]+e[28]),e[24]-=e[28],e[28]=t-e[24],t=e[24]-e[16],e[24]=t,t=e[20]-t,e[20]=t,t=e[28]-t,e[28]=t,t=e[25]-e[17],e[25]=t,t=e[21]-t,e[21]=t,t=e[29]-t,e[29]=t,t=e[17]-e[1],e[17]=t,t=e[9]-t,e[9]=t,t=e[25]-t,e[25]=t,t=e[5]-t,e[5]=t,t=e[21]-t,e[21]=t,t=e[13]-t,e[13]=t,t=e[29]-t,e[29]=t,t=e[1]-e[0],e[1]=t,t=e[16]-t,e[16]=t,t=e[17]-t,e[17]=t,t=e[8]-t,e[8]=t,t=e[9]-t,e[9]=t,t=e[24]-t,e[24]=t,t=e[25]-t,e[25]=t,t=e[4]-t,e[4]=t,t=e[5]-t,e[5]=t,t=e[20]-t,e[20]=t,t=e[21]-t,e[21]=t,t=e[12]-t,e[12]=t,t=e[13]-t,e[13]=t,t=e[28]-t,e[28]=t,t=e[29]-t,e[29]=t,t=e[0],e[0]+=e[31],e[31]-=t,t=e[1],e[1]+=e[30],e[30]-=t,t=e[16],e[16]+=e[15],e[15]-=t,t=e[17],e[17]+=e[14],e[14]-=t,t=e[8],e[8]+=e[23],e[23]-=t,t=e[9],e[9]+=e[22],e[22]-=t,t=e[24],e[24]+=e[7],e[7]-=t,t=e[25],e[25]+=e[6],e[6]-=t,t=e[4],e[4]+=e[27],e[27]-=t,t=e[5],e[5]+=e[26],e[26]-=t,t=e[20],e[20]+=e[11],e[11]-=t,t=e[21],e[21]+=e[10],e[10]-=t,t=e[12],e[12]+=e[19],e[19]-=t,t=e[13],e[13]+=e[18],e[18]-=t,t=e[28],e[28]+=e[3],e[3]-=t,t=e[29],e[29]+=e[2],e[2]-=t}}function k(m,E){for(var e=0;e<3;e++){var v,f,x,c,n,s;c=m[E+2*3]*P[I.SHORT_TYPE][0]-m[E+5*3],v=m[E+0*3]*P[I.SHORT_TYPE][2]-m[E+3*3],f=c+v,x=c-v,c=m[E+5*3]*P[I.SHORT_TYPE][0]+m[E+2*3],v=m[E+3*3]*P[I.SHORT_TYPE][2]+m[E+0*3],n=c+v,s=-c+v,v=(m[E+1*3]*P[I.SHORT_TYPE][1]-m[E+4*3])*2069978111953089e-26,c=(m[E+4*3]*P[I.SHORT_TYPE][1]+m[E+1*3])*2069978111953089e-26,m[E+3*0]=f*190752519173728e-25+v,m[E+3*5]=-n*190752519173728e-25+c,x=x*.8660254037844387*1907525191737281e-26,n=n*.5*1907525191737281e-26+c,m[E+3*1]=x-n,m[E+3*2]=x+n,f=f*.5*1907525191737281e-26-v,s=s*.8660254037844387*1907525191737281e-26,m[E+3*3]=f+s,m[E+3*4]=f-s,E++}}function _(m,E,e){var v,f;{var x,c,n,s,h,r,t,d;x=e[17]-e[9],n=e[15]-e[11],s=e[14]-e[12],h=e[0]+e[8],r=e[1]+e[7],t=e[2]+e[6],d=e[3]+e[5],m[E+17]=h+t-d-(r-e[4]),f=(h+t-d)*G[12+7]+(r-e[4]),v=(x-n-s)*G[12+6],m[E+5]=v+f,m[E+6]=v-f,c=(e[16]-e[10])*G[12+6],r=r*G[12+7]+e[4],v=x*G[12+0]+c+n*G[12+1]+s*G[12+2],f=-h*G[12+4]+r-t*G[12+5]+d*G[12+3],m[E+1]=v+f,m[E+2]=v-f,v=x*G[12+1]-c-n*G[12+2]+s*G[12+0],f=-h*G[12+5]+r-t*G[12+3]+d*G[12+4],m[E+9]=v+f,m[E+10]=v-f,v=x*G[12+2]-c+n*G[12+0]-s*G[12+1],f=h*G[12+3]-r+t*G[12+4]-d*G[12+5],m[E+13]=v+f,m[E+14]=v-f}{var o,F,R,O,a,l,g,H;o=e[8]-e[0],R=e[6]-e[2],O=e[5]-e[3],a=e[17]+e[9],l=e[16]+e[10],g=e[15]+e[11],H=e[14]+e[12],m[E+0]=a+g+H+(l+e[13]),v=(a+g+H)*G[12+7]-(l+e[13]),f=(o-R+O)*G[12+6],m[E+11]=v+f,m[E+12]=v-f,F=(e[7]-e[1])*G[12+6],l=e[13]-l*G[12+7],v=a*G[12+3]-l+g*G[12+4]+H*G[12+5],f=o*G[12+2]+F+R*G[12+0]+O*G[12+1],m[E+3]=v+f,m[E+4]=v-f,v=-a*G[12+5]+l-g*G[12+3]-H*G[12+4],f=o*G[12+1]+F-R*G[12+2]-O*G[12+0],m[E+7]=v+f,m[E+8]=v-f,v=-a*G[12+4]+l-g*G[12+5]-H*G[12+3],f=o*G[12+0]-F+R*G[12+1]-O*G[12+2],m[E+15]=v+f,m[E+16]=v-f}}this.mdct_sub48=function(m,E,e){for(var v=E,f=286,x=0;x<m.channels_out;x++){for(var c=0;c<m.mode_gr;c++){for(var n,s=m.l3_side.tt[c][x],h=s.xr,r=0,t=m.sb_sample[x][1-c],d=0,o=0;o<18/2;o++)for(U(v,f,t[d]),U(v,f+32,t[d+1]),d+=2,f+=64,n=1;n<32;n+=2)t[d-1][n]*=-1;for(n=0;n<32;n++,r+=18){var F=s.block_type,R=m.sb_sample[x][c],O=m.sb_sample[x][1-c];if(s.mixed_block_flag!=0&&n<2&&(F=0),m.amp_filter[n]<1e-12)A.fill(h,r+0,r+18,0);else{if(m.amp_filter[n]<1)for(var o=0;o<18;o++)O[o][D[n]]*=m.amp_filter[n];if(F==I.SHORT_TYPE){for(var o=-V/4;o<0;o++){var a=P[I.SHORT_TYPE][o+3];h[r+o*3+9]=R[9+o][D[n]]*a-R[8-o][D[n]],h[r+o*3+18]=R[14-o][D[n]]*a+R[15+o][D[n]],h[r+o*3+10]=R[15+o][D[n]]*a-R[14-o][D[n]],h[r+o*3+19]=O[2-o][D[n]]*a+O[3+o][D[n]],h[r+o*3+11]=O[3+o][D[n]]*a-O[2-o][D[n]],h[r+o*3+20]=O[8-o][D[n]]*a+O[9+o][D[n]]}k(h,r)}else{for(var l=w(18),o=-T/4;o<0;o++){var g,H;g=P[F][o+27]*O[o+9][D[n]]+P[F][o+36]*O[8-o][D[n]],H=P[F][o+9]*R[o+9][D[n]]-P[F][o+18]*R[8-o][D[n]],l[o+9]=g-H*y[3+o+9],l[o+18]=g*y[3+o+9]+H}_(h,r,l)}}if(F!=I.SHORT_TYPE&&n!=0)for(var o=7;o>=0;--o){var se,oe;se=h[r+o]*Y[20+o]+h[r+-1-o]*K[28+o],oe=h[r+o]*K[28+o]-h[r+-1-o]*Y[20+o],h[r+-1-o]=se,h[r+o]=oe}}}if(v=e,f=286,m.mode_gr==1)for(var re=0;re<18;re++)i.arraycopy(m.sb_sample[x][1][re],0,m.sb_sample[x][0][re],0,32)}}}return _a=B,_a}var ha,Ya;function xi(){if(Ya)return ha;Ya=1;var p=Qe(),i=He,u=i.System;i.VbrMode,i.Float,i.ShortBlock,i.Util,i.Arrays,i.new_array_n,i.new_byte,i.new_double;var A=i.new_float,w=i.new_float_n;i.new_int,i.new_int_n,i.assert;function I(){this.l=A(p.SBMAX_l),this.s=w([p.SBMAX_s,3]);var B=this;this.assign=function(L){u.arraycopy(L.l,0,B.l,0,p.SBMAX_l);for(var V=0;V<p.SBMAX_s;V++)for(var T=0;T<3;T++)B.s[V][T]=L.s[V][T]}}return ha=I,ha}var ca,Ga;function Ui(){if(Ga)return ca;Ga=1;var p=xi();function i(){this.thm=new p,this.en=new p}return ca=i,ca}var ua,$a;function Qe(){if($a)return ua;$a=1;var p=He,i=p.System,u=p.VbrMode;p.Float,p.ShortBlock,p.Util,p.Arrays;var A=p.new_array_n;p.new_byte,p.new_double;var w=p.new_float,I=p.new_float_n,B=p.new_int;p.new_int_n;var L=p.assert;V.ENCDELAY=576,V.POSTDELAY=1152,V.MDCTDELAY=48,V.FFTOFFSET=224+V.MDCTDELAY,V.DECDELAY=528,V.SBLIMIT=32,V.CBANDS=64,V.SBPSY_l=21,V.SBPSY_s=12,V.SBMAX_l=22,V.SBMAX_s=13,V.PSFB21=6,V.PSFB12=6,V.BLKSIZE=1024,V.HBLKSIZE=V.BLKSIZE/2+1,V.BLKSIZE_s=256,V.HBLKSIZE_s=V.BLKSIZE_s/2+1,V.NORM_TYPE=0,V.START_TYPE=1,V.SHORT_TYPE=2,V.STOP_TYPE=3,V.MPG_MD_LR_LR=0,V.MPG_MD_LR_I=1,V.MPG_MD_MS_LR=2,V.MPG_MD_MS_I=3,V.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function V(){var T=$i(),P=Ui(),y=V.FFTOFFSET,G=V.MPG_MD_MS_LR,Y=null;this.psy=null;var K=null,D=null,U=null;this.setModules=function(e,v,f,x){Y=e,this.psy=v,K=v,D=x,U=f};var k=new T;function _(e){var v,f;if(e.ATH.useAdjust==0){e.ATH.adjust=1;return}if(f=e.loudness_sq[0][0],v=e.loudness_sq[1][0],e.channels_out==2?(f+=e.loudness_sq[0][1],v+=e.loudness_sq[1][1]):(f+=f,v+=v),e.mode_gr==2&&(f=Math.max(f,v)),f*=.5,f*=e.ATH.aaSensitivityP,f>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var x=31.98*f+625e-6;e.ATH.adjust>=x?(e.ATH.adjust*=x*.075+.925,e.ATH.adjust<x&&(e.ATH.adjust=x)):e.ATH.adjustLimit>=x?e.ATH.adjust=x:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=x}}function m(e){var v,f;for(L(0<=e.bitrate_index&&e.bitrate_index<16),L(0<=e.mode_ext&&e.mode_ext<4),e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,e.channels_out==2&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),v=0;v<e.mode_gr;++v)for(f=0;f<e.channels_out;++f){var x=e.l3_side.tt[v][f].block_type|0;e.l3_side.tt[v][f].mixed_block_flag!=0&&(x=4),e.bitrate_blockType_Hist[e.bitrate_index][x]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][x]++,e.bitrate_blockType_Hist[15][5]++}}function E(e,v){var f=e.internal_flags,x,c;if(f.lame_encode_frame_init==0){var n,s,h=w(2014),r=w(286+1152+576);for(f.lame_encode_frame_init=1,n=0,s=0;n<286+576*(1+f.mode_gr);++n)n<576*f.mode_gr?(h[n]=0,f.channels_out==2&&(r[n]=0)):(h[n]=v[0][s],f.channels_out==2&&(r[n]=v[1][s]),++s);for(c=0;c<f.mode_gr;c++)for(x=0;x<f.channels_out;x++)f.l3_side.tt[c][x].block_type=V.SHORT_TYPE;k.mdct_sub48(f,h,r),L(576>=V.FFTOFFSET),L(f.mf_size>=V.BLKSIZE+e.framesize-V.FFTOFFSET),L(f.mf_size>=512+e.framesize-32)}}this.lame_encode_mp3_frame=function(e,v,f,x,c,n){var s,h=A([2,2]);h[0][0]=new P,h[0][1]=new P,h[1][0]=new P,h[1][1]=new P;var r=A([2,2]);r[0][0]=new P,r[0][1]=new P,r[1][0]=new P,r[1][1]=new P;var t,d=[null,null],o=e.internal_flags,F=I([2,4]),R=[.5,.5],O=[[0,0],[0,0]],a=[[0,0],[0,0]],l,g,H;if(d[0]=v,d[1]=f,o.lame_encode_frame_init==0&&E(e,d),o.padding=0,(o.slot_lag-=o.frac_SpF)<0&&(o.slot_lag+=e.out_samplerate,o.padding=1),o.psymodel!=0){var se,oe=[null,null],re=0,le=B(2);for(H=0;H<o.mode_gr;H++){for(g=0;g<o.channels_out;g++)oe[g]=d[g],re=576+H*576-V.FFTOFFSET;if(e.VBR==u.vbr_mtrh||e.VBR==u.vbr_mt?se=K.L3psycho_anal_vbr(e,oe,re,H,h,r,O[H],a[H],F[H],le):se=K.L3psycho_anal_ns(e,oe,re,H,h,r,O[H],a[H],F[H],le),se!=0)return-4;for(e.mode==MPEGMode.JOINT_STEREO&&(R[H]=F[H][2]+F[H][3],R[H]>0&&(R[H]=F[H][3]/R[H])),g=0;g<o.channels_out;g++){var be=o.l3_side.tt[H][g];be.block_type=le[g],be.mixed_block_flag=0}}}else for(H=0;H<o.mode_gr;H++)for(g=0;g<o.channels_out;g++)o.l3_side.tt[H][g].block_type=V.NORM_TYPE,o.l3_side.tt[H][g].mixed_block_flag=0,a[H][g]=O[H][g]=700;if(_(o),k.mdct_sub48(o,d[0],d[1]),o.mode_ext=V.MPG_MD_LR_LR,e.force_ms)o.mode_ext=V.MPG_MD_MS_LR;else if(e.mode==MPEGMode.JOINT_STEREO){var ce=0,ne=0;for(H=0;H<o.mode_gr;H++)for(g=0;g<o.channels_out;g++)ce+=a[H][g],ne+=O[H][g];if(ce<=1*ne){var Te=o.l3_side.tt[0],Fe=o.l3_side.tt[o.mode_gr-1];Te[0].block_type==Te[1].block_type&&Fe[0].block_type==Fe[1].block_type&&(o.mode_ext=V.MPG_MD_MS_LR)}}if(o.mode_ext==G?(t=r,l=a):(t=h,l=O),e.analysis&&o.pinfo!=null)for(H=0;H<o.mode_gr;H++)for(g=0;g<o.channels_out;g++)o.pinfo.ms_ratio[H]=o.ms_ratio[H],o.pinfo.ms_ener_ratio[H]=R[H],o.pinfo.blocktype[H][g]=o.l3_side.tt[H][g].block_type,o.pinfo.pe[H][g]=l[H][g],i.arraycopy(o.l3_side.tt[H][g].xr,0,o.pinfo.xr[H][g],0,576),o.mode_ext==G&&(o.pinfo.ers[H][g]=o.pinfo.ers[H][g+2],i.arraycopy(o.pinfo.energy[H][g+2],0,o.pinfo.energy[H][g],0,o.pinfo.energy[H][g].length));if(e.VBR==u.vbr_off||e.VBR==u.vbr_abr){var Ae,we;for(Ae=0;Ae<18;Ae++)o.nsPsy.pefirbuf[Ae]=o.nsPsy.pefirbuf[Ae+1];for(we=0,H=0;H<o.mode_gr;H++)for(g=0;g<o.channels_out;g++)we+=l[H][g];for(o.nsPsy.pefirbuf[18]=we,we=o.nsPsy.pefirbuf[9],Ae=0;Ae<9;Ae++)we+=(o.nsPsy.pefirbuf[Ae]+o.nsPsy.pefirbuf[18-Ae])*V.fircoef[Ae];for(we=670*5*o.mode_gr*o.channels_out/we,H=0;H<o.mode_gr;H++)for(g=0;g<o.channels_out;g++)l[H][g]*=we}if(o.iteration_loop.iteration_loop(e,l,R,t),Y.format_bitstream(e),s=Y.copy_buffer(o,x,c,n,1),e.bWriteVbrTag&&D.addVbrFrame(e),e.analysis&&o.pinfo!=null){for(g=0;g<o.channels_out;g++){var Me;for(Me=0;Me<y;Me++)o.pinfo.pcmdata[g][Me]=o.pinfo.pcmdata[g][Me+e.framesize];for(Me=y;Me<1600;Me++)o.pinfo.pcmdata[g][Me]=d[g][Me-y]}U.set_frame_pinfo(e,t)}return m(o),s}}return ua=V,ua}var lt=He;lt.System;lt.VbrMode;lt.Float;lt.ShortBlock;var Ua=lt.Util;lt.Arrays;lt.new_array_n;lt.new_byte;lt.new_double;var Ka=lt.new_float;lt.new_float_n;lt.new_int;lt.new_int_n;lt.assert;var Ge=Qe();function Ki(){var p=Ka(Ge.BLKSIZE),i=Ka(Ge.BLKSIZE_s/2),u=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function A(I,B,L){var V=0,T,P,y;L<<=1;var G=B+L;T=4;do{var Y,K,D,U,k,_,m;m=T>>1,U=T,k=T<<1,_=k+U,T=k<<1,P=B,y=P+m;do{var E,e,v,f;e=I[P+0]-I[P+U],E=I[P+0]+I[P+U],f=I[P+k]-I[P+_],v=I[P+k]+I[P+_],I[P+k]=E-v,I[P+0]=E+v,I[P+_]=e-f,I[P+U]=e+f,e=I[y+0]-I[y+U],E=I[y+0]+I[y+U],f=Ua.SQRT2*I[y+_],v=Ua.SQRT2*I[y+k],I[y+k]=E-v,I[y+0]=E+v,I[y+_]=e-f,I[y+U]=e+f,y+=T,P+=T}while(P<G);for(K=u[V+0],Y=u[V+1],D=1;D<m;D++){var x,c;x=1-2*Y*Y,c=2*Y*K,P=B+D,y=B+U-D;do{var n,s,h,E,e,r,v,t,f,d;s=c*I[P+U]-x*I[y+U],n=x*I[P+U]+c*I[y+U],e=I[P+0]-n,E=I[P+0]+n,r=I[y+0]-s,h=I[y+0]+s,s=c*I[P+_]-x*I[y+_],n=x*I[P+_]+c*I[y+_],f=I[P+k]-n,v=I[P+k]+n,d=I[y+k]-s,t=I[y+k]+s,s=Y*v-K*d,n=K*v+Y*d,I[P+k]=E-n,I[P+0]=E+n,I[y+_]=r-s,I[y+U]=r+s,s=K*t-Y*f,n=Y*t+K*f,I[y+k]=h-n,I[y+0]=h+n,I[P+_]=e-s,I[P+U]=e+s,y+=T,P+=T}while(P<G);x=K,K=x*u[V+0]-Y*u[V+1],Y=x*u[V+1]+Y*u[V+0]}V+=2}while(T<L)}var w=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(I,B,L,V,T){for(var P=0;P<3;P++){var y=Ge.BLKSIZE_s/2,G=65535&576/3*(P+1),Y=Ge.BLKSIZE_s/8-1;do{var K,D,U,k,_,m=w[Y<<2]&255;K=i[m]*V[L][T+m+G],_=i[127-m]*V[L][T+m+G+128],D=K-_,K=K+_,U=i[m+64]*V[L][T+m+G+64],_=i[63-m]*V[L][T+m+G+192],k=U-_,U=U+_,y-=4,B[P][y+0]=K+U,B[P][y+2]=K-U,B[P][y+1]=D+k,B[P][y+3]=D-k,K=i[m+1]*V[L][T+m+G+1],_=i[126-m]*V[L][T+m+G+129],D=K-_,K=K+_,U=i[m+65]*V[L][T+m+G+65],_=i[62-m]*V[L][T+m+G+193],k=U-_,U=U+_,B[P][y+Ge.BLKSIZE_s/2+0]=K+U,B[P][y+Ge.BLKSIZE_s/2+2]=K-U,B[P][y+Ge.BLKSIZE_s/2+1]=D+k,B[P][y+Ge.BLKSIZE_s/2+3]=D-k}while(--Y>=0);A(B[P],y,Ge.BLKSIZE_s/2)}},this.fft_long=function(I,B,L,V,T){var P=Ge.BLKSIZE/8-1,y=Ge.BLKSIZE/2;do{var G,Y,K,D,U,k=w[P]&255;G=p[k]*V[L][T+k],U=p[k+512]*V[L][T+k+512],Y=G-U,G=G+U,K=p[k+256]*V[L][T+k+256],U=p[k+768]*V[L][T+k+768],D=K-U,K=K+U,y-=4,B[y+0]=G+K,B[y+2]=G-K,B[y+1]=Y+D,B[y+3]=Y-D,G=p[k+1]*V[L][T+k+1],U=p[k+513]*V[L][T+k+513],Y=G-U,G=G+U,K=p[k+257]*V[L][T+k+257],U=p[k+769]*V[L][T+k+769],D=K-U,K=K+U,B[y+Ge.BLKSIZE/2+0]=G+K,B[y+Ge.BLKSIZE/2+2]=G-K,B[y+Ge.BLKSIZE/2+1]=Y+D,B[y+Ge.BLKSIZE/2+3]=Y-D}while(--P>=0);A(B,y,Ge.BLKSIZE/2)},this.init_fft=function(I){for(var B=0;B<Ge.BLKSIZE;B++)p[B]=.42-.5*Math.cos(2*Math.PI*(B+.5)/Ge.BLKSIZE)+.08*Math.cos(4*Math.PI*(B+.5)/Ge.BLKSIZE);for(var B=0;B<Ge.BLKSIZE_s/2;B++)i[B]=.5*(1-Math.cos(2*Math.PI*(B+.5)/Ge.BLKSIZE_s))}}var Zi=Ki,ot=He;ot.System;var E0=ot.VbrMode,Za=ot.Float,S0=ot.ShortBlock,st=ot.Util,ji=ot.Arrays;ot.new_array_n;ot.new_byte;ot.new_double;var $e=ot.new_float,Ot=ot.new_float_n,r0=ot.new_int;ot.new_int_n;var ue=ot.assert,Wi=Zi,Q=Qe();function Qi(){var p=new Wi,i=2.302585092994046,u=2,A=16,w=2,I=16,B=.34,L=1/(14752*14752)/(Q.BLKSIZE/2),V=.01,T=.8,P=.6,y=.3,G=3.5,Y=21,K=.2302585093;function D(b){return b}function U(b,S){for(var C=0,N=0;N<Q.BLKSIZE/2;++N)C+=b[N]*S.ATH.eql_w[N];return C*=L,C}function k(b,S,C,N,$,M,X,Z,q,z,j){var J=b.internal_flags;if(q<2)p.fft_long(J,N[$],q,z,j),p.fft_short(J,M[X],q,z,j);else if(q==2){for(var _e=Q.BLKSIZE-1;_e>=0;--_e){var fe=N[$+0][_e],te=N[$+1][_e];N[$+0][_e]=(fe+te)*st.SQRT2*.5,N[$+1][_e]=(fe-te)*st.SQRT2*.5}for(var me=2;me>=0;--me)for(var _e=Q.BLKSIZE_s-1;_e>=0;--_e){var fe=M[X+0][me][_e],te=M[X+1][me][_e];M[X+0][me][_e]=(fe+te)*st.SQRT2*.5,M[X+1][me][_e]=(fe-te)*st.SQRT2*.5}}S[0]=N[$+0][0],S[0]*=S[0];for(var _e=Q.BLKSIZE/2-1;_e>=0;--_e){var W=N[$+0][Q.BLKSIZE/2-_e],de=N[$+0][Q.BLKSIZE/2+_e];S[Q.BLKSIZE/2-_e]=(W*W+de*de)*.5}for(var me=2;me>=0;--me){C[me][0]=M[X+0][me][0],C[me][0]*=C[me][0];for(var _e=Q.BLKSIZE_s/2-1;_e>=0;--_e){var W=M[X+0][me][Q.BLKSIZE_s/2-_e],de=M[X+0][me][Q.BLKSIZE_s/2+_e];C[me][Q.BLKSIZE_s/2-_e]=(W*W+de*de)*.5}}{for(var ye=0,_e=11;_e<Q.HBLKSIZE;_e++)ye+=S[_e];J.tot_ener[q]=ye}if(b.analysis){for(var _e=0;_e<Q.HBLKSIZE;_e++)J.pinfo.energy[Z][q][_e]=J.pinfo.energy_save[q][_e],J.pinfo.energy_save[q][_e]=S[_e];J.pinfo.pe[Z][q]=J.pe[q]}b.athaa_loudapprox==2&&q<2&&(J.loudness_sq[Z][q]=J.loudness_sq_save[q],J.loudness_sq_save[q]=U(S,J))}var _=8,m=23,E=15,e,v,f,x=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function c(){e=Math.pow(10,(_+1)/16),v=Math.pow(10,(m+1)/16),f=Math.pow(10,E/10)}var n=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],s=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],h=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function r(b,S,C,N,$,M){var X;if(S>b)if(S<b*v)X=S/b;else return b+S;else{if(b>=S*v)return b+S;X=b/S}if(ue(b>=0),ue(S>=0),b+=S,N+3<=3+3){if(X>=e)return b;var Z=0|st.FAST_LOG10_X(X,16);return b*s[Z]}var Z=0|st.FAST_LOG10_X(X,16);if(M!=0?S=$.ATH.cb_s[C]*$.ATH.adjust:S=$.ATH.cb_l[C]*$.ATH.adjust,ue(S>=0),b<f*S){if(b>S){var q,z;return q=1,Z<=13&&(q=h[Z]),z=st.FAST_LOG10_X(b/S,10/15),b*((n[Z]-q)*z+q)}return Z>13?b:b*h[Z]}return b*n[Z]}var t=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function d(b,S,C){var N;if(b<0&&(b=0),S<0&&(S=0),b<=0)return S;if(S<=0)return b;if(S>b?N=S/b:N=b/S,-2<=C&&C<=2){if(N>=e)return b+S;var $=0|st.FAST_LOG10_X(N,16);return(b+S)*t[$]}return N<v?b+S:(b<S&&(b=S),b)}function o(b,S){var C=b.internal_flags;if(C.channels_out>1){for(var N=0;N<Q.SBMAX_l;N++){var $=C.thm[0].l[N],M=C.thm[1].l[N];C.thm[0].l[N]+=M*S,C.thm[1].l[N]+=$*S}for(var N=0;N<Q.SBMAX_s;N++)for(var X=0;X<3;X++){var $=C.thm[0].s[N][X],M=C.thm[1].s[N][X];C.thm[0].s[N][X]+=M*S,C.thm[1].s[N][X]+=$*S}}}function F(b){for(var S=0;S<Q.SBMAX_l;S++)if(!(b.thm[0].l[S]>1.58*b.thm[1].l[S]||b.thm[1].l[S]>1.58*b.thm[0].l[S])){var C=b.mld_l[S]*b.en[3].l[S],N=Math.max(b.thm[2].l[S],Math.min(b.thm[3].l[S],C));C=b.mld_l[S]*b.en[2].l[S];var $=Math.max(b.thm[3].l[S],Math.min(b.thm[2].l[S],C));b.thm[2].l[S]=N,b.thm[3].l[S]=$}for(var S=0;S<Q.SBMAX_s;S++)for(var M=0;M<3;M++)if(!(b.thm[0].s[S][M]>1.58*b.thm[1].s[S][M]||b.thm[1].s[S][M]>1.58*b.thm[0].s[S][M])){var C=b.mld_s[S]*b.en[3].s[S][M],N=Math.max(b.thm[2].s[S][M],Math.min(b.thm[3].s[S][M],C));C=b.mld_s[S]*b.en[2].s[S][M];var $=Math.max(b.thm[3].s[S][M],Math.min(b.thm[2].s[S][M],C));b.thm[2].s[S][M]=N,b.thm[3].s[S][M]=$}}function R(b,S,C){var N=S,$=Math.pow(10,C);S*=2,N*=2;for(var M=0;M<Q.SBMAX_l;M++){var X,Z,q,z;if(z=b.ATH.cb_l[b.bm_l[M]]*$,X=Math.min(Math.max(b.thm[0].l[M],z),Math.max(b.thm[1].l[M],z)),Z=Math.max(b.thm[2].l[M],z),q=Math.max(b.thm[3].l[M],z),X*S<Z+q){var j=X*N/(Z+q);Z*=j,q*=j,ue(Z+q>0)}b.thm[2].l[M]=Math.min(Z,b.thm[2].l[M]),b.thm[3].l[M]=Math.min(q,b.thm[3].l[M])}$*=Q.BLKSIZE_s/Q.BLKSIZE;for(var M=0;M<Q.SBMAX_s;M++)for(var J=0;J<3;J++){var X,Z,q,z;if(z=b.ATH.cb_s[b.bm_s[M]]*$,X=Math.min(Math.max(b.thm[0].s[M][J],z),Math.max(b.thm[1].s[M][J],z)),Z=Math.max(b.thm[2].s[M][J],z),q=Math.max(b.thm[3].s[M][J],z),X*S<Z+q){var j=X*S/(Z+q);Z*=j,q*=j,ue(Z+q>0)}b.thm[2].s[M][J]=Math.min(b.thm[2].s[M][J],Z),b.thm[3].s[M][J]=Math.min(b.thm[3].s[M][J],q)}}function O(b,S,C,N,$){var M,X,Z=0,q=0;for(M=X=0;M<Q.SBMAX_s;++X,++M){for(var z=b.bo_s[M],j=b.npart_s,J=z<j?z:j;X<J;)ue(S[X]>=0),ue(C[X]>=0),Z+=S[X],q+=C[X],X++;if(b.en[N].s[M][$]=Z,b.thm[N].s[M][$]=q,X>=j){++M;break}ue(S[X]>=0),ue(C[X]>=0);{var _e=b.PSY.bo_s_weight[M],fe=1-_e;Z=_e*S[X],q=_e*C[X],b.en[N].s[M][$]+=Z,b.thm[N].s[M][$]+=q,Z=fe*S[X],q=fe*C[X]}}for(;M<Q.SBMAX_s;++M)b.en[N].s[M][$]=0,b.thm[N].s[M][$]=0}function a(b,S,C,N){var $,M,X=0,Z=0;for($=M=0;$<Q.SBMAX_l;++M,++$){for(var q=b.bo_l[$],z=b.npart_l,j=q<z?q:z;M<j;)ue(S[M]>=0),ue(C[M]>=0),X+=S[M],Z+=C[M],M++;if(b.en[N].l[$]=X,b.thm[N].l[$]=Z,M>=z){++$;break}ue(S[M]>=0),ue(C[M]>=0);{var J=b.PSY.bo_l_weight[$],_e=1-J;X=J*S[M],Z=J*C[M],b.en[N].l[$]+=X,b.thm[N].l[$]+=Z,X=_e*S[M],Z=_e*C[M]}}for(;$<Q.SBMAX_l;++$)b.en[N].l[$]=0,b.thm[N].l[$]=0}function l(b,S,C,N,$,M){var X=b.internal_flags,Z,q;for(q=Z=0;q<X.npart_s;++q){for(var z=0,j=X.numlines_s[q],J=0;J<j;++J,++Z){var _e=S[M][Z];z+=_e}C[q]=z}for(ue(q==X.npart_s),ue(Z==129),Z=q=0;q<X.npart_s;q++){var fe=X.s3ind_s[q][0],te=X.s3_ss[Z++]*C[fe];for(++fe;fe<=X.s3ind_s[q][1];)te+=X.s3_ss[Z]*C[fe],++Z,++fe;{var me=w*X.nb_s1[$][q];N[q]=Math.min(te,me)}if(X.blocktype_old[$&1]==Q.SHORT_TYPE){var me=I*X.nb_s2[$][q],W=N[q];N[q]=Math.min(me,W)}X.nb_s2[$][q]=X.nb_s1[$][q],X.nb_s1[$][q]=te,ue(N[q]>=0)}for(;q<=Q.CBANDS;++q)C[q]=0,N[q]=0}function g(b,S,C,N){var $=b.internal_flags;b.short_blocks==S0.short_block_coupled&&!(S[0]!=0&&S[1]!=0)&&(S[0]=S[1]=0);for(var M=0;M<$.channels_out;M++)N[M]=Q.NORM_TYPE,b.short_blocks==S0.short_block_dispensed&&(S[M]=1),b.short_blocks==S0.short_block_forced&&(S[M]=0),S[M]!=0?(ue($.blocktype_old[M]!=Q.START_TYPE),$.blocktype_old[M]==Q.SHORT_TYPE&&(N[M]=Q.STOP_TYPE)):(N[M]=Q.SHORT_TYPE,$.blocktype_old[M]==Q.NORM_TYPE&&($.blocktype_old[M]=Q.START_TYPE),$.blocktype_old[M]==Q.STOP_TYPE&&($.blocktype_old[M]=Q.SHORT_TYPE)),C[M]=$.blocktype_old[M],$.blocktype_old[M]=N[M]}function H(b,S,C){return C>=1?b:C<=0?S:S>0?Math.pow(b/S,C)*S:0}var se=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function oe(b,S){for(var C=309.07,N=0;N<Q.SBMAX_s-1;N++)for(var $=0;$<3;$++){var M=b.thm.s[N][$];if(ue(N<se.length),M>0){var X=M*S,Z=b.en.s[N][$];Z>X&&(Z>X*1e10?C+=se[N]*(10*i):(ue(X>0),C+=se[N]*st.FAST_LOG10(Z/X)))}}return C}var re=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function le(b,S){for(var C=281.0575,N=0;N<Q.SBMAX_l-1;N++){var $=b.thm.l[N];if(ue(N<re.length),$>0){var M=$*S,X=b.en.l[N];X>M&&(X>M*1e10?C+=re[N]*(10*i):(ue(M>0),C+=re[N]*st.FAST_LOG10(X/M)))}}return C}function be(b,S,C,N,$){var M,X;for(M=X=0;M<b.npart_l;++M){var Z=0,q=0,z;for(z=0;z<b.numlines_l[M];++z,++X){var j=S[X];ue(j>=0),Z+=j,q<j&&(q=j)}C[M]=Z,N[M]=q,$[M]=Z*b.rnumlines_l[M],ue(b.rnumlines_l[M]>=0),ue(Z>=0),ue(C[M]>=0),ue(N[M]>=0),ue($[M]>=0)}}function ce(b,S,C,N){var $=x.length-1,M=0,X=C[M]+C[M+1];if(ue(X>=0),X>0){var Z=S[M];Z<S[M+1]&&(Z=S[M+1]),ue(b.numlines_l[M]+b.numlines_l[M+1]-1>0),X=20*(Z*2-X)/(X*(b.numlines_l[M]+b.numlines_l[M+1]-1));var q=0|X;q>$&&(q=$),N[M]=q}else N[M]=0;for(M=1;M<b.npart_l-1;M++)if(X=C[M-1]+C[M]+C[M+1],ue(X>=0),X>0){var Z=S[M-1];Z<S[M]&&(Z=S[M]),Z<S[M+1]&&(Z=S[M+1]),ue(b.numlines_l[M-1]+b.numlines_l[M]+b.numlines_l[M+1]-1>0),X=20*(Z*3-X)/(X*(b.numlines_l[M-1]+b.numlines_l[M]+b.numlines_l[M+1]-1));var q=0|X;q>$&&(q=$),N[M]=q}else N[M]=0;if(ue(M>0),ue(M==b.npart_l-1),X=C[M-1]+C[M],ue(X>=0),X>0){var Z=S[M-1];Z<S[M]&&(Z=S[M]),ue(b.numlines_l[M-1]+b.numlines_l[M]-1>0),X=20*(Z*2-X)/(X*(b.numlines_l[M-1]+b.numlines_l[M]-1));var q=0|X;q>$&&(q=$),N[M]=q}else N[M]=0;ue(M==b.npart_l-1)}var ne=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(b,S,C,N,$,M,X,Z,q,z){var j=b.internal_flags,J=Ot([2,Q.BLKSIZE]),_e=Ot([2,3,Q.BLKSIZE_s]),fe=$e(Q.CBANDS+1),te=$e(Q.CBANDS+1),me=$e(Q.CBANDS+2),W=r0(2),de=r0(2),ye,ae,ve,ee,pe,Le,he,Ee,xe=Ot([2,576]),Ne,Bt=r0(Q.CBANDS+2),Ye=r0(Q.CBANDS+2);for(ji.fill(Ye,0),ye=j.channels_out,b.mode==MPEGMode.JOINT_STEREO&&(ye=4),b.VBR==E0.vbr_off?Ne=j.ResvMax==0?0:j.ResvSize/j.ResvMax*.5:b.VBR==E0.vbr_rh||b.VBR==E0.vbr_mtrh||b.VBR==E0.vbr_mt?Ne=.6:Ne=1,ae=0;ae<j.channels_out;ae++){var ke=S[ae],at=C+576-350-Y+192;for(ue(ne.length==(Y-1)/2),ee=0;ee<576;ee++){var Rt,It;for(Rt=ke[at+ee+10],It=0,pe=0;pe<(Y-1)/2-1;pe+=2)Rt+=ne[pe]*(ke[at+ee+pe]+ke[at+ee+Y-pe]),It+=ne[pe+1]*(ke[at+ee+pe+1]+ke[at+ee+Y-pe-1]);xe[ae][ee]=Rt+It}$[N][ae].en.assign(j.en[ae]),$[N][ae].thm.assign(j.thm[ae]),ye>2&&(M[N][ae].en.assign(j.en[ae+2]),M[N][ae].thm.assign(j.thm[ae+2]))}for(ae=0;ae<ye;ae++){var Vt,Pt,We=$e(12),$t=[0,0,0,0],A0=$e(12),J0=1,Na,ga=$e(Q.CBANDS),Ha=$e(Q.CBANDS),ge=[0,0,0,0],Fa=$e(Q.HBLKSIZE),Va=Ot([3,Q.HBLKSIZE_s]);for(ue(j.npart_s<=Q.CBANDS),ue(j.npart_l<=Q.CBANDS),ee=0;ee<3;ee++)We[ee]=j.nsPsy.last_en_subshort[ae][ee+6],ue(j.nsPsy.last_en_subshort[ae][ee+4]>0),A0[ee]=We[ee]/j.nsPsy.last_en_subshort[ae][ee+4],$t[0]+=We[ee];if(ae==2)for(ee=0;ee<576;ee++){var ea,ta;ea=xe[0][ee],ta=xe[1][ee],xe[0][ee]=ea+ta,xe[1][ee]=ea-ta}{var Pa=xe[ae&1],T0=0;for(ee=0;ee<9;ee++){for(var ki=T0+64,Ze=1;T0<ki;T0++)Ze<Math.abs(Pa[T0])&&(Ze=Math.abs(Pa[T0]));j.nsPsy.last_en_subshort[ae][ee]=We[ee+3]=Ze,$t[1+ee/3]+=Ze,Ze>We[ee+3-2]?(ue(We[ee+3-2]>0),Ze=Ze/We[ee+3-2]):We[ee+3-2]>Ze*10?(ue(Ze>0),Ze=We[ee+3-2]/(Ze*10)):Ze=0,A0[ee+3]=Ze}}if(b.analysis){var aa=A0[0];for(ee=1;ee<12;ee++)aa<A0[ee]&&(aa=A0[ee]);j.pinfo.ers[N][ae]=j.pinfo.ers_save[ae],j.pinfo.ers_save[ae]=aa}for(Na=ae==3?j.nsPsy.attackthre_s:j.nsPsy.attackthre,ee=0;ee<12;ee++)ge[ee/3]==0&&A0[ee]>Na&&(ge[ee/3]=ee%3+1);for(ee=1;ee<4;ee++){var ia;$t[ee-1]>$t[ee]?(ue($t[ee]>0),ia=$t[ee-1]/$t[ee]):(ue($t[ee-1]>0),ia=$t[ee]/$t[ee-1]),ia<1.7&&(ge[ee]=0,ee==1&&(ge[0]=0))}for(ge[0]!=0&&j.nsPsy.lastAttacks[ae]!=0&&(ge[0]=0),(j.nsPsy.lastAttacks[ae]==3||ge[0]+ge[1]+ge[2]+ge[3]!=0)&&(J0=0,ge[1]!=0&&ge[0]!=0&&(ge[1]=0),ge[2]!=0&&ge[1]!=0&&(ge[2]=0),ge[3]!=0&&ge[2]!=0&&(ge[3]=0)),ae<2?de[ae]=J0:J0==0&&(de[0]=de[1]=0),q[ae]=j.tot_ener[ae],Pt=_e,Vt=J,k(b,Fa,Va,Vt,ae&1,Pt,ae&1,N,ae,S,C),be(j,Fa,fe,ga,Ha),ce(j,ga,Ha,Bt),Ee=0;Ee<3;Ee++){var sa,it;for(l(b,Va,te,me,ae,Ee),O(j,te,me,ae,Ee),he=0;he<Q.SBMAX_s;he++){if(it=j.thm[ae].s[he][Ee],it*=T,ge[Ee]>=2||ge[Ee+1]==1){var M0=Ee!=0?Ee-1:2,Ze=H(j.thm[ae].s[he][M0],it,P*Ne);it=Math.min(it,Ze)}if(ge[Ee]==1){var M0=Ee!=0?Ee-1:2,Ze=H(j.thm[ae].s[he][M0],it,y*Ne);it=Math.min(it,Ze)}else if(Ee!=0&&ge[Ee-1]==3||Ee==0&&j.nsPsy.lastAttacks[ae]==3){var M0=Ee!=2?Ee+1:0,Ze=H(j.thm[ae].s[he][M0],it,y*Ne);it=Math.min(it,Ze)}sa=We[Ee*3+3]+We[Ee*3+4]+We[Ee*3+5],We[Ee*3+5]*6<sa&&(it*=.5,We[Ee*3+4]*6<sa&&(it*=.5)),j.thm[ae].s[he][Ee]=it}}for(j.nsPsy.lastAttacks[ae]=ge[2],Le=0,ve=0;ve<j.npart_l;ve++){for(var s0=j.s3ind[ve][0],na=fe[s0]*x[Bt[s0]],n0=j.s3_ll[Le++]*na;++s0<=j.s3ind[ve][1];)na=fe[s0]*x[Bt[s0]],n0=r(n0,j.s3_ll[Le++]*na,s0,s0-ve,j,0);n0*=.158489319246111,j.blocktype_old[ae&1]==Q.SHORT_TYPE?me[ve]=n0:me[ve]=H(Math.min(n0,Math.min(u*j.nb_1[ae][ve],A*j.nb_2[ae][ve])),n0,Ne),j.nb_2[ae][ve]=j.nb_1[ae][ve],j.nb_1[ae][ve]=n0}for(;ve<=Q.CBANDS;++ve)fe[ve]=0,me[ve]=0;a(j,fe,me,ae)}if((b.mode==MPEGMode.STEREO||b.mode==MPEGMode.JOINT_STEREO)&&b.interChRatio>0&&o(b,b.interChRatio),b.mode==MPEGMode.JOINT_STEREO){var ra;F(j),ra=b.msfix,Math.abs(ra)>0&&R(j,ra,b.ATHlower*j.ATH.adjust)}for(g(b,de,z,W),ae=0;ae<ye;ae++){var w0,B0=0,g0,H0;ae>1?(w0=Z,B0=-2,g0=Q.NORM_TYPE,(z[0]==Q.SHORT_TYPE||z[1]==Q.SHORT_TYPE)&&(g0=Q.SHORT_TYPE),H0=M[N][ae-2]):(w0=X,B0=0,g0=z[ae],H0=$[N][ae]),g0==Q.SHORT_TYPE?w0[B0+ae]=oe(H0,j.masking_lower):w0[B0+ae]=le(H0,j.masking_lower),b.analysis&&(j.pinfo.pe[N][ae]=w0[B0+ae])}return 0};function Te(b,S,C,N,$,M,X,Z){var q=b.internal_flags;if(N<2)p.fft_long(q,X[Z],N,S,C);else if(N==2)for(var z=Q.BLKSIZE-1;z>=0;--z){var j=X[Z+0][z],J=X[Z+1][z];X[Z+0][z]=(j+J)*st.SQRT2*.5,X[Z+1][z]=(j-J)*st.SQRT2*.5}M[0]=X[Z+0][0],M[0]*=M[0];for(var z=Q.BLKSIZE/2-1;z>=0;--z){var _e=X[Z+0][Q.BLKSIZE/2-z],fe=X[Z+0][Q.BLKSIZE/2+z];M[Q.BLKSIZE/2-z]=(_e*_e+fe*fe)*.5}{for(var te=0,z=11;z<Q.HBLKSIZE;z++)te+=M[z];q.tot_ener[N]=te}if(b.analysis){for(var z=0;z<Q.HBLKSIZE;z++)q.pinfo.energy[$][N][z]=q.pinfo.energy_save[N][z],q.pinfo.energy_save[N][z]=M[z];q.pinfo.pe[$][N]=q.pe[N]}}function Fe(b,S,C,N,$,M,X,Z){var q=b.internal_flags;if($==0&&N<2&&p.fft_short(q,X[Z],N,S,C),N==2)for(var z=Q.BLKSIZE_s-1;z>=0;--z){var j=X[Z+0][$][z],J=X[Z+1][$][z];X[Z+0][$][z]=(j+J)*st.SQRT2*.5,X[Z+1][$][z]=(j-J)*st.SQRT2*.5}M[$][0]=X[Z+0][$][0],M[$][0]*=M[$][0];for(var z=Q.BLKSIZE_s/2-1;z>=0;--z){var _e=X[Z+0][$][Q.BLKSIZE_s/2-z],fe=X[Z+0][$][Q.BLKSIZE_s/2+z];M[$][Q.BLKSIZE_s/2-z]=(_e*_e+fe*fe)*.5}}function Ae(b,S,C,N){var $=b.internal_flags;b.athaa_loudapprox==2&&C<2&&($.loudness_sq[S][C]=$.loudness_sq_save[C],$.loudness_sq_save[C]=U(N,$))}var we=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function Me(b,S,C,N,$,M,X,Z,q,z){for(var j=Ot([2,576]),J=b.internal_flags,_e=J.channels_out,fe=b.mode==MPEGMode.JOINT_STEREO?4:_e,te=0;te<_e;te++){firbuf=S[te];var me=C+576-350-Y+192;ue(we.length==(Y-1)/2);for(var W=0;W<576;W++){var de,ye;de=firbuf[me+W+10],ye=0;for(var ae=0;ae<(Y-1)/2-1;ae+=2)de+=we[ae]*(firbuf[me+W+ae]+firbuf[me+W+Y-ae]),ye+=we[ae+1]*(firbuf[me+W+ae+1]+firbuf[me+W+Y-ae-1]);j[te][W]=de+ye}$[N][te].en.assign(J.en[te]),$[N][te].thm.assign(J.thm[te]),fe>2&&(M[N][te].en.assign(J.en[te+2]),M[N][te].thm.assign(J.thm[te+2]))}for(var te=0;te<fe;te++){var ve=$e(12),ee=$e(12),pe=[0,0,0,0],Le=j[te&1],he=0,Ee=te==3?J.nsPsy.attackthre_s:J.nsPsy.attackthre,xe=1;if(te==2)for(var W=0,ae=576;ae>0;++W,--ae){var Ne=j[0][W],Bt=j[1][W];j[0][W]=Ne+Bt,j[1][W]=Ne-Bt}for(var W=0;W<3;W++)ee[W]=J.nsPsy.last_en_subshort[te][W+6],ue(J.nsPsy.last_en_subshort[te][W+4]>0),ve[W]=ee[W]/J.nsPsy.last_en_subshort[te][W+4],pe[0]+=ee[W];for(var W=0;W<9;W++){for(var Ye=he+64,ke=1;he<Ye;he++)ke<Math.abs(Le[he])&&(ke=Math.abs(Le[he]));J.nsPsy.last_en_subshort[te][W]=ee[W+3]=ke,pe[1+W/3]+=ke,ke>ee[W+3-2]?(ue(ee[W+3-2]>0),ke=ke/ee[W+3-2]):ee[W+3-2]>ke*10?(ue(ke>0),ke=ee[W+3-2]/(ke*10)):ke=0,ve[W+3]=ke}for(var W=0;W<3;++W){var at=ee[W*3+3]+ee[W*3+4]+ee[W*3+5],Rt=1;ee[W*3+5]*6<at&&(Rt*=.5,ee[W*3+4]*6<at&&(Rt*=.5)),Z[te][W]=Rt}if(b.analysis){for(var It=ve[0],W=1;W<12;W++)It<ve[W]&&(It=ve[W]);J.pinfo.ers[N][te]=J.pinfo.ers_save[te],J.pinfo.ers_save[te]=It}for(var W=0;W<12;W++)q[te][W/3]==0&&ve[W]>Ee&&(q[te][W/3]=W%3+1);for(var W=1;W<4;W++){var Vt=pe[W-1],Pt=pe[W],We=Math.max(Vt,Pt);We<4e4&&Vt<1.7*Pt&&Pt<1.7*Vt&&(W==1&&q[te][0]<=q[te][W]&&(q[te][0]=0),q[te][W]=0)}q[te][0]<=J.nsPsy.lastAttacks[te]&&(q[te][0]=0),(J.nsPsy.lastAttacks[te]==3||q[te][0]+q[te][1]+q[te][2]+q[te][3]!=0)&&(xe=0,q[te][1]!=0&&q[te][0]!=0&&(q[te][1]=0),q[te][2]!=0&&q[te][1]!=0&&(q[te][2]=0),q[te][3]!=0&&q[te][2]!=0&&(q[te][3]=0)),te<2?z[te]=xe:xe==0&&(z[0]=z[1]=0),X[te]=J.tot_ener[te]}}function qe(b,S,C){if(C==0)for(var N=0;N<b.npart_s;N++)b.nb_s2[S][N]=b.nb_s1[S][N],b.nb_s1[S][N]=0}function Ke(b,S){for(var C=0;C<b.npart_l;C++)b.nb_2[S][C]=b.nb_1[S][C],b.nb_1[S][C]=0}function Gt(b,S,C,N){var $=x.length-1,M=0,X=C[M]+C[M+1];if(ue(X>=0),X>0){var Z=S[M];Z<S[M+1]&&(Z=S[M+1]),ue(b.numlines_s[M]+b.numlines_s[M+1]-1>0),X=20*(Z*2-X)/(X*(b.numlines_s[M]+b.numlines_s[M+1]-1));var q=0|X;q>$&&(q=$),N[M]=q}else N[M]=0;for(M=1;M<b.npart_s-1;M++)if(X=C[M-1]+C[M]+C[M+1],ue(M+1<b.npart_s),ue(X>=0),X>0){var Z=S[M-1];Z<S[M]&&(Z=S[M]),Z<S[M+1]&&(Z=S[M+1]),ue(b.numlines_s[M-1]+b.numlines_s[M]+b.numlines_s[M+1]-1>0),X=20*(Z*3-X)/(X*(b.numlines_s[M-1]+b.numlines_s[M]+b.numlines_s[M+1]-1));var q=0|X;q>$&&(q=$),N[M]=q}else N[M]=0;if(ue(M>0),ue(M==b.npart_s-1),X=C[M-1]+C[M],ue(X>=0),X>0){var Z=S[M-1];Z<S[M]&&(Z=S[M]),ue(b.numlines_s[M-1]+b.numlines_s[M]-1>0),X=20*(Z*2-X)/(X*(b.numlines_s[M-1]+b.numlines_s[M]-1));var q=0|X;q>$&&(q=$),N[M]=q}else N[M]=0;ue(M==b.npart_s-1)}function Mt(b,S,C,N,$,M){var X=b.internal_flags,Z=new float[Q.CBANDS],q=$e(Q.CBANDS),z,j,J,_e=new int[Q.CBANDS];for(J=j=0;J<X.npart_s;++J){var fe=0,te=0,me=X.numlines_s[J];for(z=0;z<me;++z,++j){var W=S[M][j];fe+=W,te<W&&(te=W)}C[J]=fe,ue(fe>=0),Z[J]=te,ue(me>0),q[J]=fe/me,ue(q[J]>=0)}for(ue(J==X.npart_s),ue(j==129);J<Q.CBANDS;++J)Z[J]=0,q[J]=0;for(Gt(X,Z,q,_e),j=J=0;J<X.npart_s;J++){var de=X.s3ind_s[J][0],ye=X.s3ind_s[J][1],ae,ve,ee,pe,Le;for(ae=_e[de],ve=1,pe=X.s3_ss[j]*C[de]*x[_e[de]],++j,++de;de<=ye;)ae+=_e[de],ve+=1,ee=X.s3_ss[j]*C[de]*x[_e[de]],pe=d(pe,ee,de-J),++j,++de;ae=(1+2*ae)/(2*ve),Le=x[ae]*.5,pe*=Le,N[J]=pe,X.nb_s2[$][J]=X.nb_s1[$][J],X.nb_s1[$][J]=pe,ee=Z[J],ee*=X.minval_s[J],ee*=Le,N[J]>ee&&(N[J]=ee),X.masking_lower>1&&(N[J]*=X.masking_lower),N[J]>C[J]&&(N[J]=C[J]),X.masking_lower<1&&(N[J]*=X.masking_lower),ue(N[J]>=0)}for(;J<Q.CBANDS;++J)C[J]=0,N[J]=0}function tt(b,S,C,N,$){var M=$e(Q.CBANDS),X=$e(Q.CBANDS),Z=r0(Q.CBANDS+2),q;be(b,S,C,M,X),ce(b,M,X,Z);var z=0;for(q=0;q<b.npart_l;q++){var j,J,_e,fe,te=b.s3ind[q][0],me=b.s3ind[q][1],W=0,de=0;for(W=Z[te],de+=1,J=b.s3_ll[z]*C[te]*x[Z[te]],++z,++te;te<=me;)W+=Z[te],de+=1,j=b.s3_ll[z]*C[te]*x[Z[te]],fe=d(J,j,te-q),J=fe,++z,++te;if(W=(1+2*W)/(2*de),_e=x[W]*.5,J*=_e,b.blocktype_old[$&1]==Q.SHORT_TYPE){var ye=u*b.nb_1[$][q];ye>0?N[q]=Math.min(J,ye):N[q]=Math.min(J,C[q]*y)}else{var ae=A*b.nb_2[$][q],ve=u*b.nb_1[$][q],ye;ae<=0&&(ae=J),ve<=0&&(ve=J),b.blocktype_old[$&1]==Q.NORM_TYPE?ye=Math.min(ve,ae):ye=ve,N[q]=Math.min(J,ye)}b.nb_2[$][q]=b.nb_1[$][q],b.nb_1[$][q]=J,j=M[q],j*=b.minval_l[q],j*=_e,N[q]>j&&(N[q]=j),b.masking_lower>1&&(N[q]*=b.masking_lower),N[q]>C[q]&&(N[q]=C[q]),b.masking_lower<1&&(N[q]*=b.masking_lower),ue(N[q]>=0)}for(;q<Q.CBANDS;++q)C[q]=0,N[q]=0}function Ft(b,S){var C=b.internal_flags;b.short_blocks==S0.short_block_coupled&&!(S[0]!=0&&S[1]!=0)&&(S[0]=S[1]=0);for(var N=0;N<C.channels_out;N++)b.short_blocks==S0.short_block_dispensed&&(S[N]=1),b.short_blocks==S0.short_block_forced&&(S[N]=0)}function a0(b,S,C){for(var N=b.internal_flags,$=0;$<N.channels_out;$++){var M=Q.NORM_TYPE;S[$]!=0?(ue(N.blocktype_old[$]!=Q.START_TYPE),N.blocktype_old[$]==Q.SHORT_TYPE&&(M=Q.STOP_TYPE)):(M=Q.SHORT_TYPE,N.blocktype_old[$]==Q.NORM_TYPE&&(N.blocktype_old[$]=Q.START_TYPE),N.blocktype_old[$]==Q.STOP_TYPE&&(N.blocktype_old[$]=Q.SHORT_TYPE)),C[$]=N.blocktype_old[$],N.blocktype_old[$]=M}}function e0(b,S,C,N,$,M,X){for(var Z=M*2,q=M>0?Math.pow(10,$):1,z,j,J=0;J<X;++J){var _e=b[2][J],fe=b[3][J],te=S[0][J],me=S[1][J],W=S[2][J],de=S[3][J];if(te<=1.58*me&&me<=1.58*te){var ye=C[J]*fe,ae=C[J]*_e;j=Math.max(W,Math.min(de,ye)),z=Math.max(de,Math.min(W,ae))}else j=W,z=de;if(M>0){var ve,ee,pe=N[J]*q;if(ve=Math.min(Math.max(te,pe),Math.max(me,pe)),W=Math.max(j,pe),de=Math.max(z,pe),ee=W+de,ee>0&&ve*Z<ee){var Le=ve*Z/ee;W*=Le,de*=Le,ue(ee>0)}j=Math.min(W,j),z=Math.min(de,z)}j>_e&&(j=_e),z>fe&&(z=fe),S[2][J]=j,S[3][J]=z}}this.L3psycho_anal_vbr=function(b,S,C,N,$,M,X,Z,q,z){var j=b.internal_flags,J,_e,fe=$e(Q.HBLKSIZE),te=Ot([3,Q.HBLKSIZE_s]),me=Ot([2,Q.BLKSIZE]),W=Ot([2,3,Q.BLKSIZE_s]),de=Ot([4,Q.CBANDS]),ye=Ot([4,Q.CBANDS]),ae=Ot([4,3]),ve=.6,ee=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],pe=r0(2),Le=b.mode==MPEGMode.JOINT_STEREO?4:j.channels_out;Me(b,S,C,N,$,M,q,ae,ee,pe),Ft(b,pe);{for(var he=0;he<Le;he++){var Ee=he&1;J=me,Te(b,S,C,he,N,fe,J,Ee),Ae(b,N,he,fe),pe[Ee]!=0?tt(j,fe,de[he],ye[he],he):Ke(j,he)}pe[0]+pe[1]==2&&b.mode==MPEGMode.JOINT_STEREO&&e0(de,ye,j.mld_cb_l,j.ATH.cb_l,b.ATHlower*j.ATH.adjust,b.msfix,j.npart_l);for(var he=0;he<Le;he++){var Ee=he&1;pe[Ee]!=0&&a(j,de[he],ye[he],he)}}{for(var xe=0;xe<3;xe++){for(var he=0;he<Le;++he){var Ee=he&1;pe[Ee]!=0?qe(j,he,xe):(_e=W,Fe(b,S,C,he,xe,te,_e,Ee),Mt(b,te,de[he],ye[he],he,xe))}pe[0]+pe[1]==0&&b.mode==MPEGMode.JOINT_STEREO&&e0(de,ye,j.mld_cb_s,j.ATH.cb_s,b.ATHlower*j.ATH.adjust,b.msfix,j.npart_s);for(var he=0;he<Le;++he){var Ee=he&1;pe[Ee]==0&&O(j,de[he],ye[he],he,xe)}}for(var he=0;he<Le;he++){var Ee=he&1;if(pe[Ee]==0)for(var Ne=0;Ne<Q.SBMAX_s;Ne++){for(var Bt=$e(3),xe=0;xe<3;xe++){var Ye=j.thm[he].s[Ne][xe];if(Ye*=T,ee[he][xe]>=2||ee[he][xe+1]==1){var ke=xe!=0?xe-1:2,at=H(j.thm[he].s[Ne][ke],Ye,P*ve);Ye=Math.min(Ye,at)}else if(ee[he][xe]==1){var ke=xe!=0?xe-1:2,at=H(j.thm[he].s[Ne][ke],Ye,y*ve);Ye=Math.min(Ye,at)}else if(xe!=0&&ee[he][xe-1]==3||xe==0&&j.nsPsy.lastAttacks[he]==3){var ke=xe!=2?xe+1:0,at=H(j.thm[he].s[Ne][ke],Ye,y*ve);Ye=Math.min(Ye,at)}Ye*=ae[he][xe],Bt[xe]=Ye}for(var xe=0;xe<3;xe++)j.thm[he].s[Ne][xe]=Bt[xe]}}}for(var he=0;he<Le;he++)j.nsPsy.lastAttacks[he]=ee[he][2];a0(b,pe,z);for(var he=0;he<Le;he++){var Rt,It,Vt,Pt;he>1?(Rt=Z,It=-2,Vt=Q.NORM_TYPE,(z[0]==Q.SHORT_TYPE||z[1]==Q.SHORT_TYPE)&&(Vt=Q.SHORT_TYPE),Pt=M[N][he-2]):(Rt=X,It=0,Vt=z[he],Pt=$[N][he]),Vt==Q.SHORT_TYPE?Rt[It+he]=oe(Pt,j.masking_lower):Rt[It+he]=le(Pt,j.masking_lower),b.analysis&&(j.pinfo.pe[N][he]=Rt[It+he])}return 0};function ze(b,S){var C=b,N;return C>=0?N=-C*27:N=C*S,N<=-72?0:Math.exp(N*K)}function i0(b){var S=0,C=0;{var N=0,$,M;for(N=0;ze(N,b)>1e-20;N-=1);for($=N,M=0;Math.abs(M-$)>1e-12;)N=(M+$)/2,ze(N,b)>0?M=N:$=N;S=$}{var N=0,$,M;for(N=0;ze(N,b)>1e-20;N+=1);for($=0,M=N;Math.abs(M-$)>1e-12;)N=(M+$)/2,ze(N,b)>0?$=N:M=N;C=M}{var X=0,Z=1e3,q;for(q=0;q<=Z;++q){var N=S+q*(C-S)/Z,z=ze(N,b);X+=z}{var j=(Z+1)/(X*(C-S));return j}}}function jt(b){var S,C,N,$;return S=b,S>=0?S*=3:S*=1.5,S>=.5&&S<=2.5?($=S-.5,C=8*($*$-2*$)):C=0,S+=.474,N=15.811389+7.5*S-17.5*Math.sqrt(1+S*S),N<=-60?0:(S=Math.exp((C+N)*K),S/=.6609193,S)}function wt(b){return b<0&&(b=0),b=b*.001,13*Math.atan(.76*b)+3.5*Math.atan(b*b/(7.5*7.5))}function p0(b,S,C,N,$,M,X,Z,q,z,j,J){var _e=$e(Q.CBANDS+1),fe=Z/(J>15?2*576:2*192),te=r0(Q.HBLKSIZE),me;Z/=q;var W=0,de=0;for(me=0;me<Q.CBANDS;me++){var ye,ae;for(ye=wt(Z*W),_e[me]=Z*W,ae=W;wt(Z*ae)-ye<B&&ae<=q/2;ae++);for(b[me]=ae-W,de=me+1;W<ae;)ue(W<Q.HBLKSIZE),te[W++]=me;if(W>q/2){W=q/2,++me;break}}ue(me<Q.CBANDS),_e[me]=Z*W;for(var ve=0;ve<J;ve++){var ee,pe,Le,he,Ee;Le=z[ve],he=z[ve+1],ee=0|Math.floor(.5+j*(Le-.5)),ee<0&&(ee=0),pe=0|Math.floor(.5+j*(he-.5)),pe>q/2&&(pe=q/2),C[ve]=(te[ee]+te[pe])/2,S[ve]=te[pe];var xe=fe*he;X[ve]=(xe-_e[S[ve]])/(_e[S[ve]+1]-_e[S[ve]]),X[ve]<0?X[ve]=0:X[ve]>1&&(X[ve]=1),Ee=wt(Z*z[ve]*j),Ee=Math.min(Ee,15.5)/15.5,M[ve]=Math.pow(10,1.25*(1-Math.cos(Math.PI*Ee))-2.5)}W=0;for(var Ne=0;Ne<de;Ne++){var Bt=b[Ne],ye,Ye;ye=wt(Z*W),Ye=wt(Z*(W+Bt-1)),N[Ne]=.5*(ye+Ye),ye=wt(Z*(W-.5)),Ye=wt(Z*(W+Bt-.5)),$[Ne]=Ye-ye,W+=Bt}return de}function ka(b,S,C,N,$,M){var X=Ot([Q.CBANDS,Q.CBANDS]),Z,q=0;if(M)for(var z=0;z<S;z++)for(Z=0;Z<S;Z++){var j=jt(C[z]-C[Z])*N[Z];X[z][Z]=j*$[z]}else for(Z=0;Z<S;Z++)for(var J=15+Math.min(21/C[Z],12),_e=i0(J),z=0;z<S;z++){var j=_e*ze(C[z]-C[Z],J)*N[Z];X[z][Z]=j*$[z]}for(var z=0;z<S;z++){for(Z=0;Z<S&&!(X[z][Z]>0);Z++);for(b[z][0]=Z,Z=S-1;Z>0&&!(X[z][Z]>0);Z--);b[z][1]=Z,q+=b[z][1]-b[z][0]+1}for(var fe=$e(q),te=0,z=0;z<S;z++)for(Z=b[z][0];Z<=b[z][1];Z++)fe[te++]=X[z][Z];return fe}function Oa(b){var S=wt(b);return S=Math.min(S,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*S))-2.5)}this.psymodel_init=function(b){var S=b.internal_flags,C,N=!0,$=13,M=24,X=0,Z=0,q=-8.25,z=-4.5,j=$e(Q.CBANDS),J=$e(Q.CBANDS),_e=$e(Q.CBANDS),fe=b.out_samplerate;switch(b.experimentalZ){default:case 0:N=!0;break;case 1:N=!(b.VBR==E0.vbr_mtrh||b.VBR==E0.vbr_mt);break;case 2:N=!1;break;case 3:$=8,X=-1.75,Z=-.0125,q=-8.25,z=-2.25;break}for(S.ms_ener_ratio_old=.25,S.blocktype_old[0]=S.blocktype_old[1]=Q.NORM_TYPE,C=0;C<4;++C){for(var W=0;W<Q.CBANDS;++W)S.nb_1[C][W]=1e20,S.nb_2[C][W]=1e20,S.nb_s1[C][W]=S.nb_s2[C][W]=1;for(var te=0;te<Q.SBMAX_l;te++)S.en[C].l[te]=1e20,S.thm[C].l[te]=1e20;for(var W=0;W<3;++W){for(var te=0;te<Q.SBMAX_s;te++)S.en[C].s[te][W]=1e20,S.thm[C].s[te][W]=1e20;S.nsPsy.lastAttacks[C]=0}for(var W=0;W<9;W++)S.nsPsy.last_en_subshort[C][W]=10}for(S.loudness_sq_save[0]=S.loudness_sq_save[1]=0,S.npart_l=p0(S.numlines_l,S.bo_l,S.bm_l,j,J,S.mld_l,S.PSY.bo_l_weight,fe,Q.BLKSIZE,S.scalefac_band.l,Q.BLKSIZE/(2*576),Q.SBMAX_l),ue(S.npart_l<Q.CBANDS),C=0;C<S.npart_l;C++){var me=X;j[C]>=$&&(me=Z*(j[C]-$)/(M-$)+X*(M-j[C])/(M-$)),_e[C]=Math.pow(10,me/10),S.numlines_l[C]>0?S.rnumlines_l[C]=1/S.numlines_l[C]:S.rnumlines_l[C]=0}S.s3_ll=ka(S.s3ind,S.npart_l,j,J,_e,N);var W=0;for(C=0;C<S.npart_l;C++){var de;de=Za.MAX_VALUE;for(var ye=0;ye<S.numlines_l[C];ye++,W++){var ae=fe*W/(1e3*Q.BLKSIZE),ve;ve=this.ATHformula(ae*1e3,b)-20,ve=Math.pow(10,.1*ve),ve*=S.numlines_l[C],de>ve&&(de=ve)}S.ATH.cb_l[C]=de,de=-20+j[C]*20/10,de>6&&(de=100),de<-15&&(de=-15),de-=8,S.minval_l[C]=Math.pow(10,de/10)*S.numlines_l[C]}for(S.npart_s=p0(S.numlines_s,S.bo_s,S.bm_s,j,J,S.mld_s,S.PSY.bo_s_weight,fe,Q.BLKSIZE_s,S.scalefac_band.s,Q.BLKSIZE_s/(2*192),Q.SBMAX_s),ue(S.npart_s<Q.CBANDS),W=0,C=0;C<S.npart_s;C++){var de,me=q;j[C]>=$&&(me=z*(j[C]-$)/(M-$)+q*(M-j[C])/(M-$)),_e[C]=Math.pow(10,me/10),de=Za.MAX_VALUE;for(var ye=0;ye<S.numlines_s[C];ye++,W++){var ae=fe*W/(1e3*Q.BLKSIZE_s),ve;ve=this.ATHformula(ae*1e3,b)-20,ve=Math.pow(10,.1*ve),ve*=S.numlines_s[C],de>ve&&(de=ve)}S.ATH.cb_s[C]=de,de=-7+j[C]*7/12,j[C]>12&&(de*=1+Math.log(1+de)*3.1),j[C]<12&&(de*=1+Math.log(1-de)*2.3),de<-15&&(de=-15),de-=8,S.minval_s[C]=Math.pow(10,de/10)*S.numlines_s[C]}S.s3_ss=ka(S.s3ind_s,S.npart_s,j,J,_e,N),c(),p.init_fft(S),S.decay=Math.exp(-1*i/(V*fe/192));{var ee;ee=G,b.exp_nspsytune&2&&(ee=1),Math.abs(b.msfix)>0&&(ee=b.msfix),b.msfix=ee;for(var pe=0;pe<S.npart_l;pe++)S.s3ind[pe][1]>S.npart_l-1&&(S.s3ind[pe][1]=S.npart_l-1)}var Le=576*S.mode_gr/fe;if(S.ATH.decay=Math.pow(10,-12/10*Le),S.ATH.adjust=.01,S.ATH.adjustLimit=1,ue(S.bo_l[Q.SBMAX_l-1]<=S.npart_l),ue(S.bo_s[Q.SBMAX_s-1]<=S.npart_s),b.ATHtype!=-1){var ae,he=b.out_samplerate/Q.BLKSIZE,Ee=0;for(ae=0,C=0;C<Q.BLKSIZE/2;++C)ae+=he,S.ATH.eql_w[C]=1/Math.pow(10,this.ATHformula(ae,b)/10),Ee+=S.ATH.eql_w[C];for(Ee=1/Ee,C=Q.BLKSIZE/2;--C>=0;)S.ATH.eql_w[C]*=Ee}{for(var pe=W=0;pe<S.npart_s;++pe)for(C=0;C<S.numlines_s[pe];++C)++W;ue(W==129);for(var pe=W=0;pe<S.npart_l;++pe)for(C=0;C<S.numlines_l[pe];++C)++W;ue(W==513)}for(W=0,C=0;C<S.npart_l;C++){var ae=fe*(W+S.numlines_l[C]/2)/(1*Q.BLKSIZE);S.mld_cb_l[C]=Oa(ae),W+=S.numlines_l[C]}for(;C<Q.CBANDS;++C)S.mld_cb_l[C]=1;for(W=0,C=0;C<S.npart_s;C++){var ae=fe*(W+S.numlines_s[C]/2)/(1*Q.BLKSIZE_s);S.mld_cb_s[C]=Oa(ae),W+=S.numlines_s[C]}for(;C<Q.CBANDS;++C)S.mld_cb_s[C]=1;return 0};function b0(b,S){b<-.3&&(b=3410),b/=1e3,b=Math.max(.1,b);var C=3.64*Math.pow(b,-.8)-6.8*Math.exp(-.6*Math.pow(b-3.4,2))+6*Math.exp(-.15*Math.pow(b-8.7,2))+(.6+.04*S)*.001*Math.pow(b,4);return C}this.ATHformula=function(b,S){var C;switch(S.ATHtype){case 0:C=b0(b,9);break;case 1:C=b0(b,-1);break;case 2:C=b0(b,0);break;case 3:C=b0(b,1)+6;break;case 4:C=b0(b,S.ATHcurve);break;default:C=b0(b,0);break}return C}}var zi=Qi;function Yt(p){var i=p;this.ordinal=function(){return i}}Yt.STEREO=new Yt(0);Yt.JOINT_STEREO=new Yt(1);Yt.DUAL_CHANNEL=new Yt(2);Yt.MONO=new Yt(3);Yt.NOT_SET=new Yt(4);var Ba=Yt;const Ji=Ma(Ba);var es=Ba;function ts(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=es.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var as=ts,is=Qe(),Ti={};Ti.SFBMAX=is.SBMAX_s*3;var W0=Ti,_t=He;_t.System;_t.VbrMode;_t.Float;_t.ShortBlock;_t.Util;_t.Arrays;_t.new_array_n;_t.new_byte;_t.new_double;var ss=_t.new_float;_t.new_float_n;var l0=_t.new_int;_t.new_int_n;_t.assert;var da=W0;function ns(){this.xr=ss(576),this.l3_enc=l0(576),this.scalefac=l0(da.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=l0(3),this.subblock_gain=l0(3+1),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=l0(da.SFBMAX),this.window=l0(da.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=l0(4),this.max_nonzero_coeff=0;var p=this;function i(A){return new Int32Array(A)}function u(A){return new Float32Array(A)}this.assign=function(A){p.xr=u(A.xr),p.l3_enc=i(A.l3_enc),p.scalefac=i(A.scalefac),p.xrpow_max=A.xrpow_max,p.part2_3_length=A.part2_3_length,p.big_values=A.big_values,p.count1=A.count1,p.global_gain=A.global_gain,p.scalefac_compress=A.scalefac_compress,p.block_type=A.block_type,p.mixed_block_flag=A.mixed_block_flag,p.table_select=i(A.table_select),p.subblock_gain=i(A.subblock_gain),p.region0_count=A.region0_count,p.region1_count=A.region1_count,p.preflag=A.preflag,p.scalefac_scale=A.scalefac_scale,p.count1table_select=A.count1table_select,p.part2_length=A.part2_length,p.sfb_lmax=A.sfb_lmax,p.sfb_smin=A.sfb_smin,p.psy_lmax=A.psy_lmax,p.sfbmax=A.sfbmax,p.psymax=A.psymax,p.sfbdivide=A.sfbdivide,p.width=i(A.width),p.window=i(A.window),p.count1bits=A.count1bits,p.sfb_partition_table=A.sfb_partition_table.slice(0),p.slen=i(A.slen),p.max_nonzero_coeff=A.max_nonzero_coeff}}var Ra=ns,ht=He;ht.System;ht.VbrMode;ht.Float;ht.ShortBlock;ht.Util;ht.Arrays;ht.new_array_n;ht.new_byte;ht.new_double;ht.new_float;ht.new_float_n;var ja=ht.new_int;ht.new_int_n;ht.assert;var rs=Ra;function ls(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[ja(4),ja(4)];for(var p=0;p<2;p++)for(var i=0;i<2;i++)this.tt[p][i]=new rs}var os=ls,ct=He,V0=ct.System;ct.VbrMode;ct.Float;ct.ShortBlock;ct.Util;ct.Arrays;ct.new_array_n;ct.new_byte;ct.new_double;ct.new_float;ct.new_float_n;var P0=ct.new_int;ct.new_int_n;ct.assert;var q0=Qe();function _s(p,i,u,A){this.l=P0(1+q0.SBMAX_l),this.s=P0(1+q0.SBMAX_s),this.psfb21=P0(1+q0.PSFB21),this.psfb12=P0(1+q0.PSFB12);var w=this.l,I=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],V0.arraycopy(this.arrL,0,w,0,Math.min(this.arrL.length,this.l.length)),V0.arraycopy(this.arrS,0,I,0,Math.min(this.arrS.length,this.s.length)),V0.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),V0.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var Mi=_s,ut=He;ut.System;ut.VbrMode;ut.Float;ut.ShortBlock;ut.Util;ut.Arrays;ut.new_array_n;ut.new_byte;ut.new_double;var va=ut.new_float,hs=ut.new_float_n,cs=ut.new_int;ut.new_int_n;ut.assert;var Wa=Qe();function us(){this.last_en_subshort=hs([4,9]),this.lastAttacks=cs(4),this.pefirbuf=va(19),this.longfact=va(Wa.SBMAX_l),this.shortfact=va(Wa.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var ds=us;function vs(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var ms=vs,dt=He;dt.System;dt.VbrMode;dt.Float;dt.ShortBlock;dt.Util;dt.Arrays;dt.new_array_n;var fs=dt.new_byte,ps=dt.new_double,Nt=dt.new_float,o0=dt.new_float_n,qt=dt.new_int,D0=dt.new_int_n;dt.assert;var bs=os,As=Mi,Es=ds,Ss=ms,Qa=xi(),Xe=Qe(),ys=W0;zt.MFSIZE=3*1152+Xe.ENCDELAY-Xe.MDCTDELAY;zt.MAX_HEADER_BUF=256;zt.MAX_BITS_PER_CHANNEL=4095;zt.MAX_BITS_PER_GRANULE=7680;zt.BPC=320;function zt(){var p=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=o0([2,zt.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new bs,this.ms_ratio=Nt(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=qt(2),this.CurrentStep=qt(2),this.masking_lower=0,this.bv_scf=qt(576),this.pseudohalf=qt(ys.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*zt.BPC+1),this.itime=ps(2),this.sideinfo_len=0,this.sb_sample=o0([2,2,18,Xe.SBLIMIT]),this.amp_filter=Nt(32);function i(){this.write_timing=0,this.ptr=0,this.buf=fs(p)}this.header=new Array(zt.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new As,this.minval_l=Nt(Xe.CBANDS),this.minval_s=Nt(Xe.CBANDS),this.nb_1=o0([4,Xe.CBANDS]),this.nb_2=o0([4,Xe.CBANDS]),this.nb_s1=o0([4,Xe.CBANDS]),this.nb_s2=o0([4,Xe.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Nt(4),this.loudness_sq=o0([2,2]),this.loudness_sq_save=Nt(2),this.mld_l=Nt(Xe.SBMAX_l),this.mld_s=Nt(Xe.SBMAX_s),this.bm_l=qt(Xe.SBMAX_l),this.bo_l=qt(Xe.SBMAX_l),this.bm_s=qt(Xe.SBMAX_s),this.bo_s=qt(Xe.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=D0([Xe.CBANDS,2]),this.s3ind_s=D0([Xe.CBANDS,2]),this.numlines_s=qt(Xe.CBANDS),this.numlines_l=qt(Xe.CBANDS),this.rnumlines_l=Nt(Xe.CBANDS),this.mld_cb_l=Nt(Xe.CBANDS),this.mld_cb_s=Nt(Xe.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Nt(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=qt(2),this.nsPsy=new Es,this.VBR_seek_table=new Ss,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=D0([16,4+1]),this.bitrate_blockType_Hist=D0([16,4+1+1]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var u=0;u<this.en.length;u++)this.en[u]=new Qa;for(var u=0;u<this.thm.length;u++)this.thm[u]=new Qa;for(var u=0;u<this.header.length;u++)this.header[u]=new i}var Q0=zt,vt=He;vt.System;vt.VbrMode;vt.Float;vt.ShortBlock;vt.Util;vt.Arrays;vt.new_array_n;vt.new_byte;vt.new_double;var _0=vt.new_float;vt.new_float_n;vt.new_int;vt.new_int_n;vt.assert;var h0=Qe();function xs(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=_0(h0.SBMAX_l),this.s=_0(h0.SBMAX_s),this.psfb21=_0(h0.PSFB21),this.psfb12=_0(h0.PSFB12),this.cb_l=_0(h0.CBANDS),this.cb_s=_0(h0.CBANDS),this.eql_w=_0(h0.BLKSIZE/2)}var Ts=xs,mt=He,nt=mt.System;mt.VbrMode;mt.Float;mt.ShortBlock;mt.Util;var za=mt.Arrays;mt.new_array_n;mt.new_byte;mt.new_double;mt.new_float;mt.new_float_n;mt.new_int;mt.new_int_n;mt.assert;Oe.STEPS_per_dB=100;Oe.MAX_dB=120;Oe.GAIN_NOT_ENOUGH_SAMPLES=-24601;Oe.GAIN_ANALYSIS_ERROR=0;Oe.GAIN_ANALYSIS_OK=1;Oe.INIT_GAIN_ANALYSIS_ERROR=0;Oe.INIT_GAIN_ANALYSIS_OK=1;Oe.YULE_ORDER=10;Oe.MAX_ORDER=Oe.YULE_ORDER;Oe.MAX_SAMP_FREQ=48e3;Oe.RMS_WINDOW_TIME_NUMERATOR=1;Oe.RMS_WINDOW_TIME_DENOMINATOR=20;Oe.MAX_SAMPLES_PER_WINDOW=Oe.MAX_SAMP_FREQ*Oe.RMS_WINDOW_TIME_NUMERATOR/Oe.RMS_WINDOW_TIME_DENOMINATOR+1;function Oe(){var p=64.82;Oe.YULE_ORDER;var i=.95;Oe.MAX_SAMP_FREQ;var u=Oe.RMS_WINDOW_TIME_NUMERATOR,A=Oe.RMS_WINDOW_TIME_DENOMINATOR;Oe.MAX_SAMPLES_PER_WINDOW;var w=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],I=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function B(y,G,Y,K,D,U){for(;D--!=0;)Y[K]=1e-10+y[G+0]*U[0]-Y[K-1]*U[1]+y[G-1]*U[2]-Y[K-2]*U[3]+y[G-2]*U[4]-Y[K-3]*U[5]+y[G-3]*U[6]-Y[K-4]*U[7]+y[G-4]*U[8]-Y[K-5]*U[9]+y[G-5]*U[10]-Y[K-6]*U[11]+y[G-6]*U[12]-Y[K-7]*U[13]+y[G-7]*U[14]-Y[K-8]*U[15]+y[G-8]*U[16]-Y[K-9]*U[17]+y[G-9]*U[18]-Y[K-10]*U[19]+y[G-10]*U[20],++K,++G}function L(y,G,Y,K,D,U){for(;D--!=0;)Y[K]=y[G+0]*U[0]-Y[K-1]*U[1]+y[G-1]*U[2]-Y[K-2]*U[3]+y[G-2]*U[4],++K,++G}function V(y,G){for(var Y=0;Y<MAX_ORDER;Y++)y.linprebuf[Y]=y.lstepbuf[Y]=y.loutbuf[Y]=y.rinprebuf[Y]=y.rstepbuf[Y]=y.routbuf[Y]=0;switch(0|G){case 48e3:y.reqindex=0;break;case 44100:y.reqindex=1;break;case 32e3:y.reqindex=2;break;case 24e3:y.reqindex=3;break;case 22050:y.reqindex=4;break;case 16e3:y.reqindex=5;break;case 12e3:y.reqindex=6;break;case 11025:y.reqindex=7;break;case 8e3:y.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return y.sampleWindow=0|(G*u+A-1)/A,y.lsum=0,y.rsum=0,y.totsamp=0,za.ill(y.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(y,G){return V(y,G)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(y.linpre=MAX_ORDER,y.rinpre=MAX_ORDER,y.lstep=MAX_ORDER,y.rstep=MAX_ORDER,y.lout=MAX_ORDER,y.rout=MAX_ORDER,za.fill(y.B,0),INIT_GAIN_ANALYSIS_OK)};function T(y){return y*y}this.AnalyzeSamples=function(y,G,Y,K,D,U,k){var _,m,E,e,v,f,x;if(U==0)return GAIN_ANALYSIS_OK;switch(x=0,v=U,k){case 1:K=G,D=Y;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(U<MAX_ORDER?(nt.arraycopy(G,Y,y.linprebuf,MAX_ORDER,U),nt.arraycopy(K,D,y.rinprebuf,MAX_ORDER,U)):(nt.arraycopy(G,Y,y.linprebuf,MAX_ORDER,MAX_ORDER),nt.arraycopy(K,D,y.rinprebuf,MAX_ORDER,MAX_ORDER));v>0;){f=v>y.sampleWindow-y.totsamp?y.sampleWindow-y.totsamp:v,x<MAX_ORDER?(_=y.linpre+x,m=y.linprebuf,E=y.rinpre+x,e=y.rinprebuf,f>MAX_ORDER-x&&(f=MAX_ORDER-x)):(_=Y+x,m=G,E=D+x,e=K),B(m,_,y.lstepbuf,y.lstep+y.totsamp,f,w[y.reqindex]),B(e,E,y.rstepbuf,y.rstep+y.totsamp,f,w[y.reqindex]),L(y.lstepbuf,y.lstep+y.totsamp,y.loutbuf,y.lout+y.totsamp,f,I[y.reqindex]),L(y.rstepbuf,y.rstep+y.totsamp,y.routbuf,y.rout+y.totsamp,f,I[y.reqindex]),_=y.lout+y.totsamp,m=y.loutbuf,E=y.rout+y.totsamp,e=y.routbuf;for(var c=f%8;c--!=0;)y.lsum+=T(m[_++]),y.rsum+=T(e[E++]);for(c=f/8;c--!=0;)y.lsum+=T(m[_+0])+T(m[_+1])+T(m[_+2])+T(m[_+3])+T(m[_+4])+T(m[_+5])+T(m[_+6])+T(m[_+7]),_+=8,y.rsum+=T(e[E+0])+T(e[E+1])+T(e[E+2])+T(e[E+3])+T(e[E+4])+T(e[E+5])+T(e[E+6])+T(e[E+7]),E+=8;if(v-=f,x+=f,y.totsamp+=f,y.totsamp==y.sampleWindow){var n=Oe.STEPS_per_dB*10*Math.log10((y.lsum+y.rsum)/y.totsamp*.5+1e-37),s=n<=0?0:0|n;s>=y.A.length&&(s=y.A.length-1),y.A[s]++,y.lsum=y.rsum=0,nt.arraycopy(y.loutbuf,y.totsamp,y.loutbuf,0,MAX_ORDER),nt.arraycopy(y.routbuf,y.totsamp,y.routbuf,0,MAX_ORDER),nt.arraycopy(y.lstepbuf,y.totsamp,y.lstepbuf,0,MAX_ORDER),nt.arraycopy(y.rstepbuf,y.totsamp,y.rstepbuf,0,MAX_ORDER),y.totsamp=0}if(y.totsamp>y.sampleWindow)return GAIN_ANALYSIS_ERROR}return U<MAX_ORDER?(nt.arraycopy(y.linprebuf,U,y.linprebuf,0,MAX_ORDER-U),nt.arraycopy(y.rinprebuf,U,y.rinprebuf,0,MAX_ORDER-U),nt.arraycopy(G,Y,y.linprebuf,MAX_ORDER-U,U),nt.arraycopy(K,D,y.rinprebuf,MAX_ORDER-U,U)):(nt.arraycopy(G,Y+U-MAX_ORDER,y.linprebuf,0,MAX_ORDER),nt.arraycopy(K,D+U-MAX_ORDER,y.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function P(y,G){var Y,K=0;for(Y=0;Y<G;Y++)K+=y[Y];if(K==0)return GAIN_NOT_ENOUGH_SAMPLES;var D=0|Math.ceil(K*(1-i));for(Y=G;Y-- >0&&!((D-=y[Y])<=0););return p-Y/Oe.STEPS_per_dB}this.GetTitleGain=function(y){for(var G=P(y.A,y.A.length),Y=0;Y<y.A.length;Y++)y.B[Y]+=y.A[Y],y.A[Y]=0;for(var Y=0;Y<MAX_ORDER;Y++)y.linprebuf[Y]=y.lstepbuf[Y]=y.loutbuf[Y]=y.rinprebuf[Y]=y.rstepbuf[Y]=y.routbuf[Y]=0;return y.totsamp=0,y.lsum=y.rsum=0,G}}var wi=Oe,ft=He;ft.System;ft.VbrMode;ft.Float;ft.ShortBlock;ft.Util;ft.Arrays;ft.new_array_n;ft.new_byte;ft.new_double;var y0=ft.new_float;ft.new_float_n;var Ja=ft.new_int;ft.new_int_n;ft.assert;var rt=wi;function Ms(){this.linprebuf=y0(rt.MAX_ORDER*2),this.linpre=0,this.lstepbuf=y0(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.lstep=0,this.loutbuf=y0(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.lout=0,this.rinprebuf=y0(rt.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=y0(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.rstep=0,this.routbuf=y0(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=Ja(0|rt.STEPS_per_dB*rt.MAX_dB),this.B=Ja(0|rt.STEPS_per_dB*rt.MAX_dB)}var Bs=Ms;function Rs(p){this.bits=p}var Bi=Rs,pt=He;pt.System;pt.VbrMode;pt.Float;pt.ShortBlock;pt.Util;pt.Arrays;pt.new_array_n;pt.new_byte;pt.new_double;var ei=pt.new_float;pt.new_float_n;var Is=pt.new_int;pt.new_int_n;var ti=pt.assert,Cs=Bi,ai=Qe(),Ls=W0,ks=Q0;function Os(p){var i=p;this.quantize=i,this.iteration_loop=function(u,A,w,I){var B=u.internal_flags,L=ei(Ls.SFBMAX),V=ei(576),T=Is(2),P=0,y,G=B.l3_side,Y=new Cs(P);this.quantize.rv.ResvFrameBegin(u,Y),P=Y.bits;for(var K=0;K<B.mode_gr;K++){y=this.quantize.qupvt.on_pe(u,A,T,P,K,K),B.mode_ext==ai.MPG_MD_MS_LR&&(this.quantize.ms_convert(B.l3_side,K),this.quantize.qupvt.reduce_side(T,w[K],P,y));for(var D=0;D<B.channels_out;D++){var U,k,_=G.tt[K][D];_.block_type!=ai.SHORT_TYPE?(U=0,k=B.PSY.mask_adjust-U):(U=0,k=B.PSY.mask_adjust_short-U),B.masking_lower=Math.pow(10,k*.1),this.quantize.init_outer_loop(B,_),this.quantize.init_xrpow(B,_,V)&&(this.quantize.qupvt.calc_xmin(u,I[K][D],_,L),this.quantize.outer_loop(u,_,L,V,D,T[D])),this.quantize.iteration_finish_one(B,K,D),ti(_.part2_3_length<=ks.MAX_BITS_PER_CHANNEL),ti(_.part2_3_length<=T[D])}}this.quantize.rv.ResvFrameEnd(B,P)}}var Ns=Os;function Be(p,i,u,A){this.xlen=p,this.linmax=i,this.table=u,this.hlen=A}var ie={};ie.t1HB=[1,1,1,0];ie.t2HB=[1,2,1,3,1,1,3,2,0];ie.t3HB=[3,2,1,1,1,1,3,2,0];ie.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];ie.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];ie.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];ie.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];ie.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];ie.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];ie.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];ie.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];ie.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];ie.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];ie.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];ie.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];ie.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];ie.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];ie.t1l=[1,4,3,5];ie.t2l=[1,4,7,4,5,7,6,7,8];ie.t3l=[2,3,7,4,4,7,6,7,8];ie.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];ie.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];ie.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];ie.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];ie.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];ie.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];ie.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];ie.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];ie.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];ie.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];ie.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];ie.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];ie.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];ie.t32l=[1+0,4+1,4+1,5+2,4+1,6+2,5+2,6+3,4+1,5+2,5+2,6+3,5+2,6+3,6+3,6+4];ie.t33l=[4+0,4+1,4+1,4+2,4+1,4+2,4+2,4+3,4+1,4+2,4+2,4+3,4+2,4+3,4+3,4+4];ie.ht=[new Be(0,0,null,null),new Be(2,0,ie.t1HB,ie.t1l),new Be(3,0,ie.t2HB,ie.t2l),new Be(3,0,ie.t3HB,ie.t3l),new Be(0,0,null,null),new Be(4,0,ie.t5HB,ie.t5l),new Be(4,0,ie.t6HB,ie.t6l),new Be(6,0,ie.t7HB,ie.t7l),new Be(6,0,ie.t8HB,ie.t8l),new Be(6,0,ie.t9HB,ie.t9l),new Be(8,0,ie.t10HB,ie.t10l),new Be(8,0,ie.t11HB,ie.t11l),new Be(8,0,ie.t12HB,ie.t12l),new Be(16,0,ie.t13HB,ie.t13l),new Be(0,0,null,ie.t16_5l),new Be(16,0,ie.t15HB,ie.t15l),new Be(1,1,ie.t16HB,ie.t16l),new Be(2,3,ie.t16HB,ie.t16l),new Be(3,7,ie.t16HB,ie.t16l),new Be(4,15,ie.t16HB,ie.t16l),new Be(6,63,ie.t16HB,ie.t16l),new Be(8,255,ie.t16HB,ie.t16l),new Be(10,1023,ie.t16HB,ie.t16l),new Be(13,8191,ie.t16HB,ie.t16l),new Be(4,15,ie.t24HB,ie.t24l),new Be(5,31,ie.t24HB,ie.t24l),new Be(6,63,ie.t24HB,ie.t24l),new Be(7,127,ie.t24HB,ie.t24l),new Be(8,255,ie.t24HB,ie.t24l),new Be(9,511,ie.t24HB,ie.t24l),new Be(11,2047,ie.t24HB,ie.t24l),new Be(13,8191,ie.t24HB,ie.t24l),new Be(0,0,ie.t32HB,ie.t32l),new Be(0,0,ie.t33HB,ie.t33l)];ie.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];ie.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];ie.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];ie.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];ie.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]];ie.scfsi_band=[0,6,11,16,21];var Ia=ie,Wt=Mi,bt=He;bt.System;var c0=bt.VbrMode,X0=bt.Float;bt.ShortBlock;var ma=bt.Util;bt.Arrays;bt.new_array_n;bt.new_byte;bt.new_double;var u0=bt.new_float;bt.new_float_n;var gs=bt.new_int;bt.new_int_n;var Qt=bt.assert,je=Qe(),Hs=Bi,Je=Q0;Lt.Q_MAX=256+1;Lt.Q_MAX2=116;Lt.LARGE_BITS=1e5;Lt.IXMAX_VAL=8206;function Lt(){var p=null,i=null,u=null;this.setModules=function(_,m,E){p=_,i=m,u=E};function A(_){return Qt(0<=_+Lt.Q_MAX2&&_<Lt.Q_MAX),y[_+Lt.Q_MAX2]}this.IPOW20=function(_){return Qt(0<=_&&_<Lt.Q_MAX),G[_]};var w=2220446049250313e-31,I=Lt.IXMAX_VAL,B=I+2,L=Lt.Q_MAX,V=Lt.Q_MAX2;Lt.LARGE_BITS;var T=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var P=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=P,this.sfBandIndex=[new Wt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Wt([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Wt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Wt([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Wt([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Wt([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Wt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Wt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Wt([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var y=u0(L+V+1),G=u0(L),Y=u0(B),K=u0(B);this.adj43=K;function D(_,m){var E=u.ATHformula(m,_);return E-=T,E=Math.pow(10,E/10+_.ATHlower),E}function U(_){for(var m=_.internal_flags.ATH.l,E=_.internal_flags.ATH.psfb21,e=_.internal_flags.ATH.s,v=_.internal_flags.ATH.psfb12,f=_.internal_flags,x=_.out_samplerate,c=0;c<je.SBMAX_l;c++){var n=f.scalefac_band.l[c],s=f.scalefac_band.l[c+1];m[c]=X0.MAX_VALUE;for(var h=n;h<s;h++){var r=h*x/1152,t=D(_,r);m[c]=Math.min(m[c],t)}}for(var c=0;c<je.PSFB21;c++){var n=f.scalefac_band.psfb21[c],s=f.scalefac_band.psfb21[c+1];E[c]=X0.MAX_VALUE;for(var h=n;h<s;h++){var r=h*x/1152,t=D(_,r);E[c]=Math.min(E[c],t)}}for(var c=0;c<je.SBMAX_s;c++){var n=f.scalefac_band.s[c],s=f.scalefac_band.s[c+1];e[c]=X0.MAX_VALUE;for(var h=n;h<s;h++){var r=h*x/384,t=D(_,r);e[c]=Math.min(e[c],t)}e[c]*=f.scalefac_band.s[c+1]-f.scalefac_band.s[c]}for(var c=0;c<je.PSFB12;c++){var n=f.scalefac_band.psfb12[c],s=f.scalefac_band.psfb12[c+1];v[c]=X0.MAX_VALUE;for(var h=n;h<s;h++){var r=h*x/384,t=D(_,r);v[c]=Math.min(v[c],t)}v[c]*=f.scalefac_band.s[13]-f.scalefac_band.s[12]}if(_.noATH){for(var c=0;c<je.SBMAX_l;c++)m[c]=1e-20;for(var c=0;c<je.PSFB21;c++)E[c]=1e-20;for(var c=0;c<je.SBMAX_s;c++)e[c]=1e-20;for(var c=0;c<je.PSFB12;c++)v[c]=1e-20}f.ATH.floor=10*Math.log10(D(_,-1))}this.iteration_init=function(_){var m=_.internal_flags,E=m.l3_side,e;if(m.iteration_init_init==0){for(m.iteration_init_init=1,E.main_data_begin=0,U(_),Y[0]=0,e=1;e<B;e++)Y[e]=Math.pow(e,4/3);for(e=0;e<B-1;e++)K[e]=e+1-Math.pow(.5*(Y[e]+Y[e+1]),.75);for(K[e]=.5,e=0;e<L;e++)G[e]=Math.pow(2,(e-210)*-.1875);for(e=0;e<=L+V;e++)y[e]=Math.pow(2,(e-210-V)*.25);p.huffman_init(m);{var v,f,x,c;for(e=_.exp_nspsytune>>2&63,e>=32&&(e-=64),v=Math.pow(10,e/4/10),e=_.exp_nspsytune>>8&63,e>=32&&(e-=64),f=Math.pow(10,e/4/10),e=_.exp_nspsytune>>14&63,e>=32&&(e-=64),x=Math.pow(10,e/4/10),e=_.exp_nspsytune>>20&63,e>=32&&(e-=64),c=x*Math.pow(10,e/4/10),e=0;e<je.SBMAX_l;e++){var n;e<=6?n=v:e<=13?n=f:e<=20?n=x:n=c,m.nsPsy.longfact[e]=n}for(e=0;e<je.SBMAX_s;e++){var n;e<=5?n=v:e<=10?n=f:e<=11?n=x:n=c,m.nsPsy.shortfact[e]=n}}}},this.on_pe=function(_,m,E,e,v,f){var x=_.internal_flags,c=0,n,s=gs(2),h,r=new Hs(c),t=i.ResvMaxBits(_,e,r,f);c=r.bits;var d=c+t;for(d>Je.MAX_BITS_PER_GRANULE&&(d=Je.MAX_BITS_PER_GRANULE),n=0,h=0;h<x.channels_out;++h)E[h]=Math.min(Je.MAX_BITS_PER_CHANNEL,c/x.channels_out),s[h]=0|E[h]*m[v][h]/700-E[h],s[h]>e*3/4&&(s[h]=e*3/4),s[h]<0&&(s[h]=0),s[h]+E[h]>Je.MAX_BITS_PER_CHANNEL&&(s[h]=Math.max(0,Je.MAX_BITS_PER_CHANNEL-E[h])),n+=s[h];if(n>t)for(h=0;h<x.channels_out;++h)s[h]=t*s[h]/n;for(h=0;h<x.channels_out;++h)E[h]+=s[h],t-=s[h];for(n=0,h=0;h<x.channels_out;++h)n+=E[h];if(n>Je.MAX_BITS_PER_GRANULE){var o=0;for(h=0;h<x.channels_out;++h)E[h]*=Je.MAX_BITS_PER_GRANULE,E[h]/=n,o+=E[h];Qt(o<=Je.MAX_BITS_PER_GRANULE)}return d},this.reduce_side=function(_,m,E,e){Qt(e<=Je.MAX_BITS_PER_GRANULE),Qt(_[0]+_[1]<=Je.MAX_BITS_PER_GRANULE);var v=.33*(.5-m)/.5;v<0&&(v=0),v>.5&&(v=.5);var f=0|v*.5*(_[0]+_[1]);f>Je.MAX_BITS_PER_CHANNEL-_[0]&&(f=Je.MAX_BITS_PER_CHANNEL-_[0]),f<0&&(f=0),_[1]>=125&&(_[1]-f>125?(_[0]<E&&(_[0]+=f),_[1]-=f):(_[0]+=_[1]-125,_[1]=125)),f=_[0]+_[1],f>e&&(_[0]=e*_[0]/f,_[1]=e*_[1]/f),Qt(_[0]<=Je.MAX_BITS_PER_CHANNEL),Qt(_[1]<=Je.MAX_BITS_PER_CHANNEL),Qt(_[0]+_[1]<=Je.MAX_BITS_PER_GRANULE)},this.athAdjust=function(_,m,E){var e=90.30873362,v=94.82444863,f=ma.FAST_LOG10_X(m,10),x=_*_,c=0;return f-=E,x>1e-20&&(c=1+ma.FAST_LOG10_X(x,10/e)),c<0&&(c=0),f*=c,f+=E+e-v,Math.pow(10,.1*f)},this.calc_xmin=function(_,m,E,e){var v=0,f=_.internal_flags,x,c=0,n=0,s=f.ATH,h=E.xr,r=_.VBR==c0.vbr_mtrh?1:0,t=f.masking_lower;for((_.VBR==c0.vbr_mtrh||_.VBR==c0.vbr_mt)&&(t=1),x=0;x<E.psy_lmax;x++){var d,o,F,R,O,a;_.VBR==c0.vbr_rh||_.VBR==c0.vbr_mtrh?o=athAdjust(s.adjust,s.l[x],s.floor):o=s.adjust*s.l[x],O=E.width[x],F=o/O,R=w,a=O>>1,d=0;do{var l,g;l=h[c]*h[c],d+=l,R+=l<F?l:F,c++,g=h[c]*h[c],d+=g,R+=g<F?g:F,c++}while(--a>0);if(d>o&&n++,x==je.SBPSY_l){var H=o*f.nsPsy.longfact[x];R<H&&(R=H)}if(r!=0&&(o=R),!_.ATHonly){var se=m.en.l[x];if(se>0){var H;H=d*m.thm.l[x]*t/se,r!=0&&(H*=f.nsPsy.longfact[x]),o<H&&(o=H)}}r!=0?e[v++]=o:e[v++]=o*f.nsPsy.longfact[x]}var oe=575;if(E.block_type!=je.SHORT_TYPE)for(var re=576;re--!=0&&BitStream.EQ(h[re],0);)oe=re;E.max_nonzero_coeff=oe;for(var le=E.sfb_smin;x<E.psymax;le++,x+=3){var O,be,ce;for(_.VBR==c0.vbr_rh||_.VBR==c0.vbr_mtrh?ce=athAdjust(s.adjust,s.s[le],s.floor):ce=s.adjust*s.s[le],O=E.width[x],be=0;be<3;be++){var d=0,o,F,R,a=O>>1;F=ce/O,R=w;do{var l,g;l=h[c]*h[c],d+=l,R+=l<F?l:F,c++,g=h[c]*h[c],d+=g,R+=g<F?g:F,c++}while(--a>0);if(d>ce&&n++,le==je.SBPSY_s){var H=ce*f.nsPsy.shortfact[le];R<H&&(R=H)}if(r!=0?o=R:o=ce,!_.ATHonly&&!_.ATHshort){var se=m.en.s[le][be];if(se>0){var H;H=d*m.thm.s[le][be]*t/se,r!=0&&(H*=f.nsPsy.shortfact[le]),o<H&&(o=H)}}r!=0?e[v++]=o:e[v++]=o*f.nsPsy.shortfact[le]}_.useTemporal&&(e[v-3]>e[v-3+1]&&(e[v-3+1]+=(e[v-3]-e[v-3+1])*f.decay),e[v-3+1]>e[v-3+2]&&(e[v-3+2]+=(e[v-3+1]-e[v-3+2])*f.decay))}return n};function k(_){this.s=_}this.calc_noise_core=function(_,m,E,e){var v=0,f=m.s,x=_.l3_enc;if(f>_.count1)for(;E--!=0;){var c;c=_.xr[f],f++,v+=c*c,c=_.xr[f],f++,v+=c*c}else if(f>_.big_values){var n=u0(2);for(n[0]=0,n[1]=e;E--!=0;){var c;c=Math.abs(_.xr[f])-n[x[f]],f++,v+=c*c,c=Math.abs(_.xr[f])-n[x[f]],f++,v+=c*c}}else for(;E--!=0;){var c;c=Math.abs(_.xr[f])-Y[x[f]]*e,f++,v+=c*c,c=Math.abs(_.xr[f])-Y[x[f]]*e,f++,v+=c*c}return m.s=f,v},this.calc_noise=function(_,m,E,e,v){var f=0,x=0,c,n,s=0,h=0,r=0,t=-20,d=0,o=_.scalefac,F=0;for(e.over_SSD=0,c=0;c<_.psymax;c++){var R=_.global_gain-(o[F++]+(_.preflag!=0?P[c]:0)<<_.scalefac_scale+1)-_.subblock_gain[_.window[c]]*8,O=0;if(v!=null&&v.step[c]==R)O=v.noise[c],d+=_.width[c],E[f++]=O/m[x++],O=v.noise_log[c];else{var a=A(R);if(n=_.width[c]>>1,d+_.width[c]>_.max_nonzero_coeff){var l;l=_.max_nonzero_coeff-d+1,l>0?n=l>>1:n=0}var g=new k(d);O=this.calc_noise_core(_,g,n,a),d=g.s,v!=null&&(v.step[c]=R,v.noise[c]=O),O=E[f++]=O/m[x++],O=ma.FAST_LOG10(Math.max(O,1e-20)),v!=null&&(v.noise_log[c]=O)}if(v!=null&&(v.global_gain=_.global_gain),r+=O,O>0){var H;H=Math.max(0|O*10+.5,1),e.over_SSD+=H*H,s++,h+=O}t=Math.max(t,O)}return e.over_count=s,e.tot_noise=r,e.over_noise=h,e.max_noise=t,s},this.set_pinfo=function(_,m,E,e,v){var f=_.internal_flags,x,c,n,s,h,r=m.scalefac_scale==0?.5:1,t=m.scalefac,d=u0(L3Side.SFBMAX),o=u0(L3Side.SFBMAX),F=new CalcNoiseResult;calc_xmin(_,E,m,d),calc_noise(m,d,o,F,null);var R=0;for(c=m.sfb_lmax,m.block_type!=je.SHORT_TYPE&&m.mixed_block_flag==0&&(c=22),x=0;x<c;x++){var O=f.scalefac_band.l[x],a=f.scalefac_band.l[x+1],l=a-O;for(s=0;R<a;R++)s+=m.xr[R]*m.xr[R];s/=l,h=1e15,f.pinfo.en[e][v][x]=h*s,f.pinfo.xfsf[e][v][x]=h*d[x]*o[x]/l,E.en.l[x]>0&&!_.ATHonly?s=s/E.en.l[x]:s=0,f.pinfo.thr[e][v][x]=h*Math.max(s*E.thm.l[x],f.ATH.l[x]),f.pinfo.LAMEsfb[e][v][x]=0,m.preflag!=0&&x>=11&&(f.pinfo.LAMEsfb[e][v][x]=-r*P[x]),x<je.SBPSY_l&&(Qt(t[x]>=0),f.pinfo.LAMEsfb[e][v][x]-=r*t[x])}if(m.block_type==je.SHORT_TYPE)for(c=x,x=m.sfb_smin;x<je.SBMAX_s;x++)for(var O=f.scalefac_band.s[x],a=f.scalefac_band.s[x+1],l=a-O,g=0;g<3;g++){for(s=0,n=O;n<a;n++)s+=m.xr[R]*m.xr[R],R++;s=Math.max(s/l,1e-20),h=1e15,f.pinfo.en_s[e][v][3*x+g]=h*s,f.pinfo.xfsf_s[e][v][3*x+g]=h*d[c]*o[c]/l,E.en.s[x][g]>0?s=s/E.en.s[x][g]:s=0,(_.ATHonly||_.ATHshort)&&(s=0),f.pinfo.thr_s[e][v][3*x+g]=h*Math.max(s*E.thm.s[x][g],f.ATH.s[x]),f.pinfo.LAMEsfb_s[e][v][3*x+g]=-2*m.subblock_gain[g],x<je.SBPSY_s&&(f.pinfo.LAMEsfb_s[e][v][3*x+g]-=r*t[c]),c++}f.pinfo.LAMEqss[e][v]=m.global_gain,f.pinfo.LAMEmainbits[e][v]=m.part2_3_length+m.part2_length,f.pinfo.LAMEsfbits[e][v]=m.part2_length,f.pinfo.over[e][v]=F.over_count,f.pinfo.max_noise[e][v]=F.max_noise*10,f.pinfo.over_noise[e][v]=F.over_noise*10,f.pinfo.tot_noise[e][v]=F.tot_noise*10,f.pinfo.over_SSD[e][v]=F.over_SSD}}var Ri=Lt,At=He,Fs=At.System;At.VbrMode;At.Float;At.ShortBlock;At.Util;var Vs=At.Arrays;At.new_array_n;At.new_byte;At.new_double;At.new_float;At.new_float_n;var I0=At.new_int;At.new_int_n;var gt=At.assert,Ve=Qe(),Pe=Ia,Ps=Ra,d0=Ri;function Ta(){var p=null;this.qupvt=null,this.setModules=function(n){this.qupvt=n,p=n};function i(n){this.bits=0|n}var u=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function A(n,s,h,r,t,d){var o=.5946/s;for(gt(n>0),n=n>>1;n--!=0;)t[d++]=o>h[r++]?0:1,t[d++]=o>h[r++]?0:1}function w(n,s,h,r,t,d){gt(n>0),n=n>>1;var o=n%2;for(n=n>>1;n--!=0;){var F,R,O,a,l,g,H,se;F=h[r++]*s,R=h[r++]*s,l=0|F,O=h[r++]*s,g=0|R,a=h[r++]*s,H=0|O,F+=p.adj43[l],se=0|a,R+=p.adj43[g],t[d++]=0|F,O+=p.adj43[H],t[d++]=0|R,a+=p.adj43[se],t[d++]=0|O,t[d++]=0|a}if(o!=0){var F,R,l,g;F=h[r++]*s,R=h[r++]*s,l=0|F,g=0|R,F+=p.adj43[l],R+=p.adj43[g],t[d++]=0|F,t[d++]=0|R}}function I(n,s,h,r,t){var d,o,F=0,R,O=0,a=0,l=0,g=s,H=0,se=g,oe=0,re=n,le=0;for(R=t!=null&&r.global_gain==t.global_gain,r.block_type==Ve.SHORT_TYPE?o=38:o=21,d=0;d<=o;d++){var be=-1;if((R||r.block_type==Ve.NORM_TYPE)&&(be=r.global_gain-(r.scalefac[d]+(r.preflag!=0?p.pretab[d]:0)<<r.scalefac_scale+1)-r.subblock_gain[r.window[d]]*8),gt(r.width[d]>=0),R&&t.step[d]==be)O!=0&&(w(O,h,re,le,se,oe),O=0),a!=0&&(A(a,h,re,le,se,oe),a=0);else{var ce=r.width[d];if(F+r.width[d]>r.max_nonzero_coeff){var ne;ne=r.max_nonzero_coeff-F+1,Vs.fill(s,r.max_nonzero_coeff,576,0),ce=ne,ce<0&&(ce=0),d=o+1}if(O==0&&a==0&&(se=g,oe=H,re=n,le=l),t!=null&&t.sfb_count1>0&&d>=t.sfb_count1&&t.step[d]>0&&be>=t.step[d]?(O!=0&&(w(O,h,re,le,se,oe),O=0,se=g,oe=H,re=n,le=l),a+=ce):(a!=0&&(A(a,h,re,le,se,oe),a=0,se=g,oe=H,re=n,le=l),O+=ce),ce<=0){a!=0&&(A(a,h,re,le,se,oe),a=0),O!=0&&(w(O,h,re,le,se,oe),O=0);break}}d<=o&&(H+=r.width[d],l+=r.width[d],F+=r.width[d])}O!=0&&(w(O,h,re,le,se,oe),O=0),a!=0&&(A(a,h,re,le,se,oe),a=0)}function B(n,s,h){var r=0,t=0;do{var d=n[s++],o=n[s++];r<d&&(r=d),t<o&&(t=o)}while(s<h);return r<t&&(r=t),r}function L(n,s,h,r,t,d){var o=Pe.ht[r].xlen*65536+Pe.ht[t].xlen,F=0,R;do{var O=n[s++],a=n[s++];O!=0&&(O>14&&(O=15,F+=o),O*=16),a!=0&&(a>14&&(a=15,F+=o),O+=a),F+=Pe.largetbl[O]}while(s<h);return R=F&65535,F>>=16,F>R&&(F=R,r=t),d.bits+=F,r}function V(n,s,h,r){var t=0,d=Pe.ht[1].hlen;do{var o=n[s+0]*2+n[s+1];s+=2,t+=d[o]}while(s<h);return r.bits+=t,1}function T(n,s,h,r,t){var d=0,o,F=Pe.ht[r].xlen,R;r==2?R=Pe.table23:R=Pe.table56;do{var O=n[s+0]*F+n[s+1];s+=2,d+=R[O]}while(s<h);return o=d&65535,d>>=16,d>o&&(d=o,r++),t.bits+=d,r}function P(n,s,h,r,t){var d=0,o=0,F=0,R=Pe.ht[r].xlen,O=Pe.ht[r].hlen,a=Pe.ht[r+1].hlen,l=Pe.ht[r+2].hlen;do{var g=n[s+0]*R+n[s+1];s+=2,d+=O[g],o+=a[g],F+=l[g]}while(s<h);var H=r;return d>o&&(d=o,H++),d>F&&(d=F,H=r+2),t.bits+=d,H}var y=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function G(n,s,h,r){var t=B(n,s,h);switch(t){case 0:return t;case 1:return V(n,s,h,r);case 2:case 3:return T(n,s,h,y[t-1],r);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return P(n,s,h,y[t-1],r);default:if(t>d0.IXMAX_VAL)return r.bits=d0.LARGE_BITS,-1;t-=15;var d;for(d=24;d<32&&!(Pe.ht[d].linmax>=t);d++);var o;for(o=d-8;o<24&&!(Pe.ht[o].linmax>=t);o++);return L(n,s,h,o,d,r)}}this.noquant_count_bits=function(n,s,h){var r=s.l3_enc,t=Math.min(576,s.max_nonzero_coeff+2>>1<<1);for(h!=null&&(h.sfb_count1=0);t>1&&!(r[t-1]|r[t-2]);t-=2);s.count1=t;for(var d=0,o=0;t>3;t-=4){var F;if(((r[t-1]|r[t-2]|r[t-3]|r[t-4])&2147483647)>1)break;F=((r[t-4]*2+r[t-3])*2+r[t-2])*2+r[t-1],d+=Pe.t32l[F],o+=Pe.t33l[F]}var R=d;if(s.count1table_select=0,d>o&&(R=o,s.count1table_select=1),s.count1bits=R,s.big_values=t,t==0)return R;if(s.block_type==Ve.SHORT_TYPE)d=3*n.scalefac_band.s[3],d>s.big_values&&(d=s.big_values),o=s.big_values;else if(s.block_type==Ve.NORM_TYPE){if(gt(t<=576),d=s.region0_count=n.bv_scf[t-2],o=s.region1_count=n.bv_scf[t-1],gt(d+o+2<Ve.SBPSY_l),o=n.scalefac_band.l[d+o+2],d=n.scalefac_band.l[d+1],o<t){var O=new i(R);s.table_select[2]=G(r,o,t,O),R=O.bits}}else s.region0_count=7,s.region1_count=Ve.SBMAX_l-1-7-1,d=n.scalefac_band.l[7+1],o=t,d>o&&(d=o);if(d=Math.min(d,t),o=Math.min(o,t),gt(d>=0),gt(o>=0),0<d){var O=new i(R);s.table_select[0]=G(r,0,d,O),R=O.bits}if(d<o){var O=new i(R);s.table_select[1]=G(r,d,o,O),R=O.bits}if(n.use_best_huffman==2&&(s.part2_3_length=R,best_huffman_divide(n,s),R=s.part2_3_length),h!=null&&s.block_type==Ve.NORM_TYPE){for(var a=0;n.scalefac_band.l[a]<s.big_values;)a++;h.sfb_count1=a}return R},this.count_bits=function(n,s,h,r){var t=h.l3_enc,d=d0.IXMAX_VAL/p.IPOW20(h.global_gain);if(h.xrpow_max>d)return d0.LARGE_BITS;if(I(s,t,p.IPOW20(h.global_gain),h,r),n.substep_shaping&2)for(var o=0,F=h.global_gain+h.scalefac_scale,R=.634521682242439/p.IPOW20(F),O=0;O<h.sfbmax;O++){var a=h.width[O];if(gt(a>=0),n.pseudohalf[O]==0)o+=a;else{var l;for(l=o,o+=a;l<o;++l)t[l]=s[l]>=R?t[l]:0}}return this.noquant_count_bits(n,h,r)};function Y(n,s,h,r,t,d,o){for(var F=s.big_values,R=0;R<=7+15;R++)r[R]=d0.LARGE_BITS;for(var R=0;R<16;R++){var O=n.scalefac_band.l[R+1];if(O>=F)break;var a=0,l=new i(a),g=G(h,0,O,l);a=l.bits;for(var H=0;H<8;H++){var se=n.scalefac_band.l[R+H+2];if(se>=F)break;var oe=a;l=new i(oe);var re=G(h,O,se,l);oe=l.bits,r[R+H]>oe&&(r[R+H]=oe,t[R+H]=R,d[R+H]=g,o[R+H]=re)}}}function K(n,s,h,r,t,d,o,F){for(var R=s.big_values,O=2;O<Ve.SBMAX_l+1;O++){var a=n.scalefac_band.l[O];if(a>=R)break;var l=t[O-2]+s.count1bits;if(h.part2_3_length<=l)break;var g=new i(l),H=G(r,a,R,g);l=g.bits,!(h.part2_3_length<=l)&&(h.assign(s),h.part2_3_length=l,h.region0_count=d[O-2],h.region1_count=O-2-d[O-2],h.table_select[0]=o[O-2],h.table_select[1]=F[O-2],h.table_select[2]=H)}}this.best_huffman_divide=function(n,s){var h=new Ps,r=s.l3_enc,t=I0(7+15+1),d=I0(7+15+1),o=I0(7+15+1),F=I0(7+15+1);if(!(s.block_type==Ve.SHORT_TYPE&&n.mode_gr==1)){h.assign(s),s.block_type==Ve.NORM_TYPE&&(Y(n,s,r,t,d,o,F),K(n,h,s,r,t,d,o,F));var R=h.big_values;if(!(R==0||(r[R-2]|r[R-1])>1)&&(R=s.count1+2,!(R>576))){h.assign(s),h.count1=R;var O=0,a=0;for(gt(R<=576);R>h.big_values;R-=4){var l=((r[R-4]*2+r[R-3])*2+r[R-2])*2+r[R-1];O+=Pe.t32l[l],a+=Pe.t33l[l]}if(h.big_values=R,h.count1table_select=0,O>a&&(O=a,h.count1table_select=1),h.count1bits=O,h.block_type==Ve.NORM_TYPE)K(n,h,s,r,t,d,o,F);else{if(h.part2_3_length=O,O=n.scalefac_band.l[7+1],O>R&&(O=R),O>0){var g=new i(h.part2_3_length);h.table_select[0]=G(r,0,O,g),h.part2_3_length=g.bits}if(R>O){var g=new i(h.part2_3_length);h.table_select[1]=G(r,O,R,g),h.part2_3_length=g.bits}s.part2_3_length>h.part2_3_length&&s.assign(h)}}}};var D=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],U=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],k=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],_=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];Ta.slen1_tab=k,Ta.slen2_tab=_;function m(n,s){for(var h,r=s.tt[1][n],t=s.tt[0][n],d=0;d<Pe.scfsi_band.length-1;d++){for(h=Pe.scfsi_band[d];h<Pe.scfsi_band[d+1]&&!(t.scalefac[h]!=r.scalefac[h]&&r.scalefac[h]>=0);h++);if(h==Pe.scfsi_band[d+1]){for(h=Pe.scfsi_band[d];h<Pe.scfsi_band[d+1];h++)r.scalefac[h]=-1;s.scfsi[n][d]=1}}var o=0,F=0;for(h=0;h<11;h++)r.scalefac[h]!=-1&&(F++,o<r.scalefac[h]&&(o=r.scalefac[h]));for(var R=0,O=0;h<Ve.SBPSY_l;h++)r.scalefac[h]!=-1&&(O++,R<r.scalefac[h]&&(R=r.scalefac[h]));for(var d=0;d<16;d++)if(o<D[d]&&R<U[d]){var a=k[d]*F+_[d]*O;r.part2_length>a&&(r.part2_length=a,r.scalefac_compress=d)}}this.best_scalefac_store=function(n,s,h,r){var t=r.tt[s][h],d,o,F,R,O=0;for(F=0,d=0;d<t.sfbmax;d++){var a=t.width[d];for(gt(a>=0),F+=a,R=-a;R<0&&t.l3_enc[R+F]==0;R++);R==0&&(t.scalefac[d]=O=-2)}if(t.scalefac_scale==0&&t.preflag==0){var l=0;for(d=0;d<t.sfbmax;d++)t.scalefac[d]>0&&(l|=t.scalefac[d]);if(!(l&1)&&l!=0){for(d=0;d<t.sfbmax;d++)t.scalefac[d]>0&&(t.scalefac[d]>>=1);t.scalefac_scale=O=1}}if(t.preflag==0&&t.block_type!=Ve.SHORT_TYPE&&n.mode_gr==2){for(d=11;d<Ve.SBPSY_l&&!(t.scalefac[d]<p.pretab[d]&&t.scalefac[d]!=-2);d++);if(d==Ve.SBPSY_l){for(d=11;d<Ve.SBPSY_l;d++)t.scalefac[d]>0&&(t.scalefac[d]-=p.pretab[d]);t.preflag=O=1}}for(o=0;o<4;o++)r.scfsi[h][o]=0;for(n.mode_gr==2&&s==1&&r.tt[0][h].block_type!=Ve.SHORT_TYPE&&r.tt[1][h].block_type!=Ve.SHORT_TYPE&&(m(h,r),O=0),d=0;d<t.sfbmax;d++)t.scalefac[d]==-2&&(t.scalefac[d]=0);O!=0&&(n.mode_gr==2?this.scale_bitcount(t):this.scale_bitcount_lsf(n,t))};function E(n,s){for(var h=0;h<s;++h)if(n[h]<0)return!1;return!0}var e=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],v=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],f=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(n){var s,h,r=0,t=0,d,o=n.scalefac;if(gt(E(o,n.sfbmax)),n.block_type==Ve.SHORT_TYPE)d=e,n.mixed_block_flag!=0&&(d=v);else if(d=f,n.preflag==0){for(h=11;h<Ve.SBPSY_l&&!(o[h]<p.pretab[h]);h++);if(h==Ve.SBPSY_l)for(n.preflag=1,h=11;h<Ve.SBPSY_l;h++)o[h]-=p.pretab[h]}for(h=0;h<n.sfbdivide;h++)r<o[h]&&(r=o[h]);for(;h<n.sfbmax;h++)t<o[h]&&(t=o[h]);for(n.part2_length=d0.LARGE_BITS,s=0;s<16;s++)r<D[s]&&t<U[s]&&n.part2_length>d[s]&&(n.part2_length=d[s],n.scalefac_compress=s);return n.part2_length==d0.LARGE_BITS};var x=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(n,s){var h,r,t,d,o,F,R,O,a=I0(4),l=s.scalefac;for(s.preflag!=0?h=2:h=0,R=0;R<4;R++)a[R]=0;if(s.block_type==Ve.SHORT_TYPE){r=1;var g=p.nr_of_sfb_block[h][r];for(O=0,t=0;t<4;t++)for(d=g[t]/3,R=0;R<d;R++,O++)for(o=0;o<3;o++)l[O*3+o]>a[t]&&(a[t]=l[O*3+o])}else{r=0;var g=p.nr_of_sfb_block[h][r];for(O=0,t=0;t<4;t++)for(d=g[t],R=0;R<d;R++,O++)l[O]>a[t]&&(a[t]=l[O])}for(F=!1,t=0;t<4;t++)a[t]>x[h][t]&&(F=!0);if(!F){var H,se,oe,re;for(s.sfb_partition_table=p.nr_of_sfb_block[h][r],t=0;t<4;t++)s.slen[t]=c[a[t]];switch(H=s.slen[0],se=s.slen[1],oe=s.slen[2],re=s.slen[3],h){case 0:s.scalefac_compress=(H*5+se<<4)+(oe<<2)+re;break;case 1:s.scalefac_compress=400+(H*5+se<<2)+oe;break;case 2:s.scalefac_compress=500+H*3+se;break;default:Fs.err.printf(`intensity stereo not implemented yet
`);break}}if(!F)for(gt(s.sfb_partition_table!=null),s.part2_length=0,t=0;t<4;t++)s.part2_length+=s.slen[t]*s.sfb_partition_table[t];return F};var c=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(n){for(var s=2;s<=576;s+=2){for(var h=0,r;n.scalefac_band.l[++h]<s;);for(r=u[h][0];n.scalefac_band.l[r+1]>s;)r--;for(r<0&&(r=u[h][0]),n.bv_scf[s-2]=r,r=u[h][1];n.scalefac_band.l[r+n.bv_scf[s-2]+2]>s;)r--;r<0&&(r=u[h][1]),n.bv_scf[s-1]=r}}}var Ii=Ta,Et=He,Ut=Et.System;Et.VbrMode;Et.Float;Et.ShortBlock;Et.Util;var qs=Et.Arrays;Et.new_array_n;var Ds=Et.new_byte;Et.new_double;Et.new_float;var Xs=Et.new_float_n,Ys=Et.new_int;Et.new_int_n;var Se=Et.assert,ii=Ii,fa=Ia,Y0=Qe(),v0=Q0;K0.EQ=function(p,i){return Math.abs(p)>Math.abs(i)?Math.abs(p-i)<=Math.abs(p)*1e-6:Math.abs(p-i)<=Math.abs(i)*1e-6};K0.NEQ=function(p,i){return!K0.EQ(p,i)};function K0(){var p=this,i=32773,u=32,A=null,w=null,I=null,B=null;this.setModules=function(c,n,s,h){A=c,w=n,I=s,B=h};var L=null,V=0,T=0,P=0;this.getframebits=function(c){var n=c.internal_flags,s;n.bitrate_index!=0?s=fa.bitrate_table[c.version][n.bitrate_index]:s=c.brate,Se(8<=s&&s<=640);var h=0|(c.version+1)*72e3*s/c.out_samplerate+n.padding;return 8*h};function y(c){Ut.arraycopy(c.header[c.w_ptr].buf,0,L,T,c.sideinfo_len),T+=c.sideinfo_len,V+=c.sideinfo_len*8,c.w_ptr=c.w_ptr+1&v0.MAX_HEADER_BUF-1}function G(c,n,s){for(Se(s<u-2);s>0;){var h;P==0&&(P=8,T++,Se(T<Lame.LAME_MAXMP3BUFFER),Se(c.header[c.w_ptr].write_timing>=V),c.header[c.w_ptr].write_timing==V&&y(c),L[T]=0),h=Math.min(s,P),s-=h,P-=h,Se(s<u),Se(P<u),L[T]|=n>>s<<P,V+=h}}function Y(c,n,s){for(Se(s<u-2);s>0;){var h;P==0&&(P=8,T++,Se(T<Lame.LAME_MAXMP3BUFFER),L[T]=0),h=Math.min(s,P),s-=h,P-=h,Se(s<u),Se(P<u),L[T]|=n>>s<<P,V+=h}}function K(c,n){var s=c.internal_flags,h;if(Se(n>=0),n>=8&&(G(s,76,8),n-=8),n>=8&&(G(s,65,8),n-=8),n>=8&&(G(s,77,8),n-=8),n>=8&&(G(s,69,8),n-=8),n>=32){var r=I.getLameShortVersion();if(n>=32)for(h=0;h<r.length&&n>=8;++h)n-=8,G(s,r.charAt(h),8)}for(;n>=1;n-=1)G(s,s.ancillary_flag,1),s.ancillary_flag^=c.disable_reservoir?0:1;Se(n==0)}function D(c,n,s){for(var h=c.header[c.h_ptr].ptr;s>0;){var r=Math.min(s,8-(h&7));s-=r,Se(s<u),c.header[c.h_ptr].buf[h>>3]|=n>>s<<8-(h&7)-r,h+=r}c.header[c.h_ptr].ptr=h}function U(c,n){c<<=8;for(var s=0;s<8;s++)c<<=1,n<<=1,(n^c)&65536&&(n^=i);return n}this.CRC_writeheader=function(c,n){var s=65535;s=U(n[2]&255,s),s=U(n[3]&255,s);for(var h=6;h<c.sideinfo_len;h++)s=U(n[h]&255,s);n[4]=byte(s>>8),n[5]=byte(s&255)};function k(c,n){var s=c.internal_flags,h,r,t;if(h=s.l3_side,s.header[s.h_ptr].ptr=0,qs.fill(s.header[s.h_ptr].buf,0,s.sideinfo_len,0),c.out_samplerate<16e3?D(s,4094,12):D(s,4095,12),D(s,c.version,1),D(s,4-3,2),D(s,c.error_protection?0:1,1),D(s,s.bitrate_index,4),D(s,s.samplerate_index,2),D(s,s.padding,1),D(s,c.extension,1),D(s,c.mode.ordinal(),2),D(s,s.mode_ext,2),D(s,c.copyright,1),D(s,c.original,1),D(s,c.emphasis,2),c.error_protection&&D(s,0,16),c.version==1){for(Se(h.main_data_begin>=0),D(s,h.main_data_begin,9),s.channels_out==2?D(s,h.private_bits,3):D(s,h.private_bits,5),t=0;t<s.channels_out;t++){var d;for(d=0;d<4;d++)D(s,h.scfsi[t][d],1)}for(r=0;r<2;r++)for(t=0;t<s.channels_out;t++){var o=h.tt[r][t];D(s,o.part2_3_length+o.part2_length,12),D(s,o.big_values/2,9),D(s,o.global_gain,8),D(s,o.scalefac_compress,4),o.block_type!=Y0.NORM_TYPE?(D(s,1,1),D(s,o.block_type,2),D(s,o.mixed_block_flag,1),o.table_select[0]==14&&(o.table_select[0]=16),D(s,o.table_select[0],5),o.table_select[1]==14&&(o.table_select[1]=16),D(s,o.table_select[1],5),D(s,o.subblock_gain[0],3),D(s,o.subblock_gain[1],3),D(s,o.subblock_gain[2],3)):(D(s,0,1),o.table_select[0]==14&&(o.table_select[0]=16),D(s,o.table_select[0],5),o.table_select[1]==14&&(o.table_select[1]=16),D(s,o.table_select[1],5),o.table_select[2]==14&&(o.table_select[2]=16),D(s,o.table_select[2],5),Se(0<=o.region0_count&&o.region0_count<16),Se(0<=o.region1_count&&o.region1_count<8),D(s,o.region0_count,4),D(s,o.region1_count,3)),D(s,o.preflag,1),D(s,o.scalefac_scale,1),D(s,o.count1table_select,1)}}else for(Se(h.main_data_begin>=0),D(s,h.main_data_begin,8),D(s,h.private_bits,s.channels_out),r=0,t=0;t<s.channels_out;t++){var o=h.tt[r][t];D(s,o.part2_3_length+o.part2_length,12),D(s,o.big_values/2,9),D(s,o.global_gain,8),D(s,o.scalefac_compress,9),o.block_type!=Y0.NORM_TYPE?(D(s,1,1),D(s,o.block_type,2),D(s,o.mixed_block_flag,1),o.table_select[0]==14&&(o.table_select[0]=16),D(s,o.table_select[0],5),o.table_select[1]==14&&(o.table_select[1]=16),D(s,o.table_select[1],5),D(s,o.subblock_gain[0],3),D(s,o.subblock_gain[1],3),D(s,o.subblock_gain[2],3)):(D(s,0,1),o.table_select[0]==14&&(o.table_select[0]=16),D(s,o.table_select[0],5),o.table_select[1]==14&&(o.table_select[1]=16),D(s,o.table_select[1],5),o.table_select[2]==14&&(o.table_select[2]=16),D(s,o.table_select[2],5),Se(0<=o.region0_count&&o.region0_count<16),Se(0<=o.region1_count&&o.region1_count<8),D(s,o.region0_count,4),D(s,o.region1_count,3)),D(s,o.scalefac_scale,1),D(s,o.count1table_select,1)}c.error_protection&&CRC_writeheader(s,s.header[s.h_ptr].buf);{var F=s.h_ptr;Se(s.header[F].ptr==s.sideinfo_len*8),s.h_ptr=F+1&v0.MAX_HEADER_BUF-1,s.header[s.h_ptr].write_timing=s.header[F].write_timing+n,s.h_ptr==s.w_ptr&&Ut.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function _(c,n){var s=fa.ht[n.count1table_select+32],h,r=0,t=n.big_values,d=n.big_values;for(Se(n.count1table_select<2),h=(n.count1-n.big_values)/4;h>0;--h){var o=0,F=0,R;R=n.l3_enc[t+0],R!=0&&(F+=8,n.xr[d+0]<0&&o++,Se(R<=1)),R=n.l3_enc[t+1],R!=0&&(F+=4,o*=2,n.xr[d+1]<0&&o++,Se(R<=1)),R=n.l3_enc[t+2],R!=0&&(F+=2,o*=2,n.xr[d+2]<0&&o++,Se(R<=1)),R=n.l3_enc[t+3],R!=0&&(F++,o*=2,n.xr[d+3]<0&&o++,Se(R<=1)),t+=4,d+=4,G(c,o+s.table[F],s.hlen[F]),r+=s.hlen[F]}return r}function m(c,n,s,h,r){var t=fa.ht[n],d=0;if(Se(n<32),n==0)return d;for(var o=s;o<h;o+=2){var F=0,R=0,O=t.xlen,a=t.xlen,l=0,g=r.l3_enc[o],H=r.l3_enc[o+1];if(g!=0&&(r.xr[o]<0&&l++,F--),n>15){if(g>14){var se=g-15;Se(se<=t.linmax),l|=se<<1,R=O,g=15}if(H>14){var oe=H-15;Se(oe<=t.linmax),l<<=O,l|=oe,R+=O,H=15}a=16}H!=0&&(l<<=1,r.xr[o+1]<0&&l++,F--),Se((g|H)<16),g=g*a+H,R-=F,F+=t.hlen[g],Se(F<=u),Se(R<=u),G(c,t.table[g],F),G(c,l,R),d+=F+R}return d}function E(c,n){var s=3*c.scalefac_band.s[3];s>n.big_values&&(s=n.big_values);var h=m(c,n.table_select[0],0,s,n);return h+=m(c,n.table_select[1],s,n.big_values,n),h}function e(c,n){var s,h,r,t;s=n.big_values,Se(0<=s&&s<=576);var d=n.region0_count+1;return Se(0<=d),Se(d<c.scalefac_band.l.length),r=c.scalefac_band.l[d],d+=n.region1_count+1,Se(0<=d),Se(d<c.scalefac_band.l.length),t=c.scalefac_band.l[d],r>s&&(r=s),t>s&&(t=s),h=m(c,n.table_select[0],0,r,n),h+=m(c,n.table_select[1],r,t,n),h+=m(c,n.table_select[2],t,s,n),h}function v(c){var n,s,h,r,t=0,d=c.internal_flags,o=d.l3_side;if(c.version==1)for(n=0;n<2;n++)for(s=0;s<d.channels_out;s++){var F=o.tt[n][s],R=ii.slen1_tab[F.scalefac_compress],O=ii.slen2_tab[F.scalefac_compress];for(r=0,h=0;h<F.sfbdivide;h++)F.scalefac[h]!=-1&&(G(d,F.scalefac[h],R),r+=R);for(;h<F.sfbmax;h++)F.scalefac[h]!=-1&&(G(d,F.scalefac[h],O),r+=O);Se(r==F.part2_length),F.block_type==Y0.SHORT_TYPE?r+=E(d,F):r+=e(d,F),r+=_(d,F),Se(r==F.part2_3_length+F.part2_length),t+=r}else for(n=0,s=0;s<d.channels_out;s++){var F=o.tt[n][s],a,l,g=0;if(Se(F.sfb_partition_table!=null),r=0,h=0,l=0,F.block_type==Y0.SHORT_TYPE){for(;l<4;l++){var H=F.sfb_partition_table[l]/3,se=F.slen[l];for(a=0;a<H;a++,h++)G(d,Math.max(F.scalefac[h*3+0],0),se),G(d,Math.max(F.scalefac[h*3+1],0),se),G(d,Math.max(F.scalefac[h*3+2],0),se),g+=3*se}r+=E(d,F)}else{for(;l<4;l++){var H=F.sfb_partition_table[l],se=F.slen[l];for(a=0;a<H;a++,h++)G(d,Math.max(F.scalefac[h],0),se),g+=se}r+=e(d,F)}r+=_(d,F),Se(r==F.part2_3_length),Se(g==F.part2_length),t+=g+r}return t}function f(){this.total=0}function x(c,n){var s=c.internal_flags,h,r,t,d,o;return o=s.w_ptr,d=s.h_ptr-1,d==-1&&(d=v0.MAX_HEADER_BUF-1),h=s.header[d].write_timing-V,n.total=h,h>=0&&(r=1+d-o,d<o&&(r=1+d-o+v0.MAX_HEADER_BUF),h-=r*8*s.sideinfo_len),t=p.getframebits(c),h+=t,n.total+=t,n.total%8!=0?n.total=1+n.total/8:n.total=n.total/8,n.total+=T+1,h<0&&Ut.err.println(`strange error flushing buffer ... 
`),h}this.flush_bitstream=function(c){var n=c.internal_flags,s,h,r=n.h_ptr-1;if(r==-1&&(r=v0.MAX_HEADER_BUF-1),s=n.l3_side,!((h=x(c,new f))<0)){if(K(c,h),Se(n.header[r].write_timing+this.getframebits(c)==V),n.ResvSize=0,s.main_data_begin=0,n.findReplayGain){var t=A.GetTitleGain(n.rgdata);Se(NEQ(t,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),n.RadioGain=Math.floor(t*10+.5)|0}n.findPeakSample&&(n.noclipGainChange=Math.ceil(Math.log10(n.PeakSample/32767)*20*10)|0,n.noclipGainChange>0&&(EQ(c.scale,1)||EQ(c.scale,0))?n.noclipScale=Math.floor(32767/n.PeakSample*100)/100:n.noclipScale=-1)}},this.add_dummy_byte=function(c,n,s){for(var h=c.internal_flags,r;s-- >0;)for(Y(h,n,8),r=0;r<v0.MAX_HEADER_BUF;++r)h.header[r].write_timing+=8},this.format_bitstream=function(c){var n=c.internal_flags,s;s=n.l3_side;var h=this.getframebits(c);K(c,s.resvDrain_pre),k(c,h);var r=8*n.sideinfo_len;if(r+=v(c),K(c,s.resvDrain_post),r+=s.resvDrain_post,s.main_data_begin+=(h-r)/8,x(c,new f)!=n.ResvSize&&Ut.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),s.main_data_begin*8!=n.ResvSize&&(Ut.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*s.main_data_begin,n.ResvSize,s.resvDrain_post,s.resvDrain_pre,8*n.sideinfo_len,r-s.resvDrain_post-8*n.sideinfo_len,r,r%8,h),Ut.err.println("This is a fatal error.  It has several possible causes:"),Ut.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),Ut.err.println(" 9%%  Your system is overclocked"),Ut.err.println(" 1%%  bug in LAME encoding library"),n.ResvSize=s.main_data_begin*8),Se(V%8==0),V>1e9){var t;for(t=0;t<v0.MAX_HEADER_BUF;++t)n.header[t].write_timing-=V;V=0}return 0},this.copy_buffer=function(c,n,s,h,r){var t=T+1;if(t<=0)return 0;if(h!=0&&t>h)return-1;if(Ut.arraycopy(L,0,n,s,t),T=-1,P=0,r!=0){var d=Ys(1);if(d[0]=c.nMusicCRC,B.updateMusicCRC(d,n,s,t),c.nMusicCRC=d[0],t>0&&(c.VBR_seek_table.nBytesWritten+=t),c.decode_on_the_fly){for(var o=Xs([2,1152]),F=t,R=-1,O;R!=0;)if(R=w.hip_decode1_unclipped(c.hip,n,s,F,o[0],o[1]),F=0,R==-1&&(R=0),R>0){if(Se(R<=1152),c.findPeakSample){for(O=0;O<R;O++)o[0][O]>c.PeakSample?c.PeakSample=o[0][O]:-o[0][O]>c.PeakSample&&(c.PeakSample=-o[0][O]);if(c.channels_out>1)for(O=0;O<R;O++)o[1][O]>c.PeakSample?c.PeakSample=o[1][O]:-o[1][O]>c.PeakSample&&(c.PeakSample=-o[1][O])}if(c.findReplayGain&&A.AnalyzeSamples(c.rgdata,o[0],0,o[1],0,R,c.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return t},this.init_bit_stream_w=function(c){L=Ds(Lame.LAME_MAXMP3BUFFER),c.h_ptr=c.w_ptr=0,c.header[c.h_ptr].write_timing=0,T=-1,P=0,V=0}}var Ca=K0;const Gs=Ma(Ca);var et=He,$s=et.System,Ce=et.VbrMode;et.Float;var pa=et.ShortBlock;et.Util;et.Arrays;et.new_array_n;et.new_byte;et.new_double;var m0=et.new_float;et.new_float_n;et.new_int;var si=et.new_int_n,Us=et.new_short_n,Ct=et.assert,ba=zi,Ks=as,C0=Q0,Zs=Ts,js=Bs,Ws=Ns,f0=Ca,Kt=Ia,De=Qe();function Ue(){var p=this,i=128*1024;Ue.V9=410,Ue.V8=420,Ue.V7=430,Ue.V6=440,Ue.V5=450,Ue.V4=460,Ue.V3=470,Ue.V2=480,Ue.V1=490,Ue.V0=500,Ue.R3MIX=1e3,Ue.STANDARD=1001,Ue.EXTREME=1002,Ue.INSANE=1003,Ue.STANDARD_FAST=1004,Ue.EXTREME_FAST=1005,Ue.MEDIUM=1006,Ue.MEDIUM_FAST=1007;var u=16384+i;Ue.LAME_MAXMP3BUFFER=u;var A,w,I,B,L,V=new ba,T,P,y;this.enc=new De,this.setModules=function(a,l,g,H,se,oe,re,le,be){A=a,w=l,I=g,B=H,L=se,T=oe,P=le,y=be,this.enc.setModules(w,V,B,T)};function G(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=m0(De.SBMAX_l),this.bo_s_weight=m0(De.SBMAX_s)}function Y(){this.lowerlimit=0}function K(a,l){this.lowpass=l}var D=4294479419;function U(a){var l;return a.class_id=D,l=a.internal_flags=new C0,a.mode=MPEGMode.NOT_SET,a.original=1,a.in_samplerate=44100,a.num_channels=2,a.num_samples=-1,a.bWriteVbrTag=!0,a.quality=-1,a.short_blocks=null,l.subblock_gain=-1,a.lowpassfreq=0,a.highpassfreq=0,a.lowpasswidth=-1,a.highpasswidth=-1,a.VBR=Ce.vbr_off,a.VBR_q=4,a.ATHcurve=-1,a.VBR_mean_bitrate_kbps=128,a.VBR_min_bitrate_kbps=0,a.VBR_max_bitrate_kbps=0,a.VBR_hard_min=0,l.VBR_min_bitrate=1,l.VBR_max_bitrate=13,a.quant_comp=-1,a.quant_comp_short=-1,a.msfix=-1,l.resample_ratio=1,l.OldValue[0]=180,l.OldValue[1]=180,l.CurrentStep[0]=4,l.CurrentStep[1]=4,l.masking_lower=1,l.nsPsy.attackthre=-1,l.nsPsy.attackthre_s=-1,a.scale=-1,a.athaa_type=-1,a.ATHtype=-1,a.athaa_loudapprox=-1,a.athaa_sensitivity=0,a.useTemporal=null,a.interChRatio=-1,l.mf_samples_to_encode=De.ENCDELAY+De.POSTDELAY,a.encoder_padding=0,l.mf_size=De.ENCDELAY-De.MDCTDELAY,a.findReplayGain=!1,a.decode_on_the_fly=!1,l.decode_on_the_fly=!1,l.findReplayGain=!1,l.findPeakSample=!1,l.RadioGain=0,l.AudiophileGain=0,l.noclipGainChange=0,l.noclipScale=-1,a.preset=0,a.write_id3tag_automatic=!0,0}this.lame_init=function(){var a=new Ks;return U(a),a.lame_allocated_gfp=1,a};function k(a){return a>1?0:a<=0?1:Math.cos(Math.PI/2*a)}this.nearestBitrateFullIndex=function(a){var l=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],g=0,H=0,se=0,oe=0;oe=l[16],se=16,H=l[16],g=16;for(var re=0;re<16;re++)if(Math.max(a,l[re+1])!=a){oe=l[re+1],se=re+1,H=l[re],g=re;break}return oe-a>a-H?g:se};function _(a,l){var g=44100;return l>=48e3?g=48e3:l>=44100?g=44100:l>=32e3?g=32e3:l>=24e3?g=24e3:l>=22050?g=22050:l>=16e3?g=16e3:l>=12e3?g=12e3:l>=11025?g=11025:l>=8e3&&(g=8e3),a==-1?g:(a<=15960&&(g=44100),a<=15250&&(g=32e3),a<=11220&&(g=24e3),a<=9970&&(g=22050),a<=7230&&(g=16e3),a<=5420&&(g=12e3),a<=4510&&(g=11025),a<=3970&&(g=8e3),l<g?l>44100?48e3:l>32e3?44100:l>24e3?32e3:l>22050?24e3:l>16e3?22050:l>12e3?16e3:l>11025?12e3:l>8e3?11025:8e3:g)}function m(a,l){switch(a){case 44100:return l.version=1,0;case 48e3:return l.version=1,1;case 32e3:return l.version=1,2;case 22050:return l.version=0,0;case 24e3:return l.version=0,1;case 16e3:return l.version=0,2;case 11025:return l.version=0,0;case 12e3:return l.version=0,1;case 8e3:return l.version=0,2;default:return l.version=0,-1}}function E(a,l,g){g<16e3&&(l=2);for(var H=Kt.bitrate_table[l][1],se=2;se<=14;se++)Kt.bitrate_table[l][se]>0&&Math.abs(Kt.bitrate_table[l][se]-a)<Math.abs(H-a)&&(H=Kt.bitrate_table[l][se]);return H}function e(a,l,g){g<16e3&&(l=2);for(var H=0;H<=14;H++)if(Kt.bitrate_table[l][H]>0&&Kt.bitrate_table[l][H]==a)return H;return-1}function v(a,l){var g=[new K(8,2e3),new K(16,3700),new K(24,3900),new K(32,5500),new K(40,7e3),new K(48,7500),new K(56,1e4),new K(64,11e3),new K(80,13500),new K(96,15100),new K(112,15600),new K(128,17e3),new K(160,17500),new K(192,18600),new K(224,19400),new K(256,19700),new K(320,20500)],H=p.nearestBitrateFullIndex(l);a.lowerlimit=g[H].lowpass}function f(a){var l=a.internal_flags,g=32,H=-1;if(l.lowpass1>0){for(var se=999,oe=0;oe<=31;oe++){var re=oe/31;re>=l.lowpass2&&(g=Math.min(g,oe)),l.lowpass1<re&&re<l.lowpass2&&(se=Math.min(se,oe))}se==999?l.lowpass1=(g-.75)/31:l.lowpass1=(se-.75)/31,l.lowpass2=g/31}if(l.highpass2>0&&l.highpass2<.9*(.75/31)&&(l.highpass1=0,l.highpass2=0,$s.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),l.highpass2>0){for(var le=-1,oe=0;oe<=31;oe++){var re=oe/31;re<=l.highpass1&&(H=Math.max(H,oe)),l.highpass1<re&&re<l.highpass2&&(le=Math.max(le,oe))}l.highpass1=H/31,le==-1?l.highpass2=(H+.75)/31:l.highpass2=(le+.75)/31}for(var oe=0;oe<32;oe++){var be,ce,re=oe/31;l.highpass2>l.highpass1?be=k((l.highpass2-re)/(l.highpass2-l.highpass1+1e-20)):be=1,l.lowpass2>l.lowpass1?ce=k((re-l.lowpass1)/(l.lowpass2-l.lowpass1+1e-20)):ce=1,l.amp_filter[oe]=be*ce}}function x(a){var l=a.internal_flags;switch(a.quality){default:case 9:l.psymodel=0,l.noise_shaping=0,l.noise_shaping_amp=0,l.noise_shaping_stop=0,l.use_best_huffman=0,l.full_outer_loop=0;break;case 8:a.quality=7;case 7:l.psymodel=1,l.noise_shaping=0,l.noise_shaping_amp=0,l.noise_shaping_stop=0,l.use_best_huffman=0,l.full_outer_loop=0;break;case 6:l.psymodel=1,l.noise_shaping==0&&(l.noise_shaping=1),l.noise_shaping_amp=0,l.noise_shaping_stop=0,l.subblock_gain==-1&&(l.subblock_gain=1),l.use_best_huffman=0,l.full_outer_loop=0;break;case 5:l.psymodel=1,l.noise_shaping==0&&(l.noise_shaping=1),l.noise_shaping_amp=0,l.noise_shaping_stop=0,l.subblock_gain==-1&&(l.subblock_gain=1),l.use_best_huffman=0,l.full_outer_loop=0;break;case 4:l.psymodel=1,l.noise_shaping==0&&(l.noise_shaping=1),l.noise_shaping_amp=0,l.noise_shaping_stop=0,l.subblock_gain==-1&&(l.subblock_gain=1),l.use_best_huffman=1,l.full_outer_loop=0;break;case 3:l.psymodel=1,l.noise_shaping==0&&(l.noise_shaping=1),l.noise_shaping_amp=1,l.noise_shaping_stop=1,l.subblock_gain==-1&&(l.subblock_gain=1),l.use_best_huffman=1,l.full_outer_loop=0;break;case 2:l.psymodel=1,l.noise_shaping==0&&(l.noise_shaping=1),l.substep_shaping==0&&(l.substep_shaping=2),l.noise_shaping_amp=1,l.noise_shaping_stop=1,l.subblock_gain==-1&&(l.subblock_gain=1),l.use_best_huffman=1,l.full_outer_loop=0;break;case 1:l.psymodel=1,l.noise_shaping==0&&(l.noise_shaping=1),l.substep_shaping==0&&(l.substep_shaping=2),l.noise_shaping_amp=2,l.noise_shaping_stop=1,l.subblock_gain==-1&&(l.subblock_gain=1),l.use_best_huffman=1,l.full_outer_loop=0;break;case 0:l.psymodel=1,l.noise_shaping==0&&(l.noise_shaping=1),l.substep_shaping==0&&(l.substep_shaping=2),l.noise_shaping_amp=2,l.noise_shaping_stop=1,l.subblock_gain==-1&&(l.subblock_gain=1),l.use_best_huffman=1,l.full_outer_loop=0;break}}function c(a){var l=a.internal_flags;a.frameNum=0,a.write_id3tag_automatic&&P.id3tag_write_v2(a),l.bitrate_stereoMode_Hist=si([16,4+1]),l.bitrate_blockType_Hist=si([16,4+1+1]),l.PeakSample=0,a.bWriteVbrTag&&T.InitVbrTag(a)}this.lame_init_params=function(a){var l=a.internal_flags;if(l.Class_ID=0,l.ATH==null&&(l.ATH=new Zs),l.PSY==null&&(l.PSY=new G),l.rgdata==null&&(l.rgdata=new js),l.channels_in=a.num_channels,l.channels_in==1&&(a.mode=MPEGMode.MONO),l.channels_out=a.mode==MPEGMode.MONO?1:2,l.mode_ext=De.MPG_MD_MS_LR,a.mode==MPEGMode.MONO&&(a.force_ms=!1),a.VBR==Ce.vbr_off&&a.VBR_mean_bitrate_kbps!=128&&a.brate==0&&(a.brate=a.VBR_mean_bitrate_kbps),a.VBR==Ce.vbr_off||a.VBR==Ce.vbr_mtrh||a.VBR==Ce.vbr_mt||(a.free_format=!1),a.VBR==Ce.vbr_off&&a.brate==0&&f0.EQ(a.compression_ratio,0)&&(a.compression_ratio=11.025),a.VBR==Ce.vbr_off&&a.compression_ratio>0&&(a.out_samplerate==0&&(a.out_samplerate=map2MP3Frequency(int(.97*a.in_samplerate))),a.brate=0|a.out_samplerate*16*l.channels_out/(1e3*a.compression_ratio),l.samplerate_index=m(a.out_samplerate,a),a.free_format||(a.brate=E(a.brate,a.version,a.out_samplerate))),a.out_samplerate!=0&&(a.out_samplerate<16e3?(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,8),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,64)):a.out_samplerate<32e3?(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,8),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,160)):(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,32),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,320))),a.lowpassfreq==0){var g=16e3;switch(a.VBR){case Ce.vbr_off:{var H=new Y;v(H,a.brate),g=H.lowerlimit;break}case Ce.vbr_abr:{var H=new Y;v(H,a.VBR_mean_bitrate_kbps),g=H.lowerlimit;break}case Ce.vbr_rh:{var se=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=a.VBR_q&&a.VBR_q<=9){var oe=se[a.VBR_q],re=se[a.VBR_q+1],le=a.VBR_q_frac;g=linear_int(oe,re,le)}else g=19500;break}default:{var se=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=a.VBR_q&&a.VBR_q<=9){var oe=se[a.VBR_q],re=se[a.VBR_q+1],le=a.VBR_q_frac;g=linear_int(oe,re,le)}else g=19500}}a.mode==MPEGMode.MONO&&(a.VBR==Ce.vbr_off||a.VBR==Ce.vbr_abr)&&(g*=1.5),a.lowpassfreq=g|0}if(a.out_samplerate==0&&(2*a.lowpassfreq>a.in_samplerate&&(a.lowpassfreq=a.in_samplerate/2),a.out_samplerate=_(a.lowpassfreq|0,a.in_samplerate)),a.lowpassfreq=Math.min(20500,a.lowpassfreq),a.lowpassfreq=Math.min(a.out_samplerate/2,a.lowpassfreq),a.VBR==Ce.vbr_off&&(a.compression_ratio=a.out_samplerate*16*l.channels_out/(1e3*a.brate)),a.VBR==Ce.vbr_abr&&(a.compression_ratio=a.out_samplerate*16*l.channels_out/(1e3*a.VBR_mean_bitrate_kbps)),a.bWriteVbrTag||(a.findReplayGain=!1,a.decode_on_the_fly=!1,l.findPeakSample=!1),l.findReplayGain=a.findReplayGain,l.decode_on_the_fly=a.decode_on_the_fly,l.decode_on_the_fly&&(l.findPeakSample=!0),l.findReplayGain&&A.InitGainAnalysis(l.rgdata,a.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return a.internal_flags=null,-6;switch(l.decode_on_the_fly&&!a.decode_only&&(l.hip!=null&&y.hip_decode_exit(l.hip),l.hip=y.hip_decode_init()),l.mode_gr=a.out_samplerate<=24e3?1:2,a.framesize=576*l.mode_gr,a.encoder_delay=De.ENCDELAY,l.resample_ratio=a.in_samplerate/a.out_samplerate,a.VBR){case Ce.vbr_mt:case Ce.vbr_rh:case Ce.vbr_mtrh:{var be=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];a.compression_ratio=be[a.VBR_q]}break;case Ce.vbr_abr:a.compression_ratio=a.out_samplerate*16*l.channels_out/(1e3*a.VBR_mean_bitrate_kbps);break;default:a.compression_ratio=a.out_samplerate*16*l.channels_out/(1e3*a.brate);break}if(a.mode==MPEGMode.NOT_SET&&(a.mode=MPEGMode.JOINT_STEREO),a.highpassfreq>0?(l.highpass1=2*a.highpassfreq,a.highpasswidth>=0?l.highpass2=2*(a.highpassfreq+a.highpasswidth):l.highpass2=(1+0)*2*a.highpassfreq,l.highpass1/=a.out_samplerate,l.highpass2/=a.out_samplerate):(l.highpass1=0,l.highpass2=0),a.lowpassfreq>0?(l.lowpass2=2*a.lowpassfreq,a.lowpasswidth>=0?(l.lowpass1=2*(a.lowpassfreq-a.lowpasswidth),l.lowpass1<0&&(l.lowpass1=0)):l.lowpass1=(1-0)*2*a.lowpassfreq,l.lowpass1/=a.out_samplerate,l.lowpass2/=a.out_samplerate):(l.lowpass1=0,l.lowpass2=0),f(a),l.samplerate_index=m(a.out_samplerate,a),l.samplerate_index<0)return a.internal_flags=null,-1;if(a.VBR==Ce.vbr_off){if(a.free_format)l.bitrate_index=0;else if(a.brate=E(a.brate,a.version,a.out_samplerate),l.bitrate_index=e(a.brate,a.version,a.out_samplerate),l.bitrate_index<=0)return a.internal_flags=null,-1}else l.bitrate_index=1;a.analysis&&(a.bWriteVbrTag=!1),l.pinfo!=null&&(a.bWriteVbrTag=!1),w.init_bit_stream_w(l);for(var ce=l.samplerate_index+3*a.version+6*(a.out_samplerate<16e3?1:0),ne=0;ne<De.SBMAX_l+1;ne++)l.scalefac_band.l[ne]=B.sfBandIndex[ce].l[ne];for(var ne=0;ne<De.PSFB21+1;ne++){var Te=(l.scalefac_band.l[22]-l.scalefac_band.l[21])/De.PSFB21,Fe=l.scalefac_band.l[21]+ne*Te;l.scalefac_band.psfb21[ne]=Fe}l.scalefac_band.psfb21[De.PSFB21]=576;for(var ne=0;ne<De.SBMAX_s+1;ne++)l.scalefac_band.s[ne]=B.sfBandIndex[ce].s[ne];for(var ne=0;ne<De.PSFB12+1;ne++){var Te=(l.scalefac_band.s[13]-l.scalefac_band.s[12])/De.PSFB12,Fe=l.scalefac_band.s[12]+ne*Te;l.scalefac_band.psfb12[ne]=Fe}l.scalefac_band.psfb12[De.PSFB12]=192,a.version==1?l.sideinfo_len=l.channels_out==1?4+17:4+32:l.sideinfo_len=l.channels_out==1?4+9:4+17,a.error_protection&&(l.sideinfo_len+=2),c(a),l.Class_ID=D;{var Ae;for(Ae=0;Ae<19;Ae++)l.nsPsy.pefirbuf[Ae]=700*l.mode_gr*l.channels_out;a.ATHtype==-1&&(a.ATHtype=4)}switch(Ct(a.VBR_q<=9),Ct(a.VBR_q>=0),a.VBR){case Ce.vbr_mt:a.VBR=Ce.vbr_mtrh;case Ce.vbr_mtrh:{a.useTemporal==null&&(a.useTemporal=!1),I.apply_preset(a,500-a.VBR_q*10,0),a.quality<0&&(a.quality=LAME_DEFAULT_QUALITY),a.quality<5&&(a.quality=0),a.quality>5&&(a.quality=5),l.PSY.mask_adjust=a.maskingadjust,l.PSY.mask_adjust_short=a.maskingadjust_short,a.experimentalY?l.sfb21_extra=!1:l.sfb21_extra=a.out_samplerate>44e3,l.iteration_loop=new VBRNewIterationLoop(L);break}case Ce.vbr_rh:{I.apply_preset(a,500-a.VBR_q*10,0),l.PSY.mask_adjust=a.maskingadjust,l.PSY.mask_adjust_short=a.maskingadjust_short,a.experimentalY?l.sfb21_extra=!1:l.sfb21_extra=a.out_samplerate>44e3,a.quality>6&&(a.quality=6),a.quality<0&&(a.quality=LAME_DEFAULT_QUALITY),l.iteration_loop=new VBROldIterationLoop(L);break}default:{var we;l.sfb21_extra=!1,a.quality<0&&(a.quality=LAME_DEFAULT_QUALITY),we=a.VBR,we==Ce.vbr_off&&(a.VBR_mean_bitrate_kbps=a.brate),I.apply_preset(a,a.VBR_mean_bitrate_kbps,0),a.VBR=we,l.PSY.mask_adjust=a.maskingadjust,l.PSY.mask_adjust_short=a.maskingadjust_short,we==Ce.vbr_off?l.iteration_loop=new Ws(L):l.iteration_loop=new ABRIterationLoop(L);break}}if(Ct(a.scale>=0),a.VBR!=Ce.vbr_off){if(l.VBR_min_bitrate=1,l.VBR_max_bitrate=14,a.out_samplerate<16e3&&(l.VBR_max_bitrate=8),a.VBR_min_bitrate_kbps!=0&&(a.VBR_min_bitrate_kbps=E(a.VBR_min_bitrate_kbps,a.version,a.out_samplerate),l.VBR_min_bitrate=e(a.VBR_min_bitrate_kbps,a.version,a.out_samplerate),l.VBR_min_bitrate<0)||a.VBR_max_bitrate_kbps!=0&&(a.VBR_max_bitrate_kbps=E(a.VBR_max_bitrate_kbps,a.version,a.out_samplerate),l.VBR_max_bitrate=e(a.VBR_max_bitrate_kbps,a.version,a.out_samplerate),l.VBR_max_bitrate<0))return-1;a.VBR_min_bitrate_kbps=Kt.bitrate_table[a.version][l.VBR_min_bitrate],a.VBR_max_bitrate_kbps=Kt.bitrate_table[a.version][l.VBR_max_bitrate],a.VBR_mean_bitrate_kbps=Math.min(Kt.bitrate_table[a.version][l.VBR_max_bitrate],a.VBR_mean_bitrate_kbps),a.VBR_mean_bitrate_kbps=Math.max(Kt.bitrate_table[a.version][l.VBR_min_bitrate],a.VBR_mean_bitrate_kbps)}return a.tune&&(l.PSY.mask_adjust+=a.tune_value_a,l.PSY.mask_adjust_short+=a.tune_value_a),x(a),Ct(a.scale>=0),a.athaa_type<0?l.ATH.useAdjust=3:l.ATH.useAdjust=a.athaa_type,l.ATH.aaSensitivityP=Math.pow(10,a.athaa_sensitivity/-10),a.short_blocks==null&&(a.short_blocks=pa.short_block_allowed),a.short_blocks==pa.short_block_allowed&&(a.mode==MPEGMode.JOINT_STEREO||a.mode==MPEGMode.STEREO)&&(a.short_blocks=pa.short_block_coupled),a.quant_comp<0&&(a.quant_comp=1),a.quant_comp_short<0&&(a.quant_comp_short=0),a.msfix<0&&(a.msfix=0),a.exp_nspsytune=a.exp_nspsytune|1,a.internal_flags.nsPsy.attackthre<0&&(a.internal_flags.nsPsy.attackthre=ba.NSATTACKTHRE),a.internal_flags.nsPsy.attackthre_s<0&&(a.internal_flags.nsPsy.attackthre_s=ba.NSATTACKTHRE_S),Ct(a.scale>=0),a.scale<0&&(a.scale=1),a.ATHtype<0&&(a.ATHtype=4),a.ATHcurve<0&&(a.ATHcurve=4),a.athaa_loudapprox<0&&(a.athaa_loudapprox=2),a.interChRatio<0&&(a.interChRatio=0),a.useTemporal==null&&(a.useTemporal=!0),l.slot_lag=l.frac_SpF=0,a.VBR==Ce.vbr_off&&(l.slot_lag=l.frac_SpF=(a.version+1)*72e3*a.brate%a.out_samplerate|0),B.iteration_init(a),V.psymodel_init(a),Ct(a.scale>=0),0};function n(a,l){(a.in_buffer_0==null||a.in_buffer_nsamples<l)&&(a.in_buffer_0=m0(l),a.in_buffer_1=m0(l),a.in_buffer_nsamples=l)}this.lame_encode_flush=function(a,l,g,H){var se=a.internal_flags,oe=Us([2,1152]),re=0,le,be,ce,ne,Te=se.mf_samples_to_encode-De.POSTDELAY,Fe=s(a);if(se.mf_samples_to_encode<1)return 0;for(le=0,a.in_samplerate!=a.out_samplerate&&(Te+=16*a.out_samplerate/a.in_samplerate),ce=a.framesize-Te%a.framesize,ce<576&&(ce+=a.framesize),a.encoder_padding=ce,ne=(Te+ce)/a.framesize;ne>0&&re>=0;){var Ae=Fe-se.mf_size,we=a.frameNum;Ae*=a.in_samplerate,Ae/=a.out_samplerate,Ae>1152&&(Ae=1152),Ae<1&&(Ae=1),be=H-le,H==0&&(be=0),re=this.lame_encode_buffer(a,oe[0],oe[1],Ae,l,g,be),g+=re,le+=re,ne-=we!=a.frameNum?1:0}if(se.mf_samples_to_encode=0,re<0||(be=H-le,H==0&&(be=0),w.flush_bitstream(a),re=w.copy_buffer(se,l,g,be,1),re<0))return re;if(g+=re,le+=re,be=H-le,H==0&&(be=0),a.write_id3tag_automatic){if(P.id3tag_write_v1(a),re=w.copy_buffer(se,l,g,be,0),re<0)return re;le+=re}return le},this.lame_encode_buffer=function(a,l,g,H,se,oe,re){var le=a.internal_flags,be=[null,null];if(le.Class_ID!=D)return-3;if(H==0)return 0;n(le,H),be[0]=le.in_buffer_0,be[1]=le.in_buffer_1;for(var ce=0;ce<H;ce++)be[0][ce]=l[ce],le.channels_in>1&&(be[1][ce]=g[ce]);return h(a,be[0],be[1],H,se,oe,re)};function s(a){var l=De.BLKSIZE+a.framesize-De.FFTOFFSET;return l=Math.max(l,512+a.framesize-32),Ct(C0.MFSIZE>=l),l}function h(a,l,g,H,se,oe,re){var le=a.internal_flags,be=0,ce,ne,Te,Fe,Ae,we=[null,null],Me=[null,null];if(le.Class_ID!=D)return-3;if(H==0)return 0;if(Ae=w.copy_buffer(le,se,oe,re,0),Ae<0)return Ae;if(oe+=Ae,be+=Ae,Me[0]=l,Me[1]=g,f0.NEQ(a.scale,0)&&f0.NEQ(a.scale,1))for(ne=0;ne<H;++ne)Me[0][ne]*=a.scale,le.channels_out==2&&(Me[1][ne]*=a.scale);if(f0.NEQ(a.scale_left,0)&&f0.NEQ(a.scale_left,1))for(ne=0;ne<H;++ne)Me[0][ne]*=a.scale_left;if(f0.NEQ(a.scale_right,0)&&f0.NEQ(a.scale_right,1))for(ne=0;ne<H;++ne)Me[1][ne]*=a.scale_right;if(a.num_channels==2&&le.channels_out==1)for(ne=0;ne<H;++ne)Me[0][ne]=.5*(Me[0][ne]+Me[1][ne]),Me[1][ne]=0;Fe=s(a),we[0]=le.mfbuf[0],we[1]=le.mfbuf[1];for(var qe=0;H>0;){var Ke=[null,null],Gt=0,Mt=0;Ke[0]=Me[0],Ke[1]=Me[1];var tt=new t;if(O(a,we,Ke,qe,H,tt),Gt=tt.n_in,Mt=tt.n_out,le.findReplayGain&&!le.decode_on_the_fly&&A.AnalyzeSamples(le.rgdata,we[0],le.mf_size,we[1],le.mf_size,Mt,le.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(H-=Gt,qe+=Gt,le.channels_out==2,le.mf_size+=Mt,Ct(le.mf_size<=C0.MFSIZE),le.mf_samples_to_encode<1&&(le.mf_samples_to_encode=De.ENCDELAY+De.POSTDELAY),le.mf_samples_to_encode+=Mt,le.mf_size>=Fe){var Ft=re-be;if(re==0&&(Ft=0),ce=r(a,we[0],we[1],se,oe,Ft),ce<0)return ce;for(oe+=ce,be+=ce,le.mf_size-=a.framesize,le.mf_samples_to_encode-=a.framesize,Te=0;Te<le.channels_out;Te++)for(ne=0;ne<le.mf_size;ne++)we[Te][ne]=we[Te][ne+a.framesize]}}return Ct(H==0),be}function r(a,l,g,H,se,oe){var re=p.enc.lame_encode_mp3_frame(a,l,g,H,se,oe);return a.frameNum++,re}function t(){this.n_in=0,this.n_out=0}function d(){this.num_used=0}function o(a,l){return l!=0?o(l,a%l):a}function F(a,l,g){var H=Math.PI*l;a/=g,a<0&&(a=0),a>1&&(a=1);var se=a-.5,oe=.42-.5*Math.cos(2*a*Math.PI)+.08*Math.cos(4*a*Math.PI);return Math.abs(se)<1e-9?H/Math.PI:oe*Math.sin(g*H*se)/(Math.PI*g*se)}function R(a,l,g,H,se,oe,re,le,be){var ce=a.internal_flags,ne,Te=0,Fe,Ae=a.out_samplerate/o(a.out_samplerate,a.in_samplerate);Ae>C0.BPC&&(Ae=C0.BPC);var we=Math.abs(ce.resample_ratio-Math.floor(.5+ce.resample_ratio))<1e-4?1:0,Me=1/ce.resample_ratio;Me>1&&(Me=1);var qe=31;qe%2==0&&--qe,qe+=we;var Ke=qe+1;if(ce.fill_buffer_resample_init==0){for(ce.inbuf_old[0]=m0(Ke),ce.inbuf_old[1]=m0(Ke),ne=0;ne<=2*Ae;++ne)ce.blackfilt[ne]=m0(Ke);for(ce.itime[0]=0,ce.itime[1]=0,Te=0;Te<=2*Ae;Te++){var Gt=0,Mt=(Te-Ae)/(2*Ae);for(ne=0;ne<=qe;ne++)Gt+=ce.blackfilt[Te][ne]=F(ne-Mt,Me,qe);for(ne=0;ne<=qe;ne++)ce.blackfilt[Te][ne]/=Gt}ce.fill_buffer_resample_init=1}var tt=ce.inbuf_old[be];for(Fe=0;Fe<H;Fe++){var Ft,a0;if(Ft=Fe*ce.resample_ratio,Te=0|Math.floor(Ft-ce.itime[be]),qe+Te-qe/2>=re)break;var Mt=Ft-ce.itime[be]-(Te+.5*(qe%2));Ct(Math.abs(Mt)<=.501),a0=0|Math.floor(Mt*2*Ae+Ae+.5);var e0=0;for(ne=0;ne<=qe;++ne){var ze=0|ne+Te-qe/2,i0;Ct(ze<re),Ct(ze+Ke>=0),i0=ze<0?tt[Ke+ze]:se[oe+ze],e0+=i0*ce.blackfilt[a0][ne]}l[g+Fe]=e0}if(le.num_used=Math.min(re,qe+Te-qe/2),ce.itime[be]+=le.num_used-Fe*ce.resample_ratio,le.num_used>=Ke)for(ne=0;ne<Ke;ne++)tt[ne]=se[oe+le.num_used+ne-Ke];else{var jt=Ke-le.num_used;for(ne=0;ne<jt;++ne)tt[ne]=tt[ne+le.num_used];for(Te=0;ne<Ke;++ne,++Te)tt[ne]=se[oe+Te];Ct(Te==le.num_used)}return Fe}function O(a,l,g,H,se,oe){var re=a.internal_flags;if(re.resample_ratio<.9999||re.resample_ratio>1.0001)for(var le=0;le<re.channels_out;le++){var be=new d;oe.n_out=R(a,l[le],re.mf_size,a.framesize,g[le],H,se,be,le),oe.n_in=be.num_used}else{oe.n_out=Math.min(a.framesize,se),oe.n_in=oe.n_out;for(var ce=0;ce<oe.n_out;++ce)l[0][re.mf_size+ce]=g[0][H+ce],re.channels_out==2&&(l[1][re.mf_size+ce]=g[1][H+ce])}}}var Ci=Ue;const Qs=Ma(Ci);var St=He;St.System;var Zt=St.VbrMode;St.Float;St.ShortBlock;St.Util;St.Arrays;St.new_array_n;St.new_byte;St.new_double;St.new_float;St.new_float_n;St.new_int;St.new_int_n;St.assert;function zs(){function p(T,P,y,G,Y,K,D,U,k,_,m,E,e,v,f){this.vbr_q=T,this.quant_comp=P,this.quant_comp_s=y,this.expY=G,this.st_lrm=Y,this.st_s=K,this.masking_adj=D,this.masking_adj_short=U,this.ath_lower=k,this.ath_curve=_,this.ath_sensitivity=m,this.interch=E,this.safejoint=e,this.sfb21mod=v,this.msfix=f}function i(T,P,y,G,Y,K,D,U,k,_,m,E,e,v){this.quant_comp=P,this.quant_comp_s=y,this.safejoint=G,this.nsmsfix=Y,this.st_lrm=K,this.st_s=D,this.nsbass=U,this.scale=k,this.masking_adj=_,this.ath_lower=m,this.ath_curve=E,this.interch=e,this.sfscale=v}var u;this.setModules=function(T){u=T};var A=[new p(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new p(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new p(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new p(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new p(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new p(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new p(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new p(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new p(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new p(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new p(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],w=[new p(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new p(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new p(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new p(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new p(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new p(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new p(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new p(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new p(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new p(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new p(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function I(T,P,y){var G=T.VBR==Zt.vbr_rh?A:w,Y=T.VBR_q_frac,K=G[P],D=G[P+1],U=K;K.st_lrm=K.st_lrm+Y*(D.st_lrm-K.st_lrm),K.st_s=K.st_s+Y*(D.st_s-K.st_s),K.masking_adj=K.masking_adj+Y*(D.masking_adj-K.masking_adj),K.masking_adj_short=K.masking_adj_short+Y*(D.masking_adj_short-K.masking_adj_short),K.ath_lower=K.ath_lower+Y*(D.ath_lower-K.ath_lower),K.ath_curve=K.ath_curve+Y*(D.ath_curve-K.ath_curve),K.ath_sensitivity=K.ath_sensitivity+Y*(D.ath_sensitivity-K.ath_sensitivity),K.interch=K.interch+Y*(D.interch-K.interch),K.msfix=K.msfix+Y*(D.msfix-K.msfix),V(T,U.vbr_q),y!=0?T.quant_comp=U.quant_comp:Math.abs(T.quant_comp- -1)>0||(T.quant_comp=U.quant_comp),y!=0?T.quant_comp_short=U.quant_comp_s:Math.abs(T.quant_comp_short- -1)>0||(T.quant_comp_short=U.quant_comp_s),U.expY!=0&&(T.experimentalY=U.expY!=0),y!=0?T.internal_flags.nsPsy.attackthre=U.st_lrm:Math.abs(T.internal_flags.nsPsy.attackthre- -1)>0||(T.internal_flags.nsPsy.attackthre=U.st_lrm),y!=0?T.internal_flags.nsPsy.attackthre_s=U.st_s:Math.abs(T.internal_flags.nsPsy.attackthre_s- -1)>0||(T.internal_flags.nsPsy.attackthre_s=U.st_s),y!=0?T.maskingadjust=U.masking_adj:Math.abs(T.maskingadjust-0)>0||(T.maskingadjust=U.masking_adj),y!=0?T.maskingadjust_short=U.masking_adj_short:Math.abs(T.maskingadjust_short-0)>0||(T.maskingadjust_short=U.masking_adj_short),y!=0?T.ATHlower=-U.ath_lower/10:Math.abs(-T.ATHlower*10-0)>0||(T.ATHlower=-U.ath_lower/10),y!=0?T.ATHcurve=U.ath_curve:Math.abs(T.ATHcurve- -1)>0||(T.ATHcurve=U.ath_curve),y!=0?T.athaa_sensitivity=U.ath_sensitivity:Math.abs(T.athaa_sensitivity- -1)>0||(T.athaa_sensitivity=U.ath_sensitivity),U.interch>0&&(y!=0?T.interChRatio=U.interch:Math.abs(T.interChRatio- -1)>0||(T.interChRatio=U.interch)),U.safejoint>0&&(T.exp_nspsytune=T.exp_nspsytune|U.safejoint),U.sfb21mod>0&&(T.exp_nspsytune=T.exp_nspsytune|U.sfb21mod<<20),y!=0?T.msfix=U.msfix:Math.abs(T.msfix- -1)>0||(T.msfix=U.msfix),y==0&&(T.VBR_q=P,T.VBR_q_frac=Y)}var B=[new i(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new i(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new i(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new i(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new i(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new i(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new i(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new i(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new i(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new i(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new i(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new i(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new i(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new i(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new i(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new i(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new i(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function L(T,P,y){var G=P,Y=u.nearestBitrateFullIndex(P);if(T.VBR=Zt.vbr_abr,T.VBR_mean_bitrate_kbps=G,T.VBR_mean_bitrate_kbps=Math.min(T.VBR_mean_bitrate_kbps,320),T.VBR_mean_bitrate_kbps=Math.max(T.VBR_mean_bitrate_kbps,8),T.brate=T.VBR_mean_bitrate_kbps,T.VBR_mean_bitrate_kbps>320&&(T.disable_reservoir=!0),B[Y].safejoint>0&&(T.exp_nspsytune=T.exp_nspsytune|2),B[Y].sfscale>0&&(T.internal_flags.noise_shaping=2),Math.abs(B[Y].nsbass)>0){var K=int(B[Y].nsbass*4);K<0&&(K+=64),T.exp_nspsytune=T.exp_nspsytune|K<<2}return y!=0?T.quant_comp=B[Y].quant_comp:Math.abs(T.quant_comp- -1)>0||(T.quant_comp=B[Y].quant_comp),y!=0?T.quant_comp_short=B[Y].quant_comp_s:Math.abs(T.quant_comp_short- -1)>0||(T.quant_comp_short=B[Y].quant_comp_s),y!=0?T.msfix=B[Y].nsmsfix:Math.abs(T.msfix- -1)>0||(T.msfix=B[Y].nsmsfix),y!=0?T.internal_flags.nsPsy.attackthre=B[Y].st_lrm:Math.abs(T.internal_flags.nsPsy.attackthre- -1)>0||(T.internal_flags.nsPsy.attackthre=B[Y].st_lrm),y!=0?T.internal_flags.nsPsy.attackthre_s=B[Y].st_s:Math.abs(T.internal_flags.nsPsy.attackthre_s- -1)>0||(T.internal_flags.nsPsy.attackthre_s=B[Y].st_s),y!=0?T.scale=B[Y].scale:Math.abs(T.scale- -1)>0||(T.scale=B[Y].scale),y!=0?T.maskingadjust=B[Y].masking_adj:Math.abs(T.maskingadjust-0)>0||(T.maskingadjust=B[Y].masking_adj),B[Y].masking_adj>0?y!=0?T.maskingadjust_short=B[Y].masking_adj*.9:Math.abs(T.maskingadjust_short-0)>0||(T.maskingadjust_short=B[Y].masking_adj*.9):y!=0?T.maskingadjust_short=B[Y].masking_adj*1.1:Math.abs(T.maskingadjust_short-0)>0||(T.maskingadjust_short=B[Y].masking_adj*1.1),y!=0?T.ATHlower=-B[Y].ath_lower/10:Math.abs(-T.ATHlower*10-0)>0||(T.ATHlower=-B[Y].ath_lower/10),y!=0?T.ATHcurve=B[Y].ath_curve:Math.abs(T.ATHcurve- -1)>0||(T.ATHcurve=B[Y].ath_curve),y!=0?T.interChRatio=B[Y].interch:Math.abs(T.interChRatio- -1)>0||(T.interChRatio=B[Y].interch),P}this.apply_preset=function(T,P,y){switch(P){case Lame.R3MIX:{P=Lame.V3,T.VBR=Zt.vbr_mtrh;break}case Lame.MEDIUM:{P=Lame.V4,T.VBR=Zt.vbr_rh;break}case Lame.MEDIUM_FAST:{P=Lame.V4,T.VBR=Zt.vbr_mtrh;break}case Lame.STANDARD:{P=Lame.V2,T.VBR=Zt.vbr_rh;break}case Lame.STANDARD_FAST:{P=Lame.V2,T.VBR=Zt.vbr_mtrh;break}case Lame.EXTREME:{P=Lame.V0,T.VBR=Zt.vbr_rh;break}case Lame.EXTREME_FAST:{P=Lame.V0,T.VBR=Zt.vbr_mtrh;break}case Lame.INSANE:return P=320,T.preset=P,L(T,P,y),T.VBR=Zt.vbr_off,P}switch(T.preset=P,P){case Lame.V9:return I(T,9,y),P;case Lame.V8:return I(T,8,y),P;case Lame.V7:return I(T,7,y),P;case Lame.V6:return I(T,6,y),P;case Lame.V5:return I(T,5,y),P;case Lame.V4:return I(T,4,y),P;case Lame.V3:return I(T,3,y),P;case Lame.V2:return I(T,2,y),P;case Lame.V1:return I(T,1,y),P;case Lame.V0:return I(T,0,y),P}return 8<=P&&P<=320?L(T,P,y):(T.preset=0,P)};function V(T,P){var y=0;return 0>P&&(y=-1,P=0),9<P&&(y=-1,P=9),T.VBR_q=P,T.VBR_q_frac=0,y}}var Js=zs;function en(){this.setModules=function(p,i){}}var tn=en;function an(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var sn=an,La=He,ni=La.new_float,nn=La.new_int;La.assert;function rn(){this.global_gain=0,this.sfb_count1=0,this.step=nn(39),this.noise=ni(39),this.noise_log=ni(39)}var ln=rn,yt=He,t0=yt.System,ri=yt.VbrMode;yt.Float;yt.ShortBlock;var Aa=yt.Util,x0=yt.Arrays;yt.new_array_n;yt.new_byte;yt.new_double;var L0=yt.new_float;yt.new_float_n;yt.new_int;yt.new_int_n;var Ht=yt.assert,on=tn,Ea=sn,_n=ln,Re=Qe(),li=Ra,oi=W0;function hn(){var p;this.rv=null;var i;this.qupvt=null;var u,A=new on,w;this.setModules=function(k,_,m,E){p=k,i=_,this.rv=_,u=m,this.qupvt=m,w=E,A.setModules(u,w)},this.ms_convert=function(k,_){for(var m=0;m<576;++m){var E=k.tt[_][0].xr[m],e=k.tt[_][1].xr[m];k.tt[_][0].xr[m]=(E+e)*(Aa.SQRT2*.5),k.tt[_][1].xr[m]=(E-e)*(Aa.SQRT2*.5)}};function I(k,_,m,E){E=0;for(var e=0;e<=m;++e){var v=Math.abs(k.xr[e]);E+=v,_[e]=Math.sqrt(v*Math.sqrt(v)),_[e]>k.xrpow_max&&(k.xrpow_max=_[e])}return E}this.init_xrpow=function(k,_,m){var E=0,e=0|_.max_nonzero_coeff;if(Ht(m!=null),_.xrpow_max=0,Ht(0<=e&&e<=575),x0.fill(m,e,576,0),E=I(_,m,e,E),E>1e-20){var v=0;k.substep_shaping&2&&(v=1);for(var f=0;f<_.psymax;f++)k.pseudohalf[f]=v;return!0}return x0.fill(_.l3_enc,0,576,0),!1};function B(k,_){var m=k.ATH,E=_.xr;if(_.block_type!=Re.SHORT_TYPE)for(var e=!1,v=Re.PSFB21-1;v>=0&&!e;v--){var f=k.scalefac_band.psfb21[v],x=k.scalefac_band.psfb21[v+1],c=u.athAdjust(m.adjust,m.psfb21[v],m.floor);k.nsPsy.longfact[21]>1e-12&&(c*=k.nsPsy.longfact[21]);for(var n=x-1;n>=f;n--)if(Math.abs(E[n])<c)E[n]=0;else{e=!0;break}}else for(var s=0;s<3;s++)for(var e=!1,v=Re.PSFB12-1;v>=0&&!e;v--){var f=k.scalefac_band.s[12]*3+(k.scalefac_band.s[13]-k.scalefac_band.s[12])*s+(k.scalefac_band.psfb12[v]-k.scalefac_band.psfb12[0]),x=f+(k.scalefac_band.psfb12[v+1]-k.scalefac_band.psfb12[v]),h=u.athAdjust(m.adjust,m.psfb12[v],m.floor);k.nsPsy.shortfact[12]>1e-12&&(h*=k.nsPsy.shortfact[12]);for(var n=x-1;n>=f;n--)if(Math.abs(E[n])<h)E[n]=0;else{e=!0;break}}}this.init_outer_loop=function(k,_){_.part2_3_length=0,_.big_values=0,_.count1=0,_.global_gain=210,_.scalefac_compress=0,_.table_select[0]=0,_.table_select[1]=0,_.table_select[2]=0,_.subblock_gain[0]=0,_.subblock_gain[1]=0,_.subblock_gain[2]=0,_.subblock_gain[3]=0,_.region0_count=0,_.region1_count=0,_.preflag=0,_.scalefac_scale=0,_.count1table_select=0,_.part2_length=0,_.sfb_lmax=Re.SBPSY_l,_.sfb_smin=Re.SBPSY_s,_.psy_lmax=k.sfb21_extra?Re.SBMAX_l:Re.SBPSY_l,_.psymax=_.psy_lmax,_.sfbmax=_.sfb_lmax,_.sfbdivide=11;for(var m=0;m<Re.SBMAX_l;m++)_.width[m]=k.scalefac_band.l[m+1]-k.scalefac_band.l[m],_.window[m]=3;if(_.block_type==Re.SHORT_TYPE){var E=L0(576);_.sfb_smin=0,_.sfb_lmax=0,_.mixed_block_flag!=0&&(_.sfb_smin=3,_.sfb_lmax=k.mode_gr*2+4),_.psymax=_.sfb_lmax+3*((k.sfb21_extra?Re.SBMAX_s:Re.SBPSY_s)-_.sfb_smin),_.sfbmax=_.sfb_lmax+3*(Re.SBPSY_s-_.sfb_smin),_.sfbdivide=_.sfbmax-18,_.psy_lmax=_.sfb_lmax;var e=k.scalefac_band.l[_.sfb_lmax];t0.arraycopy(_.xr,0,E,0,576);for(var m=_.sfb_smin;m<Re.SBMAX_s;m++)for(var v=k.scalefac_band.s[m],f=k.scalefac_band.s[m+1],x=0;x<3;x++)for(var c=v;c<f;c++)_.xr[e++]=E[3*c+x];for(var n=_.sfb_lmax,m=_.sfb_smin;m<Re.SBMAX_s;m++)_.width[n]=_.width[n+1]=_.width[n+2]=k.scalefac_band.s[m+1]-k.scalefac_band.s[m],_.window[n]=0,_.window[n+1]=1,_.window[n+2]=2,n+=3}_.count1bits=0,_.sfb_partition_table=u.nr_of_sfb_block[0][0],_.slen[0]=0,_.slen[1]=0,_.slen[2]=0,_.slen[3]=0,_.max_nonzero_coeff=575,x0.fill(_.scalefac,0),B(k,_)};function L(k){this.ordinal=k}L.BINSEARCH_NONE=new L(0),L.BINSEARCH_UP=new L(1),L.BINSEARCH_DOWN=new L(2);function V(k,_,m,E,e){var v,f=k.CurrentStep[E],x=!1,c=k.OldValue[E],n=L.BINSEARCH_NONE;for(_.global_gain=c,m-=_.part2_length,Ht(f!=0);;){var s;if(v=w.count_bits(k,e,_,null),f==1||v==m)break;v>m?(n==L.BINSEARCH_DOWN&&(x=!0),x&&(f/=2),n=L.BINSEARCH_UP,s=f):(n==L.BINSEARCH_UP&&(x=!0),x&&(f/=2),n=L.BINSEARCH_DOWN,s=-f),_.global_gain+=s,_.global_gain<0&&(_.global_gain=0,x=!0),_.global_gain>255&&(_.global_gain=255,x=!0)}for(Ht(_.global_gain>=0),Ht(_.global_gain<256);v>m&&_.global_gain<255;)_.global_gain++,v=w.count_bits(k,e,_,null);return k.CurrentStep[E]=c-_.global_gain>=4?4:2,k.OldValue[E]=_.global_gain,_.part2_3_length=v,v}this.trancate_smallspectrums=function(k,_,m,E){var e=L0(oi.SFBMAX);if(!(!(k.substep_shaping&4)&&_.block_type==Re.SHORT_TYPE||k.substep_shaping&128)){u.calc_noise(_,m,e,new Ea,null);for(var f=0;f<576;f++){var v=0;_.l3_enc[f]!=0&&(v=Math.abs(_.xr[f])),E[f]=v}var f=0,x=8;_.block_type==Re.SHORT_TYPE&&(x=6);do{var c,n,s,h,r=_.width[x];if(f+=r,!(e[x]>=1)&&(x0.sort(E,f-r,r),!BitStream.EQ(E[f-1],0))){c=(1-e[x])*m[x],n=0,h=0;do{var t;for(s=1;h+s<r&&!BitStream.NEQ(E[h+f-r],E[h+f+s-r]);s++);if(t=E[h+f-r]*E[h+f-r]*s,c<t){h!=0&&(n=E[h+f-r-1]);break}c-=t,h+=s}while(h<r);if(!BitStream.EQ(n,0))do Math.abs(_.xr[f-r])<=n&&(_.l3_enc[f-r]=0);while(--r>0)}}while(++x<_.psymax);_.part2_3_length=w.noquant_count_bits(k,_,null)}};function T(k){for(var _=0;_<k.sfbmax;_++)if(k.scalefac[_]+k.subblock_gain[k.window[_]]==0)return!1;return!0}function P(k){return Aa.FAST_LOG10(.368+.632*k*k*k)}function y(k,_){for(var m=1e-37,E=0;E<_.psymax;E++)m+=P(k[E]);return Math.max(1e-20,m)}function G(k,_,m,E,e){var v;switch(k){default:case 9:{_.over_count>0?(v=m.over_SSD<=_.over_SSD,m.over_SSD==_.over_SSD&&(v=m.bits<_.bits)):v=m.max_noise<0&&m.max_noise*10+m.bits<=_.max_noise*10+_.bits;break}case 0:v=m.over_count<_.over_count||m.over_count==_.over_count&&m.over_noise<_.over_noise||m.over_count==_.over_count&&BitStream.EQ(m.over_noise,_.over_noise)&&m.tot_noise<_.tot_noise;break;case 8:m.max_noise=y(e,E);case 1:v=m.max_noise<_.max_noise;break;case 2:v=m.tot_noise<_.tot_noise;break;case 3:v=m.tot_noise<_.tot_noise&&m.max_noise<_.max_noise;break;case 4:v=m.max_noise<=0&&_.max_noise>.2||m.max_noise<=0&&_.max_noise<0&&_.max_noise>m.max_noise-.2&&m.tot_noise<_.tot_noise||m.max_noise<=0&&_.max_noise>0&&_.max_noise>m.max_noise-.2&&m.tot_noise<_.tot_noise+_.over_noise||m.max_noise>0&&_.max_noise>-.05&&_.max_noise>m.max_noise-.1&&m.tot_noise+m.over_noise<_.tot_noise+_.over_noise||m.max_noise>0&&_.max_noise>-.1&&_.max_noise>m.max_noise-.15&&m.tot_noise+m.over_noise+m.over_noise<_.tot_noise+_.over_noise+_.over_noise;break;case 5:v=m.over_noise<_.over_noise||BitStream.EQ(m.over_noise,_.over_noise)&&m.tot_noise<_.tot_noise;break;case 6:v=m.over_noise<_.over_noise||BitStream.EQ(m.over_noise,_.over_noise)&&(m.max_noise<_.max_noise||BitStream.EQ(m.max_noise,_.max_noise)&&m.tot_noise<=_.tot_noise);break;case 7:v=m.over_count<_.over_count||m.over_noise<_.over_noise;break}return _.over_count==0&&(v=v&&m.bits<_.bits),v}function Y(k,_,m,E,e){var v=k.internal_flags,f;_.scalefac_scale==0?f=1.2968395546510096:f=1.6817928305074292;for(var x=0,c=0;c<_.sfbmax;c++)x<m[c]&&(x=m[c]);var n=v.noise_shaping_amp;switch(n==3&&(e?n=2:n=1),n){case 2:break;case 1:x>1?x=Math.pow(x,.5):x*=.95;break;case 0:default:x>1?x=1:x*=.95;break}for(var s=0,c=0;c<_.sfbmax;c++){var h=_.width[c],r;if(s+=h,!(m[c]<x)){if(v.substep_shaping&2&&(v.pseudohalf[c]=v.pseudohalf[c]==0?1:0,v.pseudohalf[c]==0&&v.noise_shaping_amp==2))return;for(_.scalefac[c]++,r=-h;r<0;r++)E[s+r]*=f,E[s+r]>_.xrpow_max&&(_.xrpow_max=E[s+r]);if(v.noise_shaping_amp==2)return}}}function K(k,_){for(var m=1.2968395546510096,E=0,e=0;e<k.sfbmax;e++){var v=k.width[e],f=k.scalefac[e];if(k.preflag!=0&&(f+=u.pretab[e]),E+=v,f&1){f++;for(var x=-v;x<0;x++)_[E+x]*=m,_[E+x]>k.xrpow_max&&(k.xrpow_max=_[E+x])}k.scalefac[e]=f>>1}k.preflag=0,k.scalefac_scale=1}function D(k,_,m){var E,e=_.scalefac;for(E=0;E<_.sfb_lmax;E++)if(e[E]>=16)return!0;for(var v=0;v<3;v++){var f=0,x=0;for(E=_.sfb_lmax+v;E<_.sfbdivide;E+=3)f<e[E]&&(f=e[E]);for(;E<_.sfbmax;E+=3)x<e[E]&&(x=e[E]);if(!(f<16&&x<8)){if(_.subblock_gain[v]>=7)return!0;_.subblock_gain[v]++;var c=k.scalefac_band.l[_.sfb_lmax];for(E=_.sfb_lmax+v;E<_.sfbmax;E+=3){var n,s=_.width[E],h=e[E];if(Ht(h>=0),h=h-(4>>_.scalefac_scale),h>=0){e[E]=h,c+=s*3;continue}e[E]=0;{var r=210+(h<<_.scalefac_scale+1);n=u.IPOW20(r)}c+=s*(v+1);for(var t=-s;t<0;t++)m[c+t]*=n,m[c+t]>_.xrpow_max&&(_.xrpow_max=m[c+t]);c+=s*(3-v-1)}{var n=u.IPOW20(202);c+=_.width[E]*(v+1);for(var t=-_.width[E];t<0;t++)m[c+t]*=n,m[c+t]>_.xrpow_max&&(_.xrpow_max=m[c+t])}}}return!1}function U(k,_,m,E,e){var v=k.internal_flags;Y(k,_,m,E,e);var f=T(_);return f?!1:(v.mode_gr==2?f=w.scale_bitcount(_):f=w.scale_bitcount_lsf(v,_),f?(v.noise_shaping>1&&(x0.fill(v.pseudohalf,0),_.scalefac_scale==0?(K(_,E),f=!1):_.block_type==Re.SHORT_TYPE&&v.subblock_gain>0&&(f=D(v,_,E)||T(_))),f||(v.mode_gr==2?f=w.scale_bitcount(_):f=w.scale_bitcount_lsf(v,_)),!f):!0)}this.outer_loop=function(k,_,m,E,e,v){var f=k.internal_flags,x=new li,c=L0(576),n=L0(oi.SFBMAX),s=new Ea,h,r=new _n,t=9999999,d=!1,o=!1,F=0;if(V(f,_,v,e,E),f.noise_shaping==0)return 100;u.calc_noise(_,m,n,s,r),s.bits=_.part2_3_length,x.assign(_);var R=0;for(t0.arraycopy(E,0,c,0,576);!d;){do{var O=new Ea,a,l=255;if(f.substep_shaping&2?a=20:a=3,f.sfb21_extra&&(n[x.sfbmax]>1||x.block_type==Re.SHORT_TYPE&&(n[x.sfbmax+1]>1||n[x.sfbmax+2]>1))||!U(k,x,n,E,o))break;x.scalefac_scale!=0&&(l=254);var g=v-x.part2_length;if(g<=0)break;for(;(x.part2_3_length=w.count_bits(f,E,x,r))>g&&x.global_gain<=l;)x.global_gain++;if(x.global_gain>l)break;if(s.over_count==0){for(;(x.part2_3_length=w.count_bits(f,E,x,r))>t&&x.global_gain<=l;)x.global_gain++;if(x.global_gain>l)break}if(u.calc_noise(x,m,n,O,r),O.bits=x.part2_3_length,_.block_type!=Re.SHORT_TYPE?h=k.quant_comp:h=k.quant_comp_short,h=G(h,s,O,x,n)?1:0,h!=0)t=_.part2_3_length,s=O,_.assign(x),R=0,t0.arraycopy(E,0,c,0,576);else if(f.full_outer_loop==0&&(++R>a&&s.over_count==0||f.noise_shaping_amp==3&&o&&R>30||f.noise_shaping_amp==3&&o&&x.global_gain-F>15))break}while(x.global_gain+x.scalefac_scale<255);f.noise_shaping_amp==3?o?d=!0:(x.assign(_),t0.arraycopy(c,0,E,0,576),R=0,F=x.global_gain,o=!0):d=!0}return Ht(_.global_gain+_.scalefac_scale<=255),k.VBR==ri.vbr_rh||k.VBR==ri.vbr_mtrh?t0.arraycopy(c,0,E,0,576):f.substep_shaping&1&&trancate_smallspectrums(f,_,m,E),s.over_count},this.iteration_finish_one=function(k,_,m){var E=k.l3_side,e=E.tt[_][m];w.best_scalefac_store(k,_,m,E),k.use_best_huffman==1&&w.best_huffman_divide(k,e),i.ResvAdjust(k,e)},this.VBR_encode_granule=function(k,_,m,E,e,v,f){var x=k.internal_flags,c=new li,n=L0(576),s=f,h=f+1,r=(f+v)/2,t,d,o=0,F=x.sfb21_extra;Ht(s<=LameInternalFlags.MAX_BITS_PER_CHANNEL),x0.fill(c.l3_enc,0);do Ht(r>=v),Ht(r<=f),Ht(v<=f),r>s-42?x.sfb21_extra=!1:x.sfb21_extra=F,d=outer_loop(k,_,m,E,e,r),d<=0?(o=1,h=_.part2_3_length,c.assign(_),t0.arraycopy(E,0,n,0,576),f=h-32,t=f-v,r=(f+v)/2):(v=r+32,t=f-v,r=(f+v)/2,o!=0&&(o=2,_.assign(c),t0.arraycopy(n,0,E,0,576)));while(t>12);x.sfb21_extra=F,o==2&&t0.arraycopy(c.l3_enc,0,_.l3_enc,0,576),Ht(_.part2_3_length<=s)},this.get_framebits=function(k,_){var m=k.internal_flags;m.bitrate_index=m.VBR_min_bitrate;var E=p.getframebits(k);m.bitrate_index=1,E=p.getframebits(k);for(var e=1;e<=m.VBR_max_bitrate;e++){m.bitrate_index=e;var v=new MeanBits(E);_[e]=i.ResvFrameBegin(k,v),E=v.bits}},this.VBR_old_prepare=function(k,_,m,E,e,v,f,x,c){var n=k.internal_flags,s,h=0,r=1,t=0;n.bitrate_index=n.VBR_max_bitrate;var d=i.ResvFrameBegin(k,new MeanBits(0))/n.mode_gr;get_framebits(k,v);for(var o=0;o<n.mode_gr;o++){var F=u.on_pe(k,_,x[o],d,o,0);n.mode_ext==Re.MPG_MD_MS_LR&&(ms_convert(n.l3_side,o),u.reduce_side(x[o],m[o],d,F));for(var R=0;R<n.channels_out;++R){var O=n.l3_side.tt[o][R];O.block_type!=Re.SHORT_TYPE?(h=1.28/(1+Math.exp(3.5-_[o][R]/300))-.05,s=n.PSY.mask_adjust-h):(h=2.56/(1+Math.exp(3.5-_[o][R]/300))-.14,s=n.PSY.mask_adjust_short-h),n.masking_lower=Math.pow(10,s*.1),init_outer_loop(n,O),c[o][R]=u.calc_xmin(k,E[o][R],O,e[o][R]),c[o][R]!=0&&(r=0),f[o][R]=126,t+=x[o][R]}}for(var o=0;o<n.mode_gr;o++)for(var R=0;R<n.channels_out;R++)t>v[n.VBR_max_bitrate]&&(x[o][R]*=v[n.VBR_max_bitrate],x[o][R]/=t),f[o][R]>x[o][R]&&(f[o][R]=x[o][R]);return r},this.bitpressure_strategy=function(k,_,m,E){for(var e=0;e<k.mode_gr;e++)for(var v=0;v<k.channels_out;v++){for(var f=k.l3_side.tt[e][v],x=_[e][v],c=0,n=0;n<f.psy_lmax;n++)x[c++]*=1+.029*n*n/Re.SBMAX_l/Re.SBMAX_l;if(f.block_type==Re.SHORT_TYPE)for(var n=f.sfb_smin;n<Re.SBMAX_s;n++)x[c++]*=1+.029*n*n/Re.SBMAX_s/Re.SBMAX_s,x[c++]*=1+.029*n*n/Re.SBMAX_s/Re.SBMAX_s,x[c++]*=1+.029*n*n/Re.SBMAX_s/Re.SBMAX_s;E[e][v]=0|Math.max(m[e][v],.9*E[e][v])}},this.VBR_new_prepare=function(k,_,m,E,e,v){var f=k.internal_flags,x=1,c=0,n=0,s;if(k.free_format){f.bitrate_index=0;var h=new MeanBits(c);s=i.ResvFrameBegin(k,h),c=h.bits,e[0]=s}else{f.bitrate_index=f.VBR_max_bitrate;var h=new MeanBits(c);i.ResvFrameBegin(k,h),c=h.bits,get_framebits(k,e),s=e[f.VBR_max_bitrate]}for(var r=0;r<f.mode_gr;r++){u.on_pe(k,_,v[r],c,r,0),f.mode_ext==Re.MPG_MD_MS_LR&&ms_convert(f.l3_side,r);for(var t=0;t<f.channels_out;++t){var d=f.l3_side.tt[r][t];f.masking_lower=Math.pow(10,f.PSY.mask_adjust*.1),init_outer_loop(f,d),u.calc_xmin(k,m[r][t],d,E[r][t])!=0&&(x=0),n+=v[r][t]}}for(var r=0;r<f.mode_gr;r++)for(var t=0;t<f.channels_out;t++)n>s&&(v[r][t]*=s,v[r][t]/=n);return x},this.calc_target_bits=function(k,_,m,E,e,v){var f=k.internal_flags,x=f.l3_side,c,n,s,h,r=0;f.bitrate_index=f.VBR_max_bitrate;var t=new MeanBits(r);for(v[0]=i.ResvFrameBegin(k,t),r=t.bits,f.bitrate_index=1,r=p.getframebits(k)-f.sideinfo_len*8,e[0]=r/(f.mode_gr*f.channels_out),r=k.VBR_mean_bitrate_kbps*k.framesize*1e3,f.substep_shaping&1&&(r*=1.09),r/=k.out_samplerate,r-=f.sideinfo_len*8,r/=f.mode_gr*f.channels_out,c=.93+.07*(11-k.compression_ratio)/(11-5.5),c<.9&&(c=.9),c>1&&(c=1),n=0;n<f.mode_gr;n++){var d=0;for(s=0;s<f.channels_out;s++){if(E[n][s]=int(c*r),_[n][s]>700){var o=int((_[n][s]-700)/1.4),F=x.tt[n][s];E[n][s]=int(c*r),F.block_type==Re.SHORT_TYPE&&o<r/2&&(o=r/2),o>r*3/2?o=r*3/2:o<0&&(o=0),E[n][s]+=o}E[n][s]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(E[n][s]=LameInternalFlags.MAX_BITS_PER_CHANNEL),d+=E[n][s]}if(d>LameInternalFlags.MAX_BITS_PER_GRANULE)for(s=0;s<f.channels_out;++s)E[n][s]*=LameInternalFlags.MAX_BITS_PER_GRANULE,E[n][s]/=d}if(f.mode_ext==Re.MPG_MD_MS_LR)for(n=0;n<f.mode_gr;n++)u.reduce_side(E[n],m[n],r*f.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(h=0,n=0;n<f.mode_gr;n++)for(s=0;s<f.channels_out;s++)E[n][s]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(E[n][s]=LameInternalFlags.MAX_BITS_PER_CHANNEL),h+=E[n][s];if(h>v[0])for(n=0;n<f.mode_gr;n++)for(s=0;s<f.channels_out;s++)E[n][s]*=v[0],E[n][s]/=h}}var cn=hn,un=He,G0=un.assert;function dn(){var p;this.setModules=function(i){p=i},this.ResvFrameBegin=function(i,u){var A=i.internal_flags,w,I=A.l3_side,B=p.getframebits(i);u.bits=(B-A.sideinfo_len*8)/A.mode_gr;var L=8*256*A.mode_gr-8;i.brate>320?w=8*int(i.brate*1e3/(i.out_samplerate/1152)/8+.5):(w=8*1440,i.strict_ISO&&(w=8*int(32e4/(i.out_samplerate/1152)/8+.5))),A.ResvMax=w-B,A.ResvMax>L&&(A.ResvMax=L),(A.ResvMax<0||i.disable_reservoir)&&(A.ResvMax=0);var V=u.bits*A.mode_gr+Math.min(A.ResvSize,A.ResvMax);return V>w&&(V=w),G0(A.ResvMax%8==0),G0(A.ResvMax>=0),I.resvDrain_pre=0,A.pinfo!=null&&(A.pinfo.mean_bits=u.bits/2,A.pinfo.resvsize=A.ResvSize),V},this.ResvMaxBits=function(i,u,A,w){var I=i.internal_flags,B,L=I.ResvSize,V=I.ResvMax;w!=0&&(L+=u),I.substep_shaping&1&&(V*=.9),A.bits=u,L*10>V*9?(B=L-V*9/10,A.bits+=B,I.substep_shaping|=128):(B=0,I.substep_shaping&=127,!i.disable_reservoir&&!(I.substep_shaping&1)&&(A.bits-=.1*u));var T=L<I.ResvMax*6/10?L:I.ResvMax*6/10;return T-=B,T<0&&(T=0),T},this.ResvAdjust=function(i,u){i.ResvSize-=u.part2_3_length+u.part2_length},this.ResvFrameEnd=function(i,u){var A,w=i.l3_side;i.ResvSize+=u*i.mode_gr;var I=0;w.resvDrain_post=0,w.resvDrain_pre=0,(A=i.ResvSize%8)!=0&&(I+=A),A=i.ResvSize-I-i.ResvMax,A>0&&(G0(A%8==0),G0(A>=0),I+=A);{var B=Math.min(w.main_data_begin*8,I)/8;w.resvDrain_pre+=8*B,I-=8*B,i.ResvSize-=8*B,w.main_data_begin-=B}w.resvDrain_post+=I,i.ResvSize-=I}}var vn=dn;function mn(){var p="http://www.mp3dev.org/",i=3,u=98,A=4,w=0,I=93;this.getLameVersion=function(){return i+"."+u+"."+A},this.getLameShortVersion=function(){return i+"."+u+"."+A},this.getLameVeryShortVersion=function(){return"LAME"+i+"."+u+"r"},this.getPsyVersion=function(){return w+"."+I},this.getLameUrl=function(){return p},this.getLameOsBitness=function(){return"32bits"}}var fn=mn,xt=He,pn=xt.System,Sa=xt.VbrMode;xt.Float;var _i=xt.ShortBlock;xt.Util;var bn=xt.Arrays;xt.new_array_n;var $0=xt.new_byte;xt.new_double;xt.new_float;xt.new_float_n;xt.new_int;xt.new_int_n;var An=xt.assert;O0.NUMTOCENTRIES=100;O0.MAXFRAMESIZE=2880;function O0(){var p,i,u;this.setModules=function(r,t,d){p=r,i=t,u=d};var A=1,w=2,I=4,B=8,L=O0.NUMTOCENTRIES,V=O0.MAXFRAMESIZE,T=L+4+4+4+4+4,P=T+9+1+1+8+1+1+3+1+1+2+4+2+2,y=128,G=64,Y=32,K=null,D="Xing",U="Info",k=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function _(r,t){if(r.nVbrNumFrames++,r.sum+=t,r.seen++,!(r.seen<r.want)&&(r.pos<r.size&&(r.bag[r.pos]=r.sum,r.pos++,r.seen=0),r.pos==r.size)){for(var d=1;d<r.size;d+=2)r.bag[d/2]=r.bag[d];r.want*=2,r.pos/=2}}function m(r,t){if(!(r.pos<=0))for(var d=1;d<L;++d){var o=d/L,F,R,O=0|Math.floor(o*r.pos);O>r.pos-1&&(O=r.pos-1),F=r.bag[O],R=r.sum;var a=0|256*F/R;a>255&&(a=255),t[d]=255&a}}this.addVbrFrame=function(r){var t=r.internal_flags,d=Tables.bitrate_table[r.version][t.bitrate_index];An(t.VBR_seek_table.bag!=null),_(t.VBR_seek_table,d)};function E(r,t){var d=r[t+0]&255;return d<<=8,d|=r[t+1]&255,d<<=8,d|=r[t+2]&255,d<<=8,d|=r[t+3]&255,d}function e(r,t,d){r[t+0]=255&(d>>24&255),r[t+1]=255&(d>>16&255),r[t+2]=255&(d>>8&255),r[t+3]=255&(d&255)}function v(r,t,d){r[t+0]=255&(d>>8&255),r[t+1]=255&(d&255)}function f(r,t){return new String(r,t,D.length(),K).equals(D)||new String(r,t,U.length(),K).equals(U)}function x(r,t,d){return 255&(r<<t|d&~(-1<<t))}function c(r,t){var d=r.internal_flags;t[0]=x(t[0],8,255),t[1]=x(t[1],3,7),t[1]=x(t[1],1,r.out_samplerate<16e3?0:1),t[1]=x(t[1],1,r.version),t[1]=x(t[1],2,4-3),t[1]=x(t[1],1,r.error_protection?0:1),t[2]=x(t[2],4,d.bitrate_index),t[2]=x(t[2],2,d.samplerate_index),t[2]=x(t[2],1,0),t[2]=x(t[2],1,r.extension),t[3]=x(t[3],2,r.mode.ordinal()),t[3]=x(t[3],2,d.mode_ext),t[3]=x(t[3],1,r.copyright),t[3]=x(t[3],1,r.original),t[3]=x(t[3],2,r.emphasis),t[0]=255;var o=255&(t[1]&241),F;r.version==1?F=y:r.out_samplerate<16e3?F=Y:F=G,r.VBR==Sa.vbr_off&&(F=r.brate);var R;r.free_format?R=0:R=255&16*p.BitrateIndex(F,r.version,r.out_samplerate),r.version==1?(t[1]=255&(o|10),o=255&(t[2]&13),t[2]=255&(R|o)):(t[1]=255&(o|2),o=255&(t[2]&13),t[2]=255&(R|o))}this.getVbrTag=function(r){var t=new VBRTagData,d=0;t.flags=0;var o=r[d+1]>>3&1,F=r[d+2]>>2&3,R=r[d+3]>>6&3,O=r[d+2]>>4&15;if(O=Tables.bitrate_table[o][O],r[d+1]>>4==14?t.samprate=Tables.samplerate_table[2][F]:t.samprate=Tables.samplerate_table[o][F],o!=0?R!=3?d+=32+4:d+=17+4:R!=3?d+=17+4:d+=9+4,!f(r,d))return null;d+=4,t.hId=o;var a=t.flags=E(r,d);if(d+=4,a&A&&(t.frames=E(r,d),d+=4),a&w&&(t.bytes=E(r,d),d+=4),a&I){if(t.toc!=null)for(var l=0;l<L;l++)t.toc[l]=r[d+l];d+=L}t.vbrScale=-1,a&B&&(t.vbrScale=E(r,d),d+=4),t.headersize=(o+1)*72e3*O/t.samprate,d+=21;var g=r[d+0]<<4;g+=r[d+1]>>4;var H=(r[d+1]&15)<<8;return H+=r[d+2]&255,(g<0||g>3e3)&&(g=-1),(H<0||H>3e3)&&(H=-1),t.encDelay=g,t.encPadding=H,t},this.InitVbrTag=function(r){var t=r.internal_flags,d;r.version==1?d=y:r.out_samplerate<16e3?d=Y:d=G,r.VBR==Sa.vbr_off&&(d=r.brate);var o=(r.version+1)*72e3*d/r.out_samplerate,F=t.sideinfo_len+P;if(t.VBR_seek_table.TotalFrameSize=o,o<F||o>V){r.bWriteVbrTag=!1;return}t.VBR_seek_table.nVbrNumFrames=0,t.VBR_seek_table.nBytesWritten=0,t.VBR_seek_table.sum=0,t.VBR_seek_table.seen=0,t.VBR_seek_table.want=1,t.VBR_seek_table.pos=0,t.VBR_seek_table.bag==null&&(t.VBR_seek_table.bag=new int[400],t.VBR_seek_table.size=400);var R=$0(V);c(r,R);for(var O=t.VBR_seek_table.TotalFrameSize,a=0;a<O;++a)i.add_dummy_byte(r,R[a]&255,1)};function n(r,t){var d=t^r;return t=t>>8^k[d&255],t}this.updateMusicCRC=function(r,t,d,o){for(var F=0;F<o;++F)r[0]=n(t[d+F],r[0])};function s(r,t,d,o,F){var R=r.internal_flags,O=0,a=r.encoder_delay,l=r.encoder_padding,g=100-10*r.VBR_q-r.quality,H=u.getLameVeryShortVersion(),se,oe=0,re,le=[1,5,3,2,4,0,3],be=0|(r.lowpassfreq/100+.5>255?255:r.lowpassfreq/100+.5),ce=0,ne=0,Te=0,Fe=r.internal_flags.noise_shaping,Ae=0,we=0,Me=0,qe=0,Ke=0,Gt=(r.exp_nspsytune&1)!=0,Mt=(r.exp_nspsytune&2)!=0,tt=!1,Ft=!1,a0=r.internal_flags.nogap_total,e0=r.internal_flags.nogap_current,ze=r.ATHtype,i0=0,jt;switch(r.VBR){case vbr_abr:jt=r.VBR_mean_bitrate_kbps;break;case vbr_off:jt=r.brate;break;default:jt=r.VBR_min_bitrate_kbps}switch(r.VBR.ordinal()<le.length?se=le[r.VBR.ordinal()]:se=0,re=16*oe+se,R.findReplayGain&&(R.RadioGain>510&&(R.RadioGain=510),R.RadioGain<-510&&(R.RadioGain=-510),ne=8192,ne|=3072,R.RadioGain>=0?ne|=R.RadioGain:(ne|=512,ne|=-R.RadioGain)),R.findPeakSample&&(ce=Math.abs(0|R.PeakSample/32767*Math.pow(2,23)+.5)),a0!=-1&&(e0>0&&(Ft=!0),e0<a0-1&&(tt=!0)),i0=ze+((Gt?1:0)<<4)+((Mt?1:0)<<5)+((tt?1:0)<<6)+((Ft?1:0)<<7),g<0&&(g=0),r.mode){case MONO:Ae=0;break;case STEREO:Ae=1;break;case DUAL_CHANNEL:Ae=2;break;case JOINT_STEREO:r.force_ms?Ae=4:Ae=3;break;case NOT_SET:default:Ae=7;break}r.in_samplerate<=32e3?Me=0:r.in_samplerate==48e3?Me=2:r.in_samplerate>48e3?Me=3:Me=1,(r.short_blocks==_i.short_block_forced||r.short_blocks==_i.short_block_dispensed||r.lowpassfreq==-1&&r.highpassfreq==-1||r.scale_left<r.scale_right||r.scale_left>r.scale_right||r.disable_reservoir&&r.brate<320||r.noATH||r.ATHonly||ze==0||r.in_samplerate<=32e3)&&(we=1),qe=Fe+(Ae<<2)+(we<<5)+(Me<<6),Ke=R.nMusicCRC,e(d,o+O,g),O+=4;for(var wt=0;wt<9;wt++)d[o+O+wt]=255&H.charAt(wt);O+=9,d[o+O]=255&re,O++,d[o+O]=255&be,O++,e(d,o+O,ce),O+=4,v(d,o+O,ne),O+=2,v(d,o+O,Te),O+=2,d[o+O]=255&i0,O++,jt>=255?d[o+O]=255:d[o+O]=255&jt,O++,d[o+O]=255&a>>4,d[o+O+1]=255&(a<<4)+(l>>8),d[o+O+2]=255&l,O+=3,d[o+O]=255&qe,O++,d[o+O++]=0,v(d,o+O,r.preset),O+=2,e(d,o+O,t),O+=4,v(d,o+O,Ke),O+=2;for(var p0=0;p0<O;p0++)F=n(d[o+p0],F);return v(d,o+O,F),O+=2,O}function h(r){r.seek(0);var t=$0(10);r.readFully(t);var d;return new String(t,"ISO-8859-1").startsWith("ID3")?d=0:d=((t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127)+t.length,d}this.getLameTagFrame=function(r,t){var d=r.internal_flags;if(!r.bWriteVbrTag||d.Class_ID!=Lame.LAME_ID||d.VBR_seek_table.pos<=0)return 0;if(t.length<d.VBR_seek_table.TotalFrameSize)return d.VBR_seek_table.TotalFrameSize;bn.fill(t,0,d.VBR_seek_table.TotalFrameSize,0),c(r,t);var o=$0(L);if(r.free_format)for(var F=1;F<L;++F)o[F]=255&255*F/100;else m(d.VBR_seek_table,o);var R=d.sideinfo_len;r.error_protection&&(R-=2),r.VBR==Sa.vbr_off?(t[R++]=255&U.charAt(0),t[R++]=255&U.charAt(1),t[R++]=255&U.charAt(2),t[R++]=255&U.charAt(3)):(t[R++]=255&D.charAt(0),t[R++]=255&D.charAt(1),t[R++]=255&D.charAt(2),t[R++]=255&D.charAt(3)),e(t,R,A+w+I+B),R+=4,e(t,R,d.VBR_seek_table.nVbrNumFrames),R+=4;var O=d.VBR_seek_table.nBytesWritten+d.VBR_seek_table.TotalFrameSize;e(t,R,0|O),R+=4,pn.arraycopy(o,0,t,R,o.length),R+=o.length,r.error_protection&&i.CRC_writeheader(d,t);for(var a=0,F=0;F<R;F++)a=n(t[F],a);return R+=s(r,O,t,R,a),d.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(r,t){var d=r.internal_flags;if(d.VBR_seek_table.pos<=0||(t.seek(t.length()),t.length()==0))return-1;var o=h(t);t.seek(o);var F=$0(V),R=getLameTagFrame(r,F);return R>F.length?-1:(R<1||t.write(F,0,R),0)}}var En=O0,Tt=He;Tt.System;Tt.VbrMode;Tt.Float;Tt.ShortBlock;Tt.Util;Tt.Arrays;Tt.new_array_n;var hi=Tt.new_byte;Tt.new_double;Tt.new_float;Tt.new_float_n;Tt.new_int;Tt.new_int_n;var ci=Tt.assert,Sn=Ci,yn=Js,xn=wi,Tn=Ri,Mn=cn,wn=Ii,Bn=vn,Rn=Ba,In=Ca;Qe();var Cn=fn,Ln=En;function kn(){this.setModules=function(p,i){}}function On(){this.setModules=function(p,i,u){}}function Nn(){}function gn(){this.setModules=function(p,i){}}function Hn(p,i,u){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),p=1,i=44100,u=128);var A=new Sn,w=new kn,I=new xn,B=new In,L=new yn,V=new Tn,T=new Mn,P=new Ln,y=new Cn,G=new gn,Y=new Bn,K=new wn,D=new On,U=new Nn;A.setModules(I,B,L,V,T,P,y,G,U),B.setModules(I,U,y,P),G.setModules(B,y),L.setModules(A),T.setModules(B,Y,V,K),V.setModules(K,Y,A.enc.psy),Y.setModules(B),K.setModules(V),P.setModules(A,B,y),w.setModules(D,U),D.setModules(y,G,L);var k=A.lame_init();k.num_channels=p,k.in_samplerate=i,k.brate=u,k.mode=Rn.STEREO,k.quality=3,k.bWriteVbrTag=!1,k.disable_reservoir=!0,k.write_id3tag_automatic=!1;var _=A.lame_init_params(k);ci(_==0);var m=1152,E=0|1.25*m+7200,e=hi(E);this.encodeBuffer=function(v,f){p==1&&(f=v),ci(v.length==f.length),v.length>m&&(m=v.length,E=0|1.25*m+7200,e=hi(E));var x=A.lame_encode_buffer(k,v,f,v.length,e,0,E);return new Int8Array(e.subarray(0,x))},this.flush=function(){var v=A.lame_encode_flush(k,e,0,E);return new Int8Array(e.subarray(0,v))}}function Xt(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function z0(p){return p.charCodeAt(0)<<24|p.charCodeAt(1)<<16|p.charCodeAt(2)<<8|p.charCodeAt(3)}Xt.RIFF=z0("RIFF");Xt.WAVE=z0("WAVE");Xt.fmt_=z0("fmt ");Xt.data=z0("data");Xt.readHeader=function(p){var i=new Xt,u=p.getUint32(0,!1);if(Xt.RIFF==u&&(p.getUint32(4,!0),Xt.WAVE==p.getUint32(8,!1)&&Xt.fmt_==p.getUint32(12,!1))){var A=p.getUint32(16,!0),w=16+4;switch(A){case 16:case 18:i.channels=p.getUint16(w+2,!0),i.sampleRate=p.getUint32(w+4,!0);break;default:throw"extended fmt chunk not implemented"}w+=A;for(var I=Xt.data,B=0;I!=u&&(u=p.getUint32(w,!1),B=p.getUint32(w+4,!0),I!=u);)w+=B+8;return i.dataLen=B,i.dataOffset=w+8,i}};wa.Mp3Encoder=Hn;wa.WavHeader=Xt;window.MPEGMode=Ji;window.Lame=Qs;window.BitStream=Gs;function Fn(p,i){const u=new Int16Array(p.length);for(let V=0;V<p.length;V++)u[V]=p[V]*32767;const A=new wa.Mp3Encoder(1,i,128),w=[],I=A.encodeBuffer(u);I.length>0&&w.push(I);const B=A.flush();return B.length>0&&w.push(B),new Blob(w,{type:"audio/mpeg"})}function Vn(p){return new DOMParser().parseFromString(p,"text/html").body.textContent||""}function Pn(p){const i=URL.createObjectURL(p);return new Audio(i)}function qn(p){const i="https://api.elevenlabs.io/v1/text-to-speech/21m00Tcm4TlvDq8ikWAM/stream?optimize_streaming_latency=4",u={accept:"audio/mpeg","xi-api-key":"bddfcabff8951ebb9e925d506452df93","Content-Type":"application/json"},A=JSON.stringify({text:p,model_id:"eleven_turbo_v2",voice_settings:{stability:.5,similarity_boost:.5}});return fetch(i,{method:"POST",headers:u,body:A}).then(w=>w.blob()).then(w=>Pn(w)).catch(w=>console.error("Error:",w))}class Dn{constructor({pageEl:i}){R0(this,"keyframes",{fadeOutPhoneBarAI:[{transform:"translateY(0px)",opacity:1},{transform:"translateY(-100%)",opacity:0}],fadeOutPhoneContainer:[{transform:"translateY(0px)",opacity:1},{transform:"translateY(-100%)",opacity:0}],fadeInPhoneBarUser:[{transform:"translateY(200%)",opacity:0},{transform:"translateY(0px)",opacity:1}],phoneBarYoyo:[{width:"32px"},{width:"8px"},{width:"32px"}],phoneBarListeningYoyo:[{width:"32px"},{width:"132px"},{width:"32px"}],reducePhoneBarOne:[{width:"32px"},{width:"8px"}],expandPhoneBarProcessing:[{width:"8px"},{width:"132px"}],dotsYoyo:[{width:"8px",offset:0},{width:"8px",offset:.1},{width:"34px",offset:.3},{width:"34px",offset:.7},{width:"8px",offset:1}],backgroundBarProcessingYoyo:[{background:"unset",offset:0},{background:"unset",offset:.29},{background:"#ff3e33",offset:.3},{background:"#ff3e33",offset:.7},{background:"unset",offset:.71},{background:"unset",offset:1}],reducePhoneBarProcessing:[{width:"132px"},{width:"8px"}],expandPhoneBarAI:[{width:"8px"},{width:"132px"}],phoneBarAIYoyo:[{width:"132px"},{width:"32px"},{width:"132px"}]});this.pageEl=i,this.phoneContainer=this.pageEl.querySelector(".phone__container"),this.phoneBarContainer=this.phoneContainer.querySelector(".phone-bar__container"),this.phoneBarOne=this.phoneBarContainer.querySelector(".phone-bar__one"),this.phoneBarOneDots=this.phoneBarOne.querySelectorAll(".dot"),this.phoneBarProcessing=this.phoneBarContainer.querySelector(".phone-bar__processing"),this.phoneBarProcessingDots=this.phoneBarProcessing.querySelectorAll(".dot"),this.phoneBarAI=this.phoneBarContainer.querySelector(".phone-bar__AI"),this.phoneBarPause=this.phoneBarContainer.querySelector(".phone-bar__pause"),this.isConnected=!1,this.colors={talkToMe:"#2B41EE"},this.animations=[]}animateTextTransition(i,u,A,w){A.textContent=i;const I=Ie(u,w.hide,{duration:300,ease:"ease-in-out",fill:"forwards"}),B=Ie(A,w.show,{duration:300,ease:"ease-in-out",fill:"forwards"});I.onfinish=()=>u.classList.remove("active"),B.onfinish=()=>A.classList.add("active")}createAnimation(i,u,A){const w=Ie(i,u,A);return this.animations.push(w),w}cancelAllAnimations(){this.isConnected=!1,this.animations.flat().forEach(u=>{u.cancel()}),this.animations=[]}newInfoText(i){const u=this.phoneContainer.querySelector(".phone__info.active"),A=this.phoneContainer.querySelector(".phone__info:not(.active)"),w={hide:[{opacity:1,transform:"translateX(-50%) translateY(0px)"},{opacity:0,transform:"translateX(-50%) translateY(-100%)"}],show:[{opacity:0,transform:"translateX(-50%) translateY(100%)"},{opacity:1,transform:" translateX(-50%)translateY(0px)"}]};this.animateTextTransition(i,u,A,w)}toConnecting(){this.dotsYoyoAnimations=this.createAnimation([this.phoneBarOneDots[0],this.phoneBarOneDots[1]],[{width:"30px"},{width:"8px"},{width:"30px"}],{duration:900,ease:"ease-out",iterations:1/0})}toConnected(){this.isConnected=!0,this.dotsYoyoAnimations.forEach(i=>i.cancel()),this.phoneBarOneDots.forEach(i=>i.classList.add("expand")),this.phoneBarOne.classList.add("active"),this.createAnimation([this.phoneBarOneDots[0],this.phoneBarOneDots[1]],[{opacity:1},{opacity:0}],{duration:100,ease:"ease-out",fill:"forwards"})}toTalkToMe(){if(this.isConnected||this.toConnected(),this.phoneBarAIYoyoAnimations){this.phoneBarAIYoyoAnimations.cancel();const i=this.createAnimation(this.phoneBarAI,this.keyframes.fadeOutPhoneBarAI,{duration:300,ease:"ease-out",fill:"forwards"});this.phoneBarOne.classList.add("active"),this.phoneBarOne.classList.add("talkToMe");const u=this.createAnimation(this.phoneBarOne,this.keyframes.fadeInPhoneBarUser,{duration:300,ease:"ease-out",fill:"forwards"});u.onfinish=()=>{this.expandPhoneBarAI.cancel(),this.phoneBarAI.classList.remove("active"),i.cancel()}}this.phoneBarOne.classList.add("talkToMe"),this.phoneBarYoyoAnimations=this.createAnimation(this.phoneBarOne,this.keyframes.phoneBarYoyo,{duration:900,ease:"ease-out",iterations:1/0})}toListening(){var i;(i=this.phoneBarYoyoAnimations)==null||i.cancel(),this.phoneBarYoyoAnimations=this.createAnimation(this.phoneBarOne,this.keyframes.phoneBarListeningYoyo,{duration:900,ease:"ease-out",iterations:1/0})}resetUserBar(){this.phoneBarOne.classList.remove("active"),this.phoneBarOne.classList.remove("talkToMe"),this.phoneBarOneDots.forEach(i=>i.classList.remove("expand"))}toProcessing(){this.phoneBarYoyoAnimations.cancel();const i=this.createAnimation(this.phoneBarOne,this.keyframes.reducePhoneBarOne,{duration:400,ease:"ease-out",fill:"forwards"});i.onfinish=()=>{this.phoneBarOne.classList.remove("active"),this.phoneBarOne.classList.remove("talkToMe"),this.phoneBarProcessing.classList.add("active"),this.createAnimation(this.phoneBarProcessing,this.keyframes.expandPhoneBarProcessing,{duration:400,ease:"ease-out",fill:"forwards"}),this.dotsYoyoAnimations=Array.from(this.phoneBarProcessingDots).map(u=>this.createAnimation(u,this.keyframes.dotsYoyo,{delay:500,duration:1500,ease:"ease-out",iterations:1/0})),this.backgroundBarProcessingYoyo=this.createAnimation(this.phoneBarProcessing,this.keyframes.backgroundBarProcessingYoyo,{delay:500,duration:1500,ease:"ease-out",iterations:1/0})}}resetProcessingBar(){this.phoneBarProcessing.classList.remove("active"),this.phoneBarProcessingDots.forEach(i=>i.classList.remove("expand"))}toAITalking(){this.dotsYoyoAnimations.forEach(u=>u.cancel()),this.backgroundBarProcessingYoyo.cancel();const i=this.createAnimation(this.phoneBarProcessing,this.keyframes.reducePhoneBarProcessing,{duration:400,ease:"ease-out",fill:"forwards"});i.onfinish=()=>{this.phoneBarProcessing.classList.remove("active"),this.phoneBarAI.classList.add("active"),this.expandPhoneBarAI=this.createAnimation(this.phoneBarAI,this.keyframes.expandPhoneBarAI,{delay:300,duration:400,ease:"ease-out",fill:"forwards"}),this.phoneBarAIYoyoAnimations=this.createAnimation(this.phoneBarAI,this.keyframes.phoneBarAIYoyo,{delay:300+this.expandPhoneBarAI.effect.getComputedTiming().duration,duration:900,ease:"ease-out",iterations:1/0})}}resetAIBar(){var i;this.phoneBarAI.classList.remove("active"),(i=this.phoneBarAIYoyoAnimations)==null||i.cancel(),this.phoneBarAIYoyoAnimations=null}toPause(i){this.phoneBarPause.classList.add("active"),i==="user"&&(this.phoneBarOne.classList.remove("active"),this.phoneBarOne.classList.remove("talkToMe")),i==="AI"&&this.phoneBarAI.classList.remove("active")}toResume(i){this.phoneBarPause.classList.remove("active"),i==="user"&&(this.phoneBarOne.classList.add("active"),this.phoneBarOne.classList.add("talkToMe")),i==="AI"&&this.phoneBarAI.classList.add("active")}leave(){this.cancelAllAnimations(),this.resetUserBar(),this.resetProcessingBar(),this.resetAIBar()}}function Xn(){const p=new(window.AudioContext||window.webkitAudioContext);let i=p.createBuffer(1,1,22050),u=p.createBufferSource();return u.buffer=i,u.connect(p.destination),u.start(0),p}class U0{constructor({audioContext:i,audioUrl:u,onPlay:A,onEnded:w,loop:I=!1}){this.audioContext=i,this.audioUrl=u,this.onPlay=A,this.onEnded=w,this.loop=I,this.currentAudioPlaying=null,this.startTime=0,this.startOffset=0,this.isPaused=!1,this.playAudio()}async playAudio(){let u=await(await fetch(this.audioUrl)).arrayBuffer(),A=await this.audioContext.decodeAudioData(u);this.currentAudioPlaying=this.audioContext.createBufferSource(),this.currentAudioPlaying.buffer=A,this.currentAudioPlaying.connect(this.audioContext.destination),this.currentAudioPlaying.loop=this.loop,this.startTime=this.audioContext.currentTime,this.currentAudioPlaying.start(0,this.startOffset%A.duration),typeof this.onPlay=="function"&&this.onPlay(),this.currentAudioPlaying.onended=()=>{if(typeof this.onEnded=="function"){if(this.isPaused)return;this.onEnded()}}}pauseAudio(){this.isPaused=!0,this.currentAudioPlaying&&(console.log("pause"),this.currentAudioPlaying.stop(),this.startOffset+=this.audioContext.currentTime-this.startTime,this.currentAudioPlaying=null)}resumeAudio(){this.isPaused=!1,this.playAudio()}stopAudio(){this.currentAudioPlaying&&(this.currentAudioPlaying.stop(),this.currentAudioPlaying=null)}}class Yn{constructor({anims:i,pageEl:u,discussion:A,emitter:w}){this.unbindEvent=null,this.emitter=w,this.pageEl=u,this.discussion=A,this.phoneContainer=this.pageEl.querySelector(".phone__container"),this.phoneBtn=this.pageEl.querySelector(".phone-btn"),this.infoText=this.phoneContainer.querySelector(".phone__info.active"),this.pauseBtn=this.phoneContainer.querySelector(".phone__pause"),this.closeBtn=this.phoneContainer.querySelector(".phone__close"),this.phoneDebugContainer=this.pageEl.querySelector(".phone__debug"),this.btnToConnected=this.pageEl.querySelector("#btn-toConnected"),this.btnToTalkToMe=this.pageEl.querySelector("#btn-toTalkToMe"),this.btnToListening=this.pageEl.querySelector("#btn-toListening"),this.btnFinishTalk=this.pageEl.querySelector("#btn-finishTalk"),this.btnFinishProcessing=this.pageEl.querySelector("#btn-finishProcessing"),this.anims=i,this.isActive=!1,this.audioContext=null,this.audioConnected=null,this.audioProcessing=null,this.currentAudioAIPlaying=null,this.currentIndexAudioAI=null,this.audiosAI=[],this.isAITalking=!1,this.isAIPaused=!1,this.isStreamEnded=!1,this.emitter.on("endStream",()=>{console.log("stream end /////// "),this.isStreamEnded=!0}),this.isConnected=!1,this.myvad=null,this.isListening=!1,this.isMicMuted=!1,this.micAccessConfirmed=!1,this.phoneAnimations=new Dn({pageEl:this.pageEl}),this.onClickOutside={interrupt:!1,resumeAI:!1,unmuteMic:!1},this.addListeners(),this.debug=!1,this.debug&&(this.phoneDebugContainer.classList.add("show"),this.anims.toStartPhoneRecording(),this.startConnecting())}startConnecting(){this.phoneAnimations.toConnecting(),console.log("connecting"),this.phoneAnimations.newInfoText("connecting")}connected(){this.phoneAnimations.toConnected(),this.phoneAnimations.newInfoText("connected"),console.log("connected"),this.audioConnected=new U0({audioUrl:"/sounds/connected.mp3",audioContext:this.audioContext}),!this.debug&&setTimeout(()=>{this.isConnected=!0,this.toTalkToMe()},1500)}leave(){var i;console.log("leave"),(i=this.audioProcessing)==null||i.stopAudio(),this.unbindEvent(),this.unbindEvent=null,this.isActive=!1,this.phoneAnimations.leave(),this.stopRecording(),this.stopAITalking()}toTalkToMe(){this.isActive&&(console.log("Talk to me"),this.unbindEvent||(this.unbindEvent=this.emitter.on("addAITextTest",i=>this.startAITalking(i))),this.isStreamEnded=!1,this.phoneAnimations.toTalkToMe(),this.phoneAnimations.newInfoText("Talk to me"),this.myvad&&this.myvad.start())}toListening(){this.isListening||this.phoneAnimations.toListening(),this.isListening=!0,console.log("I'm listening"),this.phoneAnimations.newInfoText("I'm listening")}async toProcessing(i){this.phoneAnimations.newInfoText("processing"),this.phoneAnimations.toProcessing(),this.myvad.pause(),console.log("processing"),this.audioProcessing=new U0({audioUrl:"/sounds/processing.mp3",audioContext:this.audioContext,loop:!0});const u=Fn(i,16e3);this.textRecorded=await xa(u),this.discussion.addUserElement({text:this.textRecorded})}onPlay(){this.isAITalking||(this.phoneAnimations.newInfoText("Click to interrupt"),this.phoneAnimations.toAITalking()),this.isAITalking=!0,this.onClickOutside.interrupt=!0}async startAITalking(i){var A;if(!this.isActive)return;console.log("new AIAnswer");const u=await qn(Vn(i));this.audiosAI.push(u),this.currentIndexAudioAI===null&&(console.log("first sound"),(A=this.audioProcessing)==null||A.stopAudio(),this.currentIndexAudioAI=0,this.currentAudioAIPlaying=new U0({audioUrl:this.audiosAI[this.currentIndexAudioAI].src,audioContext:this.audioContext,onPlay:this.onPlay.bind(this),onEnded:this.checkIfNextAudio.bind(this)})),this.audiosAI[this.currentIndexAudioAI].onplay=()=>{}}async checkIfNextAudio(){if(this.isActive){if(this.audiosAI[this.currentIndexAudioAI+1])this.currentIndexAudioAI++,console.log("Stil one sound"),this.currentAudioAIPlaying=new U0({audioUrl:this.audiosAI[this.currentIndexAudioAI].src,audioContext:this.audioContext,onPlay:this.onPlay.bind(this),onEnded:this.checkIfNextAudio.bind(this)});else if(this.clearAIAudios(),this.isStreamEnded){if(console.log("all sounds plaid",this.isStreamEnded),this.debug)return;this.toTalkToMe(),this.isAITalking=!1}}}clearAIAudios(){this.currentIndexAudioAI=null,this.audiosAI=[],this.onClickOutside.interrupt=!1}stopAITalking(){var i;console.log("stop talking"),(i=this.currentAudioAIPlaying)==null||i.pauseAudio(),this.currentAudioAIPlaying=null,this.isAITalking=!1,this.clearAIAudios()}interrupt(){this.stopAITalking(),this.toTalkToMe()}async startRecording(){if(this.isActive=!0,this.micAccessConfirmed?this.toTalkToMe():this.startConnecting(),this.myvad||(this.myvad=await vad.MicVAD.new({onFrameProcessed:i=>{this.micAccessConfirmed||(this.micAccessConfirmed=!0,this.connected())},onSpeechStart:()=>{this.isConnected&&this.toListening()},onSpeechEnd:i=>{this.toProcessing(i),this.isListening=!1},redemptionFrames:10*1.4})),this.debug){this.myvad.pause();return}this.myvad.start()}stopRecording(){this.myvad.pause(),this.myvad.stream.getTracks().forEach(i=>{i.stop()}),this.myvad=null}async onCompleteRecording(i){this.isRecordCanceled||(this.textRecorded=await xa(i),this.timeoutTranscripting=setTimeout(()=>{this.onCompleteTranscripting()},this.minTranscriptingTime))}pauseAI(){var i;this.isAIPaused=!0,this.phoneAnimations.newInfoText("Click to resume"),this.phoneAnimations.toPause("AI"),this.pauseBtn.classList.add("active"),this.onClickOutside.interrupt=!1,this.onClickOutside.resumeAI=!0,!this.debug&&((i=this.currentAudioAIPlaying)==null||i.pauseAudio())}resumeAI(){var i;this.isAIPaused=!1,this.phoneAnimations.toResume("AI"),this.pauseBtn.classList.remove("active"),(i=this.currentAudioAIPlaying)==null||i.resumeAudio(),this.onClickOutside.resumeAI=!1}muteMic(){this.isMicMuted=!0,this.phoneAnimations.toPause("user"),this.phoneAnimations.newInfoText("Click to resume"),console.log("mute mic"),this.pauseBtn.classList.add("active"),this.onClickOutside.unmuteMic=!0,!this.debug&&this.myvad.pause()}unmuteMic(){this.isMicMuted=!1,console.log("unmute mic"),this.phoneAnimations.toResume("user"),this.phoneAnimations.newInfoText("Start talking"),this.pauseBtn.classList.remove("active"),this.onClickOutside.unmuteMic=!1,!this.debug&&this.myvad.start()}addListeners(){this.phoneBtn.addEventListener("click",async()=>{if(this.audioContext=Xn(),this.anims.toStartPhoneRecording(),this.debug){this.startConnecting();return}this.startRecording()}),this.closeBtn.addEventListener("click",async()=>{this.anims.toStopPhoneRecording(),this.leave()}),this.pauseBtn.addEventListener("click",async()=>{this.isAITalking?this.isAIPaused?this.resumeAI():this.pauseAI():this.isMicMuted?this.unmuteMic():this.muteMic()}),this.pageEl.addEventListener("click",i=>{this.pauseBtn.contains(i.target)||this.closeBtn.contains(i.target)||(this.onClickOutside.resumeAI&&this.resumeAI(),this.onClickOutside.unmuteMic&&this.unmuteMic(),this.onClickOutside.interrupt&&(console.log("interrupt"),this.interrupt()))},{capture:!0}),this.btnToConnected.addEventListener("click",()=>{this.connected()}),this.btnToTalkToMe.addEventListener("click",()=>{this.toTalkToMe()}),this.btnToListening.addEventListener("click",()=>{this.toListening()}),this.btnFinishTalk.addEventListener("click",()=>{this.toProcessing()}),this.btnFinishProcessing.addEventListener("click",()=>{this.isActive=!0,this.startAITalking("Bonjour je suis un test")})}}class Li{constructor({text:i,container:u,backgroundColor:A,marginLeft:w}){this.text=i,this.container=u,this.backgroundColor=A,this.marginLeft=w,this.init()}init(){this.typingContainer=document.createElement("div"),this.maskEl=document.createElement("div"),this.cursorEl=document.createElement("span"),this.textEl=document.createElement("p"),this.typingContainer.classList.add("typing__container"),this.maskEl.classList.add("typing__mask"),this.cursorEl.classList.add("typing__cursor"),this.textEl.classList.add("typing__text"),this.textEl.textContent=this.text,this.maskEl.style.backgroundColor=this.backgroundColor,this.typingContainer.style.left=`${this.marginLeft}px`,this.maskEl.appendChild(this.cursorEl),this.textEl.appendChild(this.maskEl),this.typingContainer.appendChild(this.textEl),this.container.appendChild(this.typingContainer)}blink(){this.typingContainer.style.visibility="visible",this.typingContainer.style.opacity=1,this.blinkCursor=Ie(this.cursorEl,[{opacity:1},{opacity:0},{opacity:1}],{duration:300,iterations:1/0,ease:"ease-in-out"})}fadeOut(){this.blinkCursor&&this.blinkCursor.cancel(),this.cursorEl.classList.add("hidden")}writing(i){this.blinkCursor&&this.blinkCursor.cancel(),this.animShowtyping=Ie(this.typingContainer,[{opacity:0,visibility:"visible"},{opacity:1,visibility:"visible"}],{duration:700,fill:"forwards",ease:"ease-in-out"}),this.translateCursor=Ie(this.maskEl,[{transform:"translateX(0%)"},{transform:"translateX(105%)"}],{delay:this.animShowtyping.effect.getComputedTiming().duration,duration:400,fill:"forwards",ease:"ease-in-out"}),i!=null&&i.onComplete&&(this.translateCursor.onfinish=i.onComplete.bind(this))}reverse(){this.blinkCursor&&this.blinkCursor.cancel(),this.translateCursor.reverse(),Ie(this.typingContainer,[{opacity:1,visibility:"visible"},{opacity:0,visibility:"hidden"}],{delay:500,duration:700,fill:"forwards",ease:"ease-in-out"})}}function ui(p){return(p<10?"0":"")+p}const Gn="820px";function Z0(){return window.innerWidth<=parseInt(Gn)}class $n{constructor(i){this.callbacks=i,this.gumStream=null,this.recorder=null,this.input=null,this.audioContext=null,this.encodingType="mp3"}startRecording(){const i={audio:!0,video:!1};this.audioContext=new(window.AudioContext||window.webkitAudioContext),navigator.mediaDevices.getUserMedia(i).then(u=>{this.gumStream=u,this.input=this.audioContext.createMediaStreamSource(u),this.recorder=new WebAudioRecorder(this.input,{workerDir:"./libAudioRecorder/",encoding:this.encodingType,numChannels:2,onEncoderLoading:(A,w)=>{},onEncoderLoaded:(A,w)=>{}}),this.recorder.onComplete=(A,w)=>{console.log("Encoding complete"),this.blob=w,this.callbacks.onComplete(w)},this.recorder.setOptions({timeLimit:120,encodeAfterRecord:!0,ogg:{quality:.5},mp3:{bitRate:160}}),this.recorder.startRecording(),console.log("Recording started")}).catch(u=>{console.log(u)})}onUpdate(i){function u(){var w;const A=((w=this.recorder)==null?void 0:w.recordingTime())|0;i(A)}this.timeInterval=window.setInterval(u.bind(this),200)}stopRecording(){this.gumStream.getAudioTracks()[0].stop(),this.recorder.finishRecording(),clearInterval(this.timeInterval),console.log("Recording stopped")}}class Un{constructor({pageEl:i}){this.pageEl=i,this.isPageBlue=this.pageEl.classList.contains("page-blue"),this.inputEl=this.pageEl.querySelector(".input__container"),this.inputFrontEl=this.inputEl.querySelector(".input__front"),this.inputBackEl=this.inputEl.querySelector(".input__back"),this.centerBtn=this.inputFrontEl.querySelector(".center-btn"),this.frontCameraBtn=this.inputFrontEl.querySelector(".camera-btn"),this.frontMicBtn=this.inputFrontEl.querySelector(".mic-btn")||this.inputFrontEl.querySelector(".phone-btn"),this.frontCenterBtn=this.inputFrontEl.querySelector(".center-btn"),this.inputFrontHeight=this.inputFrontEl.offsetHeight,this.isPageBlue?(this.recordCounter=this.inputEl.querySelector(".record-counter"),this.infoTextEl=document.querySelector(".info-text")):(this.overlayRecordingEl=this.pageEl.querySelector(".overlay__recording"),this.recordCircle=this.overlayRecordingEl.querySelector(".circle"),this.recordCounter=this.overlayRecordingEl.querySelector(".record-counter"),this.infoTextEl=this.overlayRecordingEl.querySelector(".info-text")),this.inputText=this.inputBackEl.querySelector(".input-text"),this.inputImageContainer=this.inputEl.querySelector(".input__image--container"),this.imageDroppedContainer=this.pageEl.querySelector(".image-dropped__container"),this.phoneContainer=this.pageEl.querySelector(".phone__container"),this.pageBlue=document.querySelector(".page-blue"),this.pageGrey=document.querySelector(".page-grey"),this.cancelBtn=document.querySelector(".cancel-btn"),this.logoEl=document.querySelector(".logo__main"),this.logoMobileEl=document.querySelector(".logo__mobile"),this.categoriesListEl=document.querySelector(".categories__list--container"),this.carousselEl=document.querySelector(".caroussel__container"),this.navbarEl=document.querySelector(".nav")}fadeInButtons(i=0,u=500){Ie([this.frontMicBtn,this.frontCameraBtn,this.frontCenterBtn],[{opacity:0},{opacity:1}],{delay:i,duration:u,fill:"forwards",ease:"ease-in-out"})}fadeOutButtons(i=0,u=500){Ie([this.frontMicBtn,this.frontCameraBtn,this.frontCenterBtn],[{opacity:1},{opacity:0}],{delay:i,duration:u,fill:"forwards",ease:"ease-in-out"})}fadeInCategoriesAndCaroussel(i=0){Ie([this.categoriesListEl,this.carousselEl],[{opacity:0},{opacity:1}],{delay:i,duration:500,fill:"forwards",ease:"ease-in-out"})}fadeOutCategoriesAndCaroussel(i=0){Ie([this.categoriesListEl,this.carousselEl],[{opacity:1},{opacity:0}],{delay:i,duration:500,fill:"forwards",ease:"ease-in-out"})}fadeOutLogo(i=0){Ie(this.logoEl,[{opacity:1},{opacity:0}],{duration:i+300,fill:"forwards",ease:"ease-in-out"}),Ie(this.logoMobileEl,[{opacity:0},{opacity:1}],{delay:i+300,duration:300,fill:"forwards",ease:"ease-in-out"})}fadeInLogo(i=0){Ie(this.logoEl,[{opacity:0},{opacity:1}],{delay:i,duration:300,fill:"forwards",ease:"ease-in-out"}),Ie(this.logoMobileEl,[{opacity:1},{opacity:0}],{delay:i,duration:300,fill:"forwards",ease:"ease-in-out"})}collapseHeightInputFront({delay:i=0,duration:u=400}={}){return Ie(this.inputFrontEl,[{height:"110px"},{height:`${this.inputFrontHeight}px`}],{delay:i,duration:u,fill:"forwards",ease:"ease-in-out"})}expandHeightInputFront({delay:i=0,duration:u=250,heighTarget:A=110}={}){return Ie(this.inputFrontEl,[{height:`${this.inputFrontHeight}px`},{height:`${A}px`}],{delay:i,duration:u,fill:"forwards",ease:"ease-in-out"})}expandWidthInputFront({delay:i=0,duration:u=400}={}){return Ie(this.inputFrontEl,[{width:`${this.inputFrontHeight}px`},{width:"100%"}],{delay:i,duration:u,ease:"ease-in-out",fill:"forwards"})}fadeInInputFront({delay:i=0,duration:u=400}={}){return Ie(this.inputFrontEl,[{opacity:0},{opacity:1}],{delay:i,duration:u,ease:"ease-in-out",fill:"forwards"})}toInitial({delay:i=0,animButtons:u=!0,animBottom:A=!0,animLogo:w=!0}={}){this.inputFrontEl.style.pointerEvents="auto",this.inputBackEl.style.pointerEvents="none",this.collapseHeightInputFront({duration:250}),Ie(this.inputBackEl,[{opacity:1},{opacity:0}],{delay:i,duration:100,fill:"forwards",ease:"ease-in-out"}),u&&this.fadeInButtons(i),A&&this.fadeInCategoriesAndCaroussel(i),w&&this.fadeInLogo(i+300)}fromRecordAudioToInitial(){this.inputFrontEl.style.pointerEvents="auto",this.inputBackEl.style.pointerEvents="none",this.fadeInButtons(1e3),this.fadeInCategoriesAndCaroussel(1e3),this.fadeInLogo(1e3)}toWrite({delay:i=0,animButtons:u=!0,animLogos:A=!0,placeholder:w=""}={}){this.inputText.placeholder=w,this.inputFrontEl.style.pointerEvents="none",this.inputBackEl.style.pointerEvents="auto",this.inputEl.style.overflow="hidden",A&&this.fadeOutLogo(),this.expandHeightInputFront({delay:i,duration:250}),u&&(this.fadeOutButtons(i,100),this.fadeOutCategoriesAndCaroussel(i)),Ie(this.inputBackEl,[{opacity:0},{opacity:1}],{delay:i,duration:500,delay:i?i+400:400,fill:"forwards",ease:"ease-in-out"}),Z0()&&!this.isPageBlue?this.inputText.click():(this.inputText.focus(),this.inputText.setSelectionRange(this.inputText.value.length,this.inputText.value.length))}toStartRecorginBluePage(){this.inputEl.style.overflow="unset",this.fadeOutLogo(),this.fadeOutCategoriesAndCaroussel();const i=Ie(this.inputFrontEl,[{width:`${this.inputFrontHeight}px`,offset:.45},{width:`${this.inputFrontHeight}px`,offset:1}],{duration:600,fill:"forwards",ease:"ease-out"}),u=Ie(this.inputFrontEl,[{transform:"translate3d(-50%, -50%, 0) scale(1)",offset:0},{transform:"translate3d(-50%, -50%, 0) scale(3.5)",offset:1}],{delay:i.effect.getComputedTiming().duration-300,duration:400,fill:"forwards",ease:"ease-in"});this.animCircleYoyo=Ie(this.inputFrontEl,[{transform:"translate3d(-50%, -50%, 0) scale(3.5)"},{transform:"translate3d(-50%, -50%, 0) scale(2.4)"},{transform:"translate3d(-50%, -50%, 0) scale(3.5)"}],{delay:i.effect.getComputedTiming().duration+u.effect.getComputedTiming().duration-300,duration:800,iterations:1/0,ease:"ease-in-out"}),Ie([this.recordCounter,this.infoTextEl],[{opacity:0,visibility:"visible"},{opacity:1,visibility:"visible"}],{delay:i.effect.getComputedTiming().duration,duration:700,fill:"forwards",ease:"ease-in-out"})}toStartRecordingGreyPage(){this.overlayRecordingEl.classList.add("show"),this.inputEl.classList.add("hidden"),this.animCircleYoyo=Ie(this.recordCircle,[{transform:"translate3d(-50%, -50%, 0) scale(1.3)"},{transform:"translate3d(-50%, -50%, 0) scale(1)"},{transform:"translate3d(-50%, -50%, 0) scale(1.3)"}],{duration:800,iterations:1/0,ease:"ease-in-out"}),Ie([this.recordCounter,this.infoTextEl],[{opacity:0,visibility:"visible"},{opacity:1,visibility:"visible"}],{duration:700,fill:"forwards",ease:"ease-in-out"})}toStartRecording(){this.cancelBtn.classList.add("show"),this.navbarEl.classList.add("hidden"),this.fadeOutButtons(0,100),this.inputEl.style.pointerEvents="none",this.isPageBlue?this.toStartRecorginBluePage():this.toStartRecordingGreyPage()}toStopRecording(i){if(this.cancelBtn.classList.remove("show"),this.navbarEl.classList.remove("hidden"),this.inputEl.style.pointerEvents="unset",this.animCircleYoyo.cancel(),this.isPageBlue){Ie([this.recordCounter,this.infoTextEl],[{opacity:1,visibility:"visible"},{opacity:0,visibility:"visible"}],{duration:300,fill:"forwards",ease:"ease-in-out"});const u=Ie(this.inputFrontEl,[{transform:"translate3d(-50%, -50%, 0) scale(3)"},{transform:"translate3d(-50%, -50%, 0) scale(1)"}],{duration:300,ease:"ease-in-out",fill:"forwards"}),A=this.expandWidthInputFront({delay:u.effect.getComputedTiming().duration+500,duration:250});i!=null&&i.onComplete&&(A.onfinish=i.onComplete)}else this.overlayRecordingEl.classList.remove("show"),this.inputEl.classList.remove("hidden"),i!=null&&i.onComplete&&i.onComplete()}toStartPhoneRecording(){this.inputEl.classList.add("hidden"),this.phoneContainer.classList.add("show")}toStopPhoneRecording(){const i=Ie(this.phoneContainer,[{opacity:1,transform:"translateY(0px)"},{topacity:0,transform:"translateY(100%)"}],{duration:300,ease:"ease-in-out",fill:"forwards"});i.onfinish=()=>{const u=Ie(this.inputEl,[{opacity:0,transform:"translateY(100%)"},{topacity:1,transform:"translateY(0)"}],{duration:300,ease:"ease-in-out",fill:"forwards"});i.cancel(),this.inputEl.classList.remove("hidden"),this.phoneContainer.classList.remove("show"),u.onfinish=()=>{u.cancel()}}}toDragImage({animBottom:i=!0,delay:u=0}={}){this.imageDroppedContainer.classList.remove("visible"),setTimeout(()=>{this.frontCameraBtn.classList.add("active-imagedrop"),this.inputImageContainer.classList.add("show")},u),i&&this.fadeOutCategoriesAndCaroussel(0,500)}leaveDragImage({animBottom:i=!0}={}){this.frontCameraBtn.classList.remove("active-imagedrop"),this.inputImageContainer.classList.remove("show"),this.fadeInButtons(),i&&this.fadeInCategoriesAndCaroussel(0,500)}toImageDroped(){this.inputImageContainer.classList.remove("show"),this.fadeOutButtons(0,0);const i=Ie(this.inputFrontEl,[{width:`${this.inputFrontHeight}px`,offset:.45},{width:`${this.inputFrontHeight}px`,offset:1}],{duration:800,fill:"forwards",ease:"ease-out"});this.animCircleYoyo=Ie(this.inputFrontEl,[{opacity:1},{opacity:0},{opacity:1}],{delay:i.effect.getComputedTiming().duration,duration:400,iterations:1/0,ease:"ease-in-out"})}toImageAnalyzed(){this.cancelBtn.classList.add("show"),this.navbarEl.classList.add("hidden"),this.animCircleYoyo.cancel();const i=this.fadeInInputFront({delay:0,duration:300});this.expandWidthInputFront({delay:i.effect.getComputedTiming().duration+500,duration:250}),this.toWrite({delay:1200,animButtons:!1,animLogos:!1,placeholder:"Ask a question about the image"}),this.imageDroppedContainer.classList.add("visible")}toRemoveImage(){this.imageDroppedContainer.classList.remove("visible"),this.cancelBtn.classList.remove("show"),this.navbarEl.classList.remove("hidden"),this.toInitial({animLogo:!1})}toImageReset(){this.animCircleYoyo.cancel(),this.fadeInButtons(300,delay);const i=this.fadeInInputFront({delay:0,duration:300}),u=this.expandWidthInputFront({delay:i.effect.getComputedTiming().duration+500,duration:250});this.fadeInButtons(i.effect.getComputedTiming().duration+u.effect.getComputedTiming().duration+500,0)}}const Dt={INITIAL:"INITIAL",RECORD_AUDIO:"RECORD_AUDIO",UPLOAD_IMAGE:"UPLOAD_IMAGE",WRITE:"WRITE"};class di{constructor({pageEl:i,isActive:u,toPageGrey:A,discussion:w,emitter:I}){this.isActive=u,this.toPageGrey=A,this.discussion=w,this.emitter=I,this.pageEl=i,this.inputEl=this.pageEl.querySelector(".input__container"),this.inputFrontEl=this.inputEl.querySelector(".input__front"),this.inputBackEl=this.inputEl.querySelector(".input__back"),this.submitBtn=this.inputBackEl.querySelector(".submit"),this.centerBtn=this.inputFrontEl.querySelector(".center-btn"),this.frontCameraBtn=this.inputFrontEl.querySelector(".camera-btn"),this.frontMicBtn=this.inputFrontEl.querySelector(".mic-btn"),this.frontCenterBtn=this.inputFrontEl.querySelector(".center-btn"),this.backCameraBtn=this.inputBackEl.querySelector(".camera-btn"),this.closeInputImageBtn=this.pageEl.querySelector(".input__image--closeBtn"),this.currentImage=null,this.inputImageEl=this.pageEl.querySelector(".input__image"),this.audioRecorder=new $n({onComplete:this.onCompleteRecording.bind(this)}),this.isRecordCanceled=!1,this.recordCounter=this.pageEl.querySelector(".record-counter"),this.backMicBtnContainer=this.inputBackEl.querySelector(".mic-btn__container"),this.backMicBtn=this.backMicBtnContainer.querySelector(".mic-btn"),this.backMicText=this.backMicBtnContainer.querySelector("p"),this.isSmallRecording=!1,this.inputText=this.inputBackEl.querySelector(".input-text"),this.cancelBtn=document.body.querySelector(".cancel-btn"),this.navbarEl=document.querySelector(".nav"),this.onClickOutside={stopAudio:!1,animInitial:!1},this.currentStatus=Dt.INITIAL,this.isPageBlue=this.pageEl.classList.contains("page-blue"),this.anims=new Un({pageEl:this.pageEl}),this.inputImage=new Di({reset:()=>this.anims.toImageReset(),toImageDroped:()=>this.anims.toImageDroped(),toImageAnalyzed:()=>this.anims.toImageAnalyzed()},{onImageUploaded:B=>{this.currentImage=B}},this.pageEl),this.isPageBlue||(this.phone=new Yn({pageEl:this.pageEl,discussion:this.discussion,emitter:this.emitter,anims:{toStartPhoneRecording:()=>this.anims.toStartPhoneRecording(),toStopPhoneRecording:()=>this.anims.toStopPhoneRecording()}})),this.addListeners(),this.minTranscriptingTime=1400,this.textRecorded="text recorded",this.isPageBlue}toWrite({delay:i=0,animButtons:u=!0,animLogos:A=!0}={}){this.currentStatus=Dt.WRITE,this.anims.toWrite({delay:i,animButtons:u,animLogos:A}),this.onClickOutside.animInitial=!0}startRecording(){this.isRecordCanceled=!1,this.inputText.disabled=!0,this.audioRecorder.startRecording(),this.timecodeAudioEl=this.isSmallRecording?this.backMicText:this.recordCounter,this.audioRecorder.onUpdate(i=>{const u=ui(i/60|0)+":"+ui(i%60);this.timecodeAudioEl.textContent=u})}stopRecording(){this.audioRecorder.stopRecording()}onTranscripting(){this.typingText=new Li({text:"Converting to text",container:this.inputFrontEl,backgroundColor:ya,marginLeft:16}),this.typingText.writing({onComplete:this.typingText.blink})}onCompleteTranscripting(){if(this.inputText.disabled=!1,this.timecodeAudioEl.textContent="00:00",this.inputText.value+=this.textRecorded,this.updateInputHeight(),this.isSmallRecording){this.isSmallRecording=!1,this.inputText.focus(),this.inputText.setSelectionRange(this.inputText.value.length,this.inputText.value.length);return}this.typingText&&this.typingText.reverse(),this.toWrite({delay:1200,animButtons:!1,animLogos:!1})}async onCompleteRecording(i){this.isRecordCanceled||(this.textRecorded=await xa(i),this.timeoutTranscripting=setTimeout(()=>{this.onCompleteTranscripting()},this.minTranscriptingTime))}cancelRecord(){this.isRecordCanceled=!0,this.onClickOutside.stopAudio=!1,this.stopRecording(),this.anims.toStopRecording(),this.anims.fromRecordAudioToInitial()}onSubmit(i){i.preventDefault(),this.isPageBlue&&this.toPageGrey({duration:1200}),this.discussion.addUserElement({text:this.inputText.value,img:this.currentImage}),this.inputText.value="",this.currentImage=null,this.updateInputHeight(),this.cancelBtn.classList.remove("show"),this.navbarEl.classList.remove("hidden"),this.goToInitial()}updateInputHeight(){const i=new Event("input",{bubbles:!0,cancelable:!0});this.inputText.dispatchEvent(i)}goToInitial(){this.currentStatus=Dt.INITIAL,this.anims.toInitial(),this.onClickOutside.animInitial=!1,this.inputText.disabled=!1}addListeners(){this.centerBtn.addEventListener("click",()=>{this.toWrite()}),document.addEventListener("keydown",()=>{this.isActive&&this.currentStatus!==Dt.WRITE&&!this.inputText.disabled&&this.toWrite()},{capture:!0}),this.frontMicBtn&&this.frontMicBtn.addEventListener("click",()=>{this.currentStatus=Dt.RECORD_AUDIO,this.startRecording(),this.anims.toStartRecording(),this.onClickOutside.stopAudio=!0}),this.cancelBtn.addEventListener("click",()=>{this.currentStatus===Dt.RECORD_AUDIO&&this.cancelRecord(),this.currentStatus===Dt.UPLOAD_IMAGE&&(this.anims.toRemoveImage(),this.inputImage.disable(),this.currentImage=null),this.currentStatus=Dt.INITIAL}),this.backMicBtn.addEventListener("click",()=>{this.isSmallRecording?(this.stopRecording(),this.backMicBtnContainer.classList.remove("active")):(this.isSmallRecording=!0,this.startRecording(),this.backMicBtnContainer.classList.add("active"))}),this.frontCameraBtn.addEventListener("click",()=>{this.currentStatus=Dt.UPLOAD_IMAGE,this.inputImage.enable(),this.anims.toDragImage()}),this.backCameraBtn.addEventListener("click",()=>{this.isSmallRecording||(this.currentStatus=Dt.UPLOAD_IMAGE,this.inputImage.enable(),this.anims.toInitial({animBottom:!1,animButtons:!1}),this.anims.toDragImage({animBottom:!1,delay:300}),this.onClickOutside.animInitial=!1)}),this.closeInputImageBtn.addEventListener("click",()=>{this.currentStatus=Dt.INITIAL,this.inputImage.disable(),this.anims.leaveDragImage()}),this.inputImageEl.addEventListener("focus",i=>{document.documentElement.style.overflow="unset",window.scrollTo(0,document.body.scrollHeight)}),this.inputImageEl.addEventListener("blur",i=>{document.documentElement.style.overflow="hidden",window.scrollTo(0,0)}),this.pageEl.addEventListener("click",i=>{if(!this.isSmallRecording&&!this.inputEl.contains(i.target)&&!this.cancelBtn.contains(i.target)&&(this.onClickOutside.stopAudio&&(this.stopRecording(),this.anims.toStopRecording({onComplete:this.onTranscripting.bind(this)}),this.onClickOutside.stopAudio=!1),this.onClickOutside.animInitial)){if(this.inputText.value)return;this.goToInitial()}},{capture:!0}),this.inputText.addEventListener("focus",()=>{this.submitBtn.disabled=!this.inputText.value.trim().length>0}),this.inputText.addEventListener("keyup",i=>{this.submitBtn.disabled=!this.inputText.value.trim().length>0}),this.inputText.addEventListener("keydown",i=>{this.inputText.value.trim().length>0&&i.key==="Enter"&&!i.shiftKey&&this.onSubmit(i)}),this.submitBtn.addEventListener("click",i=>this.onSubmit(i))}}class Kn{constructor(){this.navEl=document.querySelector(".nav"),this.navBtn=this.navEl.querySelector(".nav__btn"),this.navList=this.navEl.querySelector(".nav__list"),this.addListeners()}addListeners(){this.navBtn.addEventListener("click",()=>{this.navList.classList.toggle("show")}),this.navEl.addEventListener("mouseenter",()=>{Z0()||this.navList.classList.add("show")}),this.navEl.addEventListener("mouseleave",()=>{Z0()||this.navList.classList.remove("show")})}}let k0=0;function Zn(p,i){return new Promise(u=>{function A(){k0<i.length?(i.charAt(k0)===`
`?p.innerHTML+="<br>":p.innerHTML+=i.charAt(k0),k0++,setTimeout(A,10)):(k0=0,u())}A()})}function jn(p){var i=p.split(".")[1],u=i.replace(/-/g,"+").replace(/_/g,"/"),A=decodeURIComponent(window.atob(u).split("").map(function(w){return"%"+("00"+w.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(A)}let Wn=class{constructor(i,u,A,w){this.uuid=i,this.name=u,this.picture=A,this.email=w}};class Qn{constructor(i){R0(this,"callsubmit",async(i,u,A)=>{this.container=A;var w=i;if(this.sourcelang!=this.targetlang){var I=await this.googletranslate(w,this.targetlang,this.sourcelang);w=I.data.translations[0].translatedText,I.data.translations[0].detectedSourceLanguage&&(this.sourcelang=I.data.translations[0].detectedSourceLanguage)}if(this.awaiting&&this.workflowID!="")this.submituserreply(w,this.workflowID,u);else{var B=new XMLHttpRequest;B.onreadystatechange=async()=>{if(B.readyState==4){console.log(B.response);let y=JSON.parse(B.response);console.log(y.stream_id);let G=await qa({servers:["wss://ai.iamplus.services/tasks:8443"],user:"acc",pass:"user@123"});const Y=y.stream_id;console.log(Y);let U=await(await G.jetstream().consumers.get(Y,Y)).consume();G.onclose=function(k){console.log("Socket is closed. Reconnect will be attempted in 1 second.",k.reason),setTimeout(async function(){console.log("Socket is closed. Reconnect will be attempted in 1 second.",k.reason),G=await qa({servers:["wss://ai.iamplus.services/tasks:8443"],user:"acc",pass:"user@123"})},1e3)},G.onerror=function(k){console.error("Socket encountered error: ",k.message,"Closing socket"),ws.close()};for await(const k of U){var L=k.json();console.log(L);var V=L.data;if(L.message_type=="ui"&&(this.domain=L.ui_params.domain,console.log("domain:"+this.domain),this.domain=="MovieSearch"?(this.MovieSearch=JSON.parse(L.ui_params.MovieSearch),this.MovieSearchResults=JSON.parse(L.ui_params.MovieSearchResults)):this.domain=="TaxiSearch"?(this.TaxiSearch=JSON.parse(L.ui_params.TaxiSearch),this.TaxiSearchResults=JSON.parse(L.ui_params.TaxiSearchResults)):this.domain=="RAG_CHAT"?(this.RAG_CHAT=JSON.parse(L.ui_params.RAG_CHAT),console.log("domain RAG_CHAT:"+this.RAG_CHAT)):this.domain=="FlightSearch"&&(this.FlightSearch=JSON.parse(L.ui_params.FlightSearch),this.FlightSearchResults=JSON.parse(L.ui_params.FlightSearchResults))),L.awaiting&&(this.workflowID=L.session_id,this.awaiting=!0),L.awaiting&&L.message_type=="user_question"&&(this.agentawaiting=!0),L.streaming&&L.streaming==!0){var T=await this.toTitleCase2(V);if(this.sourcelang!="en"){var P=await this.googletranslate(await this.toTitleCase2(V),this.sourcelang,this.targetlang);T=P.data.translations[0].translatedText}await this.callbacks.addAIText({text:T,container:this.container}),L.stream_status&&L.stream_status=="ended"&&(this.callbacks.emitter.emit("endStream"),this.callbacks.enableInput(),await this.callbacks.addAIText({text:`

`,container:this.container}))}else if(L.status=="Agent ended"){this.workflowID="",this.awaiting=!1,this.callbacks.enableInput();return}else if(L.awaiting){console.log("awaiting:"+L.message_type),console.log("mtext:"+V),this.workflowID=L.session_id,this.awaiting=!0;var T=await this.toTitleCase2(V);if(console.log("AIAnswer:"+T),this.sourcelang!="en"){var P=await this.googletranslate(await this.toTitleCase2(V),this.sourcelang,this.targetlang);T=P.data.translations[0].translatedText}await this.callbacks.addAIText({text:T,container:this.container}),this.callbacks.emitter.emit("endStream"),this.domain=="RAG_CHAT"?(console.log("here RAG_CHAT:"+this.RAG_CHAT),this.getGucciUI(),this.domain="",this.RAG_CHAT=""):this.domain=="MovieSearch"&&(this.getMovies(),this.domain="",this.MovieSearchResults="",this.MovieSearch=""),this.callbacks.enableInput()}else if(L.status=="central finished")this.domain=="MovieSearch"?(this.getMovies(),this.domain="",this.MovieSearchResults="",this.MovieSearch=""):this.domain=="TaxiSearch"?(this.getTaxiUI(),this.TaxiSearchResults="",this.TaxiSearch="",this.domain=""):this.domain=="FlightSearch"&&(this.getFlightUI(),this.FlightSearch="",this.domain="",this.FlightSearchResults="");else if(L.message_type=="status"&&V!=""){var T=await this.toTitleCase2(V);if(this.sourcelang!="en"){var P=await this.googletranslate(T,this.sourcelang,this.targetlang);T=P.data.translations[0].translatedText}T+=`

`,await this.callbacks.addAIText({text:T,container:this.container,type:"status"})}k.ack()}G.drain()}},B.addEventListener("error",async function(L){console.log("error: "+L);var V="An error occurred while attempting to connect.";await this.callbacks.addAIText({text:V,container:this.container}),this.callbacks.enableInput()}),this.sessionID&&this.sessionID!=""?(B.open("POST","https://ai.iamplus.services/workflow/conversation",!0),B.setRequestHeader("Content-Type","application/json"),B.send(JSON.stringify({session_id:this.sessionID,uuid:this.deploy_ID}))):(B.open("POST","https://ai.iamplus.services/workflow/tasks",!0),B.setRequestHeader("Content-Type","application/json"),B.send(JSON.stringify({query:w,uuid:this.user.uuid})))}});R0(this,"translate",(i,u)=>new Promise(async(A,w)=>{var I=JSON.stringify([{text:i}]);console.log("text:"+i);var B=new XMLHttpRequest;B.addEventListener("readystatechange",function(){if(this.readyState===4){console.log(this.responseText);var L=JSON.parse(this.responseText);A(L)}}),B.open("POST","https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to="+u),B.setRequestHeader("Ocp-Apim-Subscription-Key","dd0450eaa72d4b628c901af99e551c8a"),B.setRequestHeader("Ocp-Apim-Subscription-Region","centralindia"),B.setRequestHeader("Content-Type","application/json"),B.addEventListener("error",function(L){console.log("error: "+L),w(L)}),B.send(I)}));R0(this,"googletranslate",(i,u,A)=>new Promise(async(w,I)=>{var B=new XMLHttpRequest,L="https://translation.googleapis.com/language/translate/v2",V="AIzaSyC1I58b1AR5z5V0b32ROnw55iFUjVso5dY";B.open("POST",`${L}?key=${V}`,!0),B.setRequestHeader("Content-Type","application/json"),B.onreadystatechange=function(){if(B.readyState===4&&B.status===200){console.log("google:"+B.responseText);var P=JSON.parse(B.responseText);P.data&&P.data.translations&&w(P)}else B.readyState===4&&B.status!==200&&console.error("Error:",B.responseText)};var T=JSON.stringify({q:i,target:u,source:A});B.send(T)}));this.callbacks=i,this.autodetect=null,this.targetlang="en",this.sourcelang="en",this.location="US",this.sessionID="",this.workflowID="",this.awaiting=!1,this.agentawaiting=!1,this.domain="",this.FlightSearch="",this.FlightSearchResults="",this.TaxiSearch="",this.TaxiSearchResults="",this.container=null,this.RAG_CHAT="",this.MovieSearch="",this.MovieSearchResults="",this.user=this.getUser(),this.deploy_ID=""}getUser(){if(localStorage.getItem("googleToken")){const i=jn(localStorage.getItem("googleToken"));return new Wn(i.sub,i.name,i.picture,i.email)}else return null}toTitleCase(i){return i=i.replace(/\w\S*/g,function(u){return u.charAt(0).toUpperCase()+u.substr(1).toLowerCase()}),i=i.replaceAll(`
`,"<br>"),i}toTitleCase2(i){return i=i.replaceAll(`
`,"<br>"),i}truncate(i){var u=200;return i&&i.length>u?i.slice(0,u-1)+"&hellip;":i}submituserreply(i,u,A){var w="";A&&A.length>0?w=JSON.stringify({message_type:"user_reply",user:"User",message:{type:"text",json:{},text:i},user_data:{type:"image",url:A[0]}}):w=JSON.stringify({message_type:"user_reply",user:"User",message:{type:"text",json:{},text:i}});var I=new XMLHttpRequest;I.addEventListener("readystatechange",function(){this.readyState===4&&console.log(this.responseText)}),I.open("POST","https://ai.iamplus.services/workflow/message/"+u),I.setRequestHeader("Content-Type","application/json"),I.send(w)}getMovies(){const i=document.createElement("div"),u=document.createElement("div");u.className="moviescard-container",this.MovieSearchResults.forEach(w=>{const I=document.createElement("div");I.className="movies-card",I.setAttribute("data-info","movies-details"),I.setAttribute("data-details",JSON.stringify(w).replace(/'/g,"&#39;")),I.addEventListener("click",V=>this.showMovieDetail(V));const B=document.createElement("img");B.className="movies-image",B.setAttribute("alt",w.MovieTitle.replace(/'/g,"&#39;")),B.setAttribute("src",w.MoviePoster),I.appendChild(B);const L=document.createElement("p");L.className="movies-title",L.innerText=w.MovieTitle,I.appendChild(L),u.appendChild(I)}),i.appendChild(u);const A=document.createElement("div");A.setAttribute("id","movie-details"),i.appendChild(A),this.container.appendChild(i)}showMovieDetail(i){let u=i.target,A=u.parentElement.parentElement.parentElement.querySelector("#movie-details"),w=JSON.parse(u.parentElement.getAttribute("data-details").replace("&#39;",/'/g));w.Theatre.forEach(I=>{const B=document.createElement("div");B.className="movie-details-card";const L=document.createElement("div");L.className="movie-details-theater-header",L.innerHTML=I.Name,B.appendChild(L);const V=document.createElement("div");V.className="movie-details-dates",V.setAttribute("data-details",JSON.stringify(I).replace(/'/g,"&#39;")),this.getMoviesDateShowtime(w.MovieTitle,I,I.DateTime[0].Date,V),console.log(w.MovieTitle),B.appendChild(V),A.innerHTML="",A.appendChild(B)})}getMoviesDateShowtime(i,u,A,w){const I=document.createElement("div");I.className="movie-details-date-selector";const B=document.createElement("button");B.className="arrow left-arrow",B.innerHTML="&lt;&nbsp;&nbsp;",B.addEventListener("click",T=>this.getmovieshowtimes(T,-1,i)),u.DateTime[0].Date==A&&(B.disabled=!0),I.appendChild(B);const L=document.createElement("span");L.innerText=A,I.appendChild(L);const V=document.createElement("button");V.className="arrow right-arrow",V.innerHTML="&nbsp;&nbsp;&gt;",V.addEventListener("click",T=>this.getmovieshowtimes(T,1,i)),u.DateTime[u.DateTime.length-1].Date==A&&(V.disabled=!0),I.appendChild(V),w.appendChild(I),u.DateTime.forEach(T=>{if(T.Date==A){const P=document.createElement("div");P.className="movie-details-showtimes",T.Time.forEach(y=>{const G=document.createElement("button");G.className="movie-details-showtime",G.innerHTML=y.slice(0,-3),G.addEventListener("click",Y=>this.submitmovieselection(i,u.Name,T.Date,y.slice(0,-3))),P.appendChild(G)}),w.appendChild(P)}})}getmovieshowtimes(i,u,A){let w=i.target,I=w.parentElement.parentElement.parentElement.querySelector(".movie-details-dates"),B=JSON.parse(I.getAttribute("data-details").replace("&#39;",/'/g));if(u==1){const L=w.previousElementSibling.tagName==="SPAN"?w.previousElementSibling:null;let V=new Date(L.innerHTML);V.setDate(V.getDate()+1),I.innerHTML="",this.getMoviesDateShowtime(A,B,V.toISOString().slice(0,10),I)}else{const L=w.nextElementSibling.tagName==="SPAN"?w.nextElementSibling:null;let V=new Date(L.innerHTML);V.setDate(V.getDate()-1),I.innerHTML="",this.getMoviesDateShowtime(A,B,V.toISOString().slice(0,10),I)}}async submitmovieselection(i,u,A,w){if(i=i.replace("","'"),this.agentawaiting){var I="book movie ticket for "+JSON.stringify({movie_name:i,theatre_name:u,movie_date:A,movie_time:w}),B=JSON.stringify({message_type:"user_reply",user:"User",message:{type:"text",json:{},text:I}}),L=new XMLHttpRequest;L.withCredentials=!0,L.addEventListener("readystatechange",function(){this.readyState===4&&console.log(this.responseText)}),L.open("POST","https://ai.iamplus.services/workflow/message/"+this.workflowID),L.setRequestHeader("Content-Type","application/json"),L.send(B),this.agentawaiting=!1}else{var I="book movie ticket for "+JSON.stringify({movie_name:i,theatre_name:u,movie_date:A,movie_time:w});console.log("texttosend:"+I),this.callsubmit(I,"",this.container)}}getTaxiUI(){const i=document.createElement("div");i.className="rides-list-wrapper";let u=this.TaxiSearchResults;for(let A=0;A<u.services.length;A++){let w=u.services[A];if(w){const I=document.createElement("div");I.className="rides-list-item",i.appendChild(I);const B=document.createElement("div");B.className="rides-list-item-header",I.appendChild(B);const L=document.createElement("figure");L.className="rides-list-item-header-logo",B.appendChild(L);const V=document.createElement("img");V.setAttribute("src","./images/logo/"+w.provider+"-logo.svg"),V.setAttribute("alt",w.provider),L.appendChild(V);const T=document.createElement("div");T.className="rides-list-item-header-info";const P=document.createElement("p");w.name.includes("TAXI_HAILING")?P.innerHTML="Taxi Hailing":P.innerHTML=w.name,T.appendChild(P);const y=document.createElement("p");y.innerHTML=w.description,T.appendChild(y);const G=document.createElement("p");if(G.innerHTML=w.seats,T.appendChild(G),w.deeplink){const D=document.createElement("a");D.setAttribute("href",w.deeplink),D.setAttribute("target","_blank"),D.innerHTML="Link",T.appendChild(D)}B.appendChild(T);const Y=document.createElement("div");Y.className="rides-list-item-content";const K=document.createElement("div");if(K.className="rides-list-item-content-prices",w.price)if(w.price.length>1){const D=document.createElement("span");D.innerText="$",K.appendChild(D);const U=document.createElement("span");if(U.innerText=w.price[0]+"-"+w.price[1],K.appendChild(U),A==0){const k=document.createElement("span");k.className="rides-list-item-content-sticker",k.innerText="cheapest",Y.appendChild(k)}}else{const D=document.createElement("span");D.innerText="$",K.appendChild(D);const U=document.createElement("span");if(U.innerText=w.price,K.appendChild(U),A==0){const k=document.createElement("span");k.className="rides-list-item-content-sticker",k.innerText="cheapest",Y.appendChild(k)}}else{const D=document.createElement("span"),U=document.createElement("span");K.appendChild(D),K.appendChild(U)}Y.appendChild(K),I.appendChild(Y),i.appendChild(I),this.container.appendChild(i)}}}getFlightUI(){const i=document.createElement("div");if(i.className="FlightContainer Flight-Container",i.setAttribute("name","flightResult"),this.FlightSearch.departure_end_date.length>0&&this.FlightSearch.return_end_date.length>0){const A=document.createElement("div");A.className="flight-toggle-button-container",i.appendChild(A);const w=document.createElement("button");w.className="flight-toggle-button active",w.addEventListener("click",B=>this.toggleflights(B)),w.innerHTML="Outbound",w.id="Outbound",A.appendChild(w);const I=document.createElement("button");I.className="flight-toggle-button",I.addEventListener("click",B=>this.toggleflights(B)),I.id="Return",I.innerHTML="Return",A.appendChild(I)}let u=this.FlightSearchResults.Outbound;for(let A=0;A<2;A++)if(A==1&&(u=this.FlightSearchResults.Return),u.length>0){const w=document.createElement("div");w.className="flightResult",A==0&&(w.className="flightResult",w.setAttribute("id","flightResultOutbound"),i.appendChild(w)),A==1&&(w.setAttribute("id","flightResultReturn"),w.setAttribute("style","display:None"),i.appendChild(w));let I=0;u.forEach(B=>{const L=document.createElement("div");L.className="flightCard",L.setAttribute("onclick","window.open('"+B.link_url+"', '_blank');"),w.appendChild(L);const V=document.createElement("div");V.className="rowFlightCard",L.appendChild(V);const T=document.createElement("div");T.className="logoFight",V.appendChild(T);const P=document.createElement("div");T.appendChild(P);const y=document.createElement("img");y.setAttribute("src",B.travel.airlines_logo?B.travel.airlines_logo:"./images/flight.jpg"),y.setAttribute("style","height: 40px;mix-blend-mode: multiply;"),P.appendChild(y);const G=document.createElement("div");G.className="flghtCost",V.appendChild(G);const Y=document.createElement("span");Y.className="currency",Y.innerHTML="USD",G.appendChild(Y);const K=document.createElement("p");K.className="big",K.innerHTML=B.price.split("$")[1],G.appendChild(K);const D=document.createElement("div");D.className="rowFlightCard",L.appendChild(D);const U=document.createElement("div");U.className="start",D.appendChild(U);const k=document.createElement("span");k.innerHTML=B.airport1_code,U.appendChild(k);const _=document.createElement("p");_.className="big",_.innerHTML=B.travel.start_time.split(`
`)[0]+(B.travel.start_time.split(`
`)[1]?'<span class="small">'+B.travel.start_time.split(`
`)[1]+"</span>":""),U.appendChild(_);const m=document.createElement("div");m.className="duration",D.appendChild(m);const E=document.createElement("p");E.className="timeHourMin",E.innerHTML=B.travel.duration.split("h")[0]+'<span style="color: rgba(0, 0, 0, 0.40);">h</span> '+B.travel.duration.substring(B.travel.duration.indexOf(" "),B.travel.duration.indexOf("m"))+'<span style="color: rgba(0, 0, 0, 0.40);">m</span>',m.appendChild(E);const e=document.createElement("div");e.className="dDirection",m.appendChild(e);let v='<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.053 15.5789L12 24L10 24L12.526 15.5789L7.166 15.5789L5.5 18.7368L4 18.7368L5 14L4 9.26316L5.5 9.26316L7.167 12.4211L12.527 12.4211L10 4L12 4L17.053 12.4211L22.5 12.4211C22.8978 12.4211 23.2794 12.5874 23.5607 12.8835C23.842 13.1796 24 13.5812 24 14C24 14.4188 23.842 14.8204 23.5607 15.1165C23.2794 15.4126 22.8978 15.5789 22.5 15.5789L17.053 15.5789Z" fill="black" fill-opacity="0.4"/></svg>';B.travel.stops==0?(v+='<svg xmlns="http://www.w3.org/2000/svg" width="152" height="28" viewBox="0 0 152 28" fill="none">',v+='<line x1="0.6" y1="13.4" x2="151.4" y2="13.4" stroke="black" stroke-opacity="0.4" stroke-width="1.2"',v+='stroke-linecap="round" stroke-dasharray="0.1 4" />',v+="</svg>"):(v+='<svg width="136" height="28" viewBox="0 0 136 28" fill="none" xmlns="http://www.w3.org/2000/svg">',v+='<line x1="0.6" y1="13.4" x2="58.4" y2="13.4" stroke="black" stroke-opacity="0.4" stroke-width="1.2" stroke-linecap="round" stroke-dasharray="0.1 4"/>',v+='<g clip-path="url(#clip0_10855_133720)">',v+='<circle cx="68" cy="14" r="3.00002" stroke="black" stroke-opacity="0.4" stroke-width="1.50001"/>',v+="</g>",v+='<line x1="77.1" y1="13.4" x2="134.9" y2="13.4" stroke="black" stroke-opacity="0.4" stroke-width="1.2" stroke-linecap="round" stroke-dasharray="0.1 4"/>',v+="<defs>",v+='<clipPath id="clip0_10855_133720">',v+='<rect width="18" height="28" fill="white" transform="translate(58.5)"/>',v+="</clipPath>",v+="</defs>",v+="</svg>"),v+='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="20" viewBox="0 0 18 20" fill="none">',v+='<circle cx="9.50002" cy="10.0001" r="3.75002" fill="black" fill-opacity="0.4" />',v+="</svg>",m.innerHTML=v;const f=document.createElement("p");f.className="dDirection",B.travel.stops==0?f.innerHTML="Direct":B.travel.stops==1?f.innerHTML=B.travel.stops+" connection":f.innerHTML=B.travel.stops+" connections",m.appendChild(f);const x=document.createElement("div");x.className="destination",D.appendChild(x);const c=document.createElement("span");c.innerHTML=B.airport2_code,x.appendChild(c);const n=document.createElement("p");if(n.className="big",n.innerHTML=B.travel.end_time.split(`
`)[0]+(B.travel.end_time.split(`
`)[1]?'<span class="small">'+B.travel.end_time.split(`
`)[1]+"</span>":""),x.appendChild(n),I==0){const h=document.createElement("div");h.className="recommand",h.innerHTML="CHEAPEST",L.appendChild(h)}const s=document.createElement("div");s.className="site",s.innerHTML=B.website,L.appendChild(s),I++})}this.container.appendChild(i)}toggleflights(i){let u=i.target;u.id=="Outbound"?(u.classList.add("active"),u.parentElement.querySelector("#Return").classList.remove("active"),u.parentElement.parentElement.querySelector("#flightResultOutbound").style.display="flex",u.parentElement.parentElement.querySelector("#flightResultReturn").style.display="none"):(u.classList.add("active"),u.parentElement.querySelector("#Outbound").classList.remove("active"),u.parentElement.parentElement.querySelector("#flightResultOutbound").style.display="none",u.parentElement.parentElement.querySelector("#flightResultReturn").style.display="flex")}getGucciUI(){const i=document.createElement("div"),u=document.createElement("div");u.className="productcard-container",i.appendChild(u),this.RAG_CHAT.forEach(w=>{const I=document.createElement("div");I.className="product-card",I.setAttribute("data-info","product-details"),I.setAttribute("data-details",JSON.stringify(w).replace(/'/g,"&#39;")),I.addEventListener("click",P=>this.showProductDetail(P)),u.appendChild(I);const B=document.createElement("img");B.className="product-image",B.setAttribute("src",w.image_url),B.setAttribute("alt",w.name),I.appendChild(B);const L=document.createElement("h3");L.className="product-name",L.innerHTML=w.name,I.appendChild(L);const V=document.createElement("p");V.className="product-price",V.innerHTML=w.price,I.appendChild(V);const T=document.createElement("div");T.className="product-overlay",I.appendChild(T)});const A=document.createElement("div");A.id="product-details",i.appendChild(A),this.container.appendChild(i)}showProductDetail(i){let u=i.target;var A=JSON.parse(u.parentElement.getAttribute("data-details")),w=u.parentElement.parentElement.parentElement.querySelector("#product-details");const I=document.createElement("div");I.className="product-details-card";const B=document.createElement("div");B.className="product-details-image",I.appendChild(B);const L=document.createElement("div");L.className="carousel",B.appendChild(L),A.image_urls.forEach(D=>{const U=document.createElement("div");U.className="carouselitem";const k=document.createElement("img");k.setAttribute("src",D),k.setAttribute("alt",A.name),U.appendChild(k),L.appendChild(U)});const V=document.createElement("div");V.className="product-details",I.appendChild(V);const T=document.createElement("h1");T.className="product-details-title",T.innerHTML=A.name,V.appendChild(T);const P=document.createElement("div");P.className="product-details-price",P.innerHTML=A.price,V.appendChild(P);const y=document.createElement("button");y.className="product-details-add-btn",V.appendChild(y);const G=document.createElement("a");G.setAttribute("href",A.link_url),G.setAttribute("target","_blank"),y.appendChild(G);const Y=document.createElement("img");Y.setAttribute("src","./images/buy.svg"),G.appendChild(Y);const K=document.createElement("p");K.className="product-details-description",K.innerHTML=A.desc.replaceAll(`
`,"<br>"),V.appendChild(K),w.innerHTML="",w.appendChild(I)}formatDateToString(i){const u=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];i=new Date(i);const w=u[i.getDay()],I=i.getDate(),B=A[i.getMonth()];return`${w}, ${I} ${B}`}}class zn{constructor({toPageGrey:i,emitter:u}){this.emitter=u,this.toPageGrey=i,this.page=document.querySelector(".page-grey"),this.mainEl=this.page.querySelector("main"),this.inputText=this.page.querySelector(".input-text"),this.discussionContainer=document.querySelector(".discussion__container"),this.addUserElement=this.addUserElement.bind(this),this.lastStatus=null,this.Chat=new Qn({addAIText:this.addAIText.bind(this),disableInput:this.disableInput.bind(this),enableInput:this.enableInput.bind(this),emitter:u}),this.addListeners()}disableInput(){this.inputText.disabled=!0}enableInput(){this.inputText.disabled=!1,this.inputText.focus()}getAiAnswer({text:i,img:u}){const A=document.createElement("div");A.classList.add("discussion__ai"),this.discussionContainer.appendChild(A),this.scrollToBottom(),this.typingText=new Li({text:"",container:A,backgroundColor:Pi,marginLeft:16}),this.typingText.blink(),this.Chat.callsubmit(i,u,A)}addUserElement({text:i,img:u}){if(u){const w=document.createElement("div");w.classList.add("discussion__user"),w.appendChild(u),this.discussionContainer.appendChild(w)}const A=document.createElement("div");A.classList.add("discussion__user"),A.innerHTML=i.replace(/\n/g,"<br>"),this.discussionContainer.appendChild(A),this.scrollToBottom(),this.disableInput(),this.getAiAnswer({text:i,img:u})}async addAIText({text:i,container:u,type:A=null}={}){this.emitter.emit("addAITextTest",i),this.typingText.fadeOut();const w=document.createElement("span");return A==="status"?(u.innerHTML="",w.className="AIstatus",this.lastStatus=w):this.lastStatus&&(u.removeChild(this.lastStatus),this.lastStatus=null),u.appendChild(w),i=i.replace(/<br\/?>\s*/g,`
`),Z0()?w.innerHTML=i:(i=i.replace(/<br\/?>\s*/g,`
`),Zn(w,i))}scrollToBottom(){this.mainEl.scrollTo({top:this.discussionContainer.scrollHeight,behavior:"smooth"})}async onLoad(){var i=window.location.search,u=new URLSearchParams(i),A=u.get("q");const w=u.get("session_id"),I=u.get("deploy_id");u.get("location")&&u.get("location")!=""&&(this.Chat.location=u.get("location")),u.get("lang")&&u.get("lang")!=""&&(this.Chat.sourcelang=u.get("lang"),this.Chat.sourcelang=="ad"&&(this.Chat.sourcelang=""),this.Chat.autodetect=!0),A&&A!=""&&this.getAiAnswer({text:""}),w&&w!=""&&(this.toPageGrey(),this.Chat.sessionID=w,this.Chat.deploy_ID=I,this.getAiAnswer({text:""}))}addListeners(){window.addEventListener("load",this.onLoad()),new ResizeObserver(this.scrollToBottom.bind(this)).observe(this.discussionContainer)}}let Jn=()=>({emit(p,...i){for(let u=0,A=this.events[p]||[],w=A.length;u<w;u++)A[u](...i)},events:{},on(p,i){var u;return((u=this.events)[p]||(u[p]=[])).push(i),()=>{var A;this.events[p]=(A=this.events[p])==null?void 0:A.filter(w=>i!==w)}}});function er(p){var i=p.split(".")[1],u=i.replace(/-/g,"+").replace(/_/g,"/"),A=decodeURIComponent(window.atob(u).split("").map(function(w){return"%"+("00"+w.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(A)}class tr{constructor(i,u,A,w){this.uuid=i,this.name=u,this.picture=A,this.email=w}}class ar{constructor(){this.pageBlue=document.querySelector(".page-blue"),this.pageGrey=document.querySelector(".page-grey"),this.navbarEl=document.querySelector(".nav"),this.cancelBtn=document.querySelector(".cancel-btn"),this.emitter=Jn(),this.user=this.getUser(),this.addListeners(),this.resetScroll(),this.user||this.redirectToLogin()}getUser(){if(localStorage.getItem("googleToken")){const i=er(localStorage.getItem("googleToken"));return new tr(i.sub,i.name,i.picture,i.email)}else return null}redirectToLogin(){console.log("notloggedin"),window.location.href="./login/index.html"}toPageGrey({duration:i=0}={}){this.pageBlue.style.transitionDuration=i+"ms",this.pageGrey.style.transitionDuration=i+"ms",this.pageBlue.classList.add("hidden"),this.pageGrey.classList.add("show"),this.navbarEl.classList.add("dark"),this.cancelBtn.classList.add("dark"),setTimeout(()=>{this.inputBluePage.isActive=!1,this.inputGreyPage.isActive=!0})}initApp(){this.initNavbar(),this.initCaroussel(),this.initDiscussion(),this.initInput()}initNavbar(){new Kn}initCaroussel(){this.caroussel=new qi,this.caroussel.init()}initDiscussion(){this.discussion=new zn({emitter:this.emitter,toPageGrey:this.toPageGrey.bind(this)})}initInput(){const i={discussion:this.discussion,toPageGrey:this.toPageGrey.bind(this),emitter:this.emitter};this.inputBluePage=new di({pageEl:this.pageBlue,isActive:!0,...i}),this.inputGreyPage=new di({pageEl:this.pageGrey,isActive:!1,...i})}resetScroll(){window.scrollTo(0,0)}addListeners(){window.addEventListener("load",()=>{document.body.classList.remove("preload")}),document.fonts.ready.then(()=>{this.initApp()})}}new ar;
