var Oi=Object.defineProperty;var Hi=(p,a,_)=>a in p?Oi(p,a,{enumerable:!0,configurable:!0,writable:!0,value:_}):p[a]=_;var ra=(p,a,_)=>(Hi(p,typeof a!="symbol"?a+"":a,_),_);import"./index-1d823425.js";import{connect as o0,AckPolicy as Pi,JSONCodec as l0}from"https://cdn.jsdelivr.net/npm/nats.ws@latest/esm/nats.js";function Di({element:p,expression:a=" ",append:_=!0}){const b=Vi(p.innerHTML.toString().trim(),a);let x="";b.forEach(E=>{E.indexOf("<br>")>-1?E.split("<br>").forEach((H,T)=>{x+=T>0?"<br>"+_0(H):_0(H)}):x+=_0(E)}),p.innerHTML=x;const B=p.querySelectorAll("span");return _&&B.forEach(E=>{const N=E.textContent.length===1,H=E.innerHTML.trim()!=="",T=E.textContent!=="&",D=E.textContent!=="-";N&&H&&T&&D&&(E.innerHTML=`${E.textContent}&nbsp;`)}),B}function Fi(p){const a=[];let _=[],b=p[0].offsetTop;return p.forEach((x,B)=>{x.offsetTop===b&&_.push(x),x.offsetTop!==b&&(a.push(_),_=[],_.push(x),b=x.offsetTop),B+1===p.length&&a.push(_)}),a}function Vi(p,a){const _=p.split("<br>");let b=[];return _.forEach((x,B)=>{B>0&&b.push("<br>"),b=b.concat(x.split(a));let E=!1,N="";const H=[];b.forEach(T=>{!E&&(T.includes("<a")||T.includes("<strong"))&&(N="",E=!0),E&&(N+=` ${T}`),E&&(T.includes("/a>")||T.includes("/strong>"))&&(H.push(N),N=""),!E&&N===""&&H.push(T),E&&(T.includes("/a>")||T.includes("/strong>"))&&(E=!1)}),b=H}),b}function _0(p){return p=p.trim(),p===""||p===" "?p:p==="<br>"?"<br>":`<span>${p}</span>`+(p.length>1?" ":"")}function qi(p){let a=[],_=Math.floor(p.length/2);a.push(p[_]);for(let b=1;b<=_;b++)p[_+b]!==void 0?(a.push(p[_-b]),a.push(p[_+b])):p[_-b]!==void 0&&a.push(p[_-b]);return a}function Ie(p,a,_){return Array.isArray(p)?p.map(b=>b.animate(a,_)):p.animate(a,_)}const x0="#fff",Y0="#648ff2",$0="#eaeced";const c0=["Book me a flight from Singapore to Kuala Lumpur on  flight from Singapore to Kuala Lumpur","Book me a flight from Paris to Kuala Lumpur on  flight from Singapore to Kuala Lumpur","Book me a flight from London to Kuala Lumpur on  flight from Singapore to Kuala Lumpur"];function Pa(p,a,_){const b=_?"translateX(0%)":`translateX(${a})`,x=_?`translateX(${a})`:"translateX(0%)";return Ie(p,[{color:Y0,transform:b,offset:0},{color:x0,offset:.5},{color:x0,offset:.95},{color:Y0,transform:x,offset:1},{opacity:1}],{duration:500,fill:"forwards",ease:"ease-in-out"})}class Xi{constructor(){this.carousselEl=document.querySelector(".caroussel__container"),this.carousselTextEl=this.carousselEl.querySelector(".caroussel__text"),this.nextBtn=this.carousselEl.querySelector("#btn-next"),this.prevBtn=this.carousselEl.querySelector("#btn-prev"),this.markerEl=this.carousselEl.querySelector(".caroussel__markers")}init(){this.currentIndex=0,this.startAnimIndex=0,this.isComplete=!1,this.addText(),this.createMarkers(),this.updateButtons(),this.createLines(),this.addListeners(),this.showLines()}createMarkers(){for(let a=0;a<c0.length;a++){let _=document.createElement("span");_.classList.add("marker"),a===this.currentIndex&&_.classList.add("active"),this.markerEl.appendChild(_)}}addText(){this.carousselTextEl.innerHTML="",this.carousselTextEl.textContent=c0[this.currentIndex]}createLines(){this.splitLines=Fi(Di({element:this.carousselTextEl})),this.nbLines=this.splitLines.length,this.middleLineIndex=this.nbLines%2===1?Math.floor(this.nbLines/2):null,this.carousselTextEl.innerHTML="",this.linesEls=this.getLines(this.splitLines),this.linesSorted=qi(this.linesEls),this.addClasses(),this.addMasks()}getLines(a){return a.map((_,b)=>{const x=_.map(E=>E.outerHTML).join(" "),B=document.createElement("div");return B.innerHTML=x,this.carousselTextEl.appendChild(B),B})}addClasses(){this.linesEls.forEach((a,_)=>{if(this.middleLineIndex!==null&&_===this.middleLineIndex)a.classList.add("caroussel__line--middle");else{const x=(_-this.middleLineIndex)%2===0?"caroussel__line--even":"caroussel__line--odd";a.classList.add("caroussel__line"),a.classList.add(x)}})}addMasks(){for(let a=0;a<this.linesSorted.length;){const _=this.linesSorted[a];if(_.classList.contains("caroussel__line--middle")){const b=document.createElement("span"),x=document.createElement("span");b.classList.add("mask","mask-left"),x.classList.add("mask","mask-right"),b.textContent="/",x.textContent="/",_.appendChild(b),_.appendChild(x),a++}else{const b=this.linesSorted[a],x=this.linesSorted[a+1],B=document.createElement("span"),E=document.createElement("span");B.classList.add("mask","mask-left"),E.classList.add("mask","mask-right"),B.textContent="/",E.textContent="/",x.appendChild(B),b.appendChild(E),a+=2}}}onHideComplete(){this.isComplete||(this.isComplete=!0,this.carousselTextEl.style.opacity=0,this.addText(),this.createLines(),this.carousselTextEl.style.opacity=1,this.updateMarkers(),this.animLines(!0))}onShowComplete(){this.startAnimIndex=0,this.isAnimating=!1}animLines(a){if(this.startAnimIndex>this.nbLines-1){this.startAnimIndex=0,a?this.onShowComplete():(this.startAnimIndex=0,this.onHideComplete());return}if(this.middleLineIndex!==null&&this.startAnimIndex===0){const _=this.linesSorted[this.startAnimIndex],b=_.querySelector(".mask-left"),x=_.querySelector(".mask-right");Pa(x,"100%",a);const B=Pa(b,"-100%",a);B.onfinish=()=>{this.startAnimIndex=1,this.animLines(a)}}else{const _=this.linesSorted[this.startAnimIndex],b=this.linesSorted[this.startAnimIndex+1],x=_.querySelector(".mask"),B=b.querySelector(".mask");Pa(x,"100%",a);const E=Pa(B,"-100%",a);E.onfinish=()=>{this.startAnimIndex+=2,this.animLines(a)}}}showLines(){this.carousselTextEl.querySelectorAll(".mask").forEach(_=>{_.classList.contains("mask-left")?_.style.transform="translateX(-100%)":_.style.transform="translateX(100%)"})}updateMarkers(){const a=this.markerEl.querySelectorAll(".marker");a.forEach(_=>_.classList.remove("active")),a[this.currentIndex].classList.add("active")}updateButtons(){this.nextBtn.disabled=this.currentIndex===c0.length-1,this.prevBtn.disabled=this.currentIndex===0}prev(){this.isAnimating||(this.isAnimating=!0,this.isComplete=!1,this.currentIndex-=1,this.updateButtons(),this.animLines(!1))}next(){this.isAnimating||(this.isAnimating=!0,this.isComplete=!1,this.currentIndex+=1,this.updateButtons(),this.animLines(!1))}addListeners(){this.nextBtn.addEventListener("click",()=>{this.next()}),this.prevBtn.addEventListener("click",()=>{this.prev()})}}class Yi{constructor(a,_,b){this.pageEl=b,this.imageDroppedContainer=this.pageEl.querySelector(".image-dropped__container"),this.dropImageOverlayEl=this.pageEl.querySelector(".image-drop-zone--overlay"),this.inputFileUploadEl=this.pageEl.querySelector(".input__file-upload"),this.closeBtn=this.pageEl.querySelector(".input__image--closeBtn"),this.anims=a,this.callbacks=_,this.analizingImageMinTime=1e3,this.isEnabled=!1,this.addListeners()}uploadFile(a){let _=/image.*/;if(a.type.match(_)){let b="HTTP/HTTPS URL TO SEND THE DATA TO",x=new FormData;x.append("file",a),fetch(b,{method:"put",body:x}).then(B=>B.json()).then(B=>{console.log("Success:",B)}).catch(B=>{console.error("Error:",B)})}else console.error("Only images are allowed!",a)}enable(){this.isEnabled=!0}disable(){this.inputFileUploadEl.value="",this.imageDroppedContainer.innerHTML="",this.isEnabled=!1}onDrop(a){this.anims.toImageDroped(),console.log("TODO: add end point to send the image file to the server",a),setTimeout(()=>{this.previewImage(a)},this.analizingImageMinTime)}previewImage(a){let _=/image.*/;if(a.type.match(_)){this.anims.toImageAnalyzed();let b=new FileReader;b.readAsDataURL(a),b.onloadend=()=>{let x=document.createElement("img");x.src=b.result,a.size/1e3+"",this.imageDroppedContainer.appendChild(x),this.callbacks.onImageUploaded(x)}}else this.anims.reset(),console.error("Only images are allowed!",a)}addListeners(){["dragenter","dragover","dragleave","drop"].forEach(_=>{this.pageEl.addEventListener(_,a)});function a(_){_.preventDefault(),_.stopPropagation()}["dragenter","dragover"].forEach(_=>{this.pageEl.addEventListener(_,()=>{this.isEnabled&&this.dropImageOverlayEl.classList.add("hovered")})}),["dragleave","drop"].forEach(_=>{this.pageEl.addEventListener(_,()=>{this.isEnabled&&this.dropImageOverlayEl.classList.remove("hovered")})}),this.pageEl.addEventListener("drop",_=>{if(!this.isEnabled)return;const B=_.dataTransfer.files[0];this.onDrop(B)}),this.inputFileUploadEl.addEventListener("change",_=>{if(this.inputFileUploadEl.files&&this.inputFileUploadEl.files[0]){const b=this.inputFileUploadEl.files[0];this.onDrop(b)}})}}const T0=p=>new Promise((a,_)=>{var b=new XMLHttpRequest,x=new FormData;x.append("audio_file",p,crypto.randomUUID()+".wav"),x.append("type","audio/wav"),b.open("POST","https://ai.iamplus.services/speech/asr?task=transcribe&encode=true&output=json&word_timestamps=false",!0),b.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE&&this.status===200){var B=JSON.parse(this.responseText);a(B.text)}},b.addEventListener("error",function(B){console.log("error: "+B),a("error: text was not transcribed")}),b.send(x)});function B0(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var I0={};function $i(p){return new Int8Array(p)}function pi(p){return new Int16Array(p)}function bi(p){return new Int32Array(p)}function Si(p){return new Float32Array(p)}function Gi(p){return new Float64Array(p)}function yi(p){if(p.length==1)return Si(p[0]);var a=p[0];p=p.slice(1);for(var _=[],b=0;b<a;b++)_.push(yi(p));return _}function Ai(p){if(p.length==1)return bi(p[0]);var a=p[0];p=p.slice(1);for(var _=[],b=0;b<a;b++)_.push(Ai(p));return _}function Ei(p){if(p.length==1)return pi(p[0]);var a=p[0];p=p.slice(1);for(var _=[],b=0;b<a;b++)_.push(Ei(p));return _}function wi(p){if(p.length==1)return new Array(p[0]);var a=p[0];p=p.slice(1);for(var _=[],b=0;b<a;b++)_.push(wi(p));return _}var xi={};xi.fill=function(p,a,_,b){if(arguments.length==2)for(var x=0;x<p.length;x++)p[x]=arguments[1];else for(var x=a;x<_;x++)p[x]=b};var Na={};Na.arraycopy=function(p,a,_,b,x){for(var B=a+x;a<B;)_[b++]=p[a++]};Na.out={};Na.out.println=function(p){console.log(p)};Na.out.printf=function(){console.log.apply(console,arguments)};var Wa={};Wa.SQRT2=1.4142135623730951;Wa.FAST_LOG10=function(p){return Math.log10(p)};Wa.FAST_LOG10_X=function(p,a){return Math.log10(p)*a};function Jt(p){this.ordinal=p}Jt.short_block_allowed=new Jt(0);Jt.short_block_coupled=new Jt(1);Jt.short_block_dispensed=new Jt(2);Jt.short_block_forced=new Jt(3);var Ti={};Ti.MAX_VALUE=34028235e31;function Lt(p){this.ordinal=p}Lt.vbr_off=new Lt(0);Lt.vbr_mt=new Lt(1);Lt.vbr_rh=new Lt(2);Lt.vbr_abr=new Lt(3);Lt.vbr_mtrh=new Lt(4);Lt.vbr_default=Lt.vbr_mtrh;var Ui=function(p){},He={System:Na,VbrMode:Lt,Float:Ti,ShortBlock:Jt,Util:Wa,Arrays:xi,new_array_n:wi,new_byte:$i,new_double:Gi,new_float:Si,new_float_n:yi,new_int:bi,new_int_n:Ai,new_short:pi,new_short_n:Ei,assert:Ui},h0,G0;function Ki(){if(G0)return h0;G0=1;var p=He,a=p.System;p.VbrMode,p.Float,p.ShortBlock;var _=p.Util,b=p.Arrays;p.new_array_n,p.new_byte,p.new_double;var x=p.new_float;p.new_float_n,p.new_int,p.new_int_n,p.assert;var B=je();function E(){var N=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*_.SQRT2*.5/2384e-9,.017876148*_.SQRT2*.5/2384e-9,.003134727*_.SQRT2*.5/2384e-9,.002457142*_.SQRT2*.5/2384e-9,971317e-9*_.SQRT2*.5/2384e-9,218868e-9*_.SQRT2*.5/2384e-9,101566e-9*_.SQRT2*.5/2384e-9,13828e-9*_.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],H=12,T=36,D=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],w=D[B.SHORT_TYPE],G=D[B.SHORT_TYPE],$=D[B.SHORT_TYPE],K=D[B.SHORT_TYPE],q=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function U(m,y,e){for(var v=10,f=y+238-14-286,R=-15;R<0;R++){var u,n,s;u=N[v+-10],n=m[f+-224]*u,s=m[y+224]*u,u=N[v+-9],n+=m[f+-160]*u,s+=m[y+160]*u,u=N[v+-8],n+=m[f+-96]*u,s+=m[y+96]*u,u=N[v+-7],n+=m[f+-32]*u,s+=m[y+32]*u,u=N[v+-6],n+=m[f+32]*u,s+=m[y+-32]*u,u=N[v+-5],n+=m[f+96]*u,s+=m[y+-96]*u,u=N[v+-4],n+=m[f+160]*u,s+=m[y+-160]*u,u=N[v+-3],n+=m[f+224]*u,s+=m[y+-224]*u,u=N[v+-2],n+=m[y+-256]*u,s-=m[f+256]*u,u=N[v+-1],n+=m[y+-192]*u,s-=m[f+192]*u,u=N[v+0],n+=m[y+-128]*u,s-=m[f+128]*u,u=N[v+1],n+=m[y+-64]*u,s-=m[f+64]*u,u=N[v+2],n+=m[y+0]*u,s-=m[f+0]*u,u=N[v+3],n+=m[y+64]*u,s-=m[f+-64]*u,u=N[v+4],n+=m[y+128]*u,s-=m[f+-128]*u,u=N[v+5],n+=m[y+192]*u,s-=m[f+-192]*u,n*=N[v+6],u=s-n,e[30+R*2]=s+n,e[31+R*2]=N[v+7]*u,v+=18,y--,f++}{var n,s,h,r;s=m[y+-16]*N[v+-10],n=m[y+-32]*N[v+-2],s+=(m[y+-48]-m[y+16])*N[v+-9],n+=m[y+-96]*N[v+-1],s+=(m[y+-80]+m[y+48])*N[v+-8],n+=m[y+-160]*N[v+0],s+=(m[y+-112]-m[y+80])*N[v+-7],n+=m[y+-224]*N[v+1],s+=(m[y+-144]+m[y+112])*N[v+-6],n-=m[y+32]*N[v+2],s+=(m[y+-176]-m[y+144])*N[v+-5],n-=m[y+96]*N[v+3],s+=(m[y+-208]+m[y+176])*N[v+-4],n-=m[y+160]*N[v+4],s+=(m[y+-240]-m[y+208])*N[v+-3],n-=m[y+224],h=n-s,r=n+s,s=e[14],n=e[15]-s,e[31]=r+s,e[30]=h+n,e[15]=h-n,e[14]=r-s}{var t;t=e[28]-e[0],e[0]+=e[28],e[28]=t*N[v+-2*18+7],t=e[29]-e[1],e[1]+=e[29],e[29]=t*N[v+-2*18+7],t=e[26]-e[2],e[2]+=e[26],e[26]=t*N[v+-4*18+7],t=e[27]-e[3],e[3]+=e[27],e[27]=t*N[v+-4*18+7],t=e[24]-e[4],e[4]+=e[24],e[24]=t*N[v+-6*18+7],t=e[25]-e[5],e[5]+=e[25],e[25]=t*N[v+-6*18+7],t=e[22]-e[6],e[6]+=e[22],e[22]=t*_.SQRT2,t=e[23]-e[7],e[7]+=e[23],e[23]=t*_.SQRT2-e[7],e[7]-=e[6],e[22]-=e[7],e[23]-=e[22],t=e[6],e[6]=e[31]-t,e[31]=e[31]+t,t=e[7],e[7]=e[30]-t,e[30]=e[30]+t,t=e[22],e[22]=e[15]-t,e[15]=e[15]+t,t=e[23],e[23]=e[14]-t,e[14]=e[14]+t,t=e[20]-e[8],e[8]+=e[20],e[20]=t*N[v+-10*18+7],t=e[21]-e[9],e[9]+=e[21],e[21]=t*N[v+-10*18+7],t=e[18]-e[10],e[10]+=e[18],e[18]=t*N[v+-12*18+7],t=e[19]-e[11],e[11]+=e[19],e[19]=t*N[v+-12*18+7],t=e[16]-e[12],e[12]+=e[16],e[16]=t*N[v+-14*18+7],t=e[17]-e[13],e[13]+=e[17],e[17]=t*N[v+-14*18+7],t=-e[20]+e[24],e[20]+=e[24],e[24]=t*N[v+-12*18+7],t=-e[21]+e[25],e[21]+=e[25],e[25]=t*N[v+-12*18+7],t=e[4]-e[8],e[4]+=e[8],e[8]=t*N[v+-12*18+7],t=e[5]-e[9],e[5]+=e[9],e[9]=t*N[v+-12*18+7],t=e[0]-e[12],e[0]+=e[12],e[12]=t*N[v+-4*18+7],t=e[1]-e[13],e[1]+=e[13],e[13]=t*N[v+-4*18+7],t=e[16]-e[28],e[16]+=e[28],e[28]=t*N[v+-4*18+7],t=-e[17]+e[29],e[17]+=e[29],e[29]=t*N[v+-4*18+7],t=_.SQRT2*(e[2]-e[10]),e[2]+=e[10],e[10]=t,t=_.SQRT2*(e[3]-e[11]),e[3]+=e[11],e[11]=t,t=_.SQRT2*(-e[18]+e[26]),e[18]+=e[26],e[26]=t-e[18],t=_.SQRT2*(-e[19]+e[27]),e[19]+=e[27],e[27]=t-e[19],t=e[2],e[19]-=e[3],e[3]-=t,e[2]=e[31]-t,e[31]+=t,t=e[3],e[11]-=e[19],e[18]-=t,e[3]=e[30]-t,e[30]+=t,t=e[18],e[27]-=e[11],e[19]-=t,e[18]=e[15]-t,e[15]+=t,t=e[19],e[10]-=t,e[19]=e[14]-t,e[14]+=t,t=e[10],e[11]-=t,e[10]=e[23]-t,e[23]+=t,t=e[11],e[26]-=t,e[11]=e[22]-t,e[22]+=t,t=e[26],e[27]-=t,e[26]=e[7]-t,e[7]+=t,t=e[27],e[27]=e[6]-t,e[6]+=t,t=_.SQRT2*(e[0]-e[4]),e[0]+=e[4],e[4]=t,t=_.SQRT2*(e[1]-e[5]),e[1]+=e[5],e[5]=t,t=_.SQRT2*(e[16]-e[20]),e[16]+=e[20],e[20]=t,t=_.SQRT2*(e[17]-e[21]),e[17]+=e[21],e[21]=t,t=-_.SQRT2*(e[8]-e[12]),e[8]+=e[12],e[12]=t-e[8],t=-_.SQRT2*(e[9]-e[13]),e[9]+=e[13],e[13]=t-e[9],t=-_.SQRT2*(e[25]-e[29]),e[25]+=e[29],e[29]=t-e[25],t=-_.SQRT2*(e[24]+e[28]),e[24]-=e[28],e[28]=t-e[24],t=e[24]-e[16],e[24]=t,t=e[20]-t,e[20]=t,t=e[28]-t,e[28]=t,t=e[25]-e[17],e[25]=t,t=e[21]-t,e[21]=t,t=e[29]-t,e[29]=t,t=e[17]-e[1],e[17]=t,t=e[9]-t,e[9]=t,t=e[25]-t,e[25]=t,t=e[5]-t,e[5]=t,t=e[21]-t,e[21]=t,t=e[13]-t,e[13]=t,t=e[29]-t,e[29]=t,t=e[1]-e[0],e[1]=t,t=e[16]-t,e[16]=t,t=e[17]-t,e[17]=t,t=e[8]-t,e[8]=t,t=e[9]-t,e[9]=t,t=e[24]-t,e[24]=t,t=e[25]-t,e[25]=t,t=e[4]-t,e[4]=t,t=e[5]-t,e[5]=t,t=e[20]-t,e[20]=t,t=e[21]-t,e[21]=t,t=e[12]-t,e[12]=t,t=e[13]-t,e[13]=t,t=e[28]-t,e[28]=t,t=e[29]-t,e[29]=t,t=e[0],e[0]+=e[31],e[31]-=t,t=e[1],e[1]+=e[30],e[30]-=t,t=e[16],e[16]+=e[15],e[15]-=t,t=e[17],e[17]+=e[14],e[14]-=t,t=e[8],e[8]+=e[23],e[23]-=t,t=e[9],e[9]+=e[22],e[22]-=t,t=e[24],e[24]+=e[7],e[7]-=t,t=e[25],e[25]+=e[6],e[6]-=t,t=e[4],e[4]+=e[27],e[27]-=t,t=e[5],e[5]+=e[26],e[26]-=t,t=e[20],e[20]+=e[11],e[11]-=t,t=e[21],e[21]+=e[10],e[10]-=t,t=e[12],e[12]+=e[19],e[19]-=t,t=e[13],e[13]+=e[18],e[18]-=t,t=e[28],e[28]+=e[3],e[3]-=t,t=e[29],e[29]+=e[2],e[2]-=t}}function L(m,y){for(var e=0;e<3;e++){var v,f,R,u,n,s;u=m[y+2*3]*D[B.SHORT_TYPE][0]-m[y+5*3],v=m[y+0*3]*D[B.SHORT_TYPE][2]-m[y+3*3],f=u+v,R=u-v,u=m[y+5*3]*D[B.SHORT_TYPE][0]+m[y+2*3],v=m[y+3*3]*D[B.SHORT_TYPE][2]+m[y+0*3],n=u+v,s=-u+v,v=(m[y+1*3]*D[B.SHORT_TYPE][1]-m[y+4*3])*2069978111953089e-26,u=(m[y+4*3]*D[B.SHORT_TYPE][1]+m[y+1*3])*2069978111953089e-26,m[y+3*0]=f*190752519173728e-25+v,m[y+3*5]=-n*190752519173728e-25+u,R=R*.8660254037844387*1907525191737281e-26,n=n*.5*1907525191737281e-26+u,m[y+3*1]=R-n,m[y+3*2]=R+n,f=f*.5*1907525191737281e-26-v,s=s*.8660254037844387*1907525191737281e-26,m[y+3*3]=f+s,m[y+3*4]=f-s,y++}}function c(m,y,e){var v,f;{var R,u,n,s,h,r,t,d;R=e[17]-e[9],n=e[15]-e[11],s=e[14]-e[12],h=e[0]+e[8],r=e[1]+e[7],t=e[2]+e[6],d=e[3]+e[5],m[y+17]=h+t-d-(r-e[4]),f=(h+t-d)*G[12+7]+(r-e[4]),v=(R-n-s)*G[12+6],m[y+5]=v+f,m[y+6]=v-f,u=(e[16]-e[10])*G[12+6],r=r*G[12+7]+e[4],v=R*G[12+0]+u+n*G[12+1]+s*G[12+2],f=-h*G[12+4]+r-t*G[12+5]+d*G[12+3],m[y+1]=v+f,m[y+2]=v-f,v=R*G[12+1]-u-n*G[12+2]+s*G[12+0],f=-h*G[12+5]+r-t*G[12+3]+d*G[12+4],m[y+9]=v+f,m[y+10]=v-f,v=R*G[12+2]-u+n*G[12+0]-s*G[12+1],f=h*G[12+3]-r+t*G[12+4]-d*G[12+5],m[y+13]=v+f,m[y+14]=v-f}{var l,F,I,g,i,o,O,P;l=e[8]-e[0],I=e[6]-e[2],g=e[5]-e[3],i=e[17]+e[9],o=e[16]+e[10],O=e[15]+e[11],P=e[14]+e[12],m[y+0]=i+O+P+(o+e[13]),v=(i+O+P)*G[12+7]-(o+e[13]),f=(l-I+g)*G[12+6],m[y+11]=v+f,m[y+12]=v-f,F=(e[7]-e[1])*G[12+6],o=e[13]-o*G[12+7],v=i*G[12+3]-o+O*G[12+4]+P*G[12+5],f=l*G[12+2]+F+I*G[12+0]+g*G[12+1],m[y+3]=v+f,m[y+4]=v-f,v=-i*G[12+5]+o-O*G[12+3]-P*G[12+4],f=l*G[12+1]+F-I*G[12+2]-g*G[12+0],m[y+7]=v+f,m[y+8]=v-f,v=-i*G[12+4]+o-O*G[12+5]-P*G[12+3],f=l*G[12+0]-F+I*G[12+1]-g*G[12+2],m[y+15]=v+f,m[y+16]=v-f}}this.mdct_sub48=function(m,y,e){for(var v=y,f=286,R=0;R<m.channels_out;R++){for(var u=0;u<m.mode_gr;u++){for(var n,s=m.l3_side.tt[u][R],h=s.xr,r=0,t=m.sb_sample[R][1-u],d=0,l=0;l<18/2;l++)for(U(v,f,t[d]),U(v,f+32,t[d+1]),d+=2,f+=64,n=1;n<32;n+=2)t[d-1][n]*=-1;for(n=0;n<32;n++,r+=18){var F=s.block_type,I=m.sb_sample[R][u],g=m.sb_sample[R][1-u];if(s.mixed_block_flag!=0&&n<2&&(F=0),m.amp_filter[n]<1e-12)b.fill(h,r+0,r+18,0);else{if(m.amp_filter[n]<1)for(var l=0;l<18;l++)g[l][q[n]]*=m.amp_filter[n];if(F==B.SHORT_TYPE){for(var l=-H/4;l<0;l++){var i=D[B.SHORT_TYPE][l+3];h[r+l*3+9]=I[9+l][q[n]]*i-I[8-l][q[n]],h[r+l*3+18]=I[14-l][q[n]]*i+I[15+l][q[n]],h[r+l*3+10]=I[15+l][q[n]]*i-I[14-l][q[n]],h[r+l*3+19]=g[2-l][q[n]]*i+g[3+l][q[n]],h[r+l*3+11]=g[3+l][q[n]]*i-g[2-l][q[n]],h[r+l*3+20]=g[8-l][q[n]]*i+g[9+l][q[n]]}L(h,r)}else{for(var o=x(18),l=-T/4;l<0;l++){var O,P;O=D[F][l+27]*g[l+9][q[n]]+D[F][l+36]*g[8-l][q[n]],P=D[F][l+9]*I[l+9][q[n]]-D[F][l+18]*I[8-l][q[n]],o[l+9]=O-P*w[3+l+9],o[l+18]=O*w[3+l+9]+P}c(h,r,o)}}if(F!=B.SHORT_TYPE&&n!=0)for(var l=7;l>=0;--l){var se,le;se=h[r+l]*$[20+l]+h[r+-1-l]*K[28+l],le=h[r+l]*K[28+l]-h[r+-1-l]*$[20+l],h[r+-1-l]=se,h[r+l]=le}}}if(v=e,f=286,m.mode_gr==1)for(var re=0;re<18;re++)a.arraycopy(m.sb_sample[R][1][re],0,m.sb_sample[R][0][re],0,32)}}}return h0=E,h0}var u0,U0;function Ri(){if(U0)return u0;U0=1;var p=je(),a=He,_=a.System;a.VbrMode,a.Float,a.ShortBlock,a.Util,a.Arrays,a.new_array_n,a.new_byte,a.new_double;var b=a.new_float,x=a.new_float_n;a.new_int,a.new_int_n,a.assert;function B(){this.l=b(p.SBMAX_l),this.s=x([p.SBMAX_s,3]);var E=this;this.assign=function(N){_.arraycopy(N.l,0,E.l,0,p.SBMAX_l);for(var H=0;H<p.SBMAX_s;H++)for(var T=0;T<3;T++)E.s[H][T]=N.s[H][T]}}return u0=B,u0}var d0,K0;function Zi(){if(K0)return d0;K0=1;var p=Ri();function a(){this.thm=new p,this.en=new p}return d0=a,d0}var v0,Z0;function je(){if(Z0)return v0;Z0=1;var p=He,a=p.System,_=p.VbrMode;p.Float,p.ShortBlock,p.Util,p.Arrays;var b=p.new_array_n;p.new_byte,p.new_double;var x=p.new_float,B=p.new_float_n,E=p.new_int;p.new_int_n;var N=p.assert;H.ENCDELAY=576,H.POSTDELAY=1152,H.MDCTDELAY=48,H.FFTOFFSET=224+H.MDCTDELAY,H.DECDELAY=528,H.SBLIMIT=32,H.CBANDS=64,H.SBPSY_l=21,H.SBPSY_s=12,H.SBMAX_l=22,H.SBMAX_s=13,H.PSFB21=6,H.PSFB12=6,H.BLKSIZE=1024,H.HBLKSIZE=H.BLKSIZE/2+1,H.BLKSIZE_s=256,H.HBLKSIZE_s=H.BLKSIZE_s/2+1,H.NORM_TYPE=0,H.START_TYPE=1,H.SHORT_TYPE=2,H.STOP_TYPE=3,H.MPG_MD_LR_LR=0,H.MPG_MD_LR_I=1,H.MPG_MD_MS_LR=2,H.MPG_MD_MS_I=3,H.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function H(){var T=Ki(),D=Zi(),w=H.FFTOFFSET,G=H.MPG_MD_MS_LR,$=null;this.psy=null;var K=null,q=null,U=null;this.setModules=function(e,v,f,R){$=e,this.psy=v,K=v,q=R,U=f};var L=new T;function c(e){var v,f;if(e.ATH.useAdjust==0){e.ATH.adjust=1;return}if(f=e.loudness_sq[0][0],v=e.loudness_sq[1][0],e.channels_out==2?(f+=e.loudness_sq[0][1],v+=e.loudness_sq[1][1]):(f+=f,v+=v),e.mode_gr==2&&(f=Math.max(f,v)),f*=.5,f*=e.ATH.aaSensitivityP,f>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var R=31.98*f+625e-6;e.ATH.adjust>=R?(e.ATH.adjust*=R*.075+.925,e.ATH.adjust<R&&(e.ATH.adjust=R)):e.ATH.adjustLimit>=R?e.ATH.adjust=R:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=R}}function m(e){var v,f;for(N(0<=e.bitrate_index&&e.bitrate_index<16),N(0<=e.mode_ext&&e.mode_ext<4),e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,e.channels_out==2&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),v=0;v<e.mode_gr;++v)for(f=0;f<e.channels_out;++f){var R=e.l3_side.tt[v][f].block_type|0;e.l3_side.tt[v][f].mixed_block_flag!=0&&(R=4),e.bitrate_blockType_Hist[e.bitrate_index][R]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][R]++,e.bitrate_blockType_Hist[15][5]++}}function y(e,v){var f=e.internal_flags,R,u;if(f.lame_encode_frame_init==0){var n,s,h=x(2014),r=x(286+1152+576);for(f.lame_encode_frame_init=1,n=0,s=0;n<286+576*(1+f.mode_gr);++n)n<576*f.mode_gr?(h[n]=0,f.channels_out==2&&(r[n]=0)):(h[n]=v[0][s],f.channels_out==2&&(r[n]=v[1][s]),++s);for(u=0;u<f.mode_gr;u++)for(R=0;R<f.channels_out;R++)f.l3_side.tt[u][R].block_type=H.SHORT_TYPE;L.mdct_sub48(f,h,r),N(576>=H.FFTOFFSET),N(f.mf_size>=H.BLKSIZE+e.framesize-H.FFTOFFSET),N(f.mf_size>=512+e.framesize-32)}}this.lame_encode_mp3_frame=function(e,v,f,R,u,n){var s,h=b([2,2]);h[0][0]=new D,h[0][1]=new D,h[1][0]=new D,h[1][1]=new D;var r=b([2,2]);r[0][0]=new D,r[0][1]=new D,r[1][0]=new D,r[1][1]=new D;var t,d=[null,null],l=e.internal_flags,F=B([2,4]),I=[.5,.5],g=[[0,0],[0,0]],i=[[0,0],[0,0]],o,O,P;if(d[0]=v,d[1]=f,l.lame_encode_frame_init==0&&y(e,d),l.padding=0,(l.slot_lag-=l.frac_SpF)<0&&(l.slot_lag+=e.out_samplerate,l.padding=1),l.psymodel!=0){var se,le=[null,null],re=0,oe=E(2);for(P=0;P<l.mode_gr;P++){for(O=0;O<l.channels_out;O++)le[O]=d[O],re=576+P*576-H.FFTOFFSET;if(e.VBR==_.vbr_mtrh||e.VBR==_.vbr_mt?se=K.L3psycho_anal_vbr(e,le,re,P,h,r,g[P],i[P],F[P],oe):se=K.L3psycho_anal_ns(e,le,re,P,h,r,g[P],i[P],F[P],oe),se!=0)return-4;for(e.mode==MPEGMode.JOINT_STEREO&&(I[P]=F[P][2]+F[P][3],I[P]>0&&(I[P]=F[P][3]/I[P])),O=0;O<l.channels_out;O++){var be=l.l3_side.tt[P][O];be.block_type=oe[O],be.mixed_block_flag=0}}}else for(P=0;P<l.mode_gr;P++)for(O=0;O<l.channels_out;O++)l.l3_side.tt[P][O].block_type=H.NORM_TYPE,l.l3_side.tt[P][O].mixed_block_flag=0,i[P][O]=g[P][O]=700;if(c(l),L.mdct_sub48(l,d[0],d[1]),l.mode_ext=H.MPG_MD_LR_LR,e.force_ms)l.mode_ext=H.MPG_MD_MS_LR;else if(e.mode==MPEGMode.JOINT_STEREO){var he=0,ne=0;for(P=0;P<l.mode_gr;P++)for(O=0;O<l.channels_out;O++)he+=i[P][O],ne+=g[P][O];if(he<=1*ne){var xe=l.l3_side.tt[0],Pe=l.l3_side.tt[l.mode_gr-1];xe[0].block_type==xe[1].block_type&&Pe[0].block_type==Pe[1].block_type&&(l.mode_ext=H.MPG_MD_MS_LR)}}if(l.mode_ext==G?(t=r,o=i):(t=h,o=g),e.analysis&&l.pinfo!=null)for(P=0;P<l.mode_gr;P++)for(O=0;O<l.channels_out;O++)l.pinfo.ms_ratio[P]=l.ms_ratio[P],l.pinfo.ms_ener_ratio[P]=I[P],l.pinfo.blocktype[P][O]=l.l3_side.tt[P][O].block_type,l.pinfo.pe[P][O]=o[P][O],a.arraycopy(l.l3_side.tt[P][O].xr,0,l.pinfo.xr[P][O],0,576),l.mode_ext==G&&(l.pinfo.ers[P][O]=l.pinfo.ers[P][O+2],a.arraycopy(l.pinfo.energy[P][O+2],0,l.pinfo.energy[P][O],0,l.pinfo.energy[P][O].length));if(e.VBR==_.vbr_off||e.VBR==_.vbr_abr){var Se,Re;for(Se=0;Se<18;Se++)l.nsPsy.pefirbuf[Se]=l.nsPsy.pefirbuf[Se+1];for(Re=0,P=0;P<l.mode_gr;P++)for(O=0;O<l.channels_out;O++)Re+=o[P][O];for(l.nsPsy.pefirbuf[18]=Re,Re=l.nsPsy.pefirbuf[9],Se=0;Se<9;Se++)Re+=(l.nsPsy.pefirbuf[Se]+l.nsPsy.pefirbuf[18-Se])*H.fircoef[Se];for(Re=670*5*l.mode_gr*l.channels_out/Re,P=0;P<l.mode_gr;P++)for(O=0;O<l.channels_out;O++)o[P][O]*=Re}if(l.iteration_loop.iteration_loop(e,o,I,t),$.format_bitstream(e),s=$.copy_buffer(l,R,u,n,1),e.bWriteVbrTag&&q.addVbrFrame(e),e.analysis&&l.pinfo!=null){for(O=0;O<l.channels_out;O++){var Te;for(Te=0;Te<w;Te++)l.pinfo.pcmdata[O][Te]=l.pinfo.pcmdata[O][Te+e.framesize];for(Te=w;Te<1600;Te++)l.pinfo.pcmdata[O][Te]=d[O][Te-w]}U.set_frame_pinfo(e,t)}return m(l),s}}return v0=H,v0}var ot=He;ot.System;ot.VbrMode;ot.Float;ot.ShortBlock;var W0=ot.Util;ot.Arrays;ot.new_array_n;ot.new_byte;ot.new_double;var Q0=ot.new_float;ot.new_float_n;ot.new_int;ot.new_int_n;ot.assert;var $e=je();function Wi(){var p=Q0($e.BLKSIZE),a=Q0($e.BLKSIZE_s/2),_=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function b(B,E,N){var H=0,T,D,w;N<<=1;var G=E+N;T=4;do{var $,K,q,U,L,c,m;m=T>>1,U=T,L=T<<1,c=L+U,T=L<<1,D=E,w=D+m;do{var y,e,v,f;e=B[D+0]-B[D+U],y=B[D+0]+B[D+U],f=B[D+L]-B[D+c],v=B[D+L]+B[D+c],B[D+L]=y-v,B[D+0]=y+v,B[D+c]=e-f,B[D+U]=e+f,e=B[w+0]-B[w+U],y=B[w+0]+B[w+U],f=W0.SQRT2*B[w+c],v=W0.SQRT2*B[w+L],B[w+L]=y-v,B[w+0]=y+v,B[w+c]=e-f,B[w+U]=e+f,w+=T,D+=T}while(D<G);for(K=_[H+0],$=_[H+1],q=1;q<m;q++){var R,u;R=1-2*$*$,u=2*$*K,D=E+q,w=E+U-q;do{var n,s,h,y,e,r,v,t,f,d;s=u*B[D+U]-R*B[w+U],n=R*B[D+U]+u*B[w+U],e=B[D+0]-n,y=B[D+0]+n,r=B[w+0]-s,h=B[w+0]+s,s=u*B[D+c]-R*B[w+c],n=R*B[D+c]+u*B[w+c],f=B[D+L]-n,v=B[D+L]+n,d=B[w+L]-s,t=B[w+L]+s,s=$*v-K*d,n=K*v+$*d,B[D+L]=y-n,B[D+0]=y+n,B[w+c]=r-s,B[w+U]=r+s,s=K*t-$*f,n=$*t+K*f,B[w+L]=h-n,B[w+0]=h+n,B[D+c]=e-s,B[D+U]=e+s,w+=T,D+=T}while(D<G);R=K,K=R*_[H+0]-$*_[H+1],$=R*_[H+1]+$*_[H+0]}H+=2}while(T<N)}var x=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(B,E,N,H,T){for(var D=0;D<3;D++){var w=$e.BLKSIZE_s/2,G=65535&576/3*(D+1),$=$e.BLKSIZE_s/8-1;do{var K,q,U,L,c,m=x[$<<2]&255;K=a[m]*H[N][T+m+G],c=a[127-m]*H[N][T+m+G+128],q=K-c,K=K+c,U=a[m+64]*H[N][T+m+G+64],c=a[63-m]*H[N][T+m+G+192],L=U-c,U=U+c,w-=4,E[D][w+0]=K+U,E[D][w+2]=K-U,E[D][w+1]=q+L,E[D][w+3]=q-L,K=a[m+1]*H[N][T+m+G+1],c=a[126-m]*H[N][T+m+G+129],q=K-c,K=K+c,U=a[m+65]*H[N][T+m+G+65],c=a[62-m]*H[N][T+m+G+193],L=U-c,U=U+c,E[D][w+$e.BLKSIZE_s/2+0]=K+U,E[D][w+$e.BLKSIZE_s/2+2]=K-U,E[D][w+$e.BLKSIZE_s/2+1]=q+L,E[D][w+$e.BLKSIZE_s/2+3]=q-L}while(--$>=0);b(E[D],w,$e.BLKSIZE_s/2)}},this.fft_long=function(B,E,N,H,T){var D=$e.BLKSIZE/8-1,w=$e.BLKSIZE/2;do{var G,$,K,q,U,L=x[D]&255;G=p[L]*H[N][T+L],U=p[L+512]*H[N][T+L+512],$=G-U,G=G+U,K=p[L+256]*H[N][T+L+256],U=p[L+768]*H[N][T+L+768],q=K-U,K=K+U,w-=4,E[w+0]=G+K,E[w+2]=G-K,E[w+1]=$+q,E[w+3]=$-q,G=p[L+1]*H[N][T+L+1],U=p[L+513]*H[N][T+L+513],$=G-U,G=G+U,K=p[L+257]*H[N][T+L+257],U=p[L+769]*H[N][T+L+769],q=K-U,K=K+U,E[w+$e.BLKSIZE/2+0]=G+K,E[w+$e.BLKSIZE/2+2]=G-K,E[w+$e.BLKSIZE/2+1]=$+q,E[w+$e.BLKSIZE/2+3]=$-q}while(--D>=0);b(E,w,$e.BLKSIZE/2)},this.init_fft=function(B){for(var E=0;E<$e.BLKSIZE;E++)p[E]=.42-.5*Math.cos(2*Math.PI*(E+.5)/$e.BLKSIZE)+.08*Math.cos(4*Math.PI*(E+.5)/$e.BLKSIZE);for(var E=0;E<$e.BLKSIZE_s/2;E++)a[E]=.5*(1-Math.cos(2*Math.PI*(E+.5)/$e.BLKSIZE_s))}}var Qi=Wi,lt=He;lt.System;var Aa=lt.VbrMode,j0=lt.Float,Ea=lt.ShortBlock,st=lt.Util,ji=lt.Arrays;lt.new_array_n;lt.new_byte;lt.new_double;var Ge=lt.new_float,kt=lt.new_float_n,oa=lt.new_int;lt.new_int_n;var ue=lt.assert,zi=Qi,j=je();function Ji(){var p=new zi,a=2.302585092994046,_=2,b=16,x=2,B=16,E=.34,N=1/(14752*14752)/(j.BLKSIZE/2),H=.01,T=.8,D=.6,w=.3,G=3.5,$=21,K=.2302585093;function q(S){return S}function U(S,A){for(var C=0,k=0;k<j.BLKSIZE/2;++k)C+=S[k]*A.ATH.eql_w[k];return C*=N,C}function L(S,A,C,k,Y,M,X,Z,V,z,W){var J=S.internal_flags;if(V<2)p.fft_long(J,k[Y],V,z,W),p.fft_short(J,M[X],V,z,W);else if(V==2){for(var _e=j.BLKSIZE-1;_e>=0;--_e){var fe=k[Y+0][_e],te=k[Y+1][_e];k[Y+0][_e]=(fe+te)*st.SQRT2*.5,k[Y+1][_e]=(fe-te)*st.SQRT2*.5}for(var me=2;me>=0;--me)for(var _e=j.BLKSIZE_s-1;_e>=0;--_e){var fe=M[X+0][me][_e],te=M[X+1][me][_e];M[X+0][me][_e]=(fe+te)*st.SQRT2*.5,M[X+1][me][_e]=(fe-te)*st.SQRT2*.5}}A[0]=k[Y+0][0],A[0]*=A[0];for(var _e=j.BLKSIZE/2-1;_e>=0;--_e){var Q=k[Y+0][j.BLKSIZE/2-_e],de=k[Y+0][j.BLKSIZE/2+_e];A[j.BLKSIZE/2-_e]=(Q*Q+de*de)*.5}for(var me=2;me>=0;--me){C[me][0]=M[X+0][me][0],C[me][0]*=C[me][0];for(var _e=j.BLKSIZE_s/2-1;_e>=0;--_e){var Q=M[X+0][me][j.BLKSIZE_s/2-_e],de=M[X+0][me][j.BLKSIZE_s/2+_e];C[me][j.BLKSIZE_s/2-_e]=(Q*Q+de*de)*.5}}{for(var Ee=0,_e=11;_e<j.HBLKSIZE;_e++)Ee+=A[_e];J.tot_ener[V]=Ee}if(S.analysis){for(var _e=0;_e<j.HBLKSIZE;_e++)J.pinfo.energy[Z][V][_e]=J.pinfo.energy_save[V][_e],J.pinfo.energy_save[V][_e]=A[_e];J.pinfo.pe[Z][V]=J.pe[V]}S.athaa_loudapprox==2&&V<2&&(J.loudness_sq[Z][V]=J.loudness_sq_save[V],J.loudness_sq_save[V]=U(A,J))}var c=8,m=23,y=15,e,v,f,R=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function u(){e=Math.pow(10,(c+1)/16),v=Math.pow(10,(m+1)/16),f=Math.pow(10,y/10)}var n=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],s=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],h=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function r(S,A,C,k,Y,M){var X;if(A>S)if(A<S*v)X=A/S;else return S+A;else{if(S>=A*v)return S+A;X=S/A}if(ue(S>=0),ue(A>=0),S+=A,k+3<=3+3){if(X>=e)return S;var Z=0|st.FAST_LOG10_X(X,16);return S*s[Z]}var Z=0|st.FAST_LOG10_X(X,16);if(M!=0?A=Y.ATH.cb_s[C]*Y.ATH.adjust:A=Y.ATH.cb_l[C]*Y.ATH.adjust,ue(A>=0),S<f*A){if(S>A){var V,z;return V=1,Z<=13&&(V=h[Z]),z=st.FAST_LOG10_X(S/A,10/15),S*((n[Z]-V)*z+V)}return Z>13?S:S*h[Z]}return S*n[Z]}var t=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function d(S,A,C){var k;if(S<0&&(S=0),A<0&&(A=0),S<=0)return A;if(A<=0)return S;if(A>S?k=A/S:k=S/A,-2<=C&&C<=2){if(k>=e)return S+A;var Y=0|st.FAST_LOG10_X(k,16);return(S+A)*t[Y]}return k<v?S+A:(S<A&&(S=A),S)}function l(S,A){var C=S.internal_flags;if(C.channels_out>1){for(var k=0;k<j.SBMAX_l;k++){var Y=C.thm[0].l[k],M=C.thm[1].l[k];C.thm[0].l[k]+=M*A,C.thm[1].l[k]+=Y*A}for(var k=0;k<j.SBMAX_s;k++)for(var X=0;X<3;X++){var Y=C.thm[0].s[k][X],M=C.thm[1].s[k][X];C.thm[0].s[k][X]+=M*A,C.thm[1].s[k][X]+=Y*A}}}function F(S){for(var A=0;A<j.SBMAX_l;A++)if(!(S.thm[0].l[A]>1.58*S.thm[1].l[A]||S.thm[1].l[A]>1.58*S.thm[0].l[A])){var C=S.mld_l[A]*S.en[3].l[A],k=Math.max(S.thm[2].l[A],Math.min(S.thm[3].l[A],C));C=S.mld_l[A]*S.en[2].l[A];var Y=Math.max(S.thm[3].l[A],Math.min(S.thm[2].l[A],C));S.thm[2].l[A]=k,S.thm[3].l[A]=Y}for(var A=0;A<j.SBMAX_s;A++)for(var M=0;M<3;M++)if(!(S.thm[0].s[A][M]>1.58*S.thm[1].s[A][M]||S.thm[1].s[A][M]>1.58*S.thm[0].s[A][M])){var C=S.mld_s[A]*S.en[3].s[A][M],k=Math.max(S.thm[2].s[A][M],Math.min(S.thm[3].s[A][M],C));C=S.mld_s[A]*S.en[2].s[A][M];var Y=Math.max(S.thm[3].s[A][M],Math.min(S.thm[2].s[A][M],C));S.thm[2].s[A][M]=k,S.thm[3].s[A][M]=Y}}function I(S,A,C){var k=A,Y=Math.pow(10,C);A*=2,k*=2;for(var M=0;M<j.SBMAX_l;M++){var X,Z,V,z;if(z=S.ATH.cb_l[S.bm_l[M]]*Y,X=Math.min(Math.max(S.thm[0].l[M],z),Math.max(S.thm[1].l[M],z)),Z=Math.max(S.thm[2].l[M],z),V=Math.max(S.thm[3].l[M],z),X*A<Z+V){var W=X*k/(Z+V);Z*=W,V*=W,ue(Z+V>0)}S.thm[2].l[M]=Math.min(Z,S.thm[2].l[M]),S.thm[3].l[M]=Math.min(V,S.thm[3].l[M])}Y*=j.BLKSIZE_s/j.BLKSIZE;for(var M=0;M<j.SBMAX_s;M++)for(var J=0;J<3;J++){var X,Z,V,z;if(z=S.ATH.cb_s[S.bm_s[M]]*Y,X=Math.min(Math.max(S.thm[0].s[M][J],z),Math.max(S.thm[1].s[M][J],z)),Z=Math.max(S.thm[2].s[M][J],z),V=Math.max(S.thm[3].s[M][J],z),X*A<Z+V){var W=X*A/(Z+V);Z*=W,V*=W,ue(Z+V>0)}S.thm[2].s[M][J]=Math.min(S.thm[2].s[M][J],Z),S.thm[3].s[M][J]=Math.min(S.thm[3].s[M][J],V)}}function g(S,A,C,k,Y){var M,X,Z=0,V=0;for(M=X=0;M<j.SBMAX_s;++X,++M){for(var z=S.bo_s[M],W=S.npart_s,J=z<W?z:W;X<J;)ue(A[X]>=0),ue(C[X]>=0),Z+=A[X],V+=C[X],X++;if(S.en[k].s[M][Y]=Z,S.thm[k].s[M][Y]=V,X>=W){++M;break}ue(A[X]>=0),ue(C[X]>=0);{var _e=S.PSY.bo_s_weight[M],fe=1-_e;Z=_e*A[X],V=_e*C[X],S.en[k].s[M][Y]+=Z,S.thm[k].s[M][Y]+=V,Z=fe*A[X],V=fe*C[X]}}for(;M<j.SBMAX_s;++M)S.en[k].s[M][Y]=0,S.thm[k].s[M][Y]=0}function i(S,A,C,k){var Y,M,X=0,Z=0;for(Y=M=0;Y<j.SBMAX_l;++M,++Y){for(var V=S.bo_l[Y],z=S.npart_l,W=V<z?V:z;M<W;)ue(A[M]>=0),ue(C[M]>=0),X+=A[M],Z+=C[M],M++;if(S.en[k].l[Y]=X,S.thm[k].l[Y]=Z,M>=z){++Y;break}ue(A[M]>=0),ue(C[M]>=0);{var J=S.PSY.bo_l_weight[Y],_e=1-J;X=J*A[M],Z=J*C[M],S.en[k].l[Y]+=X,S.thm[k].l[Y]+=Z,X=_e*A[M],Z=_e*C[M]}}for(;Y<j.SBMAX_l;++Y)S.en[k].l[Y]=0,S.thm[k].l[Y]=0}function o(S,A,C,k,Y,M){var X=S.internal_flags,Z,V;for(V=Z=0;V<X.npart_s;++V){for(var z=0,W=X.numlines_s[V],J=0;J<W;++J,++Z){var _e=A[M][Z];z+=_e}C[V]=z}for(ue(V==X.npart_s),ue(Z==129),Z=V=0;V<X.npart_s;V++){var fe=X.s3ind_s[V][0],te=X.s3_ss[Z++]*C[fe];for(++fe;fe<=X.s3ind_s[V][1];)te+=X.s3_ss[Z]*C[fe],++Z,++fe;{var me=x*X.nb_s1[Y][V];k[V]=Math.min(te,me)}if(X.blocktype_old[Y&1]==j.SHORT_TYPE){var me=B*X.nb_s2[Y][V],Q=k[V];k[V]=Math.min(me,Q)}X.nb_s2[Y][V]=X.nb_s1[Y][V],X.nb_s1[Y][V]=te,ue(k[V]>=0)}for(;V<=j.CBANDS;++V)C[V]=0,k[V]=0}function O(S,A,C,k){var Y=S.internal_flags;S.short_blocks==Ea.short_block_coupled&&!(A[0]!=0&&A[1]!=0)&&(A[0]=A[1]=0);for(var M=0;M<Y.channels_out;M++)k[M]=j.NORM_TYPE,S.short_blocks==Ea.short_block_dispensed&&(A[M]=1),S.short_blocks==Ea.short_block_forced&&(A[M]=0),A[M]!=0?(ue(Y.blocktype_old[M]!=j.START_TYPE),Y.blocktype_old[M]==j.SHORT_TYPE&&(k[M]=j.STOP_TYPE)):(k[M]=j.SHORT_TYPE,Y.blocktype_old[M]==j.NORM_TYPE&&(Y.blocktype_old[M]=j.START_TYPE),Y.blocktype_old[M]==j.STOP_TYPE&&(Y.blocktype_old[M]=j.SHORT_TYPE)),C[M]=Y.blocktype_old[M],Y.blocktype_old[M]=k[M]}function P(S,A,C){return C>=1?S:C<=0?A:A>0?Math.pow(S/A,C)*A:0}var se=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function le(S,A){for(var C=309.07,k=0;k<j.SBMAX_s-1;k++)for(var Y=0;Y<3;Y++){var M=S.thm.s[k][Y];if(ue(k<se.length),M>0){var X=M*A,Z=S.en.s[k][Y];Z>X&&(Z>X*1e10?C+=se[k]*(10*a):(ue(X>0),C+=se[k]*st.FAST_LOG10(Z/X)))}}return C}var re=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function oe(S,A){for(var C=281.0575,k=0;k<j.SBMAX_l-1;k++){var Y=S.thm.l[k];if(ue(k<re.length),Y>0){var M=Y*A,X=S.en.l[k];X>M&&(X>M*1e10?C+=re[k]*(10*a):(ue(M>0),C+=re[k]*st.FAST_LOG10(X/M)))}}return C}function be(S,A,C,k,Y){var M,X;for(M=X=0;M<S.npart_l;++M){var Z=0,V=0,z;for(z=0;z<S.numlines_l[M];++z,++X){var W=A[X];ue(W>=0),Z+=W,V<W&&(V=W)}C[M]=Z,k[M]=V,Y[M]=Z*S.rnumlines_l[M],ue(S.rnumlines_l[M]>=0),ue(Z>=0),ue(C[M]>=0),ue(k[M]>=0),ue(Y[M]>=0)}}function he(S,A,C,k){var Y=R.length-1,M=0,X=C[M]+C[M+1];if(ue(X>=0),X>0){var Z=A[M];Z<A[M+1]&&(Z=A[M+1]),ue(S.numlines_l[M]+S.numlines_l[M+1]-1>0),X=20*(Z*2-X)/(X*(S.numlines_l[M]+S.numlines_l[M+1]-1));var V=0|X;V>Y&&(V=Y),k[M]=V}else k[M]=0;for(M=1;M<S.npart_l-1;M++)if(X=C[M-1]+C[M]+C[M+1],ue(X>=0),X>0){var Z=A[M-1];Z<A[M]&&(Z=A[M]),Z<A[M+1]&&(Z=A[M+1]),ue(S.numlines_l[M-1]+S.numlines_l[M]+S.numlines_l[M+1]-1>0),X=20*(Z*3-X)/(X*(S.numlines_l[M-1]+S.numlines_l[M]+S.numlines_l[M+1]-1));var V=0|X;V>Y&&(V=Y),k[M]=V}else k[M]=0;if(ue(M>0),ue(M==S.npart_l-1),X=C[M-1]+C[M],ue(X>=0),X>0){var Z=A[M-1];Z<A[M]&&(Z=A[M]),ue(S.numlines_l[M-1]+S.numlines_l[M]-1>0),X=20*(Z*2-X)/(X*(S.numlines_l[M-1]+S.numlines_l[M]-1));var V=0|X;V>Y&&(V=Y),k[M]=V}else k[M]=0;ue(M==S.npart_l-1)}var ne=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(S,A,C,k,Y,M,X,Z,V,z){var W=S.internal_flags,J=kt([2,j.BLKSIZE]),_e=kt([2,3,j.BLKSIZE_s]),fe=Ge(j.CBANDS+1),te=Ge(j.CBANDS+1),me=Ge(j.CBANDS+2),Q=oa(2),de=oa(2),Ee,ae,ve,ee,pe,ge,ce,ye,we=kt([2,576]),Ne,Mt=oa(j.CBANDS+2),Ye=oa(j.CBANDS+2);for(ji.fill(Ye,0),Ee=W.channels_out,S.mode==MPEGMode.JOINT_STEREO&&(Ee=4),S.VBR==Aa.vbr_off?Ne=W.ResvMax==0?0:W.ResvSize/W.ResvMax*.5:S.VBR==Aa.vbr_rh||S.VBR==Aa.vbr_mtrh||S.VBR==Aa.vbr_mt?Ne=.6:Ne=1,ae=0;ae<W.channels_out;ae++){var Le=A[ae],at=C+576-350-$+192;for(ue(ne.length==($-1)/2),ee=0;ee<576;ee++){var Bt,It;for(Bt=Le[at+ee+10],It=0,pe=0;pe<($-1)/2-1;pe+=2)Bt+=ne[pe]*(Le[at+ee+pe]+Le[at+ee+$-pe]),It+=ne[pe+1]*(Le[at+ee+pe+1]+Le[at+ee+$-pe-1]);we[ae][ee]=Bt+It}Y[k][ae].en.assign(W.en[ae]),Y[k][ae].thm.assign(W.thm[ae]),Ee>2&&(M[k][ae].en.assign(W.en[ae+2]),M[k][ae].thm.assign(W.thm[ae+2]))}for(ae=0;ae<Ee;ae++){var Dt,Ft,Qe=Ge(12),Gt=[0,0,0,0],ya=Ge(12),Ja=1,P0,D0=Ge(j.CBANDS),F0=Ge(j.CBANDS),Oe=[0,0,0,0],V0=Ge(j.HBLKSIZE),q0=kt([3,j.HBLKSIZE_s]);for(ue(W.npart_s<=j.CBANDS),ue(W.npart_l<=j.CBANDS),ee=0;ee<3;ee++)Qe[ee]=W.nsPsy.last_en_subshort[ae][ee+6],ue(W.nsPsy.last_en_subshort[ae][ee+4]>0),ya[ee]=Qe[ee]/W.nsPsy.last_en_subshort[ae][ee+4],Gt[0]+=Qe[ee];if(ae==2)for(ee=0;ee<576;ee++){var e0,t0;e0=we[0][ee],t0=we[1][ee],we[0][ee]=e0+t0,we[1][ee]=e0-t0}{var X0=we[ae&1],Ta=0;for(ee=0;ee<9;ee++){for(var Ni=Ta+64,Ze=1;Ta<Ni;Ta++)Ze<Math.abs(X0[Ta])&&(Ze=Math.abs(X0[Ta]));W.nsPsy.last_en_subshort[ae][ee]=Qe[ee+3]=Ze,Gt[1+ee/3]+=Ze,Ze>Qe[ee+3-2]?(ue(Qe[ee+3-2]>0),Ze=Ze/Qe[ee+3-2]):Qe[ee+3-2]>Ze*10?(ue(Ze>0),Ze=Qe[ee+3-2]/(Ze*10)):Ze=0,ya[ee+3]=Ze}}if(S.analysis){var a0=ya[0];for(ee=1;ee<12;ee++)a0<ya[ee]&&(a0=ya[ee]);W.pinfo.ers[k][ae]=W.pinfo.ers_save[ae],W.pinfo.ers_save[ae]=a0}for(P0=ae==3?W.nsPsy.attackthre_s:W.nsPsy.attackthre,ee=0;ee<12;ee++)Oe[ee/3]==0&&ya[ee]>P0&&(Oe[ee/3]=ee%3+1);for(ee=1;ee<4;ee++){var i0;Gt[ee-1]>Gt[ee]?(ue(Gt[ee]>0),i0=Gt[ee-1]/Gt[ee]):(ue(Gt[ee-1]>0),i0=Gt[ee]/Gt[ee-1]),i0<1.7&&(Oe[ee]=0,ee==1&&(Oe[0]=0))}for(Oe[0]!=0&&W.nsPsy.lastAttacks[ae]!=0&&(Oe[0]=0),(W.nsPsy.lastAttacks[ae]==3||Oe[0]+Oe[1]+Oe[2]+Oe[3]!=0)&&(Ja=0,Oe[1]!=0&&Oe[0]!=0&&(Oe[1]=0),Oe[2]!=0&&Oe[1]!=0&&(Oe[2]=0),Oe[3]!=0&&Oe[2]!=0&&(Oe[3]=0)),ae<2?de[ae]=Ja:Ja==0&&(de[0]=de[1]=0),V[ae]=W.tot_ener[ae],Ft=_e,Dt=J,L(S,V0,q0,Dt,ae&1,Ft,ae&1,k,ae,A,C),be(W,V0,fe,D0,F0),he(W,D0,F0,Mt),ye=0;ye<3;ye++){var s0,it;for(o(S,q0,te,me,ae,ye),g(W,te,me,ae,ye),ce=0;ce<j.SBMAX_s;ce++){if(it=W.thm[ae].s[ce][ye],it*=T,Oe[ye]>=2||Oe[ye+1]==1){var Ra=ye!=0?ye-1:2,Ze=P(W.thm[ae].s[ce][Ra],it,D*Ne);it=Math.min(it,Ze)}if(Oe[ye]==1){var Ra=ye!=0?ye-1:2,Ze=P(W.thm[ae].s[ce][Ra],it,w*Ne);it=Math.min(it,Ze)}else if(ye!=0&&Oe[ye-1]==3||ye==0&&W.nsPsy.lastAttacks[ae]==3){var Ra=ye!=2?ye+1:0,Ze=P(W.thm[ae].s[ce][Ra],it,w*Ne);it=Math.min(it,Ze)}s0=Qe[ye*3+3]+Qe[ye*3+4]+Qe[ye*3+5],Qe[ye*3+5]*6<s0&&(it*=.5,Qe[ye*3+4]*6<s0&&(it*=.5)),W.thm[ae].s[ce][ye]=it}}for(W.nsPsy.lastAttacks[ae]=Oe[2],ge=0,ve=0;ve<W.npart_l;ve++){for(var sa=W.s3ind[ve][0],n0=fe[sa]*R[Mt[sa]],na=W.s3_ll[ge++]*n0;++sa<=W.s3ind[ve][1];)n0=fe[sa]*R[Mt[sa]],na=r(na,W.s3_ll[ge++]*n0,sa,sa-ve,W,0);na*=.158489319246111,W.blocktype_old[ae&1]==j.SHORT_TYPE?me[ve]=na:me[ve]=P(Math.min(na,Math.min(_*W.nb_1[ae][ve],b*W.nb_2[ae][ve])),na,Ne),W.nb_2[ae][ve]=W.nb_1[ae][ve],W.nb_1[ae][ve]=na}for(;ve<=j.CBANDS;++ve)fe[ve]=0,me[ve]=0;i(W,fe,me,ae)}if((S.mode==MPEGMode.STEREO||S.mode==MPEGMode.JOINT_STEREO)&&S.interChRatio>0&&l(S,S.interChRatio),S.mode==MPEGMode.JOINT_STEREO){var r0;F(W),r0=S.msfix,Math.abs(r0)>0&&I(W,r0,S.ATHlower*W.ATH.adjust)}for(O(S,de,z,Q),ae=0;ae<Ee;ae++){var Ma,Ba=0,Oa,Ha;ae>1?(Ma=Z,Ba=-2,Oa=j.NORM_TYPE,(z[0]==j.SHORT_TYPE||z[1]==j.SHORT_TYPE)&&(Oa=j.SHORT_TYPE),Ha=M[k][ae-2]):(Ma=X,Ba=0,Oa=z[ae],Ha=Y[k][ae]),Oa==j.SHORT_TYPE?Ma[Ba+ae]=le(Ha,W.masking_lower):Ma[Ba+ae]=oe(Ha,W.masking_lower),S.analysis&&(W.pinfo.pe[k][ae]=Ma[Ba+ae])}return 0};function xe(S,A,C,k,Y,M,X,Z){var V=S.internal_flags;if(k<2)p.fft_long(V,X[Z],k,A,C);else if(k==2)for(var z=j.BLKSIZE-1;z>=0;--z){var W=X[Z+0][z],J=X[Z+1][z];X[Z+0][z]=(W+J)*st.SQRT2*.5,X[Z+1][z]=(W-J)*st.SQRT2*.5}M[0]=X[Z+0][0],M[0]*=M[0];for(var z=j.BLKSIZE/2-1;z>=0;--z){var _e=X[Z+0][j.BLKSIZE/2-z],fe=X[Z+0][j.BLKSIZE/2+z];M[j.BLKSIZE/2-z]=(_e*_e+fe*fe)*.5}{for(var te=0,z=11;z<j.HBLKSIZE;z++)te+=M[z];V.tot_ener[k]=te}if(S.analysis){for(var z=0;z<j.HBLKSIZE;z++)V.pinfo.energy[Y][k][z]=V.pinfo.energy_save[k][z],V.pinfo.energy_save[k][z]=M[z];V.pinfo.pe[Y][k]=V.pe[k]}}function Pe(S,A,C,k,Y,M,X,Z){var V=S.internal_flags;if(Y==0&&k<2&&p.fft_short(V,X[Z],k,A,C),k==2)for(var z=j.BLKSIZE_s-1;z>=0;--z){var W=X[Z+0][Y][z],J=X[Z+1][Y][z];X[Z+0][Y][z]=(W+J)*st.SQRT2*.5,X[Z+1][Y][z]=(W-J)*st.SQRT2*.5}M[Y][0]=X[Z+0][Y][0],M[Y][0]*=M[Y][0];for(var z=j.BLKSIZE_s/2-1;z>=0;--z){var _e=X[Z+0][Y][j.BLKSIZE_s/2-z],fe=X[Z+0][Y][j.BLKSIZE_s/2+z];M[Y][j.BLKSIZE_s/2-z]=(_e*_e+fe*fe)*.5}}function Se(S,A,C,k){var Y=S.internal_flags;S.athaa_loudapprox==2&&C<2&&(Y.loudness_sq[A][C]=Y.loudness_sq_save[C],Y.loudness_sq_save[C]=U(k,Y))}var Re=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function Te(S,A,C,k,Y,M,X,Z,V,z){for(var W=kt([2,576]),J=S.internal_flags,_e=J.channels_out,fe=S.mode==MPEGMode.JOINT_STEREO?4:_e,te=0;te<_e;te++){firbuf=A[te];var me=C+576-350-$+192;ue(Re.length==($-1)/2);for(var Q=0;Q<576;Q++){var de,Ee;de=firbuf[me+Q+10],Ee=0;for(var ae=0;ae<($-1)/2-1;ae+=2)de+=Re[ae]*(firbuf[me+Q+ae]+firbuf[me+Q+$-ae]),Ee+=Re[ae+1]*(firbuf[me+Q+ae+1]+firbuf[me+Q+$-ae-1]);W[te][Q]=de+Ee}Y[k][te].en.assign(J.en[te]),Y[k][te].thm.assign(J.thm[te]),fe>2&&(M[k][te].en.assign(J.en[te+2]),M[k][te].thm.assign(J.thm[te+2]))}for(var te=0;te<fe;te++){var ve=Ge(12),ee=Ge(12),pe=[0,0,0,0],ge=W[te&1],ce=0,ye=te==3?J.nsPsy.attackthre_s:J.nsPsy.attackthre,we=1;if(te==2)for(var Q=0,ae=576;ae>0;++Q,--ae){var Ne=W[0][Q],Mt=W[1][Q];W[0][Q]=Ne+Mt,W[1][Q]=Ne-Mt}for(var Q=0;Q<3;Q++)ee[Q]=J.nsPsy.last_en_subshort[te][Q+6],ue(J.nsPsy.last_en_subshort[te][Q+4]>0),ve[Q]=ee[Q]/J.nsPsy.last_en_subshort[te][Q+4],pe[0]+=ee[Q];for(var Q=0;Q<9;Q++){for(var Ye=ce+64,Le=1;ce<Ye;ce++)Le<Math.abs(ge[ce])&&(Le=Math.abs(ge[ce]));J.nsPsy.last_en_subshort[te][Q]=ee[Q+3]=Le,pe[1+Q/3]+=Le,Le>ee[Q+3-2]?(ue(ee[Q+3-2]>0),Le=Le/ee[Q+3-2]):ee[Q+3-2]>Le*10?(ue(Le>0),Le=ee[Q+3-2]/(Le*10)):Le=0,ve[Q+3]=Le}for(var Q=0;Q<3;++Q){var at=ee[Q*3+3]+ee[Q*3+4]+ee[Q*3+5],Bt=1;ee[Q*3+5]*6<at&&(Bt*=.5,ee[Q*3+4]*6<at&&(Bt*=.5)),Z[te][Q]=Bt}if(S.analysis){for(var It=ve[0],Q=1;Q<12;Q++)It<ve[Q]&&(It=ve[Q]);J.pinfo.ers[k][te]=J.pinfo.ers_save[te],J.pinfo.ers_save[te]=It}for(var Q=0;Q<12;Q++)V[te][Q/3]==0&&ve[Q]>ye&&(V[te][Q/3]=Q%3+1);for(var Q=1;Q<4;Q++){var Dt=pe[Q-1],Ft=pe[Q],Qe=Math.max(Dt,Ft);Qe<4e4&&Dt<1.7*Ft&&Ft<1.7*Dt&&(Q==1&&V[te][0]<=V[te][Q]&&(V[te][0]=0),V[te][Q]=0)}V[te][0]<=J.nsPsy.lastAttacks[te]&&(V[te][0]=0),(J.nsPsy.lastAttacks[te]==3||V[te][0]+V[te][1]+V[te][2]+V[te][3]!=0)&&(we=0,V[te][1]!=0&&V[te][0]!=0&&(V[te][1]=0),V[te][2]!=0&&V[te][1]!=0&&(V[te][2]=0),V[te][3]!=0&&V[te][2]!=0&&(V[te][3]=0)),te<2?z[te]=we:we==0&&(z[0]=z[1]=0),X[te]=J.tot_ener[te]}}function Ve(S,A,C){if(C==0)for(var k=0;k<S.npart_s;k++)S.nb_s2[A][k]=S.nb_s1[A][k],S.nb_s1[A][k]=0}function Ke(S,A){for(var C=0;C<S.npart_l;C++)S.nb_2[A][C]=S.nb_1[A][C],S.nb_1[A][C]=0}function $t(S,A,C,k){var Y=R.length-1,M=0,X=C[M]+C[M+1];if(ue(X>=0),X>0){var Z=A[M];Z<A[M+1]&&(Z=A[M+1]),ue(S.numlines_s[M]+S.numlines_s[M+1]-1>0),X=20*(Z*2-X)/(X*(S.numlines_s[M]+S.numlines_s[M+1]-1));var V=0|X;V>Y&&(V=Y),k[M]=V}else k[M]=0;for(M=1;M<S.npart_s-1;M++)if(X=C[M-1]+C[M]+C[M+1],ue(M+1<S.npart_s),ue(X>=0),X>0){var Z=A[M-1];Z<A[M]&&(Z=A[M]),Z<A[M+1]&&(Z=A[M+1]),ue(S.numlines_s[M-1]+S.numlines_s[M]+S.numlines_s[M+1]-1>0),X=20*(Z*3-X)/(X*(S.numlines_s[M-1]+S.numlines_s[M]+S.numlines_s[M+1]-1));var V=0|X;V>Y&&(V=Y),k[M]=V}else k[M]=0;if(ue(M>0),ue(M==S.npart_s-1),X=C[M-1]+C[M],ue(X>=0),X>0){var Z=A[M-1];Z<A[M]&&(Z=A[M]),ue(S.numlines_s[M-1]+S.numlines_s[M]-1>0),X=20*(Z*2-X)/(X*(S.numlines_s[M-1]+S.numlines_s[M]-1));var V=0|X;V>Y&&(V=Y),k[M]=V}else k[M]=0;ue(M==S.npart_s-1)}function Tt(S,A,C,k,Y,M){var X=S.internal_flags,Z=new float[j.CBANDS],V=Ge(j.CBANDS),z,W,J,_e=new int[j.CBANDS];for(J=W=0;J<X.npart_s;++J){var fe=0,te=0,me=X.numlines_s[J];for(z=0;z<me;++z,++W){var Q=A[M][W];fe+=Q,te<Q&&(te=Q)}C[J]=fe,ue(fe>=0),Z[J]=te,ue(me>0),V[J]=fe/me,ue(V[J]>=0)}for(ue(J==X.npart_s),ue(W==129);J<j.CBANDS;++J)Z[J]=0,V[J]=0;for($t(X,Z,V,_e),W=J=0;J<X.npart_s;J++){var de=X.s3ind_s[J][0],Ee=X.s3ind_s[J][1],ae,ve,ee,pe,ge;for(ae=_e[de],ve=1,pe=X.s3_ss[W]*C[de]*R[_e[de]],++W,++de;de<=Ee;)ae+=_e[de],ve+=1,ee=X.s3_ss[W]*C[de]*R[_e[de]],pe=d(pe,ee,de-J),++W,++de;ae=(1+2*ae)/(2*ve),ge=R[ae]*.5,pe*=ge,k[J]=pe,X.nb_s2[Y][J]=X.nb_s1[Y][J],X.nb_s1[Y][J]=pe,ee=Z[J],ee*=X.minval_s[J],ee*=ge,k[J]>ee&&(k[J]=ee),X.masking_lower>1&&(k[J]*=X.masking_lower),k[J]>C[J]&&(k[J]=C[J]),X.masking_lower<1&&(k[J]*=X.masking_lower),ue(k[J]>=0)}for(;J<j.CBANDS;++J)C[J]=0,k[J]=0}function tt(S,A,C,k,Y){var M=Ge(j.CBANDS),X=Ge(j.CBANDS),Z=oa(j.CBANDS+2),V;be(S,A,C,M,X),he(S,M,X,Z);var z=0;for(V=0;V<S.npart_l;V++){var W,J,_e,fe,te=S.s3ind[V][0],me=S.s3ind[V][1],Q=0,de=0;for(Q=Z[te],de+=1,J=S.s3_ll[z]*C[te]*R[Z[te]],++z,++te;te<=me;)Q+=Z[te],de+=1,W=S.s3_ll[z]*C[te]*R[Z[te]],fe=d(J,W,te-V),J=fe,++z,++te;if(Q=(1+2*Q)/(2*de),_e=R[Q]*.5,J*=_e,S.blocktype_old[Y&1]==j.SHORT_TYPE){var Ee=_*S.nb_1[Y][V];Ee>0?k[V]=Math.min(J,Ee):k[V]=Math.min(J,C[V]*w)}else{var ae=b*S.nb_2[Y][V],ve=_*S.nb_1[Y][V],Ee;ae<=0&&(ae=J),ve<=0&&(ve=J),S.blocktype_old[Y&1]==j.NORM_TYPE?Ee=Math.min(ve,ae):Ee=ve,k[V]=Math.min(J,Ee)}S.nb_2[Y][V]=S.nb_1[Y][V],S.nb_1[Y][V]=J,W=M[V],W*=S.minval_l[V],W*=_e,k[V]>W&&(k[V]=W),S.masking_lower>1&&(k[V]*=S.masking_lower),k[V]>C[V]&&(k[V]=C[V]),S.masking_lower<1&&(k[V]*=S.masking_lower),ue(k[V]>=0)}for(;V<j.CBANDS;++V)C[V]=0,k[V]=0}function Pt(S,A){var C=S.internal_flags;S.short_blocks==Ea.short_block_coupled&&!(A[0]!=0&&A[1]!=0)&&(A[0]=A[1]=0);for(var k=0;k<C.channels_out;k++)S.short_blocks==Ea.short_block_dispensed&&(A[k]=1),S.short_blocks==Ea.short_block_forced&&(A[k]=0)}function aa(S,A,C){for(var k=S.internal_flags,Y=0;Y<k.channels_out;Y++){var M=j.NORM_TYPE;A[Y]!=0?(ue(k.blocktype_old[Y]!=j.START_TYPE),k.blocktype_old[Y]==j.SHORT_TYPE&&(M=j.STOP_TYPE)):(M=j.SHORT_TYPE,k.blocktype_old[Y]==j.NORM_TYPE&&(k.blocktype_old[Y]=j.START_TYPE),k.blocktype_old[Y]==j.STOP_TYPE&&(k.blocktype_old[Y]=j.SHORT_TYPE)),C[Y]=k.blocktype_old[Y],k.blocktype_old[Y]=M}}function ea(S,A,C,k,Y,M,X){for(var Z=M*2,V=M>0?Math.pow(10,Y):1,z,W,J=0;J<X;++J){var _e=S[2][J],fe=S[3][J],te=A[0][J],me=A[1][J],Q=A[2][J],de=A[3][J];if(te<=1.58*me&&me<=1.58*te){var Ee=C[J]*fe,ae=C[J]*_e;W=Math.max(Q,Math.min(de,Ee)),z=Math.max(de,Math.min(Q,ae))}else W=Q,z=de;if(M>0){var ve,ee,pe=k[J]*V;if(ve=Math.min(Math.max(te,pe),Math.max(me,pe)),Q=Math.max(W,pe),de=Math.max(z,pe),ee=Q+de,ee>0&&ve*Z<ee){var ge=ve*Z/ee;Q*=ge,de*=ge,ue(ee>0)}W=Math.min(Q,W),z=Math.min(de,z)}W>_e&&(W=_e),z>fe&&(z=fe),A[2][J]=W,A[3][J]=z}}this.L3psycho_anal_vbr=function(S,A,C,k,Y,M,X,Z,V,z){var W=S.internal_flags,J,_e,fe=Ge(j.HBLKSIZE),te=kt([3,j.HBLKSIZE_s]),me=kt([2,j.BLKSIZE]),Q=kt([2,3,j.BLKSIZE_s]),de=kt([4,j.CBANDS]),Ee=kt([4,j.CBANDS]),ae=kt([4,3]),ve=.6,ee=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],pe=oa(2),ge=S.mode==MPEGMode.JOINT_STEREO?4:W.channels_out;Te(S,A,C,k,Y,M,V,ae,ee,pe),Pt(S,pe);{for(var ce=0;ce<ge;ce++){var ye=ce&1;J=me,xe(S,A,C,ce,k,fe,J,ye),Se(S,k,ce,fe),pe[ye]!=0?tt(W,fe,de[ce],Ee[ce],ce):Ke(W,ce)}pe[0]+pe[1]==2&&S.mode==MPEGMode.JOINT_STEREO&&ea(de,Ee,W.mld_cb_l,W.ATH.cb_l,S.ATHlower*W.ATH.adjust,S.msfix,W.npart_l);for(var ce=0;ce<ge;ce++){var ye=ce&1;pe[ye]!=0&&i(W,de[ce],Ee[ce],ce)}}{for(var we=0;we<3;we++){for(var ce=0;ce<ge;++ce){var ye=ce&1;pe[ye]!=0?Ve(W,ce,we):(_e=Q,Pe(S,A,C,ce,we,te,_e,ye),Tt(S,te,de[ce],Ee[ce],ce,we))}pe[0]+pe[1]==0&&S.mode==MPEGMode.JOINT_STEREO&&ea(de,Ee,W.mld_cb_s,W.ATH.cb_s,S.ATHlower*W.ATH.adjust,S.msfix,W.npart_s);for(var ce=0;ce<ge;++ce){var ye=ce&1;pe[ye]==0&&g(W,de[ce],Ee[ce],ce,we)}}for(var ce=0;ce<ge;ce++){var ye=ce&1;if(pe[ye]==0)for(var Ne=0;Ne<j.SBMAX_s;Ne++){for(var Mt=Ge(3),we=0;we<3;we++){var Ye=W.thm[ce].s[Ne][we];if(Ye*=T,ee[ce][we]>=2||ee[ce][we+1]==1){var Le=we!=0?we-1:2,at=P(W.thm[ce].s[Ne][Le],Ye,D*ve);Ye=Math.min(Ye,at)}else if(ee[ce][we]==1){var Le=we!=0?we-1:2,at=P(W.thm[ce].s[Ne][Le],Ye,w*ve);Ye=Math.min(Ye,at)}else if(we!=0&&ee[ce][we-1]==3||we==0&&W.nsPsy.lastAttacks[ce]==3){var Le=we!=2?we+1:0,at=P(W.thm[ce].s[Ne][Le],Ye,w*ve);Ye=Math.min(Ye,at)}Ye*=ae[ce][we],Mt[we]=Ye}for(var we=0;we<3;we++)W.thm[ce].s[Ne][we]=Mt[we]}}}for(var ce=0;ce<ge;ce++)W.nsPsy.lastAttacks[ce]=ee[ce][2];aa(S,pe,z);for(var ce=0;ce<ge;ce++){var Bt,It,Dt,Ft;ce>1?(Bt=Z,It=-2,Dt=j.NORM_TYPE,(z[0]==j.SHORT_TYPE||z[1]==j.SHORT_TYPE)&&(Dt=j.SHORT_TYPE),Ft=M[k][ce-2]):(Bt=X,It=0,Dt=z[ce],Ft=Y[k][ce]),Dt==j.SHORT_TYPE?Bt[It+ce]=le(Ft,W.masking_lower):Bt[It+ce]=oe(Ft,W.masking_lower),S.analysis&&(W.pinfo.pe[k][ce]=Bt[It+ce])}return 0};function ze(S,A){var C=S,k;return C>=0?k=-C*27:k=C*A,k<=-72?0:Math.exp(k*K)}function ia(S){var A=0,C=0;{var k=0,Y,M;for(k=0;ze(k,S)>1e-20;k-=1);for(Y=k,M=0;Math.abs(M-Y)>1e-12;)k=(M+Y)/2,ze(k,S)>0?M=k:Y=k;A=Y}{var k=0,Y,M;for(k=0;ze(k,S)>1e-20;k+=1);for(Y=0,M=k;Math.abs(M-Y)>1e-12;)k=(M+Y)/2,ze(k,S)>0?Y=k:M=k;C=M}{var X=0,Z=1e3,V;for(V=0;V<=Z;++V){var k=A+V*(C-A)/Z,z=ze(k,S);X+=z}{var W=(Z+1)/(X*(C-A));return W}}}function Wt(S){var A,C,k,Y;return A=S,A>=0?A*=3:A*=1.5,A>=.5&&A<=2.5?(Y=A-.5,C=8*(Y*Y-2*Y)):C=0,A+=.474,k=15.811389+7.5*A-17.5*Math.sqrt(1+A*A),k<=-60?0:(A=Math.exp((C+k)*K),A/=.6609193,A)}function Rt(S){return S<0&&(S=0),S=S*.001,13*Math.atan(.76*S)+3.5*Math.atan(S*S/(7.5*7.5))}function ba(S,A,C,k,Y,M,X,Z,V,z,W,J){var _e=Ge(j.CBANDS+1),fe=Z/(J>15?2*576:2*192),te=oa(j.HBLKSIZE),me;Z/=V;var Q=0,de=0;for(me=0;me<j.CBANDS;me++){var Ee,ae;for(Ee=Rt(Z*Q),_e[me]=Z*Q,ae=Q;Rt(Z*ae)-Ee<E&&ae<=V/2;ae++);for(S[me]=ae-Q,de=me+1;Q<ae;)ue(Q<j.HBLKSIZE),te[Q++]=me;if(Q>V/2){Q=V/2,++me;break}}ue(me<j.CBANDS),_e[me]=Z*Q;for(var ve=0;ve<J;ve++){var ee,pe,ge,ce,ye;ge=z[ve],ce=z[ve+1],ee=0|Math.floor(.5+W*(ge-.5)),ee<0&&(ee=0),pe=0|Math.floor(.5+W*(ce-.5)),pe>V/2&&(pe=V/2),C[ve]=(te[ee]+te[pe])/2,A[ve]=te[pe];var we=fe*ce;X[ve]=(we-_e[A[ve]])/(_e[A[ve]+1]-_e[A[ve]]),X[ve]<0?X[ve]=0:X[ve]>1&&(X[ve]=1),ye=Rt(Z*z[ve]*W),ye=Math.min(ye,15.5)/15.5,M[ve]=Math.pow(10,1.25*(1-Math.cos(Math.PI*ye))-2.5)}Q=0;for(var Ne=0;Ne<de;Ne++){var Mt=S[Ne],Ee,Ye;Ee=Rt(Z*Q),Ye=Rt(Z*(Q+Mt-1)),k[Ne]=.5*(Ee+Ye),Ee=Rt(Z*(Q-.5)),Ye=Rt(Z*(Q+Mt-.5)),Y[Ne]=Ye-Ee,Q+=Mt}return de}function O0(S,A,C,k,Y,M){var X=kt([j.CBANDS,j.CBANDS]),Z,V=0;if(M)for(var z=0;z<A;z++)for(Z=0;Z<A;Z++){var W=Wt(C[z]-C[Z])*k[Z];X[z][Z]=W*Y[z]}else for(Z=0;Z<A;Z++)for(var J=15+Math.min(21/C[Z],12),_e=ia(J),z=0;z<A;z++){var W=_e*ze(C[z]-C[Z],J)*k[Z];X[z][Z]=W*Y[z]}for(var z=0;z<A;z++){for(Z=0;Z<A&&!(X[z][Z]>0);Z++);for(S[z][0]=Z,Z=A-1;Z>0&&!(X[z][Z]>0);Z--);S[z][1]=Z,V+=S[z][1]-S[z][0]+1}for(var fe=Ge(V),te=0,z=0;z<A;z++)for(Z=S[z][0];Z<=S[z][1];Z++)fe[te++]=X[z][Z];return fe}function H0(S){var A=Rt(S);return A=Math.min(A,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*A))-2.5)}this.psymodel_init=function(S){var A=S.internal_flags,C,k=!0,Y=13,M=24,X=0,Z=0,V=-8.25,z=-4.5,W=Ge(j.CBANDS),J=Ge(j.CBANDS),_e=Ge(j.CBANDS),fe=S.out_samplerate;switch(S.experimentalZ){default:case 0:k=!0;break;case 1:k=!(S.VBR==Aa.vbr_mtrh||S.VBR==Aa.vbr_mt);break;case 2:k=!1;break;case 3:Y=8,X=-1.75,Z=-.0125,V=-8.25,z=-2.25;break}for(A.ms_ener_ratio_old=.25,A.blocktype_old[0]=A.blocktype_old[1]=j.NORM_TYPE,C=0;C<4;++C){for(var Q=0;Q<j.CBANDS;++Q)A.nb_1[C][Q]=1e20,A.nb_2[C][Q]=1e20,A.nb_s1[C][Q]=A.nb_s2[C][Q]=1;for(var te=0;te<j.SBMAX_l;te++)A.en[C].l[te]=1e20,A.thm[C].l[te]=1e20;for(var Q=0;Q<3;++Q){for(var te=0;te<j.SBMAX_s;te++)A.en[C].s[te][Q]=1e20,A.thm[C].s[te][Q]=1e20;A.nsPsy.lastAttacks[C]=0}for(var Q=0;Q<9;Q++)A.nsPsy.last_en_subshort[C][Q]=10}for(A.loudness_sq_save[0]=A.loudness_sq_save[1]=0,A.npart_l=ba(A.numlines_l,A.bo_l,A.bm_l,W,J,A.mld_l,A.PSY.bo_l_weight,fe,j.BLKSIZE,A.scalefac_band.l,j.BLKSIZE/(2*576),j.SBMAX_l),ue(A.npart_l<j.CBANDS),C=0;C<A.npart_l;C++){var me=X;W[C]>=Y&&(me=Z*(W[C]-Y)/(M-Y)+X*(M-W[C])/(M-Y)),_e[C]=Math.pow(10,me/10),A.numlines_l[C]>0?A.rnumlines_l[C]=1/A.numlines_l[C]:A.rnumlines_l[C]=0}A.s3_ll=O0(A.s3ind,A.npart_l,W,J,_e,k);var Q=0;for(C=0;C<A.npart_l;C++){var de;de=j0.MAX_VALUE;for(var Ee=0;Ee<A.numlines_l[C];Ee++,Q++){var ae=fe*Q/(1e3*j.BLKSIZE),ve;ve=this.ATHformula(ae*1e3,S)-20,ve=Math.pow(10,.1*ve),ve*=A.numlines_l[C],de>ve&&(de=ve)}A.ATH.cb_l[C]=de,de=-20+W[C]*20/10,de>6&&(de=100),de<-15&&(de=-15),de-=8,A.minval_l[C]=Math.pow(10,de/10)*A.numlines_l[C]}for(A.npart_s=ba(A.numlines_s,A.bo_s,A.bm_s,W,J,A.mld_s,A.PSY.bo_s_weight,fe,j.BLKSIZE_s,A.scalefac_band.s,j.BLKSIZE_s/(2*192),j.SBMAX_s),ue(A.npart_s<j.CBANDS),Q=0,C=0;C<A.npart_s;C++){var de,me=V;W[C]>=Y&&(me=z*(W[C]-Y)/(M-Y)+V*(M-W[C])/(M-Y)),_e[C]=Math.pow(10,me/10),de=j0.MAX_VALUE;for(var Ee=0;Ee<A.numlines_s[C];Ee++,Q++){var ae=fe*Q/(1e3*j.BLKSIZE_s),ve;ve=this.ATHformula(ae*1e3,S)-20,ve=Math.pow(10,.1*ve),ve*=A.numlines_s[C],de>ve&&(de=ve)}A.ATH.cb_s[C]=de,de=-7+W[C]*7/12,W[C]>12&&(de*=1+Math.log(1+de)*3.1),W[C]<12&&(de*=1+Math.log(1-de)*2.3),de<-15&&(de=-15),de-=8,A.minval_s[C]=Math.pow(10,de/10)*A.numlines_s[C]}A.s3_ss=O0(A.s3ind_s,A.npart_s,W,J,_e,k),u(),p.init_fft(A),A.decay=Math.exp(-1*a/(H*fe/192));{var ee;ee=G,S.exp_nspsytune&2&&(ee=1),Math.abs(S.msfix)>0&&(ee=S.msfix),S.msfix=ee;for(var pe=0;pe<A.npart_l;pe++)A.s3ind[pe][1]>A.npart_l-1&&(A.s3ind[pe][1]=A.npart_l-1)}var ge=576*A.mode_gr/fe;if(A.ATH.decay=Math.pow(10,-12/10*ge),A.ATH.adjust=.01,A.ATH.adjustLimit=1,ue(A.bo_l[j.SBMAX_l-1]<=A.npart_l),ue(A.bo_s[j.SBMAX_s-1]<=A.npart_s),S.ATHtype!=-1){var ae,ce=S.out_samplerate/j.BLKSIZE,ye=0;for(ae=0,C=0;C<j.BLKSIZE/2;++C)ae+=ce,A.ATH.eql_w[C]=1/Math.pow(10,this.ATHformula(ae,S)/10),ye+=A.ATH.eql_w[C];for(ye=1/ye,C=j.BLKSIZE/2;--C>=0;)A.ATH.eql_w[C]*=ye}{for(var pe=Q=0;pe<A.npart_s;++pe)for(C=0;C<A.numlines_s[pe];++C)++Q;ue(Q==129);for(var pe=Q=0;pe<A.npart_l;++pe)for(C=0;C<A.numlines_l[pe];++C)++Q;ue(Q==513)}for(Q=0,C=0;C<A.npart_l;C++){var ae=fe*(Q+A.numlines_l[C]/2)/(1*j.BLKSIZE);A.mld_cb_l[C]=H0(ae),Q+=A.numlines_l[C]}for(;C<j.CBANDS;++C)A.mld_cb_l[C]=1;for(Q=0,C=0;C<A.npart_s;C++){var ae=fe*(Q+A.numlines_s[C]/2)/(1*j.BLKSIZE_s);A.mld_cb_s[C]=H0(ae),Q+=A.numlines_s[C]}for(;C<j.CBANDS;++C)A.mld_cb_s[C]=1;return 0};function Sa(S,A){S<-.3&&(S=3410),S/=1e3,S=Math.max(.1,S);var C=3.64*Math.pow(S,-.8)-6.8*Math.exp(-.6*Math.pow(S-3.4,2))+6*Math.exp(-.15*Math.pow(S-8.7,2))+(.6+.04*A)*.001*Math.pow(S,4);return C}this.ATHformula=function(S,A){var C;switch(A.ATHtype){case 0:C=Sa(S,9);break;case 1:C=Sa(S,-1);break;case 2:C=Sa(S,0);break;case 3:C=Sa(S,1)+6;break;case 4:C=Sa(S,A.ATHcurve);break;default:C=Sa(S,0);break}return C}}var es=Ji;function Yt(p){var a=p;this.ordinal=function(){return a}}Yt.STEREO=new Yt(0);Yt.JOINT_STEREO=new Yt(1);Yt.DUAL_CHANNEL=new Yt(2);Yt.MONO=new Yt(3);Yt.NOT_SET=new Yt(4);var C0=Yt;const ts=B0(C0);var as=C0;function is(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=as.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var ss=is,ns=je(),Mi={};Mi.SFBMAX=ns.SBMAX_s*3;var Qa=Mi,_t=He;_t.System;_t.VbrMode;_t.Float;_t.ShortBlock;_t.Util;_t.Arrays;_t.new_array_n;_t.new_byte;_t.new_double;var rs=_t.new_float;_t.new_float_n;var la=_t.new_int;_t.new_int_n;_t.assert;var m0=Qa;function os(){this.xr=rs(576),this.l3_enc=la(576),this.scalefac=la(m0.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=la(3),this.subblock_gain=la(3+1),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=la(m0.SFBMAX),this.window=la(m0.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=la(4),this.max_nonzero_coeff=0;var p=this;function a(b){return new Int32Array(b)}function _(b){return new Float32Array(b)}this.assign=function(b){p.xr=_(b.xr),p.l3_enc=a(b.l3_enc),p.scalefac=a(b.scalefac),p.xrpow_max=b.xrpow_max,p.part2_3_length=b.part2_3_length,p.big_values=b.big_values,p.count1=b.count1,p.global_gain=b.global_gain,p.scalefac_compress=b.scalefac_compress,p.block_type=b.block_type,p.mixed_block_flag=b.mixed_block_flag,p.table_select=a(b.table_select),p.subblock_gain=a(b.subblock_gain),p.region0_count=b.region0_count,p.region1_count=b.region1_count,p.preflag=b.preflag,p.scalefac_scale=b.scalefac_scale,p.count1table_select=b.count1table_select,p.part2_length=b.part2_length,p.sfb_lmax=b.sfb_lmax,p.sfb_smin=b.sfb_smin,p.psy_lmax=b.psy_lmax,p.sfbmax=b.sfbmax,p.psymax=b.psymax,p.sfbdivide=b.sfbdivide,p.width=a(b.width),p.window=a(b.window),p.count1bits=b.count1bits,p.sfb_partition_table=b.sfb_partition_table.slice(0),p.slen=a(b.slen),p.max_nonzero_coeff=b.max_nonzero_coeff}}var g0=os,ct=He;ct.System;ct.VbrMode;ct.Float;ct.ShortBlock;ct.Util;ct.Arrays;ct.new_array_n;ct.new_byte;ct.new_double;ct.new_float;ct.new_float_n;var z0=ct.new_int;ct.new_int_n;ct.assert;var ls=g0;function _s(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[z0(4),z0(4)];for(var p=0;p<2;p++)for(var a=0;a<2;a++)this.tt[p][a]=new ls}var cs=_s,ht=He,Da=ht.System;ht.VbrMode;ht.Float;ht.ShortBlock;ht.Util;ht.Arrays;ht.new_array_n;ht.new_byte;ht.new_double;ht.new_float;ht.new_float_n;var Fa=ht.new_int;ht.new_int_n;ht.assert;var Va=je();function hs(p,a,_,b){this.l=Fa(1+Va.SBMAX_l),this.s=Fa(1+Va.SBMAX_s),this.psfb21=Fa(1+Va.PSFB21),this.psfb12=Fa(1+Va.PSFB12);var x=this.l,B=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],Da.arraycopy(this.arrL,0,x,0,Math.min(this.arrL.length,this.l.length)),Da.arraycopy(this.arrS,0,B,0,Math.min(this.arrS.length,this.s.length)),Da.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),Da.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var Bi=hs,ut=He;ut.System;ut.VbrMode;ut.Float;ut.ShortBlock;ut.Util;ut.Arrays;ut.new_array_n;ut.new_byte;ut.new_double;var f0=ut.new_float,us=ut.new_float_n,ds=ut.new_int;ut.new_int_n;ut.assert;var J0=je();function vs(){this.last_en_subshort=us([4,9]),this.lastAttacks=ds(4),this.pefirbuf=f0(19),this.longfact=f0(J0.SBMAX_l),this.shortfact=f0(J0.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var ms=vs;function fs(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var ps=fs,dt=He;dt.System;dt.VbrMode;dt.Float;dt.ShortBlock;dt.Util;dt.Arrays;dt.new_array_n;var bs=dt.new_byte,Ss=dt.new_double,Nt=dt.new_float,_a=dt.new_float_n,Vt=dt.new_int,qa=dt.new_int_n;dt.assert;var ys=cs,As=Bi,Es=ms,xs=ps,ei=Ri(),Xe=je(),Ts=Qa;zt.MFSIZE=3*1152+Xe.ENCDELAY-Xe.MDCTDELAY;zt.MAX_HEADER_BUF=256;zt.MAX_BITS_PER_CHANNEL=4095;zt.MAX_BITS_PER_GRANULE=7680;zt.BPC=320;function zt(){var p=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=_a([2,zt.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new ys,this.ms_ratio=Nt(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Vt(2),this.CurrentStep=Vt(2),this.masking_lower=0,this.bv_scf=Vt(576),this.pseudohalf=Vt(Ts.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*zt.BPC+1),this.itime=Ss(2),this.sideinfo_len=0,this.sb_sample=_a([2,2,18,Xe.SBLIMIT]),this.amp_filter=Nt(32);function a(){this.write_timing=0,this.ptr=0,this.buf=bs(p)}this.header=new Array(zt.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new As,this.minval_l=Nt(Xe.CBANDS),this.minval_s=Nt(Xe.CBANDS),this.nb_1=_a([4,Xe.CBANDS]),this.nb_2=_a([4,Xe.CBANDS]),this.nb_s1=_a([4,Xe.CBANDS]),this.nb_s2=_a([4,Xe.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Nt(4),this.loudness_sq=_a([2,2]),this.loudness_sq_save=Nt(2),this.mld_l=Nt(Xe.SBMAX_l),this.mld_s=Nt(Xe.SBMAX_s),this.bm_l=Vt(Xe.SBMAX_l),this.bo_l=Vt(Xe.SBMAX_l),this.bm_s=Vt(Xe.SBMAX_s),this.bo_s=Vt(Xe.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=qa([Xe.CBANDS,2]),this.s3ind_s=qa([Xe.CBANDS,2]),this.numlines_s=Vt(Xe.CBANDS),this.numlines_l=Vt(Xe.CBANDS),this.rnumlines_l=Nt(Xe.CBANDS),this.mld_cb_l=Nt(Xe.CBANDS),this.mld_cb_s=Nt(Xe.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Nt(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Vt(2),this.nsPsy=new Es,this.VBR_seek_table=new xs,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=qa([16,4+1]),this.bitrate_blockType_Hist=qa([16,4+1+1]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var _=0;_<this.en.length;_++)this.en[_]=new ei;for(var _=0;_<this.thm.length;_++)this.thm[_]=new ei;for(var _=0;_<this.header.length;_++)this.header[_]=new a}var ja=zt,vt=He;vt.System;vt.VbrMode;vt.Float;vt.ShortBlock;vt.Util;vt.Arrays;vt.new_array_n;vt.new_byte;vt.new_double;var ca=vt.new_float;vt.new_float_n;vt.new_int;vt.new_int_n;vt.assert;var ha=je();function Rs(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=ca(ha.SBMAX_l),this.s=ca(ha.SBMAX_s),this.psfb21=ca(ha.PSFB21),this.psfb12=ca(ha.PSFB12),this.cb_l=ca(ha.CBANDS),this.cb_s=ca(ha.CBANDS),this.eql_w=ca(ha.BLKSIZE/2)}var Ms=Rs,mt=He,nt=mt.System;mt.VbrMode;mt.Float;mt.ShortBlock;mt.Util;var ti=mt.Arrays;mt.new_array_n;mt.new_byte;mt.new_double;mt.new_float;mt.new_float_n;mt.new_int;mt.new_int_n;mt.assert;ke.STEPS_per_dB=100;ke.MAX_dB=120;ke.GAIN_NOT_ENOUGH_SAMPLES=-24601;ke.GAIN_ANALYSIS_ERROR=0;ke.GAIN_ANALYSIS_OK=1;ke.INIT_GAIN_ANALYSIS_ERROR=0;ke.INIT_GAIN_ANALYSIS_OK=1;ke.YULE_ORDER=10;ke.MAX_ORDER=ke.YULE_ORDER;ke.MAX_SAMP_FREQ=48e3;ke.RMS_WINDOW_TIME_NUMERATOR=1;ke.RMS_WINDOW_TIME_DENOMINATOR=20;ke.MAX_SAMPLES_PER_WINDOW=ke.MAX_SAMP_FREQ*ke.RMS_WINDOW_TIME_NUMERATOR/ke.RMS_WINDOW_TIME_DENOMINATOR+1;function ke(){var p=64.82;ke.YULE_ORDER;var a=.95;ke.MAX_SAMP_FREQ;var _=ke.RMS_WINDOW_TIME_NUMERATOR,b=ke.RMS_WINDOW_TIME_DENOMINATOR;ke.MAX_SAMPLES_PER_WINDOW;var x=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],B=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function E(w,G,$,K,q,U){for(;q--!=0;)$[K]=1e-10+w[G+0]*U[0]-$[K-1]*U[1]+w[G-1]*U[2]-$[K-2]*U[3]+w[G-2]*U[4]-$[K-3]*U[5]+w[G-3]*U[6]-$[K-4]*U[7]+w[G-4]*U[8]-$[K-5]*U[9]+w[G-5]*U[10]-$[K-6]*U[11]+w[G-6]*U[12]-$[K-7]*U[13]+w[G-7]*U[14]-$[K-8]*U[15]+w[G-8]*U[16]-$[K-9]*U[17]+w[G-9]*U[18]-$[K-10]*U[19]+w[G-10]*U[20],++K,++G}function N(w,G,$,K,q,U){for(;q--!=0;)$[K]=w[G+0]*U[0]-$[K-1]*U[1]+w[G-1]*U[2]-$[K-2]*U[3]+w[G-2]*U[4],++K,++G}function H(w,G){for(var $=0;$<MAX_ORDER;$++)w.linprebuf[$]=w.lstepbuf[$]=w.loutbuf[$]=w.rinprebuf[$]=w.rstepbuf[$]=w.routbuf[$]=0;switch(0|G){case 48e3:w.reqindex=0;break;case 44100:w.reqindex=1;break;case 32e3:w.reqindex=2;break;case 24e3:w.reqindex=3;break;case 22050:w.reqindex=4;break;case 16e3:w.reqindex=5;break;case 12e3:w.reqindex=6;break;case 11025:w.reqindex=7;break;case 8e3:w.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return w.sampleWindow=0|(G*_+b-1)/b,w.lsum=0,w.rsum=0,w.totsamp=0,ti.ill(w.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(w,G){return H(w,G)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(w.linpre=MAX_ORDER,w.rinpre=MAX_ORDER,w.lstep=MAX_ORDER,w.rstep=MAX_ORDER,w.lout=MAX_ORDER,w.rout=MAX_ORDER,ti.fill(w.B,0),INIT_GAIN_ANALYSIS_OK)};function T(w){return w*w}this.AnalyzeSamples=function(w,G,$,K,q,U,L){var c,m,y,e,v,f,R;if(U==0)return GAIN_ANALYSIS_OK;switch(R=0,v=U,L){case 1:K=G,q=$;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(U<MAX_ORDER?(nt.arraycopy(G,$,w.linprebuf,MAX_ORDER,U),nt.arraycopy(K,q,w.rinprebuf,MAX_ORDER,U)):(nt.arraycopy(G,$,w.linprebuf,MAX_ORDER,MAX_ORDER),nt.arraycopy(K,q,w.rinprebuf,MAX_ORDER,MAX_ORDER));v>0;){f=v>w.sampleWindow-w.totsamp?w.sampleWindow-w.totsamp:v,R<MAX_ORDER?(c=w.linpre+R,m=w.linprebuf,y=w.rinpre+R,e=w.rinprebuf,f>MAX_ORDER-R&&(f=MAX_ORDER-R)):(c=$+R,m=G,y=q+R,e=K),E(m,c,w.lstepbuf,w.lstep+w.totsamp,f,x[w.reqindex]),E(e,y,w.rstepbuf,w.rstep+w.totsamp,f,x[w.reqindex]),N(w.lstepbuf,w.lstep+w.totsamp,w.loutbuf,w.lout+w.totsamp,f,B[w.reqindex]),N(w.rstepbuf,w.rstep+w.totsamp,w.routbuf,w.rout+w.totsamp,f,B[w.reqindex]),c=w.lout+w.totsamp,m=w.loutbuf,y=w.rout+w.totsamp,e=w.routbuf;for(var u=f%8;u--!=0;)w.lsum+=T(m[c++]),w.rsum+=T(e[y++]);for(u=f/8;u--!=0;)w.lsum+=T(m[c+0])+T(m[c+1])+T(m[c+2])+T(m[c+3])+T(m[c+4])+T(m[c+5])+T(m[c+6])+T(m[c+7]),c+=8,w.rsum+=T(e[y+0])+T(e[y+1])+T(e[y+2])+T(e[y+3])+T(e[y+4])+T(e[y+5])+T(e[y+6])+T(e[y+7]),y+=8;if(v-=f,R+=f,w.totsamp+=f,w.totsamp==w.sampleWindow){var n=ke.STEPS_per_dB*10*Math.log10((w.lsum+w.rsum)/w.totsamp*.5+1e-37),s=n<=0?0:0|n;s>=w.A.length&&(s=w.A.length-1),w.A[s]++,w.lsum=w.rsum=0,nt.arraycopy(w.loutbuf,w.totsamp,w.loutbuf,0,MAX_ORDER),nt.arraycopy(w.routbuf,w.totsamp,w.routbuf,0,MAX_ORDER),nt.arraycopy(w.lstepbuf,w.totsamp,w.lstepbuf,0,MAX_ORDER),nt.arraycopy(w.rstepbuf,w.totsamp,w.rstepbuf,0,MAX_ORDER),w.totsamp=0}if(w.totsamp>w.sampleWindow)return GAIN_ANALYSIS_ERROR}return U<MAX_ORDER?(nt.arraycopy(w.linprebuf,U,w.linprebuf,0,MAX_ORDER-U),nt.arraycopy(w.rinprebuf,U,w.rinprebuf,0,MAX_ORDER-U),nt.arraycopy(G,$,w.linprebuf,MAX_ORDER-U,U),nt.arraycopy(K,q,w.rinprebuf,MAX_ORDER-U,U)):(nt.arraycopy(G,$+U-MAX_ORDER,w.linprebuf,0,MAX_ORDER),nt.arraycopy(K,q+U-MAX_ORDER,w.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function D(w,G){var $,K=0;for($=0;$<G;$++)K+=w[$];if(K==0)return GAIN_NOT_ENOUGH_SAMPLES;var q=0|Math.ceil(K*(1-a));for($=G;$-- >0&&!((q-=w[$])<=0););return p-$/ke.STEPS_per_dB}this.GetTitleGain=function(w){for(var G=D(w.A,w.A.length),$=0;$<w.A.length;$++)w.B[$]+=w.A[$],w.A[$]=0;for(var $=0;$<MAX_ORDER;$++)w.linprebuf[$]=w.lstepbuf[$]=w.loutbuf[$]=w.rinprebuf[$]=w.rstepbuf[$]=w.routbuf[$]=0;return w.totsamp=0,w.lsum=w.rsum=0,G}}var Ii=ke,ft=He;ft.System;ft.VbrMode;ft.Float;ft.ShortBlock;ft.Util;ft.Arrays;ft.new_array_n;ft.new_byte;ft.new_double;var wa=ft.new_float;ft.new_float_n;var ai=ft.new_int;ft.new_int_n;ft.assert;var rt=Ii;function Bs(){this.linprebuf=wa(rt.MAX_ORDER*2),this.linpre=0,this.lstepbuf=wa(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.lstep=0,this.loutbuf=wa(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.lout=0,this.rinprebuf=wa(rt.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=wa(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.rstep=0,this.routbuf=wa(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=ai(0|rt.STEPS_per_dB*rt.MAX_dB),this.B=ai(0|rt.STEPS_per_dB*rt.MAX_dB)}var Is=Bs;function Cs(p){this.bits=p}var Ci=Cs,pt=He;pt.System;pt.VbrMode;pt.Float;pt.ShortBlock;pt.Util;pt.Arrays;pt.new_array_n;pt.new_byte;pt.new_double;var ii=pt.new_float;pt.new_float_n;var gs=pt.new_int;pt.new_int_n;var si=pt.assert,Ls=Ci,ni=je(),ks=Qa,Ns=ja;function Os(p){var a=p;this.quantize=a,this.iteration_loop=function(_,b,x,B){var E=_.internal_flags,N=ii(ks.SFBMAX),H=ii(576),T=gs(2),D=0,w,G=E.l3_side,$=new Ls(D);this.quantize.rv.ResvFrameBegin(_,$),D=$.bits;for(var K=0;K<E.mode_gr;K++){w=this.quantize.qupvt.on_pe(_,b,T,D,K,K),E.mode_ext==ni.MPG_MD_MS_LR&&(this.quantize.ms_convert(E.l3_side,K),this.quantize.qupvt.reduce_side(T,x[K],D,w));for(var q=0;q<E.channels_out;q++){var U,L,c=G.tt[K][q];c.block_type!=ni.SHORT_TYPE?(U=0,L=E.PSY.mask_adjust-U):(U=0,L=E.PSY.mask_adjust_short-U),E.masking_lower=Math.pow(10,L*.1),this.quantize.init_outer_loop(E,c),this.quantize.init_xrpow(E,c,H)&&(this.quantize.qupvt.calc_xmin(_,B[K][q],c,N),this.quantize.outer_loop(_,c,N,H,q,T[q])),this.quantize.iteration_finish_one(E,K,q),si(c.part2_3_length<=Ns.MAX_BITS_PER_CHANNEL),si(c.part2_3_length<=T[q])}}this.quantize.rv.ResvFrameEnd(E,D)}}var Hs=Os;function Me(p,a,_,b){this.xlen=p,this.linmax=a,this.table=_,this.hlen=b}var ie={};ie.t1HB=[1,1,1,0];ie.t2HB=[1,2,1,3,1,1,3,2,0];ie.t3HB=[3,2,1,1,1,1,3,2,0];ie.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];ie.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];ie.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];ie.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];ie.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];ie.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];ie.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];ie.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];ie.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];ie.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];ie.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];ie.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];ie.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];ie.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];ie.t1l=[1,4,3,5];ie.t2l=[1,4,7,4,5,7,6,7,8];ie.t3l=[2,3,7,4,4,7,6,7,8];ie.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];ie.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];ie.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];ie.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];ie.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];ie.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];ie.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];ie.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];ie.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];ie.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];ie.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];ie.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];ie.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];ie.t32l=[1+0,4+1,4+1,5+2,4+1,6+2,5+2,6+3,4+1,5+2,5+2,6+3,5+2,6+3,6+3,6+4];ie.t33l=[4+0,4+1,4+1,4+2,4+1,4+2,4+2,4+3,4+1,4+2,4+2,4+3,4+2,4+3,4+3,4+4];ie.ht=[new Me(0,0,null,null),new Me(2,0,ie.t1HB,ie.t1l),new Me(3,0,ie.t2HB,ie.t2l),new Me(3,0,ie.t3HB,ie.t3l),new Me(0,0,null,null),new Me(4,0,ie.t5HB,ie.t5l),new Me(4,0,ie.t6HB,ie.t6l),new Me(6,0,ie.t7HB,ie.t7l),new Me(6,0,ie.t8HB,ie.t8l),new Me(6,0,ie.t9HB,ie.t9l),new Me(8,0,ie.t10HB,ie.t10l),new Me(8,0,ie.t11HB,ie.t11l),new Me(8,0,ie.t12HB,ie.t12l),new Me(16,0,ie.t13HB,ie.t13l),new Me(0,0,null,ie.t16_5l),new Me(16,0,ie.t15HB,ie.t15l),new Me(1,1,ie.t16HB,ie.t16l),new Me(2,3,ie.t16HB,ie.t16l),new Me(3,7,ie.t16HB,ie.t16l),new Me(4,15,ie.t16HB,ie.t16l),new Me(6,63,ie.t16HB,ie.t16l),new Me(8,255,ie.t16HB,ie.t16l),new Me(10,1023,ie.t16HB,ie.t16l),new Me(13,8191,ie.t16HB,ie.t16l),new Me(4,15,ie.t24HB,ie.t24l),new Me(5,31,ie.t24HB,ie.t24l),new Me(6,63,ie.t24HB,ie.t24l),new Me(7,127,ie.t24HB,ie.t24l),new Me(8,255,ie.t24HB,ie.t24l),new Me(9,511,ie.t24HB,ie.t24l),new Me(11,2047,ie.t24HB,ie.t24l),new Me(13,8191,ie.t24HB,ie.t24l),new Me(0,0,ie.t32HB,ie.t32l),new Me(0,0,ie.t33HB,ie.t33l)];ie.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];ie.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];ie.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];ie.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];ie.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]];ie.scfsi_band=[0,6,11,16,21];var L0=ie,Qt=Bi,bt=He;bt.System;var ua=bt.VbrMode,Xa=bt.Float;bt.ShortBlock;var p0=bt.Util;bt.Arrays;bt.new_array_n;bt.new_byte;bt.new_double;var da=bt.new_float;bt.new_float_n;var Ps=bt.new_int;bt.new_int_n;var jt=bt.assert,We=je(),Ds=Ci,Je=ja;gt.Q_MAX=256+1;gt.Q_MAX2=116;gt.LARGE_BITS=1e5;gt.IXMAX_VAL=8206;function gt(){var p=null,a=null,_=null;this.setModules=function(c,m,y){p=c,a=m,_=y};function b(c){return jt(0<=c+gt.Q_MAX2&&c<gt.Q_MAX),w[c+gt.Q_MAX2]}this.IPOW20=function(c){return jt(0<=c&&c<gt.Q_MAX),G[c]};var x=2220446049250313e-31,B=gt.IXMAX_VAL,E=B+2,N=gt.Q_MAX,H=gt.Q_MAX2;gt.LARGE_BITS;var T=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var D=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=D,this.sfBandIndex=[new Qt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Qt([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var w=da(N+H+1),G=da(N),$=da(E),K=da(E);this.adj43=K;function q(c,m){var y=_.ATHformula(m,c);return y-=T,y=Math.pow(10,y/10+c.ATHlower),y}function U(c){for(var m=c.internal_flags.ATH.l,y=c.internal_flags.ATH.psfb21,e=c.internal_flags.ATH.s,v=c.internal_flags.ATH.psfb12,f=c.internal_flags,R=c.out_samplerate,u=0;u<We.SBMAX_l;u++){var n=f.scalefac_band.l[u],s=f.scalefac_band.l[u+1];m[u]=Xa.MAX_VALUE;for(var h=n;h<s;h++){var r=h*R/1152,t=q(c,r);m[u]=Math.min(m[u],t)}}for(var u=0;u<We.PSFB21;u++){var n=f.scalefac_band.psfb21[u],s=f.scalefac_band.psfb21[u+1];y[u]=Xa.MAX_VALUE;for(var h=n;h<s;h++){var r=h*R/1152,t=q(c,r);y[u]=Math.min(y[u],t)}}for(var u=0;u<We.SBMAX_s;u++){var n=f.scalefac_band.s[u],s=f.scalefac_band.s[u+1];e[u]=Xa.MAX_VALUE;for(var h=n;h<s;h++){var r=h*R/384,t=q(c,r);e[u]=Math.min(e[u],t)}e[u]*=f.scalefac_band.s[u+1]-f.scalefac_band.s[u]}for(var u=0;u<We.PSFB12;u++){var n=f.scalefac_band.psfb12[u],s=f.scalefac_band.psfb12[u+1];v[u]=Xa.MAX_VALUE;for(var h=n;h<s;h++){var r=h*R/384,t=q(c,r);v[u]=Math.min(v[u],t)}v[u]*=f.scalefac_band.s[13]-f.scalefac_band.s[12]}if(c.noATH){for(var u=0;u<We.SBMAX_l;u++)m[u]=1e-20;for(var u=0;u<We.PSFB21;u++)y[u]=1e-20;for(var u=0;u<We.SBMAX_s;u++)e[u]=1e-20;for(var u=0;u<We.PSFB12;u++)v[u]=1e-20}f.ATH.floor=10*Math.log10(q(c,-1))}this.iteration_init=function(c){var m=c.internal_flags,y=m.l3_side,e;if(m.iteration_init_init==0){for(m.iteration_init_init=1,y.main_data_begin=0,U(c),$[0]=0,e=1;e<E;e++)$[e]=Math.pow(e,4/3);for(e=0;e<E-1;e++)K[e]=e+1-Math.pow(.5*($[e]+$[e+1]),.75);for(K[e]=.5,e=0;e<N;e++)G[e]=Math.pow(2,(e-210)*-.1875);for(e=0;e<=N+H;e++)w[e]=Math.pow(2,(e-210-H)*.25);p.huffman_init(m);{var v,f,R,u;for(e=c.exp_nspsytune>>2&63,e>=32&&(e-=64),v=Math.pow(10,e/4/10),e=c.exp_nspsytune>>8&63,e>=32&&(e-=64),f=Math.pow(10,e/4/10),e=c.exp_nspsytune>>14&63,e>=32&&(e-=64),R=Math.pow(10,e/4/10),e=c.exp_nspsytune>>20&63,e>=32&&(e-=64),u=R*Math.pow(10,e/4/10),e=0;e<We.SBMAX_l;e++){var n;e<=6?n=v:e<=13?n=f:e<=20?n=R:n=u,m.nsPsy.longfact[e]=n}for(e=0;e<We.SBMAX_s;e++){var n;e<=5?n=v:e<=10?n=f:e<=11?n=R:n=u,m.nsPsy.shortfact[e]=n}}}},this.on_pe=function(c,m,y,e,v,f){var R=c.internal_flags,u=0,n,s=Ps(2),h,r=new Ds(u),t=a.ResvMaxBits(c,e,r,f);u=r.bits;var d=u+t;for(d>Je.MAX_BITS_PER_GRANULE&&(d=Je.MAX_BITS_PER_GRANULE),n=0,h=0;h<R.channels_out;++h)y[h]=Math.min(Je.MAX_BITS_PER_CHANNEL,u/R.channels_out),s[h]=0|y[h]*m[v][h]/700-y[h],s[h]>e*3/4&&(s[h]=e*3/4),s[h]<0&&(s[h]=0),s[h]+y[h]>Je.MAX_BITS_PER_CHANNEL&&(s[h]=Math.max(0,Je.MAX_BITS_PER_CHANNEL-y[h])),n+=s[h];if(n>t)for(h=0;h<R.channels_out;++h)s[h]=t*s[h]/n;for(h=0;h<R.channels_out;++h)y[h]+=s[h],t-=s[h];for(n=0,h=0;h<R.channels_out;++h)n+=y[h];if(n>Je.MAX_BITS_PER_GRANULE){var l=0;for(h=0;h<R.channels_out;++h)y[h]*=Je.MAX_BITS_PER_GRANULE,y[h]/=n,l+=y[h];jt(l<=Je.MAX_BITS_PER_GRANULE)}return d},this.reduce_side=function(c,m,y,e){jt(e<=Je.MAX_BITS_PER_GRANULE),jt(c[0]+c[1]<=Je.MAX_BITS_PER_GRANULE);var v=.33*(.5-m)/.5;v<0&&(v=0),v>.5&&(v=.5);var f=0|v*.5*(c[0]+c[1]);f>Je.MAX_BITS_PER_CHANNEL-c[0]&&(f=Je.MAX_BITS_PER_CHANNEL-c[0]),f<0&&(f=0),c[1]>=125&&(c[1]-f>125?(c[0]<y&&(c[0]+=f),c[1]-=f):(c[0]+=c[1]-125,c[1]=125)),f=c[0]+c[1],f>e&&(c[0]=e*c[0]/f,c[1]=e*c[1]/f),jt(c[0]<=Je.MAX_BITS_PER_CHANNEL),jt(c[1]<=Je.MAX_BITS_PER_CHANNEL),jt(c[0]+c[1]<=Je.MAX_BITS_PER_GRANULE)},this.athAdjust=function(c,m,y){var e=90.30873362,v=94.82444863,f=p0.FAST_LOG10_X(m,10),R=c*c,u=0;return f-=y,R>1e-20&&(u=1+p0.FAST_LOG10_X(R,10/e)),u<0&&(u=0),f*=u,f+=y+e-v,Math.pow(10,.1*f)},this.calc_xmin=function(c,m,y,e){var v=0,f=c.internal_flags,R,u=0,n=0,s=f.ATH,h=y.xr,r=c.VBR==ua.vbr_mtrh?1:0,t=f.masking_lower;for((c.VBR==ua.vbr_mtrh||c.VBR==ua.vbr_mt)&&(t=1),R=0;R<y.psy_lmax;R++){var d,l,F,I,g,i;c.VBR==ua.vbr_rh||c.VBR==ua.vbr_mtrh?l=athAdjust(s.adjust,s.l[R],s.floor):l=s.adjust*s.l[R],g=y.width[R],F=l/g,I=x,i=g>>1,d=0;do{var o,O;o=h[u]*h[u],d+=o,I+=o<F?o:F,u++,O=h[u]*h[u],d+=O,I+=O<F?O:F,u++}while(--i>0);if(d>l&&n++,R==We.SBPSY_l){var P=l*f.nsPsy.longfact[R];I<P&&(I=P)}if(r!=0&&(l=I),!c.ATHonly){var se=m.en.l[R];if(se>0){var P;P=d*m.thm.l[R]*t/se,r!=0&&(P*=f.nsPsy.longfact[R]),l<P&&(l=P)}}r!=0?e[v++]=l:e[v++]=l*f.nsPsy.longfact[R]}var le=575;if(y.block_type!=We.SHORT_TYPE)for(var re=576;re--!=0&&BitStream.EQ(h[re],0);)le=re;y.max_nonzero_coeff=le;for(var oe=y.sfb_smin;R<y.psymax;oe++,R+=3){var g,be,he;for(c.VBR==ua.vbr_rh||c.VBR==ua.vbr_mtrh?he=athAdjust(s.adjust,s.s[oe],s.floor):he=s.adjust*s.s[oe],g=y.width[R],be=0;be<3;be++){var d=0,l,F,I,i=g>>1;F=he/g,I=x;do{var o,O;o=h[u]*h[u],d+=o,I+=o<F?o:F,u++,O=h[u]*h[u],d+=O,I+=O<F?O:F,u++}while(--i>0);if(d>he&&n++,oe==We.SBPSY_s){var P=he*f.nsPsy.shortfact[oe];I<P&&(I=P)}if(r!=0?l=I:l=he,!c.ATHonly&&!c.ATHshort){var se=m.en.s[oe][be];if(se>0){var P;P=d*m.thm.s[oe][be]*t/se,r!=0&&(P*=f.nsPsy.shortfact[oe]),l<P&&(l=P)}}r!=0?e[v++]=l:e[v++]=l*f.nsPsy.shortfact[oe]}c.useTemporal&&(e[v-3]>e[v-3+1]&&(e[v-3+1]+=(e[v-3]-e[v-3+1])*f.decay),e[v-3+1]>e[v-3+2]&&(e[v-3+2]+=(e[v-3+1]-e[v-3+2])*f.decay))}return n};function L(c){this.s=c}this.calc_noise_core=function(c,m,y,e){var v=0,f=m.s,R=c.l3_enc;if(f>c.count1)for(;y--!=0;){var u;u=c.xr[f],f++,v+=u*u,u=c.xr[f],f++,v+=u*u}else if(f>c.big_values){var n=da(2);for(n[0]=0,n[1]=e;y--!=0;){var u;u=Math.abs(c.xr[f])-n[R[f]],f++,v+=u*u,u=Math.abs(c.xr[f])-n[R[f]],f++,v+=u*u}}else for(;y--!=0;){var u;u=Math.abs(c.xr[f])-$[R[f]]*e,f++,v+=u*u,u=Math.abs(c.xr[f])-$[R[f]]*e,f++,v+=u*u}return m.s=f,v},this.calc_noise=function(c,m,y,e,v){var f=0,R=0,u,n,s=0,h=0,r=0,t=-20,d=0,l=c.scalefac,F=0;for(e.over_SSD=0,u=0;u<c.psymax;u++){var I=c.global_gain-(l[F++]+(c.preflag!=0?D[u]:0)<<c.scalefac_scale+1)-c.subblock_gain[c.window[u]]*8,g=0;if(v!=null&&v.step[u]==I)g=v.noise[u],d+=c.width[u],y[f++]=g/m[R++],g=v.noise_log[u];else{var i=b(I);if(n=c.width[u]>>1,d+c.width[u]>c.max_nonzero_coeff){var o;o=c.max_nonzero_coeff-d+1,o>0?n=o>>1:n=0}var O=new L(d);g=this.calc_noise_core(c,O,n,i),d=O.s,v!=null&&(v.step[u]=I,v.noise[u]=g),g=y[f++]=g/m[R++],g=p0.FAST_LOG10(Math.max(g,1e-20)),v!=null&&(v.noise_log[u]=g)}if(v!=null&&(v.global_gain=c.global_gain),r+=g,g>0){var P;P=Math.max(0|g*10+.5,1),e.over_SSD+=P*P,s++,h+=g}t=Math.max(t,g)}return e.over_count=s,e.tot_noise=r,e.over_noise=h,e.max_noise=t,s},this.set_pinfo=function(c,m,y,e,v){var f=c.internal_flags,R,u,n,s,h,r=m.scalefac_scale==0?.5:1,t=m.scalefac,d=da(L3Side.SFBMAX),l=da(L3Side.SFBMAX),F=new CalcNoiseResult;calc_xmin(c,y,m,d),calc_noise(m,d,l,F,null);var I=0;for(u=m.sfb_lmax,m.block_type!=We.SHORT_TYPE&&m.mixed_block_flag==0&&(u=22),R=0;R<u;R++){var g=f.scalefac_band.l[R],i=f.scalefac_band.l[R+1],o=i-g;for(s=0;I<i;I++)s+=m.xr[I]*m.xr[I];s/=o,h=1e15,f.pinfo.en[e][v][R]=h*s,f.pinfo.xfsf[e][v][R]=h*d[R]*l[R]/o,y.en.l[R]>0&&!c.ATHonly?s=s/y.en.l[R]:s=0,f.pinfo.thr[e][v][R]=h*Math.max(s*y.thm.l[R],f.ATH.l[R]),f.pinfo.LAMEsfb[e][v][R]=0,m.preflag!=0&&R>=11&&(f.pinfo.LAMEsfb[e][v][R]=-r*D[R]),R<We.SBPSY_l&&(jt(t[R]>=0),f.pinfo.LAMEsfb[e][v][R]-=r*t[R])}if(m.block_type==We.SHORT_TYPE)for(u=R,R=m.sfb_smin;R<We.SBMAX_s;R++)for(var g=f.scalefac_band.s[R],i=f.scalefac_band.s[R+1],o=i-g,O=0;O<3;O++){for(s=0,n=g;n<i;n++)s+=m.xr[I]*m.xr[I],I++;s=Math.max(s/o,1e-20),h=1e15,f.pinfo.en_s[e][v][3*R+O]=h*s,f.pinfo.xfsf_s[e][v][3*R+O]=h*d[u]*l[u]/o,y.en.s[R][O]>0?s=s/y.en.s[R][O]:s=0,(c.ATHonly||c.ATHshort)&&(s=0),f.pinfo.thr_s[e][v][3*R+O]=h*Math.max(s*y.thm.s[R][O],f.ATH.s[R]),f.pinfo.LAMEsfb_s[e][v][3*R+O]=-2*m.subblock_gain[O],R<We.SBPSY_s&&(f.pinfo.LAMEsfb_s[e][v][3*R+O]-=r*t[u]),u++}f.pinfo.LAMEqss[e][v]=m.global_gain,f.pinfo.LAMEmainbits[e][v]=m.part2_3_length+m.part2_length,f.pinfo.LAMEsfbits[e][v]=m.part2_length,f.pinfo.over[e][v]=F.over_count,f.pinfo.max_noise[e][v]=F.max_noise*10,f.pinfo.over_noise[e][v]=F.over_noise*10,f.pinfo.tot_noise[e][v]=F.tot_noise*10,f.pinfo.over_SSD[e][v]=F.over_SSD}}var gi=gt,St=He,Fs=St.System;St.VbrMode;St.Float;St.ShortBlock;St.Util;var Vs=St.Arrays;St.new_array_n;St.new_byte;St.new_double;St.new_float;St.new_float_n;var Ia=St.new_int;St.new_int_n;var Ot=St.assert,De=je(),Fe=L0,qs=g0,va=gi;function R0(){var p=null;this.qupvt=null,this.setModules=function(n){this.qupvt=n,p=n};function a(n){this.bits=0|n}var _=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function b(n,s,h,r,t,d){var l=.5946/s;for(Ot(n>0),n=n>>1;n--!=0;)t[d++]=l>h[r++]?0:1,t[d++]=l>h[r++]?0:1}function x(n,s,h,r,t,d){Ot(n>0),n=n>>1;var l=n%2;for(n=n>>1;n--!=0;){var F,I,g,i,o,O,P,se;F=h[r++]*s,I=h[r++]*s,o=0|F,g=h[r++]*s,O=0|I,i=h[r++]*s,P=0|g,F+=p.adj43[o],se=0|i,I+=p.adj43[O],t[d++]=0|F,g+=p.adj43[P],t[d++]=0|I,i+=p.adj43[se],t[d++]=0|g,t[d++]=0|i}if(l!=0){var F,I,o,O;F=h[r++]*s,I=h[r++]*s,o=0|F,O=0|I,F+=p.adj43[o],I+=p.adj43[O],t[d++]=0|F,t[d++]=0|I}}function B(n,s,h,r,t){var d,l,F=0,I,g=0,i=0,o=0,O=s,P=0,se=O,le=0,re=n,oe=0;for(I=t!=null&&r.global_gain==t.global_gain,r.block_type==De.SHORT_TYPE?l=38:l=21,d=0;d<=l;d++){var be=-1;if((I||r.block_type==De.NORM_TYPE)&&(be=r.global_gain-(r.scalefac[d]+(r.preflag!=0?p.pretab[d]:0)<<r.scalefac_scale+1)-r.subblock_gain[r.window[d]]*8),Ot(r.width[d]>=0),I&&t.step[d]==be)g!=0&&(x(g,h,re,oe,se,le),g=0),i!=0&&(b(i,h,re,oe,se,le),i=0);else{var he=r.width[d];if(F+r.width[d]>r.max_nonzero_coeff){var ne;ne=r.max_nonzero_coeff-F+1,Vs.fill(s,r.max_nonzero_coeff,576,0),he=ne,he<0&&(he=0),d=l+1}if(g==0&&i==0&&(se=O,le=P,re=n,oe=o),t!=null&&t.sfb_count1>0&&d>=t.sfb_count1&&t.step[d]>0&&be>=t.step[d]?(g!=0&&(x(g,h,re,oe,se,le),g=0,se=O,le=P,re=n,oe=o),i+=he):(i!=0&&(b(i,h,re,oe,se,le),i=0,se=O,le=P,re=n,oe=o),g+=he),he<=0){i!=0&&(b(i,h,re,oe,se,le),i=0),g!=0&&(x(g,h,re,oe,se,le),g=0);break}}d<=l&&(P+=r.width[d],o+=r.width[d],F+=r.width[d])}g!=0&&(x(g,h,re,oe,se,le),g=0),i!=0&&(b(i,h,re,oe,se,le),i=0)}function E(n,s,h){var r=0,t=0;do{var d=n[s++],l=n[s++];r<d&&(r=d),t<l&&(t=l)}while(s<h);return r<t&&(r=t),r}function N(n,s,h,r,t,d){var l=Fe.ht[r].xlen*65536+Fe.ht[t].xlen,F=0,I;do{var g=n[s++],i=n[s++];g!=0&&(g>14&&(g=15,F+=l),g*=16),i!=0&&(i>14&&(i=15,F+=l),g+=i),F+=Fe.largetbl[g]}while(s<h);return I=F&65535,F>>=16,F>I&&(F=I,r=t),d.bits+=F,r}function H(n,s,h,r){var t=0,d=Fe.ht[1].hlen;do{var l=n[s+0]*2+n[s+1];s+=2,t+=d[l]}while(s<h);return r.bits+=t,1}function T(n,s,h,r,t){var d=0,l,F=Fe.ht[r].xlen,I;r==2?I=Fe.table23:I=Fe.table56;do{var g=n[s+0]*F+n[s+1];s+=2,d+=I[g]}while(s<h);return l=d&65535,d>>=16,d>l&&(d=l,r++),t.bits+=d,r}function D(n,s,h,r,t){var d=0,l=0,F=0,I=Fe.ht[r].xlen,g=Fe.ht[r].hlen,i=Fe.ht[r+1].hlen,o=Fe.ht[r+2].hlen;do{var O=n[s+0]*I+n[s+1];s+=2,d+=g[O],l+=i[O],F+=o[O]}while(s<h);var P=r;return d>l&&(d=l,P++),d>F&&(d=F,P=r+2),t.bits+=d,P}var w=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function G(n,s,h,r){var t=E(n,s,h);switch(t){case 0:return t;case 1:return H(n,s,h,r);case 2:case 3:return T(n,s,h,w[t-1],r);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return D(n,s,h,w[t-1],r);default:if(t>va.IXMAX_VAL)return r.bits=va.LARGE_BITS,-1;t-=15;var d;for(d=24;d<32&&!(Fe.ht[d].linmax>=t);d++);var l;for(l=d-8;l<24&&!(Fe.ht[l].linmax>=t);l++);return N(n,s,h,l,d,r)}}this.noquant_count_bits=function(n,s,h){var r=s.l3_enc,t=Math.min(576,s.max_nonzero_coeff+2>>1<<1);for(h!=null&&(h.sfb_count1=0);t>1&&!(r[t-1]|r[t-2]);t-=2);s.count1=t;for(var d=0,l=0;t>3;t-=4){var F;if(((r[t-1]|r[t-2]|r[t-3]|r[t-4])&2147483647)>1)break;F=((r[t-4]*2+r[t-3])*2+r[t-2])*2+r[t-1],d+=Fe.t32l[F],l+=Fe.t33l[F]}var I=d;if(s.count1table_select=0,d>l&&(I=l,s.count1table_select=1),s.count1bits=I,s.big_values=t,t==0)return I;if(s.block_type==De.SHORT_TYPE)d=3*n.scalefac_band.s[3],d>s.big_values&&(d=s.big_values),l=s.big_values;else if(s.block_type==De.NORM_TYPE){if(Ot(t<=576),d=s.region0_count=n.bv_scf[t-2],l=s.region1_count=n.bv_scf[t-1],Ot(d+l+2<De.SBPSY_l),l=n.scalefac_band.l[d+l+2],d=n.scalefac_band.l[d+1],l<t){var g=new a(I);s.table_select[2]=G(r,l,t,g),I=g.bits}}else s.region0_count=7,s.region1_count=De.SBMAX_l-1-7-1,d=n.scalefac_band.l[7+1],l=t,d>l&&(d=l);if(d=Math.min(d,t),l=Math.min(l,t),Ot(d>=0),Ot(l>=0),0<d){var g=new a(I);s.table_select[0]=G(r,0,d,g),I=g.bits}if(d<l){var g=new a(I);s.table_select[1]=G(r,d,l,g),I=g.bits}if(n.use_best_huffman==2&&(s.part2_3_length=I,best_huffman_divide(n,s),I=s.part2_3_length),h!=null&&s.block_type==De.NORM_TYPE){for(var i=0;n.scalefac_band.l[i]<s.big_values;)i++;h.sfb_count1=i}return I},this.count_bits=function(n,s,h,r){var t=h.l3_enc,d=va.IXMAX_VAL/p.IPOW20(h.global_gain);if(h.xrpow_max>d)return va.LARGE_BITS;if(B(s,t,p.IPOW20(h.global_gain),h,r),n.substep_shaping&2)for(var l=0,F=h.global_gain+h.scalefac_scale,I=.634521682242439/p.IPOW20(F),g=0;g<h.sfbmax;g++){var i=h.width[g];if(Ot(i>=0),n.pseudohalf[g]==0)l+=i;else{var o;for(o=l,l+=i;o<l;++o)t[o]=s[o]>=I?t[o]:0}}return this.noquant_count_bits(n,h,r)};function $(n,s,h,r,t,d,l){for(var F=s.big_values,I=0;I<=7+15;I++)r[I]=va.LARGE_BITS;for(var I=0;I<16;I++){var g=n.scalefac_band.l[I+1];if(g>=F)break;var i=0,o=new a(i),O=G(h,0,g,o);i=o.bits;for(var P=0;P<8;P++){var se=n.scalefac_band.l[I+P+2];if(se>=F)break;var le=i;o=new a(le);var re=G(h,g,se,o);le=o.bits,r[I+P]>le&&(r[I+P]=le,t[I+P]=I,d[I+P]=O,l[I+P]=re)}}}function K(n,s,h,r,t,d,l,F){for(var I=s.big_values,g=2;g<De.SBMAX_l+1;g++){var i=n.scalefac_band.l[g];if(i>=I)break;var o=t[g-2]+s.count1bits;if(h.part2_3_length<=o)break;var O=new a(o),P=G(r,i,I,O);o=O.bits,!(h.part2_3_length<=o)&&(h.assign(s),h.part2_3_length=o,h.region0_count=d[g-2],h.region1_count=g-2-d[g-2],h.table_select[0]=l[g-2],h.table_select[1]=F[g-2],h.table_select[2]=P)}}this.best_huffman_divide=function(n,s){var h=new qs,r=s.l3_enc,t=Ia(7+15+1),d=Ia(7+15+1),l=Ia(7+15+1),F=Ia(7+15+1);if(!(s.block_type==De.SHORT_TYPE&&n.mode_gr==1)){h.assign(s),s.block_type==De.NORM_TYPE&&($(n,s,r,t,d,l,F),K(n,h,s,r,t,d,l,F));var I=h.big_values;if(!(I==0||(r[I-2]|r[I-1])>1)&&(I=s.count1+2,!(I>576))){h.assign(s),h.count1=I;var g=0,i=0;for(Ot(I<=576);I>h.big_values;I-=4){var o=((r[I-4]*2+r[I-3])*2+r[I-2])*2+r[I-1];g+=Fe.t32l[o],i+=Fe.t33l[o]}if(h.big_values=I,h.count1table_select=0,g>i&&(g=i,h.count1table_select=1),h.count1bits=g,h.block_type==De.NORM_TYPE)K(n,h,s,r,t,d,l,F);else{if(h.part2_3_length=g,g=n.scalefac_band.l[7+1],g>I&&(g=I),g>0){var O=new a(h.part2_3_length);h.table_select[0]=G(r,0,g,O),h.part2_3_length=O.bits}if(I>g){var O=new a(h.part2_3_length);h.table_select[1]=G(r,g,I,O),h.part2_3_length=O.bits}s.part2_3_length>h.part2_3_length&&s.assign(h)}}}};var q=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],U=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],L=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],c=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];R0.slen1_tab=L,R0.slen2_tab=c;function m(n,s){for(var h,r=s.tt[1][n],t=s.tt[0][n],d=0;d<Fe.scfsi_band.length-1;d++){for(h=Fe.scfsi_band[d];h<Fe.scfsi_band[d+1]&&!(t.scalefac[h]!=r.scalefac[h]&&r.scalefac[h]>=0);h++);if(h==Fe.scfsi_band[d+1]){for(h=Fe.scfsi_band[d];h<Fe.scfsi_band[d+1];h++)r.scalefac[h]=-1;s.scfsi[n][d]=1}}var l=0,F=0;for(h=0;h<11;h++)r.scalefac[h]!=-1&&(F++,l<r.scalefac[h]&&(l=r.scalefac[h]));for(var I=0,g=0;h<De.SBPSY_l;h++)r.scalefac[h]!=-1&&(g++,I<r.scalefac[h]&&(I=r.scalefac[h]));for(var d=0;d<16;d++)if(l<q[d]&&I<U[d]){var i=L[d]*F+c[d]*g;r.part2_length>i&&(r.part2_length=i,r.scalefac_compress=d)}}this.best_scalefac_store=function(n,s,h,r){var t=r.tt[s][h],d,l,F,I,g=0;for(F=0,d=0;d<t.sfbmax;d++){var i=t.width[d];for(Ot(i>=0),F+=i,I=-i;I<0&&t.l3_enc[I+F]==0;I++);I==0&&(t.scalefac[d]=g=-2)}if(t.scalefac_scale==0&&t.preflag==0){var o=0;for(d=0;d<t.sfbmax;d++)t.scalefac[d]>0&&(o|=t.scalefac[d]);if(!(o&1)&&o!=0){for(d=0;d<t.sfbmax;d++)t.scalefac[d]>0&&(t.scalefac[d]>>=1);t.scalefac_scale=g=1}}if(t.preflag==0&&t.block_type!=De.SHORT_TYPE&&n.mode_gr==2){for(d=11;d<De.SBPSY_l&&!(t.scalefac[d]<p.pretab[d]&&t.scalefac[d]!=-2);d++);if(d==De.SBPSY_l){for(d=11;d<De.SBPSY_l;d++)t.scalefac[d]>0&&(t.scalefac[d]-=p.pretab[d]);t.preflag=g=1}}for(l=0;l<4;l++)r.scfsi[h][l]=0;for(n.mode_gr==2&&s==1&&r.tt[0][h].block_type!=De.SHORT_TYPE&&r.tt[1][h].block_type!=De.SHORT_TYPE&&(m(h,r),g=0),d=0;d<t.sfbmax;d++)t.scalefac[d]==-2&&(t.scalefac[d]=0);g!=0&&(n.mode_gr==2?this.scale_bitcount(t):this.scale_bitcount_lsf(n,t))};function y(n,s){for(var h=0;h<s;++h)if(n[h]<0)return!1;return!0}var e=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],v=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],f=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(n){var s,h,r=0,t=0,d,l=n.scalefac;if(Ot(y(l,n.sfbmax)),n.block_type==De.SHORT_TYPE)d=e,n.mixed_block_flag!=0&&(d=v);else if(d=f,n.preflag==0){for(h=11;h<De.SBPSY_l&&!(l[h]<p.pretab[h]);h++);if(h==De.SBPSY_l)for(n.preflag=1,h=11;h<De.SBPSY_l;h++)l[h]-=p.pretab[h]}for(h=0;h<n.sfbdivide;h++)r<l[h]&&(r=l[h]);for(;h<n.sfbmax;h++)t<l[h]&&(t=l[h]);for(n.part2_length=va.LARGE_BITS,s=0;s<16;s++)r<q[s]&&t<U[s]&&n.part2_length>d[s]&&(n.part2_length=d[s],n.scalefac_compress=s);return n.part2_length==va.LARGE_BITS};var R=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(n,s){var h,r,t,d,l,F,I,g,i=Ia(4),o=s.scalefac;for(s.preflag!=0?h=2:h=0,I=0;I<4;I++)i[I]=0;if(s.block_type==De.SHORT_TYPE){r=1;var O=p.nr_of_sfb_block[h][r];for(g=0,t=0;t<4;t++)for(d=O[t]/3,I=0;I<d;I++,g++)for(l=0;l<3;l++)o[g*3+l]>i[t]&&(i[t]=o[g*3+l])}else{r=0;var O=p.nr_of_sfb_block[h][r];for(g=0,t=0;t<4;t++)for(d=O[t],I=0;I<d;I++,g++)o[g]>i[t]&&(i[t]=o[g])}for(F=!1,t=0;t<4;t++)i[t]>R[h][t]&&(F=!0);if(!F){var P,se,le,re;for(s.sfb_partition_table=p.nr_of_sfb_block[h][r],t=0;t<4;t++)s.slen[t]=u[i[t]];switch(P=s.slen[0],se=s.slen[1],le=s.slen[2],re=s.slen[3],h){case 0:s.scalefac_compress=(P*5+se<<4)+(le<<2)+re;break;case 1:s.scalefac_compress=400+(P*5+se<<2)+le;break;case 2:s.scalefac_compress=500+P*3+se;break;default:Fs.err.printf(`intensity stereo not implemented yet
`);break}}if(!F)for(Ot(s.sfb_partition_table!=null),s.part2_length=0,t=0;t<4;t++)s.part2_length+=s.slen[t]*s.sfb_partition_table[t];return F};var u=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(n){for(var s=2;s<=576;s+=2){for(var h=0,r;n.scalefac_band.l[++h]<s;);for(r=_[h][0];n.scalefac_band.l[r+1]>s;)r--;for(r<0&&(r=_[h][0]),n.bv_scf[s-2]=r,r=_[h][1];n.scalefac_band.l[r+n.bv_scf[s-2]+2]>s;)r--;r<0&&(r=_[h][1]),n.bv_scf[s-1]=r}}}var Li=R0,yt=He,Ut=yt.System;yt.VbrMode;yt.Float;yt.ShortBlock;yt.Util;var Xs=yt.Arrays;yt.new_array_n;var Ys=yt.new_byte;yt.new_double;yt.new_float;var $s=yt.new_float_n,Gs=yt.new_int;yt.new_int_n;var Ae=yt.assert,ri=Li,b0=L0,Ya=je(),ma=ja;Ka.EQ=function(p,a){return Math.abs(p)>Math.abs(a)?Math.abs(p-a)<=Math.abs(p)*1e-6:Math.abs(p-a)<=Math.abs(a)*1e-6};Ka.NEQ=function(p,a){return!Ka.EQ(p,a)};function Ka(){var p=this,a=32773,_=32,b=null,x=null,B=null,E=null;this.setModules=function(u,n,s,h){b=u,x=n,B=s,E=h};var N=null,H=0,T=0,D=0;this.getframebits=function(u){var n=u.internal_flags,s;n.bitrate_index!=0?s=b0.bitrate_table[u.version][n.bitrate_index]:s=u.brate,Ae(8<=s&&s<=640);var h=0|(u.version+1)*72e3*s/u.out_samplerate+n.padding;return 8*h};function w(u){Ut.arraycopy(u.header[u.w_ptr].buf,0,N,T,u.sideinfo_len),T+=u.sideinfo_len,H+=u.sideinfo_len*8,u.w_ptr=u.w_ptr+1&ma.MAX_HEADER_BUF-1}function G(u,n,s){for(Ae(s<_-2);s>0;){var h;D==0&&(D=8,T++,Ae(T<Lame.LAME_MAXMP3BUFFER),Ae(u.header[u.w_ptr].write_timing>=H),u.header[u.w_ptr].write_timing==H&&w(u),N[T]=0),h=Math.min(s,D),s-=h,D-=h,Ae(s<_),Ae(D<_),N[T]|=n>>s<<D,H+=h}}function $(u,n,s){for(Ae(s<_-2);s>0;){var h;D==0&&(D=8,T++,Ae(T<Lame.LAME_MAXMP3BUFFER),N[T]=0),h=Math.min(s,D),s-=h,D-=h,Ae(s<_),Ae(D<_),N[T]|=n>>s<<D,H+=h}}function K(u,n){var s=u.internal_flags,h;if(Ae(n>=0),n>=8&&(G(s,76,8),n-=8),n>=8&&(G(s,65,8),n-=8),n>=8&&(G(s,77,8),n-=8),n>=8&&(G(s,69,8),n-=8),n>=32){var r=B.getLameShortVersion();if(n>=32)for(h=0;h<r.length&&n>=8;++h)n-=8,G(s,r.charAt(h),8)}for(;n>=1;n-=1)G(s,s.ancillary_flag,1),s.ancillary_flag^=u.disable_reservoir?0:1;Ae(n==0)}function q(u,n,s){for(var h=u.header[u.h_ptr].ptr;s>0;){var r=Math.min(s,8-(h&7));s-=r,Ae(s<_),u.header[u.h_ptr].buf[h>>3]|=n>>s<<8-(h&7)-r,h+=r}u.header[u.h_ptr].ptr=h}function U(u,n){u<<=8;for(var s=0;s<8;s++)u<<=1,n<<=1,(n^u)&65536&&(n^=a);return n}this.CRC_writeheader=function(u,n){var s=65535;s=U(n[2]&255,s),s=U(n[3]&255,s);for(var h=6;h<u.sideinfo_len;h++)s=U(n[h]&255,s);n[4]=byte(s>>8),n[5]=byte(s&255)};function L(u,n){var s=u.internal_flags,h,r,t;if(h=s.l3_side,s.header[s.h_ptr].ptr=0,Xs.fill(s.header[s.h_ptr].buf,0,s.sideinfo_len,0),u.out_samplerate<16e3?q(s,4094,12):q(s,4095,12),q(s,u.version,1),q(s,4-3,2),q(s,u.error_protection?0:1,1),q(s,s.bitrate_index,4),q(s,s.samplerate_index,2),q(s,s.padding,1),q(s,u.extension,1),q(s,u.mode.ordinal(),2),q(s,s.mode_ext,2),q(s,u.copyright,1),q(s,u.original,1),q(s,u.emphasis,2),u.error_protection&&q(s,0,16),u.version==1){for(Ae(h.main_data_begin>=0),q(s,h.main_data_begin,9),s.channels_out==2?q(s,h.private_bits,3):q(s,h.private_bits,5),t=0;t<s.channels_out;t++){var d;for(d=0;d<4;d++)q(s,h.scfsi[t][d],1)}for(r=0;r<2;r++)for(t=0;t<s.channels_out;t++){var l=h.tt[r][t];q(s,l.part2_3_length+l.part2_length,12),q(s,l.big_values/2,9),q(s,l.global_gain,8),q(s,l.scalefac_compress,4),l.block_type!=Ya.NORM_TYPE?(q(s,1,1),q(s,l.block_type,2),q(s,l.mixed_block_flag,1),l.table_select[0]==14&&(l.table_select[0]=16),q(s,l.table_select[0],5),l.table_select[1]==14&&(l.table_select[1]=16),q(s,l.table_select[1],5),q(s,l.subblock_gain[0],3),q(s,l.subblock_gain[1],3),q(s,l.subblock_gain[2],3)):(q(s,0,1),l.table_select[0]==14&&(l.table_select[0]=16),q(s,l.table_select[0],5),l.table_select[1]==14&&(l.table_select[1]=16),q(s,l.table_select[1],5),l.table_select[2]==14&&(l.table_select[2]=16),q(s,l.table_select[2],5),Ae(0<=l.region0_count&&l.region0_count<16),Ae(0<=l.region1_count&&l.region1_count<8),q(s,l.region0_count,4),q(s,l.region1_count,3)),q(s,l.preflag,1),q(s,l.scalefac_scale,1),q(s,l.count1table_select,1)}}else for(Ae(h.main_data_begin>=0),q(s,h.main_data_begin,8),q(s,h.private_bits,s.channels_out),r=0,t=0;t<s.channels_out;t++){var l=h.tt[r][t];q(s,l.part2_3_length+l.part2_length,12),q(s,l.big_values/2,9),q(s,l.global_gain,8),q(s,l.scalefac_compress,9),l.block_type!=Ya.NORM_TYPE?(q(s,1,1),q(s,l.block_type,2),q(s,l.mixed_block_flag,1),l.table_select[0]==14&&(l.table_select[0]=16),q(s,l.table_select[0],5),l.table_select[1]==14&&(l.table_select[1]=16),q(s,l.table_select[1],5),q(s,l.subblock_gain[0],3),q(s,l.subblock_gain[1],3),q(s,l.subblock_gain[2],3)):(q(s,0,1),l.table_select[0]==14&&(l.table_select[0]=16),q(s,l.table_select[0],5),l.table_select[1]==14&&(l.table_select[1]=16),q(s,l.table_select[1],5),l.table_select[2]==14&&(l.table_select[2]=16),q(s,l.table_select[2],5),Ae(0<=l.region0_count&&l.region0_count<16),Ae(0<=l.region1_count&&l.region1_count<8),q(s,l.region0_count,4),q(s,l.region1_count,3)),q(s,l.scalefac_scale,1),q(s,l.count1table_select,1)}u.error_protection&&CRC_writeheader(s,s.header[s.h_ptr].buf);{var F=s.h_ptr;Ae(s.header[F].ptr==s.sideinfo_len*8),s.h_ptr=F+1&ma.MAX_HEADER_BUF-1,s.header[s.h_ptr].write_timing=s.header[F].write_timing+n,s.h_ptr==s.w_ptr&&Ut.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function c(u,n){var s=b0.ht[n.count1table_select+32],h,r=0,t=n.big_values,d=n.big_values;for(Ae(n.count1table_select<2),h=(n.count1-n.big_values)/4;h>0;--h){var l=0,F=0,I;I=n.l3_enc[t+0],I!=0&&(F+=8,n.xr[d+0]<0&&l++,Ae(I<=1)),I=n.l3_enc[t+1],I!=0&&(F+=4,l*=2,n.xr[d+1]<0&&l++,Ae(I<=1)),I=n.l3_enc[t+2],I!=0&&(F+=2,l*=2,n.xr[d+2]<0&&l++,Ae(I<=1)),I=n.l3_enc[t+3],I!=0&&(F++,l*=2,n.xr[d+3]<0&&l++,Ae(I<=1)),t+=4,d+=4,G(u,l+s.table[F],s.hlen[F]),r+=s.hlen[F]}return r}function m(u,n,s,h,r){var t=b0.ht[n],d=0;if(Ae(n<32),n==0)return d;for(var l=s;l<h;l+=2){var F=0,I=0,g=t.xlen,i=t.xlen,o=0,O=r.l3_enc[l],P=r.l3_enc[l+1];if(O!=0&&(r.xr[l]<0&&o++,F--),n>15){if(O>14){var se=O-15;Ae(se<=t.linmax),o|=se<<1,I=g,O=15}if(P>14){var le=P-15;Ae(le<=t.linmax),o<<=g,o|=le,I+=g,P=15}i=16}P!=0&&(o<<=1,r.xr[l+1]<0&&o++,F--),Ae((O|P)<16),O=O*i+P,I-=F,F+=t.hlen[O],Ae(F<=_),Ae(I<=_),G(u,t.table[O],F),G(u,o,I),d+=F+I}return d}function y(u,n){var s=3*u.scalefac_band.s[3];s>n.big_values&&(s=n.big_values);var h=m(u,n.table_select[0],0,s,n);return h+=m(u,n.table_select[1],s,n.big_values,n),h}function e(u,n){var s,h,r,t;s=n.big_values,Ae(0<=s&&s<=576);var d=n.region0_count+1;return Ae(0<=d),Ae(d<u.scalefac_band.l.length),r=u.scalefac_band.l[d],d+=n.region1_count+1,Ae(0<=d),Ae(d<u.scalefac_band.l.length),t=u.scalefac_band.l[d],r>s&&(r=s),t>s&&(t=s),h=m(u,n.table_select[0],0,r,n),h+=m(u,n.table_select[1],r,t,n),h+=m(u,n.table_select[2],t,s,n),h}function v(u){var n,s,h,r,t=0,d=u.internal_flags,l=d.l3_side;if(u.version==1)for(n=0;n<2;n++)for(s=0;s<d.channels_out;s++){var F=l.tt[n][s],I=ri.slen1_tab[F.scalefac_compress],g=ri.slen2_tab[F.scalefac_compress];for(r=0,h=0;h<F.sfbdivide;h++)F.scalefac[h]!=-1&&(G(d,F.scalefac[h],I),r+=I);for(;h<F.sfbmax;h++)F.scalefac[h]!=-1&&(G(d,F.scalefac[h],g),r+=g);Ae(r==F.part2_length),F.block_type==Ya.SHORT_TYPE?r+=y(d,F):r+=e(d,F),r+=c(d,F),Ae(r==F.part2_3_length+F.part2_length),t+=r}else for(n=0,s=0;s<d.channels_out;s++){var F=l.tt[n][s],i,o,O=0;if(Ae(F.sfb_partition_table!=null),r=0,h=0,o=0,F.block_type==Ya.SHORT_TYPE){for(;o<4;o++){var P=F.sfb_partition_table[o]/3,se=F.slen[o];for(i=0;i<P;i++,h++)G(d,Math.max(F.scalefac[h*3+0],0),se),G(d,Math.max(F.scalefac[h*3+1],0),se),G(d,Math.max(F.scalefac[h*3+2],0),se),O+=3*se}r+=y(d,F)}else{for(;o<4;o++){var P=F.sfb_partition_table[o],se=F.slen[o];for(i=0;i<P;i++,h++)G(d,Math.max(F.scalefac[h],0),se),O+=se}r+=e(d,F)}r+=c(d,F),Ae(r==F.part2_3_length),Ae(O==F.part2_length),t+=O+r}return t}function f(){this.total=0}function R(u,n){var s=u.internal_flags,h,r,t,d,l;return l=s.w_ptr,d=s.h_ptr-1,d==-1&&(d=ma.MAX_HEADER_BUF-1),h=s.header[d].write_timing-H,n.total=h,h>=0&&(r=1+d-l,d<l&&(r=1+d-l+ma.MAX_HEADER_BUF),h-=r*8*s.sideinfo_len),t=p.getframebits(u),h+=t,n.total+=t,n.total%8!=0?n.total=1+n.total/8:n.total=n.total/8,n.total+=T+1,h<0&&Ut.err.println(`strange error flushing buffer ... 
`),h}this.flush_bitstream=function(u){var n=u.internal_flags,s,h,r=n.h_ptr-1;if(r==-1&&(r=ma.MAX_HEADER_BUF-1),s=n.l3_side,!((h=R(u,new f))<0)){if(K(u,h),Ae(n.header[r].write_timing+this.getframebits(u)==H),n.ResvSize=0,s.main_data_begin=0,n.findReplayGain){var t=b.GetTitleGain(n.rgdata);Ae(NEQ(t,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),n.RadioGain=Math.floor(t*10+.5)|0}n.findPeakSample&&(n.noclipGainChange=Math.ceil(Math.log10(n.PeakSample/32767)*20*10)|0,n.noclipGainChange>0&&(EQ(u.scale,1)||EQ(u.scale,0))?n.noclipScale=Math.floor(32767/n.PeakSample*100)/100:n.noclipScale=-1)}},this.add_dummy_byte=function(u,n,s){for(var h=u.internal_flags,r;s-- >0;)for($(h,n,8),r=0;r<ma.MAX_HEADER_BUF;++r)h.header[r].write_timing+=8},this.format_bitstream=function(u){var n=u.internal_flags,s;s=n.l3_side;var h=this.getframebits(u);K(u,s.resvDrain_pre),L(u,h);var r=8*n.sideinfo_len;if(r+=v(u),K(u,s.resvDrain_post),r+=s.resvDrain_post,s.main_data_begin+=(h-r)/8,R(u,new f)!=n.ResvSize&&Ut.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),s.main_data_begin*8!=n.ResvSize&&(Ut.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*s.main_data_begin,n.ResvSize,s.resvDrain_post,s.resvDrain_pre,8*n.sideinfo_len,r-s.resvDrain_post-8*n.sideinfo_len,r,r%8,h),Ut.err.println("This is a fatal error.  It has several possible causes:"),Ut.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),Ut.err.println(" 9%%  Your system is overclocked"),Ut.err.println(" 1%%  bug in LAME encoding library"),n.ResvSize=s.main_data_begin*8),Ae(H%8==0),H>1e9){var t;for(t=0;t<ma.MAX_HEADER_BUF;++t)n.header[t].write_timing-=H;H=0}return 0},this.copy_buffer=function(u,n,s,h,r){var t=T+1;if(t<=0)return 0;if(h!=0&&t>h)return-1;if(Ut.arraycopy(N,0,n,s,t),T=-1,D=0,r!=0){var d=Gs(1);if(d[0]=u.nMusicCRC,E.updateMusicCRC(d,n,s,t),u.nMusicCRC=d[0],t>0&&(u.VBR_seek_table.nBytesWritten+=t),u.decode_on_the_fly){for(var l=$s([2,1152]),F=t,I=-1,g;I!=0;)if(I=x.hip_decode1_unclipped(u.hip,n,s,F,l[0],l[1]),F=0,I==-1&&(I=0),I>0){if(Ae(I<=1152),u.findPeakSample){for(g=0;g<I;g++)l[0][g]>u.PeakSample?u.PeakSample=l[0][g]:-l[0][g]>u.PeakSample&&(u.PeakSample=-l[0][g]);if(u.channels_out>1)for(g=0;g<I;g++)l[1][g]>u.PeakSample?u.PeakSample=l[1][g]:-l[1][g]>u.PeakSample&&(u.PeakSample=-l[1][g])}if(u.findReplayGain&&b.AnalyzeSamples(u.rgdata,l[0],0,l[1],0,I,u.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return t},this.init_bit_stream_w=function(u){N=Ys(Lame.LAME_MAXMP3BUFFER),u.h_ptr=u.w_ptr=0,u.header[u.h_ptr].write_timing=0,T=-1,D=0,H=0}}var k0=Ka;const Us=B0(k0);var et=He,Ks=et.System,Ce=et.VbrMode;et.Float;var S0=et.ShortBlock;et.Util;et.Arrays;et.new_array_n;et.new_byte;et.new_double;var fa=et.new_float;et.new_float_n;et.new_int;var oi=et.new_int_n,Zs=et.new_short_n,Ct=et.assert,y0=es,Ws=ss,Ca=ja,Qs=Ms,js=Is,zs=Hs,pa=k0,Kt=L0,qe=je();function Ue(){var p=this,a=128*1024;Ue.V9=410,Ue.V8=420,Ue.V7=430,Ue.V6=440,Ue.V5=450,Ue.V4=460,Ue.V3=470,Ue.V2=480,Ue.V1=490,Ue.V0=500,Ue.R3MIX=1e3,Ue.STANDARD=1001,Ue.EXTREME=1002,Ue.INSANE=1003,Ue.STANDARD_FAST=1004,Ue.EXTREME_FAST=1005,Ue.MEDIUM=1006,Ue.MEDIUM_FAST=1007;var _=16384+a;Ue.LAME_MAXMP3BUFFER=_;var b,x,B,E,N,H=new y0,T,D,w;this.enc=new qe,this.setModules=function(i,o,O,P,se,le,re,oe,be){b=i,x=o,B=O,E=P,N=se,T=le,D=oe,w=be,this.enc.setModules(x,H,E,T)};function G(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=fa(qe.SBMAX_l),this.bo_s_weight=fa(qe.SBMAX_s)}function $(){this.lowerlimit=0}function K(i,o){this.lowpass=o}var q=4294479419;function U(i){var o;return i.class_id=q,o=i.internal_flags=new Ca,i.mode=MPEGMode.NOT_SET,i.original=1,i.in_samplerate=44100,i.num_channels=2,i.num_samples=-1,i.bWriteVbrTag=!0,i.quality=-1,i.short_blocks=null,o.subblock_gain=-1,i.lowpassfreq=0,i.highpassfreq=0,i.lowpasswidth=-1,i.highpasswidth=-1,i.VBR=Ce.vbr_off,i.VBR_q=4,i.ATHcurve=-1,i.VBR_mean_bitrate_kbps=128,i.VBR_min_bitrate_kbps=0,i.VBR_max_bitrate_kbps=0,i.VBR_hard_min=0,o.VBR_min_bitrate=1,o.VBR_max_bitrate=13,i.quant_comp=-1,i.quant_comp_short=-1,i.msfix=-1,o.resample_ratio=1,o.OldValue[0]=180,o.OldValue[1]=180,o.CurrentStep[0]=4,o.CurrentStep[1]=4,o.masking_lower=1,o.nsPsy.attackthre=-1,o.nsPsy.attackthre_s=-1,i.scale=-1,i.athaa_type=-1,i.ATHtype=-1,i.athaa_loudapprox=-1,i.athaa_sensitivity=0,i.useTemporal=null,i.interChRatio=-1,o.mf_samples_to_encode=qe.ENCDELAY+qe.POSTDELAY,i.encoder_padding=0,o.mf_size=qe.ENCDELAY-qe.MDCTDELAY,i.findReplayGain=!1,i.decode_on_the_fly=!1,o.decode_on_the_fly=!1,o.findReplayGain=!1,o.findPeakSample=!1,o.RadioGain=0,o.AudiophileGain=0,o.noclipGainChange=0,o.noclipScale=-1,i.preset=0,i.write_id3tag_automatic=!0,0}this.lame_init=function(){var i=new Ws;return U(i),i.lame_allocated_gfp=1,i};function L(i){return i>1?0:i<=0?1:Math.cos(Math.PI/2*i)}this.nearestBitrateFullIndex=function(i){var o=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],O=0,P=0,se=0,le=0;le=o[16],se=16,P=o[16],O=16;for(var re=0;re<16;re++)if(Math.max(i,o[re+1])!=i){le=o[re+1],se=re+1,P=o[re],O=re;break}return le-i>i-P?O:se};function c(i,o){var O=44100;return o>=48e3?O=48e3:o>=44100?O=44100:o>=32e3?O=32e3:o>=24e3?O=24e3:o>=22050?O=22050:o>=16e3?O=16e3:o>=12e3?O=12e3:o>=11025?O=11025:o>=8e3&&(O=8e3),i==-1?O:(i<=15960&&(O=44100),i<=15250&&(O=32e3),i<=11220&&(O=24e3),i<=9970&&(O=22050),i<=7230&&(O=16e3),i<=5420&&(O=12e3),i<=4510&&(O=11025),i<=3970&&(O=8e3),o<O?o>44100?48e3:o>32e3?44100:o>24e3?32e3:o>22050?24e3:o>16e3?22050:o>12e3?16e3:o>11025?12e3:o>8e3?11025:8e3:O)}function m(i,o){switch(i){case 44100:return o.version=1,0;case 48e3:return o.version=1,1;case 32e3:return o.version=1,2;case 22050:return o.version=0,0;case 24e3:return o.version=0,1;case 16e3:return o.version=0,2;case 11025:return o.version=0,0;case 12e3:return o.version=0,1;case 8e3:return o.version=0,2;default:return o.version=0,-1}}function y(i,o,O){O<16e3&&(o=2);for(var P=Kt.bitrate_table[o][1],se=2;se<=14;se++)Kt.bitrate_table[o][se]>0&&Math.abs(Kt.bitrate_table[o][se]-i)<Math.abs(P-i)&&(P=Kt.bitrate_table[o][se]);return P}function e(i,o,O){O<16e3&&(o=2);for(var P=0;P<=14;P++)if(Kt.bitrate_table[o][P]>0&&Kt.bitrate_table[o][P]==i)return P;return-1}function v(i,o){var O=[new K(8,2e3),new K(16,3700),new K(24,3900),new K(32,5500),new K(40,7e3),new K(48,7500),new K(56,1e4),new K(64,11e3),new K(80,13500),new K(96,15100),new K(112,15600),new K(128,17e3),new K(160,17500),new K(192,18600),new K(224,19400),new K(256,19700),new K(320,20500)],P=p.nearestBitrateFullIndex(o);i.lowerlimit=O[P].lowpass}function f(i){var o=i.internal_flags,O=32,P=-1;if(o.lowpass1>0){for(var se=999,le=0;le<=31;le++){var re=le/31;re>=o.lowpass2&&(O=Math.min(O,le)),o.lowpass1<re&&re<o.lowpass2&&(se=Math.min(se,le))}se==999?o.lowpass1=(O-.75)/31:o.lowpass1=(se-.75)/31,o.lowpass2=O/31}if(o.highpass2>0&&o.highpass2<.9*(.75/31)&&(o.highpass1=0,o.highpass2=0,Ks.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),o.highpass2>0){for(var oe=-1,le=0;le<=31;le++){var re=le/31;re<=o.highpass1&&(P=Math.max(P,le)),o.highpass1<re&&re<o.highpass2&&(oe=Math.max(oe,le))}o.highpass1=P/31,oe==-1?o.highpass2=(P+.75)/31:o.highpass2=(oe+.75)/31}for(var le=0;le<32;le++){var be,he,re=le/31;o.highpass2>o.highpass1?be=L((o.highpass2-re)/(o.highpass2-o.highpass1+1e-20)):be=1,o.lowpass2>o.lowpass1?he=L((re-o.lowpass1)/(o.lowpass2-o.lowpass1+1e-20)):he=1,o.amp_filter[le]=be*he}}function R(i){var o=i.internal_flags;switch(i.quality){default:case 9:o.psymodel=0,o.noise_shaping=0,o.noise_shaping_amp=0,o.noise_shaping_stop=0,o.use_best_huffman=0,o.full_outer_loop=0;break;case 8:i.quality=7;case 7:o.psymodel=1,o.noise_shaping=0,o.noise_shaping_amp=0,o.noise_shaping_stop=0,o.use_best_huffman=0,o.full_outer_loop=0;break;case 6:o.psymodel=1,o.noise_shaping==0&&(o.noise_shaping=1),o.noise_shaping_amp=0,o.noise_shaping_stop=0,o.subblock_gain==-1&&(o.subblock_gain=1),o.use_best_huffman=0,o.full_outer_loop=0;break;case 5:o.psymodel=1,o.noise_shaping==0&&(o.noise_shaping=1),o.noise_shaping_amp=0,o.noise_shaping_stop=0,o.subblock_gain==-1&&(o.subblock_gain=1),o.use_best_huffman=0,o.full_outer_loop=0;break;case 4:o.psymodel=1,o.noise_shaping==0&&(o.noise_shaping=1),o.noise_shaping_amp=0,o.noise_shaping_stop=0,o.subblock_gain==-1&&(o.subblock_gain=1),o.use_best_huffman=1,o.full_outer_loop=0;break;case 3:o.psymodel=1,o.noise_shaping==0&&(o.noise_shaping=1),o.noise_shaping_amp=1,o.noise_shaping_stop=1,o.subblock_gain==-1&&(o.subblock_gain=1),o.use_best_huffman=1,o.full_outer_loop=0;break;case 2:o.psymodel=1,o.noise_shaping==0&&(o.noise_shaping=1),o.substep_shaping==0&&(o.substep_shaping=2),o.noise_shaping_amp=1,o.noise_shaping_stop=1,o.subblock_gain==-1&&(o.subblock_gain=1),o.use_best_huffman=1,o.full_outer_loop=0;break;case 1:o.psymodel=1,o.noise_shaping==0&&(o.noise_shaping=1),o.substep_shaping==0&&(o.substep_shaping=2),o.noise_shaping_amp=2,o.noise_shaping_stop=1,o.subblock_gain==-1&&(o.subblock_gain=1),o.use_best_huffman=1,o.full_outer_loop=0;break;case 0:o.psymodel=1,o.noise_shaping==0&&(o.noise_shaping=1),o.substep_shaping==0&&(o.substep_shaping=2),o.noise_shaping_amp=2,o.noise_shaping_stop=1,o.subblock_gain==-1&&(o.subblock_gain=1),o.use_best_huffman=1,o.full_outer_loop=0;break}}function u(i){var o=i.internal_flags;i.frameNum=0,i.write_id3tag_automatic&&D.id3tag_write_v2(i),o.bitrate_stereoMode_Hist=oi([16,4+1]),o.bitrate_blockType_Hist=oi([16,4+1+1]),o.PeakSample=0,i.bWriteVbrTag&&T.InitVbrTag(i)}this.lame_init_params=function(i){var o=i.internal_flags;if(o.Class_ID=0,o.ATH==null&&(o.ATH=new Qs),o.PSY==null&&(o.PSY=new G),o.rgdata==null&&(o.rgdata=new js),o.channels_in=i.num_channels,o.channels_in==1&&(i.mode=MPEGMode.MONO),o.channels_out=i.mode==MPEGMode.MONO?1:2,o.mode_ext=qe.MPG_MD_MS_LR,i.mode==MPEGMode.MONO&&(i.force_ms=!1),i.VBR==Ce.vbr_off&&i.VBR_mean_bitrate_kbps!=128&&i.brate==0&&(i.brate=i.VBR_mean_bitrate_kbps),i.VBR==Ce.vbr_off||i.VBR==Ce.vbr_mtrh||i.VBR==Ce.vbr_mt||(i.free_format=!1),i.VBR==Ce.vbr_off&&i.brate==0&&pa.EQ(i.compression_ratio,0)&&(i.compression_ratio=11.025),i.VBR==Ce.vbr_off&&i.compression_ratio>0&&(i.out_samplerate==0&&(i.out_samplerate=map2MP3Frequency(int(.97*i.in_samplerate))),i.brate=0|i.out_samplerate*16*o.channels_out/(1e3*i.compression_ratio),o.samplerate_index=m(i.out_samplerate,i),i.free_format||(i.brate=y(i.brate,i.version,i.out_samplerate))),i.out_samplerate!=0&&(i.out_samplerate<16e3?(i.VBR_mean_bitrate_kbps=Math.max(i.VBR_mean_bitrate_kbps,8),i.VBR_mean_bitrate_kbps=Math.min(i.VBR_mean_bitrate_kbps,64)):i.out_samplerate<32e3?(i.VBR_mean_bitrate_kbps=Math.max(i.VBR_mean_bitrate_kbps,8),i.VBR_mean_bitrate_kbps=Math.min(i.VBR_mean_bitrate_kbps,160)):(i.VBR_mean_bitrate_kbps=Math.max(i.VBR_mean_bitrate_kbps,32),i.VBR_mean_bitrate_kbps=Math.min(i.VBR_mean_bitrate_kbps,320))),i.lowpassfreq==0){var O=16e3;switch(i.VBR){case Ce.vbr_off:{var P=new $;v(P,i.brate),O=P.lowerlimit;break}case Ce.vbr_abr:{var P=new $;v(P,i.VBR_mean_bitrate_kbps),O=P.lowerlimit;break}case Ce.vbr_rh:{var se=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=i.VBR_q&&i.VBR_q<=9){var le=se[i.VBR_q],re=se[i.VBR_q+1],oe=i.VBR_q_frac;O=linear_int(le,re,oe)}else O=19500;break}default:{var se=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=i.VBR_q&&i.VBR_q<=9){var le=se[i.VBR_q],re=se[i.VBR_q+1],oe=i.VBR_q_frac;O=linear_int(le,re,oe)}else O=19500}}i.mode==MPEGMode.MONO&&(i.VBR==Ce.vbr_off||i.VBR==Ce.vbr_abr)&&(O*=1.5),i.lowpassfreq=O|0}if(i.out_samplerate==0&&(2*i.lowpassfreq>i.in_samplerate&&(i.lowpassfreq=i.in_samplerate/2),i.out_samplerate=c(i.lowpassfreq|0,i.in_samplerate)),i.lowpassfreq=Math.min(20500,i.lowpassfreq),i.lowpassfreq=Math.min(i.out_samplerate/2,i.lowpassfreq),i.VBR==Ce.vbr_off&&(i.compression_ratio=i.out_samplerate*16*o.channels_out/(1e3*i.brate)),i.VBR==Ce.vbr_abr&&(i.compression_ratio=i.out_samplerate*16*o.channels_out/(1e3*i.VBR_mean_bitrate_kbps)),i.bWriteVbrTag||(i.findReplayGain=!1,i.decode_on_the_fly=!1,o.findPeakSample=!1),o.findReplayGain=i.findReplayGain,o.decode_on_the_fly=i.decode_on_the_fly,o.decode_on_the_fly&&(o.findPeakSample=!0),o.findReplayGain&&b.InitGainAnalysis(o.rgdata,i.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return i.internal_flags=null,-6;switch(o.decode_on_the_fly&&!i.decode_only&&(o.hip!=null&&w.hip_decode_exit(o.hip),o.hip=w.hip_decode_init()),o.mode_gr=i.out_samplerate<=24e3?1:2,i.framesize=576*o.mode_gr,i.encoder_delay=qe.ENCDELAY,o.resample_ratio=i.in_samplerate/i.out_samplerate,i.VBR){case Ce.vbr_mt:case Ce.vbr_rh:case Ce.vbr_mtrh:{var be=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];i.compression_ratio=be[i.VBR_q]}break;case Ce.vbr_abr:i.compression_ratio=i.out_samplerate*16*o.channels_out/(1e3*i.VBR_mean_bitrate_kbps);break;default:i.compression_ratio=i.out_samplerate*16*o.channels_out/(1e3*i.brate);break}if(i.mode==MPEGMode.NOT_SET&&(i.mode=MPEGMode.JOINT_STEREO),i.highpassfreq>0?(o.highpass1=2*i.highpassfreq,i.highpasswidth>=0?o.highpass2=2*(i.highpassfreq+i.highpasswidth):o.highpass2=(1+0)*2*i.highpassfreq,o.highpass1/=i.out_samplerate,o.highpass2/=i.out_samplerate):(o.highpass1=0,o.highpass2=0),i.lowpassfreq>0?(o.lowpass2=2*i.lowpassfreq,i.lowpasswidth>=0?(o.lowpass1=2*(i.lowpassfreq-i.lowpasswidth),o.lowpass1<0&&(o.lowpass1=0)):o.lowpass1=(1-0)*2*i.lowpassfreq,o.lowpass1/=i.out_samplerate,o.lowpass2/=i.out_samplerate):(o.lowpass1=0,o.lowpass2=0),f(i),o.samplerate_index=m(i.out_samplerate,i),o.samplerate_index<0)return i.internal_flags=null,-1;if(i.VBR==Ce.vbr_off){if(i.free_format)o.bitrate_index=0;else if(i.brate=y(i.brate,i.version,i.out_samplerate),o.bitrate_index=e(i.brate,i.version,i.out_samplerate),o.bitrate_index<=0)return i.internal_flags=null,-1}else o.bitrate_index=1;i.analysis&&(i.bWriteVbrTag=!1),o.pinfo!=null&&(i.bWriteVbrTag=!1),x.init_bit_stream_w(o);for(var he=o.samplerate_index+3*i.version+6*(i.out_samplerate<16e3?1:0),ne=0;ne<qe.SBMAX_l+1;ne++)o.scalefac_band.l[ne]=E.sfBandIndex[he].l[ne];for(var ne=0;ne<qe.PSFB21+1;ne++){var xe=(o.scalefac_band.l[22]-o.scalefac_band.l[21])/qe.PSFB21,Pe=o.scalefac_band.l[21]+ne*xe;o.scalefac_band.psfb21[ne]=Pe}o.scalefac_band.psfb21[qe.PSFB21]=576;for(var ne=0;ne<qe.SBMAX_s+1;ne++)o.scalefac_band.s[ne]=E.sfBandIndex[he].s[ne];for(var ne=0;ne<qe.PSFB12+1;ne++){var xe=(o.scalefac_band.s[13]-o.scalefac_band.s[12])/qe.PSFB12,Pe=o.scalefac_band.s[12]+ne*xe;o.scalefac_band.psfb12[ne]=Pe}o.scalefac_band.psfb12[qe.PSFB12]=192,i.version==1?o.sideinfo_len=o.channels_out==1?4+17:4+32:o.sideinfo_len=o.channels_out==1?4+9:4+17,i.error_protection&&(o.sideinfo_len+=2),u(i),o.Class_ID=q;{var Se;for(Se=0;Se<19;Se++)o.nsPsy.pefirbuf[Se]=700*o.mode_gr*o.channels_out;i.ATHtype==-1&&(i.ATHtype=4)}switch(Ct(i.VBR_q<=9),Ct(i.VBR_q>=0),i.VBR){case Ce.vbr_mt:i.VBR=Ce.vbr_mtrh;case Ce.vbr_mtrh:{i.useTemporal==null&&(i.useTemporal=!1),B.apply_preset(i,500-i.VBR_q*10,0),i.quality<0&&(i.quality=LAME_DEFAULT_QUALITY),i.quality<5&&(i.quality=0),i.quality>5&&(i.quality=5),o.PSY.mask_adjust=i.maskingadjust,o.PSY.mask_adjust_short=i.maskingadjust_short,i.experimentalY?o.sfb21_extra=!1:o.sfb21_extra=i.out_samplerate>44e3,o.iteration_loop=new VBRNewIterationLoop(N);break}case Ce.vbr_rh:{B.apply_preset(i,500-i.VBR_q*10,0),o.PSY.mask_adjust=i.maskingadjust,o.PSY.mask_adjust_short=i.maskingadjust_short,i.experimentalY?o.sfb21_extra=!1:o.sfb21_extra=i.out_samplerate>44e3,i.quality>6&&(i.quality=6),i.quality<0&&(i.quality=LAME_DEFAULT_QUALITY),o.iteration_loop=new VBROldIterationLoop(N);break}default:{var Re;o.sfb21_extra=!1,i.quality<0&&(i.quality=LAME_DEFAULT_QUALITY),Re=i.VBR,Re==Ce.vbr_off&&(i.VBR_mean_bitrate_kbps=i.brate),B.apply_preset(i,i.VBR_mean_bitrate_kbps,0),i.VBR=Re,o.PSY.mask_adjust=i.maskingadjust,o.PSY.mask_adjust_short=i.maskingadjust_short,Re==Ce.vbr_off?o.iteration_loop=new zs(N):o.iteration_loop=new ABRIterationLoop(N);break}}if(Ct(i.scale>=0),i.VBR!=Ce.vbr_off){if(o.VBR_min_bitrate=1,o.VBR_max_bitrate=14,i.out_samplerate<16e3&&(o.VBR_max_bitrate=8),i.VBR_min_bitrate_kbps!=0&&(i.VBR_min_bitrate_kbps=y(i.VBR_min_bitrate_kbps,i.version,i.out_samplerate),o.VBR_min_bitrate=e(i.VBR_min_bitrate_kbps,i.version,i.out_samplerate),o.VBR_min_bitrate<0)||i.VBR_max_bitrate_kbps!=0&&(i.VBR_max_bitrate_kbps=y(i.VBR_max_bitrate_kbps,i.version,i.out_samplerate),o.VBR_max_bitrate=e(i.VBR_max_bitrate_kbps,i.version,i.out_samplerate),o.VBR_max_bitrate<0))return-1;i.VBR_min_bitrate_kbps=Kt.bitrate_table[i.version][o.VBR_min_bitrate],i.VBR_max_bitrate_kbps=Kt.bitrate_table[i.version][o.VBR_max_bitrate],i.VBR_mean_bitrate_kbps=Math.min(Kt.bitrate_table[i.version][o.VBR_max_bitrate],i.VBR_mean_bitrate_kbps),i.VBR_mean_bitrate_kbps=Math.max(Kt.bitrate_table[i.version][o.VBR_min_bitrate],i.VBR_mean_bitrate_kbps)}return i.tune&&(o.PSY.mask_adjust+=i.tune_value_a,o.PSY.mask_adjust_short+=i.tune_value_a),R(i),Ct(i.scale>=0),i.athaa_type<0?o.ATH.useAdjust=3:o.ATH.useAdjust=i.athaa_type,o.ATH.aaSensitivityP=Math.pow(10,i.athaa_sensitivity/-10),i.short_blocks==null&&(i.short_blocks=S0.short_block_allowed),i.short_blocks==S0.short_block_allowed&&(i.mode==MPEGMode.JOINT_STEREO||i.mode==MPEGMode.STEREO)&&(i.short_blocks=S0.short_block_coupled),i.quant_comp<0&&(i.quant_comp=1),i.quant_comp_short<0&&(i.quant_comp_short=0),i.msfix<0&&(i.msfix=0),i.exp_nspsytune=i.exp_nspsytune|1,i.internal_flags.nsPsy.attackthre<0&&(i.internal_flags.nsPsy.attackthre=y0.NSATTACKTHRE),i.internal_flags.nsPsy.attackthre_s<0&&(i.internal_flags.nsPsy.attackthre_s=y0.NSATTACKTHRE_S),Ct(i.scale>=0),i.scale<0&&(i.scale=1),i.ATHtype<0&&(i.ATHtype=4),i.ATHcurve<0&&(i.ATHcurve=4),i.athaa_loudapprox<0&&(i.athaa_loudapprox=2),i.interChRatio<0&&(i.interChRatio=0),i.useTemporal==null&&(i.useTemporal=!0),o.slot_lag=o.frac_SpF=0,i.VBR==Ce.vbr_off&&(o.slot_lag=o.frac_SpF=(i.version+1)*72e3*i.brate%i.out_samplerate|0),E.iteration_init(i),H.psymodel_init(i),Ct(i.scale>=0),0};function n(i,o){(i.in_buffer_0==null||i.in_buffer_nsamples<o)&&(i.in_buffer_0=fa(o),i.in_buffer_1=fa(o),i.in_buffer_nsamples=o)}this.lame_encode_flush=function(i,o,O,P){var se=i.internal_flags,le=Zs([2,1152]),re=0,oe,be,he,ne,xe=se.mf_samples_to_encode-qe.POSTDELAY,Pe=s(i);if(se.mf_samples_to_encode<1)return 0;for(oe=0,i.in_samplerate!=i.out_samplerate&&(xe+=16*i.out_samplerate/i.in_samplerate),he=i.framesize-xe%i.framesize,he<576&&(he+=i.framesize),i.encoder_padding=he,ne=(xe+he)/i.framesize;ne>0&&re>=0;){var Se=Pe-se.mf_size,Re=i.frameNum;Se*=i.in_samplerate,Se/=i.out_samplerate,Se>1152&&(Se=1152),Se<1&&(Se=1),be=P-oe,P==0&&(be=0),re=this.lame_encode_buffer(i,le[0],le[1],Se,o,O,be),O+=re,oe+=re,ne-=Re!=i.frameNum?1:0}if(se.mf_samples_to_encode=0,re<0||(be=P-oe,P==0&&(be=0),x.flush_bitstream(i),re=x.copy_buffer(se,o,O,be,1),re<0))return re;if(O+=re,oe+=re,be=P-oe,P==0&&(be=0),i.write_id3tag_automatic){if(D.id3tag_write_v1(i),re=x.copy_buffer(se,o,O,be,0),re<0)return re;oe+=re}return oe},this.lame_encode_buffer=function(i,o,O,P,se,le,re){var oe=i.internal_flags,be=[null,null];if(oe.Class_ID!=q)return-3;if(P==0)return 0;n(oe,P),be[0]=oe.in_buffer_0,be[1]=oe.in_buffer_1;for(var he=0;he<P;he++)be[0][he]=o[he],oe.channels_in>1&&(be[1][he]=O[he]);return h(i,be[0],be[1],P,se,le,re)};function s(i){var o=qe.BLKSIZE+i.framesize-qe.FFTOFFSET;return o=Math.max(o,512+i.framesize-32),Ct(Ca.MFSIZE>=o),o}function h(i,o,O,P,se,le,re){var oe=i.internal_flags,be=0,he,ne,xe,Pe,Se,Re=[null,null],Te=[null,null];if(oe.Class_ID!=q)return-3;if(P==0)return 0;if(Se=x.copy_buffer(oe,se,le,re,0),Se<0)return Se;if(le+=Se,be+=Se,Te[0]=o,Te[1]=O,pa.NEQ(i.scale,0)&&pa.NEQ(i.scale,1))for(ne=0;ne<P;++ne)Te[0][ne]*=i.scale,oe.channels_out==2&&(Te[1][ne]*=i.scale);if(pa.NEQ(i.scale_left,0)&&pa.NEQ(i.scale_left,1))for(ne=0;ne<P;++ne)Te[0][ne]*=i.scale_left;if(pa.NEQ(i.scale_right,0)&&pa.NEQ(i.scale_right,1))for(ne=0;ne<P;++ne)Te[1][ne]*=i.scale_right;if(i.num_channels==2&&oe.channels_out==1)for(ne=0;ne<P;++ne)Te[0][ne]=.5*(Te[0][ne]+Te[1][ne]),Te[1][ne]=0;Pe=s(i),Re[0]=oe.mfbuf[0],Re[1]=oe.mfbuf[1];for(var Ve=0;P>0;){var Ke=[null,null],$t=0,Tt=0;Ke[0]=Te[0],Ke[1]=Te[1];var tt=new t;if(g(i,Re,Ke,Ve,P,tt),$t=tt.n_in,Tt=tt.n_out,oe.findReplayGain&&!oe.decode_on_the_fly&&b.AnalyzeSamples(oe.rgdata,Re[0],oe.mf_size,Re[1],oe.mf_size,Tt,oe.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(P-=$t,Ve+=$t,oe.channels_out==2,oe.mf_size+=Tt,Ct(oe.mf_size<=Ca.MFSIZE),oe.mf_samples_to_encode<1&&(oe.mf_samples_to_encode=qe.ENCDELAY+qe.POSTDELAY),oe.mf_samples_to_encode+=Tt,oe.mf_size>=Pe){var Pt=re-be;if(re==0&&(Pt=0),he=r(i,Re[0],Re[1],se,le,Pt),he<0)return he;for(le+=he,be+=he,oe.mf_size-=i.framesize,oe.mf_samples_to_encode-=i.framesize,xe=0;xe<oe.channels_out;xe++)for(ne=0;ne<oe.mf_size;ne++)Re[xe][ne]=Re[xe][ne+i.framesize]}}return Ct(P==0),be}function r(i,o,O,P,se,le){var re=p.enc.lame_encode_mp3_frame(i,o,O,P,se,le);return i.frameNum++,re}function t(){this.n_in=0,this.n_out=0}function d(){this.num_used=0}function l(i,o){return o!=0?l(o,i%o):i}function F(i,o,O){var P=Math.PI*o;i/=O,i<0&&(i=0),i>1&&(i=1);var se=i-.5,le=.42-.5*Math.cos(2*i*Math.PI)+.08*Math.cos(4*i*Math.PI);return Math.abs(se)<1e-9?P/Math.PI:le*Math.sin(O*P*se)/(Math.PI*O*se)}function I(i,o,O,P,se,le,re,oe,be){var he=i.internal_flags,ne,xe=0,Pe,Se=i.out_samplerate/l(i.out_samplerate,i.in_samplerate);Se>Ca.BPC&&(Se=Ca.BPC);var Re=Math.abs(he.resample_ratio-Math.floor(.5+he.resample_ratio))<1e-4?1:0,Te=1/he.resample_ratio;Te>1&&(Te=1);var Ve=31;Ve%2==0&&--Ve,Ve+=Re;var Ke=Ve+1;if(he.fill_buffer_resample_init==0){for(he.inbuf_old[0]=fa(Ke),he.inbuf_old[1]=fa(Ke),ne=0;ne<=2*Se;++ne)he.blackfilt[ne]=fa(Ke);for(he.itime[0]=0,he.itime[1]=0,xe=0;xe<=2*Se;xe++){var $t=0,Tt=(xe-Se)/(2*Se);for(ne=0;ne<=Ve;ne++)$t+=he.blackfilt[xe][ne]=F(ne-Tt,Te,Ve);for(ne=0;ne<=Ve;ne++)he.blackfilt[xe][ne]/=$t}he.fill_buffer_resample_init=1}var tt=he.inbuf_old[be];for(Pe=0;Pe<P;Pe++){var Pt,aa;if(Pt=Pe*he.resample_ratio,xe=0|Math.floor(Pt-he.itime[be]),Ve+xe-Ve/2>=re)break;var Tt=Pt-he.itime[be]-(xe+.5*(Ve%2));Ct(Math.abs(Tt)<=.501),aa=0|Math.floor(Tt*2*Se+Se+.5);var ea=0;for(ne=0;ne<=Ve;++ne){var ze=0|ne+xe-Ve/2,ia;Ct(ze<re),Ct(ze+Ke>=0),ia=ze<0?tt[Ke+ze]:se[le+ze],ea+=ia*he.blackfilt[aa][ne]}o[O+Pe]=ea}if(oe.num_used=Math.min(re,Ve+xe-Ve/2),he.itime[be]+=oe.num_used-Pe*he.resample_ratio,oe.num_used>=Ke)for(ne=0;ne<Ke;ne++)tt[ne]=se[le+oe.num_used+ne-Ke];else{var Wt=Ke-oe.num_used;for(ne=0;ne<Wt;++ne)tt[ne]=tt[ne+oe.num_used];for(xe=0;ne<Ke;++ne,++xe)tt[ne]=se[le+xe];Ct(xe==oe.num_used)}return Pe}function g(i,o,O,P,se,le){var re=i.internal_flags;if(re.resample_ratio<.9999||re.resample_ratio>1.0001)for(var oe=0;oe<re.channels_out;oe++){var be=new d;le.n_out=I(i,o[oe],re.mf_size,i.framesize,O[oe],P,se,be,oe),le.n_in=be.num_used}else{le.n_out=Math.min(i.framesize,se),le.n_in=le.n_out;for(var he=0;he<le.n_out;++he)o[0][re.mf_size+he]=O[0][P+he],re.channels_out==2&&(o[1][re.mf_size+he]=O[1][P+he])}}}var ki=Ue;const Js=B0(ki);var At=He;At.System;var Zt=At.VbrMode;At.Float;At.ShortBlock;At.Util;At.Arrays;At.new_array_n;At.new_byte;At.new_double;At.new_float;At.new_float_n;At.new_int;At.new_int_n;At.assert;function en(){function p(T,D,w,G,$,K,q,U,L,c,m,y,e,v,f){this.vbr_q=T,this.quant_comp=D,this.quant_comp_s=w,this.expY=G,this.st_lrm=$,this.st_s=K,this.masking_adj=q,this.masking_adj_short=U,this.ath_lower=L,this.ath_curve=c,this.ath_sensitivity=m,this.interch=y,this.safejoint=e,this.sfb21mod=v,this.msfix=f}function a(T,D,w,G,$,K,q,U,L,c,m,y,e,v){this.quant_comp=D,this.quant_comp_s=w,this.safejoint=G,this.nsmsfix=$,this.st_lrm=K,this.st_s=q,this.nsbass=U,this.scale=L,this.masking_adj=c,this.ath_lower=m,this.ath_curve=y,this.interch=e,this.sfscale=v}var _;this.setModules=function(T){_=T};var b=[new p(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new p(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new p(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new p(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new p(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new p(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new p(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new p(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new p(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new p(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new p(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],x=[new p(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new p(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new p(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new p(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new p(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new p(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new p(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new p(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new p(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new p(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new p(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function B(T,D,w){var G=T.VBR==Zt.vbr_rh?b:x,$=T.VBR_q_frac,K=G[D],q=G[D+1],U=K;K.st_lrm=K.st_lrm+$*(q.st_lrm-K.st_lrm),K.st_s=K.st_s+$*(q.st_s-K.st_s),K.masking_adj=K.masking_adj+$*(q.masking_adj-K.masking_adj),K.masking_adj_short=K.masking_adj_short+$*(q.masking_adj_short-K.masking_adj_short),K.ath_lower=K.ath_lower+$*(q.ath_lower-K.ath_lower),K.ath_curve=K.ath_curve+$*(q.ath_curve-K.ath_curve),K.ath_sensitivity=K.ath_sensitivity+$*(q.ath_sensitivity-K.ath_sensitivity),K.interch=K.interch+$*(q.interch-K.interch),K.msfix=K.msfix+$*(q.msfix-K.msfix),H(T,U.vbr_q),w!=0?T.quant_comp=U.quant_comp:Math.abs(T.quant_comp- -1)>0||(T.quant_comp=U.quant_comp),w!=0?T.quant_comp_short=U.quant_comp_s:Math.abs(T.quant_comp_short- -1)>0||(T.quant_comp_short=U.quant_comp_s),U.expY!=0&&(T.experimentalY=U.expY!=0),w!=0?T.internal_flags.nsPsy.attackthre=U.st_lrm:Math.abs(T.internal_flags.nsPsy.attackthre- -1)>0||(T.internal_flags.nsPsy.attackthre=U.st_lrm),w!=0?T.internal_flags.nsPsy.attackthre_s=U.st_s:Math.abs(T.internal_flags.nsPsy.attackthre_s- -1)>0||(T.internal_flags.nsPsy.attackthre_s=U.st_s),w!=0?T.maskingadjust=U.masking_adj:Math.abs(T.maskingadjust-0)>0||(T.maskingadjust=U.masking_adj),w!=0?T.maskingadjust_short=U.masking_adj_short:Math.abs(T.maskingadjust_short-0)>0||(T.maskingadjust_short=U.masking_adj_short),w!=0?T.ATHlower=-U.ath_lower/10:Math.abs(-T.ATHlower*10-0)>0||(T.ATHlower=-U.ath_lower/10),w!=0?T.ATHcurve=U.ath_curve:Math.abs(T.ATHcurve- -1)>0||(T.ATHcurve=U.ath_curve),w!=0?T.athaa_sensitivity=U.ath_sensitivity:Math.abs(T.athaa_sensitivity- -1)>0||(T.athaa_sensitivity=U.ath_sensitivity),U.interch>0&&(w!=0?T.interChRatio=U.interch:Math.abs(T.interChRatio- -1)>0||(T.interChRatio=U.interch)),U.safejoint>0&&(T.exp_nspsytune=T.exp_nspsytune|U.safejoint),U.sfb21mod>0&&(T.exp_nspsytune=T.exp_nspsytune|U.sfb21mod<<20),w!=0?T.msfix=U.msfix:Math.abs(T.msfix- -1)>0||(T.msfix=U.msfix),w==0&&(T.VBR_q=D,T.VBR_q_frac=$)}var E=[new a(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new a(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new a(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new a(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new a(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new a(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new a(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new a(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new a(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new a(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new a(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new a(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new a(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new a(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new a(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new a(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new a(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function N(T,D,w){var G=D,$=_.nearestBitrateFullIndex(D);if(T.VBR=Zt.vbr_abr,T.VBR_mean_bitrate_kbps=G,T.VBR_mean_bitrate_kbps=Math.min(T.VBR_mean_bitrate_kbps,320),T.VBR_mean_bitrate_kbps=Math.max(T.VBR_mean_bitrate_kbps,8),T.brate=T.VBR_mean_bitrate_kbps,T.VBR_mean_bitrate_kbps>320&&(T.disable_reservoir=!0),E[$].safejoint>0&&(T.exp_nspsytune=T.exp_nspsytune|2),E[$].sfscale>0&&(T.internal_flags.noise_shaping=2),Math.abs(E[$].nsbass)>0){var K=int(E[$].nsbass*4);K<0&&(K+=64),T.exp_nspsytune=T.exp_nspsytune|K<<2}return w!=0?T.quant_comp=E[$].quant_comp:Math.abs(T.quant_comp- -1)>0||(T.quant_comp=E[$].quant_comp),w!=0?T.quant_comp_short=E[$].quant_comp_s:Math.abs(T.quant_comp_short- -1)>0||(T.quant_comp_short=E[$].quant_comp_s),w!=0?T.msfix=E[$].nsmsfix:Math.abs(T.msfix- -1)>0||(T.msfix=E[$].nsmsfix),w!=0?T.internal_flags.nsPsy.attackthre=E[$].st_lrm:Math.abs(T.internal_flags.nsPsy.attackthre- -1)>0||(T.internal_flags.nsPsy.attackthre=E[$].st_lrm),w!=0?T.internal_flags.nsPsy.attackthre_s=E[$].st_s:Math.abs(T.internal_flags.nsPsy.attackthre_s- -1)>0||(T.internal_flags.nsPsy.attackthre_s=E[$].st_s),w!=0?T.scale=E[$].scale:Math.abs(T.scale- -1)>0||(T.scale=E[$].scale),w!=0?T.maskingadjust=E[$].masking_adj:Math.abs(T.maskingadjust-0)>0||(T.maskingadjust=E[$].masking_adj),E[$].masking_adj>0?w!=0?T.maskingadjust_short=E[$].masking_adj*.9:Math.abs(T.maskingadjust_short-0)>0||(T.maskingadjust_short=E[$].masking_adj*.9):w!=0?T.maskingadjust_short=E[$].masking_adj*1.1:Math.abs(T.maskingadjust_short-0)>0||(T.maskingadjust_short=E[$].masking_adj*1.1),w!=0?T.ATHlower=-E[$].ath_lower/10:Math.abs(-T.ATHlower*10-0)>0||(T.ATHlower=-E[$].ath_lower/10),w!=0?T.ATHcurve=E[$].ath_curve:Math.abs(T.ATHcurve- -1)>0||(T.ATHcurve=E[$].ath_curve),w!=0?T.interChRatio=E[$].interch:Math.abs(T.interChRatio- -1)>0||(T.interChRatio=E[$].interch),D}this.apply_preset=function(T,D,w){switch(D){case Lame.R3MIX:{D=Lame.V3,T.VBR=Zt.vbr_mtrh;break}case Lame.MEDIUM:{D=Lame.V4,T.VBR=Zt.vbr_rh;break}case Lame.MEDIUM_FAST:{D=Lame.V4,T.VBR=Zt.vbr_mtrh;break}case Lame.STANDARD:{D=Lame.V2,T.VBR=Zt.vbr_rh;break}case Lame.STANDARD_FAST:{D=Lame.V2,T.VBR=Zt.vbr_mtrh;break}case Lame.EXTREME:{D=Lame.V0,T.VBR=Zt.vbr_rh;break}case Lame.EXTREME_FAST:{D=Lame.V0,T.VBR=Zt.vbr_mtrh;break}case Lame.INSANE:return D=320,T.preset=D,N(T,D,w),T.VBR=Zt.vbr_off,D}switch(T.preset=D,D){case Lame.V9:return B(T,9,w),D;case Lame.V8:return B(T,8,w),D;case Lame.V7:return B(T,7,w),D;case Lame.V6:return B(T,6,w),D;case Lame.V5:return B(T,5,w),D;case Lame.V4:return B(T,4,w),D;case Lame.V3:return B(T,3,w),D;case Lame.V2:return B(T,2,w),D;case Lame.V1:return B(T,1,w),D;case Lame.V0:return B(T,0,w),D}return 8<=D&&D<=320?N(T,D,w):(T.preset=0,D)};function H(T,D){var w=0;return 0>D&&(w=-1,D=0),9<D&&(w=-1,D=9),T.VBR_q=D,T.VBR_q_frac=0,w}}var tn=en;function an(){this.setModules=function(p,a){}}var sn=an;function nn(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var rn=nn,N0=He,li=N0.new_float,on=N0.new_int;N0.assert;function ln(){this.global_gain=0,this.sfb_count1=0,this.step=on(39),this.noise=li(39),this.noise_log=li(39)}var _n=ln,Et=He,ta=Et.System,_i=Et.VbrMode;Et.Float;Et.ShortBlock;var A0=Et.Util,xa=Et.Arrays;Et.new_array_n;Et.new_byte;Et.new_double;var ga=Et.new_float;Et.new_float_n;Et.new_int;Et.new_int_n;var Ht=Et.assert,cn=sn,E0=rn,hn=_n,Be=je(),ci=g0,hi=Qa;function un(){var p;this.rv=null;var a;this.qupvt=null;var _,b=new cn,x;this.setModules=function(L,c,m,y){p=L,a=c,this.rv=c,_=m,this.qupvt=m,x=y,b.setModules(_,x)},this.ms_convert=function(L,c){for(var m=0;m<576;++m){var y=L.tt[c][0].xr[m],e=L.tt[c][1].xr[m];L.tt[c][0].xr[m]=(y+e)*(A0.SQRT2*.5),L.tt[c][1].xr[m]=(y-e)*(A0.SQRT2*.5)}};function B(L,c,m,y){y=0;for(var e=0;e<=m;++e){var v=Math.abs(L.xr[e]);y+=v,c[e]=Math.sqrt(v*Math.sqrt(v)),c[e]>L.xrpow_max&&(L.xrpow_max=c[e])}return y}this.init_xrpow=function(L,c,m){var y=0,e=0|c.max_nonzero_coeff;if(Ht(m!=null),c.xrpow_max=0,Ht(0<=e&&e<=575),xa.fill(m,e,576,0),y=B(c,m,e,y),y>1e-20){var v=0;L.substep_shaping&2&&(v=1);for(var f=0;f<c.psymax;f++)L.pseudohalf[f]=v;return!0}return xa.fill(c.l3_enc,0,576,0),!1};function E(L,c){var m=L.ATH,y=c.xr;if(c.block_type!=Be.SHORT_TYPE)for(var e=!1,v=Be.PSFB21-1;v>=0&&!e;v--){var f=L.scalefac_band.psfb21[v],R=L.scalefac_band.psfb21[v+1],u=_.athAdjust(m.adjust,m.psfb21[v],m.floor);L.nsPsy.longfact[21]>1e-12&&(u*=L.nsPsy.longfact[21]);for(var n=R-1;n>=f;n--)if(Math.abs(y[n])<u)y[n]=0;else{e=!0;break}}else for(var s=0;s<3;s++)for(var e=!1,v=Be.PSFB12-1;v>=0&&!e;v--){var f=L.scalefac_band.s[12]*3+(L.scalefac_band.s[13]-L.scalefac_band.s[12])*s+(L.scalefac_band.psfb12[v]-L.scalefac_band.psfb12[0]),R=f+(L.scalefac_band.psfb12[v+1]-L.scalefac_band.psfb12[v]),h=_.athAdjust(m.adjust,m.psfb12[v],m.floor);L.nsPsy.shortfact[12]>1e-12&&(h*=L.nsPsy.shortfact[12]);for(var n=R-1;n>=f;n--)if(Math.abs(y[n])<h)y[n]=0;else{e=!0;break}}}this.init_outer_loop=function(L,c){c.part2_3_length=0,c.big_values=0,c.count1=0,c.global_gain=210,c.scalefac_compress=0,c.table_select[0]=0,c.table_select[1]=0,c.table_select[2]=0,c.subblock_gain[0]=0,c.subblock_gain[1]=0,c.subblock_gain[2]=0,c.subblock_gain[3]=0,c.region0_count=0,c.region1_count=0,c.preflag=0,c.scalefac_scale=0,c.count1table_select=0,c.part2_length=0,c.sfb_lmax=Be.SBPSY_l,c.sfb_smin=Be.SBPSY_s,c.psy_lmax=L.sfb21_extra?Be.SBMAX_l:Be.SBPSY_l,c.psymax=c.psy_lmax,c.sfbmax=c.sfb_lmax,c.sfbdivide=11;for(var m=0;m<Be.SBMAX_l;m++)c.width[m]=L.scalefac_band.l[m+1]-L.scalefac_band.l[m],c.window[m]=3;if(c.block_type==Be.SHORT_TYPE){var y=ga(576);c.sfb_smin=0,c.sfb_lmax=0,c.mixed_block_flag!=0&&(c.sfb_smin=3,c.sfb_lmax=L.mode_gr*2+4),c.psymax=c.sfb_lmax+3*((L.sfb21_extra?Be.SBMAX_s:Be.SBPSY_s)-c.sfb_smin),c.sfbmax=c.sfb_lmax+3*(Be.SBPSY_s-c.sfb_smin),c.sfbdivide=c.sfbmax-18,c.psy_lmax=c.sfb_lmax;var e=L.scalefac_band.l[c.sfb_lmax];ta.arraycopy(c.xr,0,y,0,576);for(var m=c.sfb_smin;m<Be.SBMAX_s;m++)for(var v=L.scalefac_band.s[m],f=L.scalefac_band.s[m+1],R=0;R<3;R++)for(var u=v;u<f;u++)c.xr[e++]=y[3*u+R];for(var n=c.sfb_lmax,m=c.sfb_smin;m<Be.SBMAX_s;m++)c.width[n]=c.width[n+1]=c.width[n+2]=L.scalefac_band.s[m+1]-L.scalefac_band.s[m],c.window[n]=0,c.window[n+1]=1,c.window[n+2]=2,n+=3}c.count1bits=0,c.sfb_partition_table=_.nr_of_sfb_block[0][0],c.slen[0]=0,c.slen[1]=0,c.slen[2]=0,c.slen[3]=0,c.max_nonzero_coeff=575,xa.fill(c.scalefac,0),E(L,c)};function N(L){this.ordinal=L}N.BINSEARCH_NONE=new N(0),N.BINSEARCH_UP=new N(1),N.BINSEARCH_DOWN=new N(2);function H(L,c,m,y,e){var v,f=L.CurrentStep[y],R=!1,u=L.OldValue[y],n=N.BINSEARCH_NONE;for(c.global_gain=u,m-=c.part2_length,Ht(f!=0);;){var s;if(v=x.count_bits(L,e,c,null),f==1||v==m)break;v>m?(n==N.BINSEARCH_DOWN&&(R=!0),R&&(f/=2),n=N.BINSEARCH_UP,s=f):(n==N.BINSEARCH_UP&&(R=!0),R&&(f/=2),n=N.BINSEARCH_DOWN,s=-f),c.global_gain+=s,c.global_gain<0&&(c.global_gain=0,R=!0),c.global_gain>255&&(c.global_gain=255,R=!0)}for(Ht(c.global_gain>=0),Ht(c.global_gain<256);v>m&&c.global_gain<255;)c.global_gain++,v=x.count_bits(L,e,c,null);return L.CurrentStep[y]=u-c.global_gain>=4?4:2,L.OldValue[y]=c.global_gain,c.part2_3_length=v,v}this.trancate_smallspectrums=function(L,c,m,y){var e=ga(hi.SFBMAX);if(!(!(L.substep_shaping&4)&&c.block_type==Be.SHORT_TYPE||L.substep_shaping&128)){_.calc_noise(c,m,e,new E0,null);for(var f=0;f<576;f++){var v=0;c.l3_enc[f]!=0&&(v=Math.abs(c.xr[f])),y[f]=v}var f=0,R=8;c.block_type==Be.SHORT_TYPE&&(R=6);do{var u,n,s,h,r=c.width[R];if(f+=r,!(e[R]>=1)&&(xa.sort(y,f-r,r),!BitStream.EQ(y[f-1],0))){u=(1-e[R])*m[R],n=0,h=0;do{var t;for(s=1;h+s<r&&!BitStream.NEQ(y[h+f-r],y[h+f+s-r]);s++);if(t=y[h+f-r]*y[h+f-r]*s,u<t){h!=0&&(n=y[h+f-r-1]);break}u-=t,h+=s}while(h<r);if(!BitStream.EQ(n,0))do Math.abs(c.xr[f-r])<=n&&(c.l3_enc[f-r]=0);while(--r>0)}}while(++R<c.psymax);c.part2_3_length=x.noquant_count_bits(L,c,null)}};function T(L){for(var c=0;c<L.sfbmax;c++)if(L.scalefac[c]+L.subblock_gain[L.window[c]]==0)return!1;return!0}function D(L){return A0.FAST_LOG10(.368+.632*L*L*L)}function w(L,c){for(var m=1e-37,y=0;y<c.psymax;y++)m+=D(L[y]);return Math.max(1e-20,m)}function G(L,c,m,y,e){var v;switch(L){default:case 9:{c.over_count>0?(v=m.over_SSD<=c.over_SSD,m.over_SSD==c.over_SSD&&(v=m.bits<c.bits)):v=m.max_noise<0&&m.max_noise*10+m.bits<=c.max_noise*10+c.bits;break}case 0:v=m.over_count<c.over_count||m.over_count==c.over_count&&m.over_noise<c.over_noise||m.over_count==c.over_count&&BitStream.EQ(m.over_noise,c.over_noise)&&m.tot_noise<c.tot_noise;break;case 8:m.max_noise=w(e,y);case 1:v=m.max_noise<c.max_noise;break;case 2:v=m.tot_noise<c.tot_noise;break;case 3:v=m.tot_noise<c.tot_noise&&m.max_noise<c.max_noise;break;case 4:v=m.max_noise<=0&&c.max_noise>.2||m.max_noise<=0&&c.max_noise<0&&c.max_noise>m.max_noise-.2&&m.tot_noise<c.tot_noise||m.max_noise<=0&&c.max_noise>0&&c.max_noise>m.max_noise-.2&&m.tot_noise<c.tot_noise+c.over_noise||m.max_noise>0&&c.max_noise>-.05&&c.max_noise>m.max_noise-.1&&m.tot_noise+m.over_noise<c.tot_noise+c.over_noise||m.max_noise>0&&c.max_noise>-.1&&c.max_noise>m.max_noise-.15&&m.tot_noise+m.over_noise+m.over_noise<c.tot_noise+c.over_noise+c.over_noise;break;case 5:v=m.over_noise<c.over_noise||BitStream.EQ(m.over_noise,c.over_noise)&&m.tot_noise<c.tot_noise;break;case 6:v=m.over_noise<c.over_noise||BitStream.EQ(m.over_noise,c.over_noise)&&(m.max_noise<c.max_noise||BitStream.EQ(m.max_noise,c.max_noise)&&m.tot_noise<=c.tot_noise);break;case 7:v=m.over_count<c.over_count||m.over_noise<c.over_noise;break}return c.over_count==0&&(v=v&&m.bits<c.bits),v}function $(L,c,m,y,e){var v=L.internal_flags,f;c.scalefac_scale==0?f=1.2968395546510096:f=1.6817928305074292;for(var R=0,u=0;u<c.sfbmax;u++)R<m[u]&&(R=m[u]);var n=v.noise_shaping_amp;switch(n==3&&(e?n=2:n=1),n){case 2:break;case 1:R>1?R=Math.pow(R,.5):R*=.95;break;case 0:default:R>1?R=1:R*=.95;break}for(var s=0,u=0;u<c.sfbmax;u++){var h=c.width[u],r;if(s+=h,!(m[u]<R)){if(v.substep_shaping&2&&(v.pseudohalf[u]=v.pseudohalf[u]==0?1:0,v.pseudohalf[u]==0&&v.noise_shaping_amp==2))return;for(c.scalefac[u]++,r=-h;r<0;r++)y[s+r]*=f,y[s+r]>c.xrpow_max&&(c.xrpow_max=y[s+r]);if(v.noise_shaping_amp==2)return}}}function K(L,c){for(var m=1.2968395546510096,y=0,e=0;e<L.sfbmax;e++){var v=L.width[e],f=L.scalefac[e];if(L.preflag!=0&&(f+=_.pretab[e]),y+=v,f&1){f++;for(var R=-v;R<0;R++)c[y+R]*=m,c[y+R]>L.xrpow_max&&(L.xrpow_max=c[y+R])}L.scalefac[e]=f>>1}L.preflag=0,L.scalefac_scale=1}function q(L,c,m){var y,e=c.scalefac;for(y=0;y<c.sfb_lmax;y++)if(e[y]>=16)return!0;for(var v=0;v<3;v++){var f=0,R=0;for(y=c.sfb_lmax+v;y<c.sfbdivide;y+=3)f<e[y]&&(f=e[y]);for(;y<c.sfbmax;y+=3)R<e[y]&&(R=e[y]);if(!(f<16&&R<8)){if(c.subblock_gain[v]>=7)return!0;c.subblock_gain[v]++;var u=L.scalefac_band.l[c.sfb_lmax];for(y=c.sfb_lmax+v;y<c.sfbmax;y+=3){var n,s=c.width[y],h=e[y];if(Ht(h>=0),h=h-(4>>c.scalefac_scale),h>=0){e[y]=h,u+=s*3;continue}e[y]=0;{var r=210+(h<<c.scalefac_scale+1);n=_.IPOW20(r)}u+=s*(v+1);for(var t=-s;t<0;t++)m[u+t]*=n,m[u+t]>c.xrpow_max&&(c.xrpow_max=m[u+t]);u+=s*(3-v-1)}{var n=_.IPOW20(202);u+=c.width[y]*(v+1);for(var t=-c.width[y];t<0;t++)m[u+t]*=n,m[u+t]>c.xrpow_max&&(c.xrpow_max=m[u+t])}}}return!1}function U(L,c,m,y,e){var v=L.internal_flags;$(L,c,m,y,e);var f=T(c);return f?!1:(v.mode_gr==2?f=x.scale_bitcount(c):f=x.scale_bitcount_lsf(v,c),f?(v.noise_shaping>1&&(xa.fill(v.pseudohalf,0),c.scalefac_scale==0?(K(c,y),f=!1):c.block_type==Be.SHORT_TYPE&&v.subblock_gain>0&&(f=q(v,c,y)||T(c))),f||(v.mode_gr==2?f=x.scale_bitcount(c):f=x.scale_bitcount_lsf(v,c)),!f):!0)}this.outer_loop=function(L,c,m,y,e,v){var f=L.internal_flags,R=new ci,u=ga(576),n=ga(hi.SFBMAX),s=new E0,h,r=new hn,t=9999999,d=!1,l=!1,F=0;if(H(f,c,v,e,y),f.noise_shaping==0)return 100;_.calc_noise(c,m,n,s,r),s.bits=c.part2_3_length,R.assign(c);var I=0;for(ta.arraycopy(y,0,u,0,576);!d;){do{var g=new E0,i,o=255;if(f.substep_shaping&2?i=20:i=3,f.sfb21_extra&&(n[R.sfbmax]>1||R.block_type==Be.SHORT_TYPE&&(n[R.sfbmax+1]>1||n[R.sfbmax+2]>1))||!U(L,R,n,y,l))break;R.scalefac_scale!=0&&(o=254);var O=v-R.part2_length;if(O<=0)break;for(;(R.part2_3_length=x.count_bits(f,y,R,r))>O&&R.global_gain<=o;)R.global_gain++;if(R.global_gain>o)break;if(s.over_count==0){for(;(R.part2_3_length=x.count_bits(f,y,R,r))>t&&R.global_gain<=o;)R.global_gain++;if(R.global_gain>o)break}if(_.calc_noise(R,m,n,g,r),g.bits=R.part2_3_length,c.block_type!=Be.SHORT_TYPE?h=L.quant_comp:h=L.quant_comp_short,h=G(h,s,g,R,n)?1:0,h!=0)t=c.part2_3_length,s=g,c.assign(R),I=0,ta.arraycopy(y,0,u,0,576);else if(f.full_outer_loop==0&&(++I>i&&s.over_count==0||f.noise_shaping_amp==3&&l&&I>30||f.noise_shaping_amp==3&&l&&R.global_gain-F>15))break}while(R.global_gain+R.scalefac_scale<255);f.noise_shaping_amp==3?l?d=!0:(R.assign(c),ta.arraycopy(u,0,y,0,576),I=0,F=R.global_gain,l=!0):d=!0}return Ht(c.global_gain+c.scalefac_scale<=255),L.VBR==_i.vbr_rh||L.VBR==_i.vbr_mtrh?ta.arraycopy(u,0,y,0,576):f.substep_shaping&1&&trancate_smallspectrums(f,c,m,y),s.over_count},this.iteration_finish_one=function(L,c,m){var y=L.l3_side,e=y.tt[c][m];x.best_scalefac_store(L,c,m,y),L.use_best_huffman==1&&x.best_huffman_divide(L,e),a.ResvAdjust(L,e)},this.VBR_encode_granule=function(L,c,m,y,e,v,f){var R=L.internal_flags,u=new ci,n=ga(576),s=f,h=f+1,r=(f+v)/2,t,d,l=0,F=R.sfb21_extra;Ht(s<=LameInternalFlags.MAX_BITS_PER_CHANNEL),xa.fill(u.l3_enc,0);do Ht(r>=v),Ht(r<=f),Ht(v<=f),r>s-42?R.sfb21_extra=!1:R.sfb21_extra=F,d=outer_loop(L,c,m,y,e,r),d<=0?(l=1,h=c.part2_3_length,u.assign(c),ta.arraycopy(y,0,n,0,576),f=h-32,t=f-v,r=(f+v)/2):(v=r+32,t=f-v,r=(f+v)/2,l!=0&&(l=2,c.assign(u),ta.arraycopy(n,0,y,0,576)));while(t>12);R.sfb21_extra=F,l==2&&ta.arraycopy(u.l3_enc,0,c.l3_enc,0,576),Ht(c.part2_3_length<=s)},this.get_framebits=function(L,c){var m=L.internal_flags;m.bitrate_index=m.VBR_min_bitrate;var y=p.getframebits(L);m.bitrate_index=1,y=p.getframebits(L);for(var e=1;e<=m.VBR_max_bitrate;e++){m.bitrate_index=e;var v=new MeanBits(y);c[e]=a.ResvFrameBegin(L,v),y=v.bits}},this.VBR_old_prepare=function(L,c,m,y,e,v,f,R,u){var n=L.internal_flags,s,h=0,r=1,t=0;n.bitrate_index=n.VBR_max_bitrate;var d=a.ResvFrameBegin(L,new MeanBits(0))/n.mode_gr;get_framebits(L,v);for(var l=0;l<n.mode_gr;l++){var F=_.on_pe(L,c,R[l],d,l,0);n.mode_ext==Be.MPG_MD_MS_LR&&(ms_convert(n.l3_side,l),_.reduce_side(R[l],m[l],d,F));for(var I=0;I<n.channels_out;++I){var g=n.l3_side.tt[l][I];g.block_type!=Be.SHORT_TYPE?(h=1.28/(1+Math.exp(3.5-c[l][I]/300))-.05,s=n.PSY.mask_adjust-h):(h=2.56/(1+Math.exp(3.5-c[l][I]/300))-.14,s=n.PSY.mask_adjust_short-h),n.masking_lower=Math.pow(10,s*.1),init_outer_loop(n,g),u[l][I]=_.calc_xmin(L,y[l][I],g,e[l][I]),u[l][I]!=0&&(r=0),f[l][I]=126,t+=R[l][I]}}for(var l=0;l<n.mode_gr;l++)for(var I=0;I<n.channels_out;I++)t>v[n.VBR_max_bitrate]&&(R[l][I]*=v[n.VBR_max_bitrate],R[l][I]/=t),f[l][I]>R[l][I]&&(f[l][I]=R[l][I]);return r},this.bitpressure_strategy=function(L,c,m,y){for(var e=0;e<L.mode_gr;e++)for(var v=0;v<L.channels_out;v++){for(var f=L.l3_side.tt[e][v],R=c[e][v],u=0,n=0;n<f.psy_lmax;n++)R[u++]*=1+.029*n*n/Be.SBMAX_l/Be.SBMAX_l;if(f.block_type==Be.SHORT_TYPE)for(var n=f.sfb_smin;n<Be.SBMAX_s;n++)R[u++]*=1+.029*n*n/Be.SBMAX_s/Be.SBMAX_s,R[u++]*=1+.029*n*n/Be.SBMAX_s/Be.SBMAX_s,R[u++]*=1+.029*n*n/Be.SBMAX_s/Be.SBMAX_s;y[e][v]=0|Math.max(m[e][v],.9*y[e][v])}},this.VBR_new_prepare=function(L,c,m,y,e,v){var f=L.internal_flags,R=1,u=0,n=0,s;if(L.free_format){f.bitrate_index=0;var h=new MeanBits(u);s=a.ResvFrameBegin(L,h),u=h.bits,e[0]=s}else{f.bitrate_index=f.VBR_max_bitrate;var h=new MeanBits(u);a.ResvFrameBegin(L,h),u=h.bits,get_framebits(L,e),s=e[f.VBR_max_bitrate]}for(var r=0;r<f.mode_gr;r++){_.on_pe(L,c,v[r],u,r,0),f.mode_ext==Be.MPG_MD_MS_LR&&ms_convert(f.l3_side,r);for(var t=0;t<f.channels_out;++t){var d=f.l3_side.tt[r][t];f.masking_lower=Math.pow(10,f.PSY.mask_adjust*.1),init_outer_loop(f,d),_.calc_xmin(L,m[r][t],d,y[r][t])!=0&&(R=0),n+=v[r][t]}}for(var r=0;r<f.mode_gr;r++)for(var t=0;t<f.channels_out;t++)n>s&&(v[r][t]*=s,v[r][t]/=n);return R},this.calc_target_bits=function(L,c,m,y,e,v){var f=L.internal_flags,R=f.l3_side,u,n,s,h,r=0;f.bitrate_index=f.VBR_max_bitrate;var t=new MeanBits(r);for(v[0]=a.ResvFrameBegin(L,t),r=t.bits,f.bitrate_index=1,r=p.getframebits(L)-f.sideinfo_len*8,e[0]=r/(f.mode_gr*f.channels_out),r=L.VBR_mean_bitrate_kbps*L.framesize*1e3,f.substep_shaping&1&&(r*=1.09),r/=L.out_samplerate,r-=f.sideinfo_len*8,r/=f.mode_gr*f.channels_out,u=.93+.07*(11-L.compression_ratio)/(11-5.5),u<.9&&(u=.9),u>1&&(u=1),n=0;n<f.mode_gr;n++){var d=0;for(s=0;s<f.channels_out;s++){if(y[n][s]=int(u*r),c[n][s]>700){var l=int((c[n][s]-700)/1.4),F=R.tt[n][s];y[n][s]=int(u*r),F.block_type==Be.SHORT_TYPE&&l<r/2&&(l=r/2),l>r*3/2?l=r*3/2:l<0&&(l=0),y[n][s]+=l}y[n][s]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(y[n][s]=LameInternalFlags.MAX_BITS_PER_CHANNEL),d+=y[n][s]}if(d>LameInternalFlags.MAX_BITS_PER_GRANULE)for(s=0;s<f.channels_out;++s)y[n][s]*=LameInternalFlags.MAX_BITS_PER_GRANULE,y[n][s]/=d}if(f.mode_ext==Be.MPG_MD_MS_LR)for(n=0;n<f.mode_gr;n++)_.reduce_side(y[n],m[n],r*f.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(h=0,n=0;n<f.mode_gr;n++)for(s=0;s<f.channels_out;s++)y[n][s]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(y[n][s]=LameInternalFlags.MAX_BITS_PER_CHANNEL),h+=y[n][s];if(h>v[0])for(n=0;n<f.mode_gr;n++)for(s=0;s<f.channels_out;s++)y[n][s]*=v[0],y[n][s]/=h}}var dn=un,vn=He,$a=vn.assert;function mn(){var p;this.setModules=function(a){p=a},this.ResvFrameBegin=function(a,_){var b=a.internal_flags,x,B=b.l3_side,E=p.getframebits(a);_.bits=(E-b.sideinfo_len*8)/b.mode_gr;var N=8*256*b.mode_gr-8;a.brate>320?x=8*int(a.brate*1e3/(a.out_samplerate/1152)/8+.5):(x=8*1440,a.strict_ISO&&(x=8*int(32e4/(a.out_samplerate/1152)/8+.5))),b.ResvMax=x-E,b.ResvMax>N&&(b.ResvMax=N),(b.ResvMax<0||a.disable_reservoir)&&(b.ResvMax=0);var H=_.bits*b.mode_gr+Math.min(b.ResvSize,b.ResvMax);return H>x&&(H=x),$a(b.ResvMax%8==0),$a(b.ResvMax>=0),B.resvDrain_pre=0,b.pinfo!=null&&(b.pinfo.mean_bits=_.bits/2,b.pinfo.resvsize=b.ResvSize),H},this.ResvMaxBits=function(a,_,b,x){var B=a.internal_flags,E,N=B.ResvSize,H=B.ResvMax;x!=0&&(N+=_),B.substep_shaping&1&&(H*=.9),b.bits=_,N*10>H*9?(E=N-H*9/10,b.bits+=E,B.substep_shaping|=128):(E=0,B.substep_shaping&=127,!a.disable_reservoir&&!(B.substep_shaping&1)&&(b.bits-=.1*_));var T=N<B.ResvMax*6/10?N:B.ResvMax*6/10;return T-=E,T<0&&(T=0),T},this.ResvAdjust=function(a,_){a.ResvSize-=_.part2_3_length+_.part2_length},this.ResvFrameEnd=function(a,_){var b,x=a.l3_side;a.ResvSize+=_*a.mode_gr;var B=0;x.resvDrain_post=0,x.resvDrain_pre=0,(b=a.ResvSize%8)!=0&&(B+=b),b=a.ResvSize-B-a.ResvMax,b>0&&($a(b%8==0),$a(b>=0),B+=b);{var E=Math.min(x.main_data_begin*8,B)/8;x.resvDrain_pre+=8*E,B-=8*E,a.ResvSize-=8*E,x.main_data_begin-=E}x.resvDrain_post+=B,a.ResvSize-=B}}var fn=mn;function pn(){var p="http://www.mp3dev.org/",a=3,_=98,b=4,x=0,B=93;this.getLameVersion=function(){return a+"."+_+"."+b},this.getLameShortVersion=function(){return a+"."+_+"."+b},this.getLameVeryShortVersion=function(){return"LAME"+a+"."+_+"r"},this.getPsyVersion=function(){return x+"."+B},this.getLameUrl=function(){return p},this.getLameOsBitness=function(){return"32bits"}}var bn=pn,wt=He,Sn=wt.System,w0=wt.VbrMode;wt.Float;var ui=wt.ShortBlock;wt.Util;var yn=wt.Arrays;wt.new_array_n;var Ga=wt.new_byte;wt.new_double;wt.new_float;wt.new_float_n;wt.new_int;wt.new_int_n;var An=wt.assert;ka.NUMTOCENTRIES=100;ka.MAXFRAMESIZE=2880;function ka(){var p,a,_;this.setModules=function(r,t,d){p=r,a=t,_=d};var b=1,x=2,B=4,E=8,N=ka.NUMTOCENTRIES,H=ka.MAXFRAMESIZE,T=N+4+4+4+4+4,D=T+9+1+1+8+1+1+3+1+1+2+4+2+2,w=128,G=64,$=32,K=null,q="Xing",U="Info",L=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function c(r,t){if(r.nVbrNumFrames++,r.sum+=t,r.seen++,!(r.seen<r.want)&&(r.pos<r.size&&(r.bag[r.pos]=r.sum,r.pos++,r.seen=0),r.pos==r.size)){for(var d=1;d<r.size;d+=2)r.bag[d/2]=r.bag[d];r.want*=2,r.pos/=2}}function m(r,t){if(!(r.pos<=0))for(var d=1;d<N;++d){var l=d/N,F,I,g=0|Math.floor(l*r.pos);g>r.pos-1&&(g=r.pos-1),F=r.bag[g],I=r.sum;var i=0|256*F/I;i>255&&(i=255),t[d]=255&i}}this.addVbrFrame=function(r){var t=r.internal_flags,d=Tables.bitrate_table[r.version][t.bitrate_index];An(t.VBR_seek_table.bag!=null),c(t.VBR_seek_table,d)};function y(r,t){var d=r[t+0]&255;return d<<=8,d|=r[t+1]&255,d<<=8,d|=r[t+2]&255,d<<=8,d|=r[t+3]&255,d}function e(r,t,d){r[t+0]=255&(d>>24&255),r[t+1]=255&(d>>16&255),r[t+2]=255&(d>>8&255),r[t+3]=255&(d&255)}function v(r,t,d){r[t+0]=255&(d>>8&255),r[t+1]=255&(d&255)}function f(r,t){return new String(r,t,q.length(),K).equals(q)||new String(r,t,U.length(),K).equals(U)}function R(r,t,d){return 255&(r<<t|d&~(-1<<t))}function u(r,t){var d=r.internal_flags;t[0]=R(t[0],8,255),t[1]=R(t[1],3,7),t[1]=R(t[1],1,r.out_samplerate<16e3?0:1),t[1]=R(t[1],1,r.version),t[1]=R(t[1],2,4-3),t[1]=R(t[1],1,r.error_protection?0:1),t[2]=R(t[2],4,d.bitrate_index),t[2]=R(t[2],2,d.samplerate_index),t[2]=R(t[2],1,0),t[2]=R(t[2],1,r.extension),t[3]=R(t[3],2,r.mode.ordinal()),t[3]=R(t[3],2,d.mode_ext),t[3]=R(t[3],1,r.copyright),t[3]=R(t[3],1,r.original),t[3]=R(t[3],2,r.emphasis),t[0]=255;var l=255&(t[1]&241),F;r.version==1?F=w:r.out_samplerate<16e3?F=$:F=G,r.VBR==w0.vbr_off&&(F=r.brate);var I;r.free_format?I=0:I=255&16*p.BitrateIndex(F,r.version,r.out_samplerate),r.version==1?(t[1]=255&(l|10),l=255&(t[2]&13),t[2]=255&(I|l)):(t[1]=255&(l|2),l=255&(t[2]&13),t[2]=255&(I|l))}this.getVbrTag=function(r){var t=new VBRTagData,d=0;t.flags=0;var l=r[d+1]>>3&1,F=r[d+2]>>2&3,I=r[d+3]>>6&3,g=r[d+2]>>4&15;if(g=Tables.bitrate_table[l][g],r[d+1]>>4==14?t.samprate=Tables.samplerate_table[2][F]:t.samprate=Tables.samplerate_table[l][F],l!=0?I!=3?d+=32+4:d+=17+4:I!=3?d+=17+4:d+=9+4,!f(r,d))return null;d+=4,t.hId=l;var i=t.flags=y(r,d);if(d+=4,i&b&&(t.frames=y(r,d),d+=4),i&x&&(t.bytes=y(r,d),d+=4),i&B){if(t.toc!=null)for(var o=0;o<N;o++)t.toc[o]=r[d+o];d+=N}t.vbrScale=-1,i&E&&(t.vbrScale=y(r,d),d+=4),t.headersize=(l+1)*72e3*g/t.samprate,d+=21;var O=r[d+0]<<4;O+=r[d+1]>>4;var P=(r[d+1]&15)<<8;return P+=r[d+2]&255,(O<0||O>3e3)&&(O=-1),(P<0||P>3e3)&&(P=-1),t.encDelay=O,t.encPadding=P,t},this.InitVbrTag=function(r){var t=r.internal_flags,d;r.version==1?d=w:r.out_samplerate<16e3?d=$:d=G,r.VBR==w0.vbr_off&&(d=r.brate);var l=(r.version+1)*72e3*d/r.out_samplerate,F=t.sideinfo_len+D;if(t.VBR_seek_table.TotalFrameSize=l,l<F||l>H){r.bWriteVbrTag=!1;return}t.VBR_seek_table.nVbrNumFrames=0,t.VBR_seek_table.nBytesWritten=0,t.VBR_seek_table.sum=0,t.VBR_seek_table.seen=0,t.VBR_seek_table.want=1,t.VBR_seek_table.pos=0,t.VBR_seek_table.bag==null&&(t.VBR_seek_table.bag=new int[400],t.VBR_seek_table.size=400);var I=Ga(H);u(r,I);for(var g=t.VBR_seek_table.TotalFrameSize,i=0;i<g;++i)a.add_dummy_byte(r,I[i]&255,1)};function n(r,t){var d=t^r;return t=t>>8^L[d&255],t}this.updateMusicCRC=function(r,t,d,l){for(var F=0;F<l;++F)r[0]=n(t[d+F],r[0])};function s(r,t,d,l,F){var I=r.internal_flags,g=0,i=r.encoder_delay,o=r.encoder_padding,O=100-10*r.VBR_q-r.quality,P=_.getLameVeryShortVersion(),se,le=0,re,oe=[1,5,3,2,4,0,3],be=0|(r.lowpassfreq/100+.5>255?255:r.lowpassfreq/100+.5),he=0,ne=0,xe=0,Pe=r.internal_flags.noise_shaping,Se=0,Re=0,Te=0,Ve=0,Ke=0,$t=(r.exp_nspsytune&1)!=0,Tt=(r.exp_nspsytune&2)!=0,tt=!1,Pt=!1,aa=r.internal_flags.nogap_total,ea=r.internal_flags.nogap_current,ze=r.ATHtype,ia=0,Wt;switch(r.VBR){case vbr_abr:Wt=r.VBR_mean_bitrate_kbps;break;case vbr_off:Wt=r.brate;break;default:Wt=r.VBR_min_bitrate_kbps}switch(r.VBR.ordinal()<oe.length?se=oe[r.VBR.ordinal()]:se=0,re=16*le+se,I.findReplayGain&&(I.RadioGain>510&&(I.RadioGain=510),I.RadioGain<-510&&(I.RadioGain=-510),ne=8192,ne|=3072,I.RadioGain>=0?ne|=I.RadioGain:(ne|=512,ne|=-I.RadioGain)),I.findPeakSample&&(he=Math.abs(0|I.PeakSample/32767*Math.pow(2,23)+.5)),aa!=-1&&(ea>0&&(Pt=!0),ea<aa-1&&(tt=!0)),ia=ze+(($t?1:0)<<4)+((Tt?1:0)<<5)+((tt?1:0)<<6)+((Pt?1:0)<<7),O<0&&(O=0),r.mode){case MONO:Se=0;break;case STEREO:Se=1;break;case DUAL_CHANNEL:Se=2;break;case JOINT_STEREO:r.force_ms?Se=4:Se=3;break;case NOT_SET:default:Se=7;break}r.in_samplerate<=32e3?Te=0:r.in_samplerate==48e3?Te=2:r.in_samplerate>48e3?Te=3:Te=1,(r.short_blocks==ui.short_block_forced||r.short_blocks==ui.short_block_dispensed||r.lowpassfreq==-1&&r.highpassfreq==-1||r.scale_left<r.scale_right||r.scale_left>r.scale_right||r.disable_reservoir&&r.brate<320||r.noATH||r.ATHonly||ze==0||r.in_samplerate<=32e3)&&(Re=1),Ve=Pe+(Se<<2)+(Re<<5)+(Te<<6),Ke=I.nMusicCRC,e(d,l+g,O),g+=4;for(var Rt=0;Rt<9;Rt++)d[l+g+Rt]=255&P.charAt(Rt);g+=9,d[l+g]=255&re,g++,d[l+g]=255&be,g++,e(d,l+g,he),g+=4,v(d,l+g,ne),g+=2,v(d,l+g,xe),g+=2,d[l+g]=255&ia,g++,Wt>=255?d[l+g]=255:d[l+g]=255&Wt,g++,d[l+g]=255&i>>4,d[l+g+1]=255&(i<<4)+(o>>8),d[l+g+2]=255&o,g+=3,d[l+g]=255&Ve,g++,d[l+g++]=0,v(d,l+g,r.preset),g+=2,e(d,l+g,t),g+=4,v(d,l+g,Ke),g+=2;for(var ba=0;ba<g;ba++)F=n(d[l+ba],F);return v(d,l+g,F),g+=2,g}function h(r){r.seek(0);var t=Ga(10);r.readFully(t);var d;return new String(t,"ISO-8859-1").startsWith("ID3")?d=0:d=((t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127)+t.length,d}this.getLameTagFrame=function(r,t){var d=r.internal_flags;if(!r.bWriteVbrTag||d.Class_ID!=Lame.LAME_ID||d.VBR_seek_table.pos<=0)return 0;if(t.length<d.VBR_seek_table.TotalFrameSize)return d.VBR_seek_table.TotalFrameSize;yn.fill(t,0,d.VBR_seek_table.TotalFrameSize,0),u(r,t);var l=Ga(N);if(r.free_format)for(var F=1;F<N;++F)l[F]=255&255*F/100;else m(d.VBR_seek_table,l);var I=d.sideinfo_len;r.error_protection&&(I-=2),r.VBR==w0.vbr_off?(t[I++]=255&U.charAt(0),t[I++]=255&U.charAt(1),t[I++]=255&U.charAt(2),t[I++]=255&U.charAt(3)):(t[I++]=255&q.charAt(0),t[I++]=255&q.charAt(1),t[I++]=255&q.charAt(2),t[I++]=255&q.charAt(3)),e(t,I,b+x+B+E),I+=4,e(t,I,d.VBR_seek_table.nVbrNumFrames),I+=4;var g=d.VBR_seek_table.nBytesWritten+d.VBR_seek_table.TotalFrameSize;e(t,I,0|g),I+=4,Sn.arraycopy(l,0,t,I,l.length),I+=l.length,r.error_protection&&a.CRC_writeheader(d,t);for(var i=0,F=0;F<I;F++)i=n(t[F],i);return I+=s(r,g,t,I,i),d.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(r,t){var d=r.internal_flags;if(d.VBR_seek_table.pos<=0||(t.seek(t.length()),t.length()==0))return-1;var l=h(t);t.seek(l);var F=Ga(H),I=getLameTagFrame(r,F);return I>F.length?-1:(I<1||t.write(F,0,I),0)}}var En=ka,xt=He;xt.System;xt.VbrMode;xt.Float;xt.ShortBlock;xt.Util;xt.Arrays;xt.new_array_n;var di=xt.new_byte;xt.new_double;xt.new_float;xt.new_float_n;xt.new_int;xt.new_int_n;var vi=xt.assert,wn=ki,xn=tn,Tn=Ii,Rn=gi,Mn=dn,Bn=Li,In=fn,Cn=C0,gn=k0;je();var Ln=bn,kn=En;function Nn(){this.setModules=function(p,a){}}function On(){this.setModules=function(p,a,_){}}function Hn(){}function Pn(){this.setModules=function(p,a){}}function Dn(p,a,_){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),p=1,a=44100,_=128);var b=new wn,x=new Nn,B=new Tn,E=new gn,N=new xn,H=new Rn,T=new Mn,D=new kn,w=new Ln,G=new Pn,$=new In,K=new Bn,q=new On,U=new Hn;b.setModules(B,E,N,H,T,D,w,G,U),E.setModules(B,U,w,D),G.setModules(E,w),N.setModules(b),T.setModules(E,$,H,K),H.setModules(K,$,b.enc.psy),$.setModules(E),K.setModules(H),D.setModules(b,E,w),x.setModules(q,U),q.setModules(w,G,N);var L=b.lame_init();L.num_channels=p,L.in_samplerate=a,L.brate=_,L.mode=Cn.STEREO,L.quality=3,L.bWriteVbrTag=!1,L.disable_reservoir=!0,L.write_id3tag_automatic=!1;var c=b.lame_init_params(L);vi(c==0);var m=1152,y=0|1.25*m+7200,e=di(y);this.encodeBuffer=function(v,f){p==1&&(f=v),vi(v.length==f.length),v.length>m&&(m=v.length,y=0|1.25*m+7200,e=di(y));var R=b.lame_encode_buffer(L,v,f,v.length,e,0,y);return new Int8Array(e.subarray(0,R))},this.flush=function(){var v=b.lame_encode_flush(L,e,0,y);return new Int8Array(e.subarray(0,v))}}function Xt(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function za(p){return p.charCodeAt(0)<<24|p.charCodeAt(1)<<16|p.charCodeAt(2)<<8|p.charCodeAt(3)}Xt.RIFF=za("RIFF");Xt.WAVE=za("WAVE");Xt.fmt_=za("fmt ");Xt.data=za("data");Xt.readHeader=function(p){var a=new Xt,_=p.getUint32(0,!1);if(Xt.RIFF==_&&(p.getUint32(4,!0),Xt.WAVE==p.getUint32(8,!1)&&Xt.fmt_==p.getUint32(12,!1))){var b=p.getUint32(16,!0),x=16+4;switch(b){case 16:case 18:a.channels=p.getUint16(x+2,!0),a.sampleRate=p.getUint32(x+4,!0);break;default:throw"extended fmt chunk not implemented"}x+=b;for(var B=Xt.data,E=0;B!=_&&(_=p.getUint32(x,!1),E=p.getUint32(x+4,!0),B!=_);)x+=E+8;return a.dataLen=E,a.dataOffset=x+8,a}};I0.Mp3Encoder=Dn;I0.WavHeader=Xt;window.MPEGMode=ts;window.Lame=Js;window.BitStream=Us;function Fn(p,a){const _=new Int16Array(p.length);for(let H=0;H<p.length;H++)_[H]=p[H]*32767;const b=new I0.Mp3Encoder(1,a,128),x=[],B=b.encodeBuffer(_);B.length>0&&x.push(B);const E=b.flush();return E.length>0&&x.push(E),new Blob(x,{type:"audio/mpeg"})}function Vn(p){return new DOMParser().parseFromString(p,"text/html").body.textContent||""}function qn(p){const a=atob(p),_=a.length,b=new Uint8Array(_);for(let x=0;x<_;x++)b[x]=a.charCodeAt(x);return b}function Xn(p){const a=URL.createObjectURL(p);return new Audio(a)}function Yn(p){const b="wss://api.elevenlabs.io/v1/text-to-speech/21m00Tcm4TlvDq8ikWAM/stream-input?model_id=eleven_monolingual_v1",x=new WebSocket(b);let B=[];return new Promise((E,N)=>{x.onopen=function(H){const T={text:" ",voice_settings:{stability:.5,similarity_boost:.8},xi_api_key:"bddfcabff8951ebb9e925d506452df93"};x.send(JSON.stringify(T));const D={text:p+" ",try_trigger_generation:!0};x.send(JSON.stringify(D));const w={text:""};x.send(JSON.stringify(w))},x.onmessage=function(H){const T=JSON.parse(H.data);if(T.audio){const D=qn(T.audio);B.push(D)}else console.log("No audio data in the response");T.isFinal,T.normalizedAlignment},x.onerror=function(H){console.error(`WebSocket Error: ${H}`),N(H)},x.onclose=function(H){H.wasClean?console.info(`Connection closed cleanly, code=${H.code}, reason=${H.reason}`):console.warn("Connection died");const T=new Blob(B,{type:"audio/mpeg"}),D=Xn(T);E(D)}})}class $n{constructor({pageEl:a}){ra(this,"keyframes",{fadeOutPhoneBarAI:[{transform:"translateY(0px)",opacity:1},{transform:"translateY(-100%)",opacity:0}],fadeOutPhoneContainer:[{transform:"translateY(0px)",opacity:1},{transform:"translateY(-100%)",opacity:0}],fadeInPhoneBarUser:[{transform:"translateY(200%)",opacity:0},{transform:"translateY(0px)",opacity:1}],phoneBarYoyo:[{width:"32px"},{width:"8px"},{width:"32px"}],phoneBarListeningYoyo:[{width:"32px"},{width:"132px"},{width:"32px"}],reducePhoneBarOne:[{width:"32px"},{width:"8px"}],expandPhoneBarProcessing:[{width:"8px"},{width:"132px"}],dotsYoyo:[{width:"8px",offset:0},{width:"8px",offset:.1},{width:"34px",offset:.3},{width:"34px",offset:.7},{width:"8px",offset:1}],backgroundBarProcessingYoyo:[{background:"unset",offset:0},{background:"unset",offset:.29},{background:"#ff3e33",offset:.3},{background:"#ff3e33",offset:.7},{background:"unset",offset:.71},{background:"unset",offset:1}],reducePhoneBarProcessing:[{width:"132px"},{width:"8px"}],expandPhoneBarAI:[{width:"8px"},{width:"132px"}],phoneBarAIYoyo:[{width:"132px"},{width:"32px"},{width:"132px"}]});this.pageEl=a,this.phoneContainer=this.pageEl.querySelector(".phone__container"),this.phoneBarContainer=this.phoneContainer.querySelector(".phone-bar__container"),this.phoneBarOne=this.phoneBarContainer.querySelector(".phone-bar__one"),this.phoneBarOneDots=this.phoneBarOne.querySelectorAll(".dot"),this.phoneBarProcessing=this.phoneBarContainer.querySelector(".phone-bar__processing"),this.phoneBarProcessingDots=this.phoneBarProcessing.querySelectorAll(".dot"),this.phoneBarAI=this.phoneBarContainer.querySelector(".phone-bar__AI"),this.phoneBarPause=this.phoneBarContainer.querySelector(".phone-bar__pause"),this.isConnected=!1,this.colors={talkToMe:"#2B41EE"},this.animations=[]}animateTextTransition(a,_,b,x){b.textContent=a;const B=Ie(_,x.hide,{duration:300,ease:"ease-in-out",fill:"forwards"}),E=Ie(b,x.show,{duration:300,ease:"ease-in-out",fill:"forwards"});B.onfinish=()=>_.classList.remove("active"),E.onfinish=()=>b.classList.add("active")}createAnimation(a,_,b){const x=Ie(a,_,b);return this.animations.push(x),x}cancelAllAnimations(){this.isConnected=!1,this.animations.flat().forEach(_=>{_.cancel()}),this.animations=[]}newInfoText(a){const _=this.phoneContainer.querySelector(".phone__info.active"),b=this.phoneContainer.querySelector(".phone__info:not(.active)"),x={hide:[{opacity:1,transform:"translateX(-50%) translateY(0px)"},{opacity:0,transform:"translateX(-50%) translateY(-100%)"}],show:[{opacity:0,transform:"translateX(-50%) translateY(100%)"},{opacity:1,transform:" translateX(-50%)translateY(0px)"}]};this.animateTextTransition(a,_,b,x)}toConnecting(){this.dotsYoyoAnimations=this.createAnimation([this.phoneBarOneDots[0],this.phoneBarOneDots[1]],[{width:"30px"},{width:"8px"},{width:"30px"}],{duration:900,ease:"ease-out",iterations:1/0})}toConnected(){this.isConnected=!0,this.dotsYoyoAnimations.forEach(a=>a.cancel()),this.phoneBarOneDots.forEach(a=>a.classList.add("expand")),this.phoneBarOne.classList.add("active"),this.createAnimation([this.phoneBarOneDots[0],this.phoneBarOneDots[1]],[{opacity:1},{opacity:0}],{duration:100,ease:"ease-out",fill:"forwards"})}toTalkToMe(){if(this.isConnected||this.toConnected(),this.phoneBarAIYoyoAnimations){this.phoneBarAIYoyoAnimations.cancel();const a=this.createAnimation(this.phoneBarAI,this.keyframes.fadeOutPhoneBarAI,{duration:300,ease:"ease-out",fill:"forwards"});this.phoneBarOne.classList.add("active"),this.phoneBarOne.classList.add("talkToMe");const _=this.createAnimation(this.phoneBarOne,this.keyframes.fadeInPhoneBarUser,{duration:300,ease:"ease-out",fill:"forwards"});_.onfinish=()=>{this.expandPhoneBarAI.cancel(),this.phoneBarAI.classList.remove("active"),a.cancel()}}this.phoneBarOne.classList.add("talkToMe"),this.phoneBarYoyoAnimations=this.createAnimation(this.phoneBarOne,this.keyframes.phoneBarYoyo,{duration:900,ease:"ease-out",iterations:1/0})}toListening(){var a;(a=this.phoneBarYoyoAnimations)==null||a.cancel(),this.phoneBarYoyoAnimations=this.createAnimation(this.phoneBarOne,this.keyframes.phoneBarListeningYoyo,{duration:900,ease:"ease-out",iterations:1/0})}resetUserBar(){this.phoneBarOne.classList.remove("active"),this.phoneBarOne.classList.remove("talkToMe"),this.phoneBarOneDots.forEach(a=>a.classList.remove("expand"))}toProcessing(){if(this.phoneBarAIYoyoAnimations){this.phoneBarAIYoyoAnimations.cancel();const _=this.createAnimation(this.phoneBarAI,this.keyframes.fadeOutPhoneBarAI,{duration:300,ease:"ease-out",fill:"forwards"});this.phoneBarOne.classList.add("active"),this.phoneBarOne.classList.add("talkToMe");const b=this.createAnimation(this.phoneBarOne,this.keyframes.fadeInPhoneBarUser,{duration:300,ease:"ease-out",fill:"forwards"});b.onfinish=()=>{this.expandPhoneBarAI.cancel(),this.phoneBarAI.classList.remove("active"),_.cancel()}}this.phoneBarYoyoAnimations.cancel();const a=this.createAnimation(this.phoneBarOne,this.keyframes.reducePhoneBarOne,{duration:400,ease:"ease-out",fill:"forwards"});a.onfinish=()=>{this.phoneBarOne.classList.remove("active"),this.phoneBarOne.classList.remove("talkToMe"),this.phoneBarProcessing.classList.add("active"),this.createAnimation(this.phoneBarProcessing,this.keyframes.expandPhoneBarProcessing,{duration:400,ease:"ease-out",fill:"forwards"}),this.dotsYoyoAnimations=Array.from(this.phoneBarProcessingDots).map(_=>this.createAnimation(_,this.keyframes.dotsYoyo,{delay:500,duration:1500,ease:"ease-out",iterations:1/0})),this.backgroundBarProcessingYoyo=this.createAnimation(this.phoneBarProcessing,this.keyframes.backgroundBarProcessingYoyo,{delay:500,duration:1500,ease:"ease-out",iterations:1/0})}}resetProcessingBar(){this.phoneBarProcessing.classList.remove("active"),this.phoneBarProcessingDots.forEach(a=>a.classList.remove("expand"))}toAITalking(){this.dotsYoyoAnimations.forEach(_=>_.cancel()),this.backgroundBarProcessingYoyo.cancel();const a=this.createAnimation(this.phoneBarProcessing,this.keyframes.reducePhoneBarProcessing,{duration:400,ease:"ease-out",fill:"forwards"});a.onfinish=()=>{this.phoneBarProcessing.classList.remove("active"),this.phoneBarAI.classList.add("active"),this.expandPhoneBarAI=this.createAnimation(this.phoneBarAI,this.keyframes.expandPhoneBarAI,{delay:300,duration:400,ease:"ease-out",fill:"forwards"}),this.phoneBarAIYoyoAnimations=this.createAnimation(this.phoneBarAI,this.keyframes.phoneBarAIYoyo,{delay:300+this.expandPhoneBarAI.effect.getComputedTiming().duration,duration:900,ease:"ease-out",iterations:1/0})}}resetAIBar(){var a;this.phoneBarAI.classList.remove("active"),(a=this.phoneBarAIYoyoAnimations)==null||a.cancel(),this.phoneBarAIYoyoAnimations=null}toPause(a){this.phoneBarPause.classList.add("active"),a==="user"&&(this.phoneBarOne.classList.remove("active"),this.phoneBarOne.classList.remove("talkToMe")),a==="AI"&&this.phoneBarAI.classList.remove("active")}toResume(a){this.phoneBarPause.classList.remove("active"),a==="user"&&(this.phoneBarOne.classList.add("active"),this.phoneBarOne.classList.add("talkToMe")),a==="AI"&&this.phoneBarAI.classList.add("active")}leave(){this.cancelAllAnimations(),this.resetUserBar(),this.resetProcessingBar(),this.resetAIBar()}}function Gn(){const p=new(window.AudioContext||window.webkitAudioContext);let a=p.createBuffer(1,1,22050),_=p.createBufferSource();return _.buffer=a,_.connect(p.destination),_.start(0),p}class Ua{constructor({audioContext:a,audioUrl:_,onPlay:b,onEnded:x,loop:B=!1}){this.audioContext=a,this.audioUrl=_,this.onPlay=b,this.onEnded=x,this.loop=B,this.currentAudioPlaying=null,this.startTime=0,this.startOffset=0,this.isPaused=!1,this.playAudio()}async playAudio(){let _=await(await fetch(this.audioUrl)).arrayBuffer(),b=await this.audioContext.decodeAudioData(_);this.currentAudioPlaying=this.audioContext.createBufferSource(),this.currentAudioPlaying.buffer=b,this.currentAudioPlaying.connect(this.audioContext.destination),this.currentAudioPlaying.loop=this.loop,this.startTime=this.audioContext.currentTime,this.currentAudioPlaying.start(0,this.startOffset%b.duration),typeof this.onPlay=="function"&&this.onPlay(),this.currentAudioPlaying.onended=()=>{if(typeof this.onEnded=="function"){if(this.isPaused)return;this.onEnded()}}}pauseAudio(){this.isPaused=!0,this.currentAudioPlaying&&(console.log("pause"),this.currentAudioPlaying.stop(),this.startOffset+=this.audioContext.currentTime-this.startTime,this.currentAudioPlaying=null)}resumeAudio(){this.isPaused=!1,this.playAudio()}stopAudio(){this.currentAudioPlaying&&(this.currentAudioPlaying.stop(),this.currentAudioPlaying=null)}}const Un="/sounds/debugFlights.mp3";class Kn{constructor({anims:a,pageEl:_,discussion:b,emitter:x}){this.unbindEvent=null,this.emitter=x,this.pageEl=_,this.discussion=b,this.phoneContainer=this.pageEl.querySelector(".phone__container"),this.phoneBtn=this.pageEl.querySelector(".phone-btn"),this.infoText=this.phoneContainer.querySelector(".phone__info.active"),this.pauseBtn=this.phoneContainer.querySelector(".phone__pause"),this.closeBtn=this.phoneContainer.querySelector(".phone__close"),this.phoneDebugContainer=this.pageEl.querySelector(".phone__debug"),this.btnToConnected=this.pageEl.querySelector("#btn-toConnected"),this.btnToTalkToMe=this.pageEl.querySelector("#btn-toTalkToMe"),this.btnToListening=this.pageEl.querySelector("#btn-toListening"),this.btnFinishTalk=this.pageEl.querySelector("#btn-finishTalk"),this.btnFinishProcessing=this.pageEl.querySelector("#btn-finishProcessing"),this.anims=a,this.isActive=!1,this.audioContext=null,this.audioConnected=null,this.audioProcessing=null,this.currentAudioAIPlaying=null,this.currentIndexAudioAI=null,this.audiosAI=[],this.isAITalking=!1,this.isAIPaused=!1,this.isStreamEnded=!1,this.emitter.on("endStream",()=>{console.log("stream end /////// "),this.isStreamEnded=!0}),this.isConnected=!1,this.myvad=null,this.isListening=!1,this.isMicMuted=!1,this.micAccessConfirmed=!1,this.phoneAnimations=new $n({pageEl:this.pageEl}),this.onClickOutside={interrupt:!1,resumeAI:!1,unmuteMic:!1},this.addListeners(),this.debug=!1,this.debugFlights=!1,this.debug&&(this.phoneDebugContainer.classList.add("show"),this.anims.toStartPhoneRecording(),this.startConnecting())}startConnecting(){this.phoneAnimations.toConnecting(),console.log("connecting"),this.phoneAnimations.newInfoText("connecting")}connected(){this.phoneAnimations.toConnected(),this.phoneAnimations.newInfoText("connected"),console.log("connected"),!this.debug&&(this.audioConnected=new Ua({audioUrl:"/sounds/connected.mp3",audioContext:this.audioContext}),setTimeout(()=>{this.isConnected=!0,this.toTalkToMe()},1500))}leave(){var a;console.log("leave"),(a=this.audioProcessing)==null||a.stopAudio(),this.unbindEvent(),this.unbindEvent=null,this.isActive=!1,this.phoneAnimations.leave(),this.stopRecording(),this.stopAITalking()}toTalkToMe(){this.isActive&&(console.log("Talk to me"),this.unbindEvent||(this.unbindEvent=this.emitter.on("addAIText",a=>this.startAITalking(a))),this.isStreamEnded=!1,this.phoneAnimations.toTalkToMe(),this.phoneAnimations.newInfoText("Talk to me"),this.myvad&&this.myvad.start())}toListening(){this.isListening||this.phoneAnimations.toListening(),this.isListening=!0,console.log("I'm listening"),this.phoneAnimations.newInfoText("I'm listening")}async toProcessing(a){if(this.phoneAnimations.newInfoText("processing"),this.phoneAnimations.toProcessing(),console.log("processing"),this.debug){this.discussion.addUserElement({text:"Hi I am a test",debug:!0});return}if(this.myvad.pause(),this.audioProcessing=new Ua({audioUrl:"/sounds/processing.mp3",audioContext:this.audioContext,loop:!0}),!a)return;const _=Fn(a,16e3);this.textRecorded=await T0(_),this.discussion.addUserElement({text:this.textRecorded})}onPlay(){this.isAITalking||(this.phoneAnimations.newInfoText("Click to interrupt"),this.phoneAnimations.toAITalking()),this.isAITalking=!0,this.onClickOutside.interrupt=!0}async startAITalking(a){var b;if(!this.isActive)return;if(console.log("new AIAnswer"),this.debug){this.onPlay();return}const _=await Yn(Vn(a));this.audiosAI.push(_),this.currentIndexAudioAI===null&&(console.log("first sound"),(b=this.audioProcessing)==null||b.stopAudio(),this.currentIndexAudioAI=0,this.currentAudioAIPlaying=new Ua({audioUrl:this.audiosAI[this.currentIndexAudioAI].src,audioContext:this.audioContext,onPlay:this.onPlay.bind(this),onEnded:this.checkIfNextAudio.bind(this)})),this.audiosAI[this.currentIndexAudioAI].onplay=()=>{}}async checkIfNextAudio(){this.isActive&&(this.audiosAI[this.currentIndexAudioAI+1]?(this.currentIndexAudioAI++,console.log("Stil one sound"),this.currentAudioAIPlaying=new Ua({audioUrl:this.audiosAI[this.currentIndexAudioAI].src,audioContext:this.audioContext,onPlay:this.onPlay.bind(this),onEnded:this.checkIfNextAudio.bind(this)})):(this.clearAIAudios(),this.isAITalking=!1,this.isStreamEnded?(console.log("all sounds plaid",this.isStreamEnded),this.toTalkToMe()):this.toProcessing()))}clearAIAudios(){this.currentIndexAudioAI=null,this.audiosAI=[],this.onClickOutside.interrupt=!1}stopAITalking(){var a;console.log("stop talking"),(a=this.currentAudioAIPlaying)==null||a.pauseAudio(),this.currentAudioAIPlaying=null,this.isAITalking=!1,this.clearAIAudios()}interrupt(){this.stopAITalking(),this.toTalkToMe()}async startRecording(){if(this.isActive=!0,this.micAccessConfirmed?this.toTalkToMe():this.startConnecting(),this.myvad||(this.myvad=await vad.MicVAD.new({onFrameProcessed:a=>{this.micAccessConfirmed||(this.micAccessConfirmed=!0,this.connected())},onSpeechStart:()=>{this.isConnected&&this.toListening()},onSpeechEnd:a=>{this.debugFlights||(this.isListening=!1,this.toProcessing(a))},redemptionFrames:10*1.4})),this.debugFlights&&setTimeout(()=>{this.myvad.pause();const a=new Audio;a.src=Un,this.toProcessing(a)},2500),this.debug){this.myvad.pause();return}this.myvad.start()}stopRecording(){this.myvad.pause(),this.myvad.stream.getTracks().forEach(a=>{a.stop()}),this.myvad=null}async onCompleteRecording(a){this.isRecordCanceled||(this.textRecorded=await T0(a),this.timeoutTranscripting=setTimeout(()=>{this.onCompleteTranscripting()},this.minTranscriptingTime))}pauseAI(){var a;this.isAIPaused=!0,this.phoneAnimations.newInfoText("Click to resume"),this.phoneAnimations.toPause("AI"),this.pauseBtn.classList.add("active"),this.onClickOutside.interrupt=!1,this.onClickOutside.resumeAI=!0,!this.debug&&((a=this.currentAudioAIPlaying)==null||a.pauseAudio())}resumeAI(){var a;this.isAIPaused=!1,this.phoneAnimations.toResume("AI"),this.pauseBtn.classList.remove("active"),(a=this.currentAudioAIPlaying)==null||a.resumeAudio(),this.onClickOutside.resumeAI=!1}muteMic(){this.isMicMuted=!0,this.phoneAnimations.toPause("user"),this.phoneAnimations.newInfoText("Click to resume"),console.log("mute mic"),this.pauseBtn.classList.add("active"),this.onClickOutside.unmuteMic=!0,!this.debug&&this.myvad.pause()}unmuteMic(){this.isMicMuted=!1,console.log("unmute mic"),this.phoneAnimations.toResume("user"),this.phoneAnimations.newInfoText("Start talking"),this.pauseBtn.classList.remove("active"),this.onClickOutside.unmuteMic=!1,!this.debug&&this.myvad.start()}addListeners(){this.phoneBtn.addEventListener("click",async()=>{if(this.audioContext=Gn(),this.anims.toStartPhoneRecording(),this.debug){this.startConnecting();return}this.startRecording()}),this.closeBtn.addEventListener("click",async()=>{this.anims.toStopPhoneRecording(),this.leave()}),this.pauseBtn.addEventListener("click",async()=>{this.isAITalking?this.isAIPaused?this.resumeAI():this.pauseAI():this.isMicMuted?this.unmuteMic():this.muteMic()}),this.pageEl.addEventListener("click",a=>{this.pauseBtn.contains(a.target)||this.closeBtn.contains(a.target)||(this.onClickOutside.resumeAI&&this.resumeAI(),this.onClickOutside.unmuteMic&&this.unmuteMic(),this.onClickOutside.interrupt&&(console.log("interrupt"),this.interrupt()))},{capture:!0}),this.btnToConnected.addEventListener("click",()=>{this.isActive=!0,this.connected()}),this.btnToTalkToMe.addEventListener("click",()=>{this.toTalkToMe()}),this.btnToListening.addEventListener("click",()=>{this.toListening()}),this.btnFinishTalk.addEventListener("click",()=>{this.toProcessing()}),this.btnFinishProcessing.addEventListener("click",()=>{})}}class M0{constructor({text:a,container:_,backgroundColor:b,marginLeft:x}){this.text=a,this.container=_,this.backgroundColor=b,this.marginLeft=x,this.init()}init(){this.typingContainer=document.createElement("div"),this.maskEl=document.createElement("div"),this.cursorEl=document.createElement("span"),this.textEl=document.createElement("p"),this.typingContainer.classList.add("typing__container"),this.maskEl.classList.add("typing__mask"),this.cursorEl.classList.add("typing__cursor"),this.textEl.classList.add("typing__text"),this.textEl.textContent=this.text,this.maskEl.style.backgroundColor=this.backgroundColor,this.typingContainer.style.left=`${this.marginLeft}px`,this.maskEl.appendChild(this.cursorEl),this.textEl.appendChild(this.maskEl),this.typingContainer.appendChild(this.textEl),this.container.appendChild(this.typingContainer),this.translateCursor=null}updateText(a){this.textEl.textContent=a,this.textEl.appendChild(this.maskEl)}blink(){this.typingContainer.style.visibility="visible",this.typingContainer.style.opacity=1,this.blinkCursor=Ie(this.cursorEl,[{opacity:1},{opacity:0},{opacity:1}],{duration:300,iterations:1/0,ease:"ease-in-out"})}fadeOut(){this.blinkCursor&&this.blinkCursor.cancel(),this.cursorEl.classList.add("hidden")}writing(){return new Promise(a=>{this.blinkCursor&&this.blinkCursor.cancel(),this.animShowtyping=Ie(this.typingContainer,[{opacity:0,visibility:"visible"},{opacity:1,visibility:"visible"}],{duration:700,fill:"forwards",ease:"ease-in-out"}),this.translateCursor=Ie(this.maskEl,[{transform:"translateX(0%)"},{transform:"translateX(105%)"}],{delay:this.animShowtyping.effect.getComputedTiming().duration,duration:200,fill:"forwards",ease:"ease-in-out"}),this.translateCursor.onfinish=()=>{a()}})}reverse(){return new Promise(a=>{this.translateCursor.reverse(),Ie(this.typingContainer,[{opacity:1,visibility:"visible"},{opacity:0,visibility:"hidden"}],{delay:200,duration:1,fill:"forwards",ease:"ease-in-out"}).onfinish=()=>{a()}})}}function mi(p){return(p<10?"0":"")+p}const Zn="820px";function Za(){return window.innerWidth<=parseInt(Zn)}class Wn{constructor(a){this.callbacks=a,this.gumStream=null,this.recorder=null,this.input=null,this.audioContext=null,this.encodingType="mp3"}startRecording(){const a={audio:!0,video:!1};this.audioContext=new(window.AudioContext||window.webkitAudioContext),navigator.mediaDevices.getUserMedia(a).then(_=>{this.gumStream=_,this.input=this.audioContext.createMediaStreamSource(_),this.recorder=new WebAudioRecorder(this.input,{workerDir:"./libAudioRecorder/",encoding:this.encodingType,numChannels:2,onEncoderLoading:(b,x)=>{},onEncoderLoaded:(b,x)=>{}}),this.recorder.onComplete=(b,x)=>{console.log("Encoding complete"),this.blob=x,this.callbacks.onComplete(x)},this.recorder.setOptions({timeLimit:120,encodeAfterRecord:!0,ogg:{quality:.5},mp3:{bitRate:160}}),this.recorder.startRecording(),console.log("Recording started")}).catch(_=>{console.log(_)})}onUpdate(a){function _(){var x;const b=((x=this.recorder)==null?void 0:x.recordingTime())|0;a(b)}this.timeInterval=window.setInterval(_.bind(this),200)}stopRecording(){this.gumStream.getAudioTracks()[0].stop(),this.recorder.finishRecording(),clearInterval(this.timeInterval),console.log("Recording stopped")}}class Qn{constructor({pageEl:a}){this.pageEl=a,this.isPageBlue=this.pageEl.classList.contains("page-blue"),this.inputEl=this.pageEl.querySelector(".input__container"),this.inputFrontEl=this.inputEl.querySelector(".input__front"),this.inputBackEl=this.inputEl.querySelector(".input__back"),this.centerBtn=this.inputFrontEl.querySelector(".center-btn"),this.frontCameraBtn=this.inputFrontEl.querySelector(".camera-btn"),this.frontMicBtn=this.inputFrontEl.querySelector(".mic-btn")||this.inputFrontEl.querySelector(".phone-btn"),this.frontCenterBtn=this.inputFrontEl.querySelector(".center-btn"),this.inputFrontHeight=this.inputFrontEl.offsetHeight,this.isPageBlue?(this.recordCounter=this.inputEl.querySelector(".record-counter"),this.infoTextEl=document.querySelector(".info-text")):(this.overlayRecordingEl=this.pageEl.querySelector(".overlay__recording"),this.recordCircle=this.overlayRecordingEl.querySelector(".circle"),this.recordCounter=this.overlayRecordingEl.querySelector(".record-counter"),this.infoTextEl=this.overlayRecordingEl.querySelector(".info-text")),this.inputText=this.inputBackEl.querySelector(".input-text"),this.inputImageContainer=this.inputEl.querySelector(".input__image--container"),this.imageDroppedContainer=this.pageEl.querySelector(".image-dropped__container"),this.phoneContainer=this.pageEl.querySelector(".phone__container"),this.pageBlue=document.querySelector(".page-blue"),this.pageGrey=document.querySelector(".page-grey"),this.cancelBtn=document.querySelector(".cancel-btn"),this.logoEl=document.querySelector(".logo__main"),this.logoMobileEl=document.querySelector(".logo__mobile"),this.categoriesListEl=document.querySelector(".categories__list--container"),this.carousselEl=document.querySelector(".caroussel__container"),this.navbarEl=document.querySelector(".nav")}fadeInButtons(a=0,_=500){Ie([this.frontMicBtn,this.frontCameraBtn,this.frontCenterBtn],[{opacity:0},{opacity:1}],{delay:a,duration:_,fill:"forwards",ease:"ease-in-out"})}fadeOutButtons(a=0,_=500){Ie([this.frontMicBtn,this.frontCameraBtn,this.frontCenterBtn],[{opacity:1},{opacity:0}],{delay:a,duration:_,fill:"forwards",ease:"ease-in-out"})}fadeInCategoriesAndCaroussel(a=0){Ie([this.categoriesListEl,this.carousselEl],[{opacity:0},{opacity:1}],{delay:a,duration:500,fill:"forwards",ease:"ease-in-out"})}fadeOutCategoriesAndCaroussel(a=0){Ie([this.categoriesListEl,this.carousselEl],[{opacity:1},{opacity:0}],{delay:a,duration:500,fill:"forwards",ease:"ease-in-out"})}fadeOutLogo(a=0){Ie(this.logoEl,[{opacity:1},{opacity:0}],{duration:a+300,fill:"forwards",ease:"ease-in-out"}),Ie(this.logoMobileEl,[{opacity:0},{opacity:1}],{delay:a+300,duration:300,fill:"forwards",ease:"ease-in-out"})}fadeInLogo(a=0){Ie(this.logoEl,[{opacity:0},{opacity:1}],{delay:a,duration:300,fill:"forwards",ease:"ease-in-out"}),Ie(this.logoMobileEl,[{opacity:1},{opacity:0}],{delay:a,duration:300,fill:"forwards",ease:"ease-in-out"})}collapseHeightInputFront({delay:a=0,duration:_=400}={}){return Ie(this.inputFrontEl,[{height:"110px"},{height:`${this.inputFrontHeight}px`}],{delay:a,duration:_,fill:"forwards",ease:"ease-in-out"})}expandHeightInputFront({delay:a=0,duration:_=250,heighTarget:b=110}={}){return Ie(this.inputFrontEl,[{height:`${this.inputFrontHeight}px`},{height:`${b}px`}],{delay:a,duration:_,fill:"forwards",ease:"ease-in-out"})}expandWidthInputFront({delay:a=0,duration:_=400}={}){return Ie(this.inputFrontEl,[{width:`${this.inputFrontHeight}px`},{width:"100%"}],{delay:a,duration:_,ease:"ease-in-out",fill:"forwards"})}fadeInInputFront({delay:a=0,duration:_=400}={}){return Ie(this.inputFrontEl,[{opacity:0},{opacity:1}],{delay:a,duration:_,ease:"ease-in-out",fill:"forwards"})}toInitial({delay:a=0,animButtons:_=!0,animBottom:b=!0,animLogo:x=!0}={}){this.inputFrontEl.style.pointerEvents="auto",this.inputBackEl.style.pointerEvents="none",this.collapseHeightInputFront({duration:250}),Ie(this.inputBackEl,[{opacity:1},{opacity:0}],{delay:a,duration:100,fill:"forwards",ease:"ease-in-out"}),_&&this.fadeInButtons(a),b&&this.fadeInCategoriesAndCaroussel(a),x&&this.fadeInLogo(a+300)}fromRecordAudioToInitial(){this.inputFrontEl.style.pointerEvents="auto",this.inputBackEl.style.pointerEvents="none",this.fadeInButtons(1e3),this.fadeInCategoriesAndCaroussel(1e3),this.fadeInLogo(1e3)}toWrite({delay:a=0,animButtons:_=!0,animLogos:b=!0,placeholder:x=""}={}){this.inputText.placeholder=x,this.inputFrontEl.style.pointerEvents="none",this.inputBackEl.style.pointerEvents="auto",this.inputEl.style.overflow="hidden",b&&this.fadeOutLogo(),this.expandHeightInputFront({delay:a,duration:250}),_&&(this.fadeOutButtons(a,100),this.fadeOutCategoriesAndCaroussel(a)),Ie(this.inputBackEl,[{opacity:0},{opacity:1}],{delay:a,duration:500,delay:a?a+400:400,fill:"forwards",ease:"ease-in-out"}),Za()&&!this.isPageBlue?this.inputText.click():(this.inputText.focus(),this.inputText.setSelectionRange(this.inputText.value.length,this.inputText.value.length))}toStartRecorginBluePage(){this.inputEl.style.overflow="unset",this.fadeOutLogo(),this.fadeOutCategoriesAndCaroussel();const a=Ie(this.inputFrontEl,[{width:`${this.inputFrontHeight}px`,offset:.45},{width:`${this.inputFrontHeight}px`,offset:1}],{duration:600,fill:"forwards",ease:"ease-out"}),_=Ie(this.inputFrontEl,[{transform:"translate3d(-50%, -50%, 0) scale(1)",offset:0},{transform:"translate3d(-50%, -50%, 0) scale(3.5)",offset:1}],{delay:a.effect.getComputedTiming().duration-300,duration:400,fill:"forwards",ease:"ease-in"});this.animCircleYoyo=Ie(this.inputFrontEl,[{transform:"translate3d(-50%, -50%, 0) scale(3.5)"},{transform:"translate3d(-50%, -50%, 0) scale(2.4)"},{transform:"translate3d(-50%, -50%, 0) scale(3.5)"}],{delay:a.effect.getComputedTiming().duration+_.effect.getComputedTiming().duration-300,duration:800,iterations:1/0,ease:"ease-in-out"}),Ie([this.recordCounter,this.infoTextEl],[{opacity:0,visibility:"visible"},{opacity:1,visibility:"visible"}],{delay:a.effect.getComputedTiming().duration,duration:700,fill:"forwards",ease:"ease-in-out"})}toStartRecordingGreyPage(){this.overlayRecordingEl.classList.add("show"),this.inputEl.classList.add("hidden"),this.animCircleYoyo=Ie(this.recordCircle,[{transform:"translate3d(-50%, -50%, 0) scale(1.3)"},{transform:"translate3d(-50%, -50%, 0) scale(1)"},{transform:"translate3d(-50%, -50%, 0) scale(1.3)"}],{duration:800,iterations:1/0,ease:"ease-in-out"}),Ie([this.recordCounter,this.infoTextEl],[{opacity:0,visibility:"visible"},{opacity:1,visibility:"visible"}],{duration:700,fill:"forwards",ease:"ease-in-out"})}toStartRecording(){this.cancelBtn.classList.add("show"),this.navbarEl.classList.add("hidden"),this.fadeOutButtons(0,100),this.inputEl.style.pointerEvents="none",this.isPageBlue?this.toStartRecorginBluePage():this.toStartRecordingGreyPage()}toStopRecording(a){if(this.cancelBtn.classList.remove("show"),this.navbarEl.classList.remove("hidden"),this.inputEl.style.pointerEvents="unset",this.animCircleYoyo.cancel(),this.isPageBlue){Ie([this.recordCounter,this.infoTextEl],[{opacity:1,visibility:"visible"},{opacity:0,visibility:"visible"}],{duration:300,fill:"forwards",ease:"ease-in-out"});const _=Ie(this.inputFrontEl,[{transform:"translate3d(-50%, -50%, 0) scale(3)"},{transform:"translate3d(-50%, -50%, 0) scale(1)"}],{duration:300,ease:"ease-in-out",fill:"forwards"}),b=this.expandWidthInputFront({delay:_.effect.getComputedTiming().duration+500,duration:250});a!=null&&a.onComplete&&(b.onfinish=a.onComplete)}else this.overlayRecordingEl.classList.remove("show"),this.inputEl.classList.remove("hidden"),a!=null&&a.onComplete&&a.onComplete()}toStartPhoneRecording(){this.inputEl.classList.add("hidden"),this.phoneContainer.classList.add("show")}toStopPhoneRecording(){const a=Ie(this.phoneContainer,[{opacity:1,transform:"translateY(0px)"},{topacity:0,transform:"translateY(100%)"}],{duration:300,ease:"ease-in-out",fill:"forwards"});a.onfinish=()=>{const _=Ie(this.inputEl,[{opacity:0,transform:"translateY(100%)"},{topacity:1,transform:"translateY(0)"}],{duration:300,ease:"ease-in-out",fill:"forwards"});a.cancel(),this.inputEl.classList.remove("hidden"),this.phoneContainer.classList.remove("show"),_.onfinish=()=>{_.cancel()}}}toDragImage({animBottom:a=!0,delay:_=0}={}){this.imageDroppedContainer.classList.remove("visible"),setTimeout(()=>{this.frontCameraBtn.classList.add("active-imagedrop"),this.inputImageContainer.classList.add("show")},_),a&&this.fadeOutCategoriesAndCaroussel(0,500)}leaveDragImage({animBottom:a=!0}={}){this.frontCameraBtn.classList.remove("active-imagedrop"),this.inputImageContainer.classList.remove("show"),this.fadeInButtons(),a&&this.fadeInCategoriesAndCaroussel(0,500)}toImageDroped(){this.inputImageContainer.classList.remove("show"),this.fadeOutButtons(0,0);const a=Ie(this.inputFrontEl,[{width:`${this.inputFrontHeight}px`,offset:.45},{width:`${this.inputFrontHeight}px`,offset:1}],{duration:800,fill:"forwards",ease:"ease-out"});this.animCircleYoyo=Ie(this.inputFrontEl,[{opacity:1},{opacity:0},{opacity:1}],{delay:a.effect.getComputedTiming().duration,duration:400,iterations:1/0,ease:"ease-in-out"})}toImageAnalyzed(){this.cancelBtn.classList.add("show"),this.navbarEl.classList.add("hidden"),this.animCircleYoyo.cancel();const a=this.fadeInInputFront({delay:0,duration:300});this.expandWidthInputFront({delay:a.effect.getComputedTiming().duration+500,duration:250}),this.toWrite({delay:1200,animButtons:!1,animLogos:!1,placeholder:"Ask a question about the image"}),this.imageDroppedContainer.classList.add("visible")}toRemoveImage(){this.imageDroppedContainer.classList.remove("visible"),this.cancelBtn.classList.remove("show"),this.navbarEl.classList.remove("hidden"),this.toInitial({animLogo:!1})}toImageReset(){this.animCircleYoyo.cancel(),this.fadeInButtons(300,delay);const a=this.fadeInInputFront({delay:0,duration:300}),_=this.expandWidthInputFront({delay:a.effect.getComputedTiming().duration+500,duration:250});this.fadeInButtons(a.effect.getComputedTiming().duration+_.effect.getComputedTiming().duration+500,0)}}const qt={INITIAL:"INITIAL",RECORD_AUDIO:"RECORD_AUDIO",UPLOAD_IMAGE:"UPLOAD_IMAGE",WRITE:"WRITE"};class fi{constructor({pageEl:a,isActive:_,toPageGrey:b,discussion:x,emitter:B}){this.isActive=_,this.toPageGrey=b,this.discussion=x,this.emitter=B,this.pageEl=a,this.inputEl=this.pageEl.querySelector(".input__container"),this.inputFrontEl=this.inputEl.querySelector(".input__front"),this.inputBackEl=this.inputEl.querySelector(".input__back"),this.submitBtn=this.inputBackEl.querySelector(".submit"),this.centerBtn=this.inputFrontEl.querySelector(".center-btn"),this.frontCameraBtn=this.inputFrontEl.querySelector(".camera-btn"),this.frontMicBtn=this.inputFrontEl.querySelector(".mic-btn"),this.frontCenterBtn=this.inputFrontEl.querySelector(".center-btn"),this.backCameraBtn=this.inputBackEl.querySelector(".camera-btn"),this.closeInputImageBtn=this.pageEl.querySelector(".input__image--closeBtn"),this.currentImage=null,this.inputImageEl=this.pageEl.querySelector(".input__image"),this.audioRecorder=new Wn({onComplete:this.onCompleteRecording.bind(this)}),this.isRecordCanceled=!1,this.recordCounter=this.pageEl.querySelector(".record-counter"),this.backMicBtnContainer=this.inputBackEl.querySelector(".mic-btn__container"),this.backMicBtn=this.backMicBtnContainer.querySelector(".mic-btn"),this.backMicText=this.backMicBtnContainer.querySelector("p"),this.isSmallRecording=!1,this.inputText=this.inputBackEl.querySelector(".input-text"),this.cancelBtn=document.body.querySelector(".cancel-btn"),this.navbarEl=document.querySelector(".nav"),this.onClickOutside={stopAudio:!1,animInitial:!1},this.currentStatus=qt.INITIAL,this.isPageBlue=this.pageEl.classList.contains("page-blue"),this.anims=new Qn({pageEl:this.pageEl}),this.inputImage=new Yi({reset:()=>this.anims.toImageReset(),toImageDroped:()=>this.anims.toImageDroped(),toImageAnalyzed:()=>this.anims.toImageAnalyzed()},{onImageUploaded:E=>{this.currentImage=E}},this.pageEl),this.isPageBlue||(this.phone=new Kn({pageEl:this.pageEl,discussion:this.discussion,emitter:this.emitter,anims:{toStartPhoneRecording:()=>this.anims.toStartPhoneRecording(),toStopPhoneRecording:()=>this.anims.toStopPhoneRecording()}})),this.addListeners(),this.minTranscriptingTime=1400,this.textRecorded="text recorded",this.isPageBlue}toWrite({delay:a=0,animButtons:_=!0,animLogos:b=!0}={}){this.currentStatus=qt.WRITE,this.anims.toWrite({delay:a,animButtons:_,animLogos:b}),this.onClickOutside.animInitial=!0}startRecording(){this.isRecordCanceled=!1,this.inputText.disabled=!0,this.audioRecorder.startRecording(),this.timecodeAudioEl=this.isSmallRecording?this.backMicText:this.recordCounter,this.audioRecorder.onUpdate(a=>{const _=mi(a/60|0)+":"+mi(a%60);this.timecodeAudioEl.textContent=_})}stopRecording(){this.audioRecorder.stopRecording()}onTranscripting(){this.typingText=new M0({text:"Converting to text",container:this.inputFrontEl,backgroundColor:x0,marginLeft:16}),this.typingText.writing({onComplete:this.typingText.blink})}onCompleteTranscripting(){if(this.inputText.disabled=!1,this.timecodeAudioEl.textContent="00:00",this.inputText.value+=this.textRecorded,this.updateInputHeight(),this.isSmallRecording){this.isSmallRecording=!1,this.inputText.focus(),this.inputText.setSelectionRange(this.inputText.value.length,this.inputText.value.length);return}this.typingText&&this.typingText.reverse(),this.toWrite({delay:1200,animButtons:!1,animLogos:!1})}async onCompleteRecording(a){this.isRecordCanceled||(this.textRecorded=await T0(a),this.timeoutTranscripting=setTimeout(()=>{this.onCompleteTranscripting()},this.minTranscriptingTime))}cancelRecord(){this.isRecordCanceled=!0,this.onClickOutside.stopAudio=!1,this.stopRecording(),this.anims.toStopRecording(),this.anims.fromRecordAudioToInitial()}onSubmit(a){a.preventDefault(),this.isPageBlue&&this.toPageGrey({duration:1200}),this.discussion.addUserElement({text:this.inputText.value,img:this.currentImage}),this.inputText.value="",this.currentImage=null,this.updateInputHeight(),this.cancelBtn.classList.remove("show"),this.navbarEl.classList.remove("hidden"),this.goToInitial()}updateInputHeight(){const a=new Event("input",{bubbles:!0,cancelable:!0});this.inputText.dispatchEvent(a)}goToInitial(){this.currentStatus=qt.INITIAL,this.anims.toInitial(),this.onClickOutside.animInitial=!1,this.inputText.disabled=!1}addListeners(){this.centerBtn.addEventListener("click",()=>{this.toWrite()}),document.addEventListener("keydown",()=>{this.isActive&&this.currentStatus!==qt.WRITE&&!this.inputText.disabled&&this.toWrite()},{capture:!0}),this.frontMicBtn&&this.frontMicBtn.addEventListener("click",()=>{this.currentStatus=qt.RECORD_AUDIO,this.startRecording(),this.anims.toStartRecording(),this.onClickOutside.stopAudio=!0}),this.cancelBtn.addEventListener("click",()=>{this.currentStatus===qt.RECORD_AUDIO&&this.cancelRecord(),this.currentStatus===qt.UPLOAD_IMAGE&&(this.anims.toRemoveImage(),this.inputImage.disable(),this.currentImage=null),this.currentStatus=qt.INITIAL}),this.backMicBtn.addEventListener("click",()=>{this.isSmallRecording?(this.stopRecording(),this.backMicBtnContainer.classList.remove("active")):(this.isSmallRecording=!0,this.startRecording(),this.backMicBtnContainer.classList.add("active"))}),this.frontCameraBtn.addEventListener("click",()=>{this.currentStatus=qt.UPLOAD_IMAGE,this.inputImage.enable(),this.anims.toDragImage()}),this.backCameraBtn.addEventListener("click",()=>{this.isSmallRecording||(this.currentStatus=qt.UPLOAD_IMAGE,this.inputImage.enable(),this.anims.toInitial({animBottom:!1,animButtons:!1}),this.anims.toDragImage({animBottom:!1,delay:300}),this.onClickOutside.animInitial=!1)}),this.closeInputImageBtn.addEventListener("click",()=>{this.currentStatus=qt.INITIAL,this.inputImage.disable(),this.anims.leaveDragImage()}),this.inputImageEl.addEventListener("focus",a=>{document.documentElement.style.overflow="unset",window.scrollTo(0,document.body.scrollHeight)}),this.inputImageEl.addEventListener("blur",a=>{document.documentElement.style.overflow="hidden",window.scrollTo(0,0)}),this.pageEl.addEventListener("click",a=>{if(!this.isSmallRecording&&!this.inputEl.contains(a.target)&&!this.cancelBtn.contains(a.target)&&(this.onClickOutside.stopAudio&&(this.stopRecording(),this.anims.toStopRecording({onComplete:this.onTranscripting.bind(this)}),this.onClickOutside.stopAudio=!1),this.onClickOutside.animInitial)){if(this.inputText.value)return;this.goToInitial()}},{capture:!0}),this.inputText.addEventListener("focus",()=>{this.submitBtn.disabled=!this.inputText.value.trim().length>0}),this.inputText.addEventListener("keyup",a=>{this.submitBtn.disabled=!this.inputText.value.trim().length>0}),this.inputText.addEventListener("keydown",a=>{this.inputText.value.trim().length>0&&a.key==="Enter"&&!a.shiftKey&&this.onSubmit(a)}),this.submitBtn.addEventListener("click",a=>this.onSubmit(a))}}class jn{constructor(){this.navEl=document.querySelector(".nav"),this.navBtn=this.navEl.querySelector(".nav__btn"),this.navList=this.navEl.querySelector(".nav__list"),this.addListeners()}addListeners(){this.navBtn.addEventListener("click",()=>{this.navList.classList.toggle("show")}),this.navEl.addEventListener("mouseenter",()=>{Za()||this.navList.classList.add("show")}),this.navEl.addEventListener("mouseleave",()=>{Za()||this.navList.classList.remove("show")})}}let La=0;function zn(p,a){return new Promise(_=>{if(Za()){p.innerHTML=a,_();return}function b(){La<a.length?(a.charAt(La)===`
`?p.innerHTML+="<br>":p.innerHTML+=a.charAt(La),La++,setTimeout(b,10)):(La=0,_())}b()})}function Jn(p){var a=p.split(".")[1],_=a.replace(/-/g,"+").replace(/_/g,"/"),b=decodeURIComponent(window.atob(_).split("").map(function(x){return"%"+("00"+x.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(b)}let er=class{constructor(a,_,b,x){this.uuid=a,this.name=_,this.picture=b,this.email=x}};class tr{constructor(a){ra(this,"callsubmit",async(a,_,b)=>{this.container=b;var x=a;if(this.sourcelang!=this.targetlang){var B=await this.googletranslate(x,this.targetlang,this.sourcelang);x=B.data.translations[0].translatedText,B.data.translations[0].detectedSourceLanguage&&(this.sourcelang=B.data.translations[0].detectedSourceLanguage)}if(this.awaiting&&this.workflowID!="")this.submituserreply(x,this.workflowID,_);else{var E=new XMLHttpRequest;E.onreadystatechange=async()=>{if(E.readyState==4){console.log(E.response);let N=JSON.parse(E.response);console.log(N.stream_id);let H=N.stream_id;this.getstreamdata(H)}},E.addEventListener("error",async function(N){console.log("error: "+N);var H="An error occurred while attempting to connect.";await this.callbacks.addAIText({text:H,container:this.container}),this.callbacks.enableInput()}),this.sessionID&&this.sessionID!=""?(E.open("POST","https://ai.iamplus.services/workflow/conversation",!0),E.setRequestHeader("Content-Type","application/json"),E.send(JSON.stringify({session_id:this.sessionID,uuid:this.deploy_ID}))):(E.open("POST","https://ai.iamplus.services/workflow/tasks",!0),E.setRequestHeader("Content-Type","application/json"),E.send(JSON.stringify({query:x,uuid:this.user.uuid})))}});ra(this,"getstreamdata",async a=>{console.log(a);let _=await o0({servers:["wss://ai.iamplus.services/tasks:8443"],user:"acc",pass:"user@123"}),B=await(await _.jetstream().consumers.get(a,a)).consume();_.onclose=function(D){console.log("Socket is closed. Reconnect will be attempted in 1 second.",D.reason),setTimeout(async function(){console.log("Socket is closed. Reconnect will be attempted in 1 second.",D.reason),_=await o0({servers:["wss://ai.iamplus.services/tasks:8443"],user:"acc",pass:"user@123"})},1e3)},_.onerror=function(D){console.error("Socket encountered error: ",D.message,"Closing socket"),ws.close()};for await(const D of B){var E=D.json();console.log(E);var N=E.data;if(E.message_type=="ui"&&(this.domain=E.ui_params.domain,console.log("domain:"+this.domain),this.domain=="MovieSearch"?(this.MovieSearch=JSON.parse(E.ui_params.MovieSearch),this.MovieSearchResults=JSON.parse(E.ui_params.MovieSearchResults)):this.domain=="TaxiSearch"?(this.TaxiSearch=JSON.parse(E.ui_params.TaxiSearch),this.TaxiSearchResults=JSON.parse(E.ui_params.TaxiSearchResults)):this.domain=="RAG_CHAT"?(this.RAG_CHAT=JSON.parse(E.ui_params.RAG_CHAT),console.log("domain RAG_CHAT:"+this.RAG_CHAT)):this.domain=="FlightSearch"&&(this.FlightSearch=JSON.parse(E.ui_params.FlightSearch),this.FlightSearchResults=JSON.parse(E.ui_params.FlightSearchResults))),E.awaiting&&(this.workflowID=E.session_id,this.awaiting=!0),E.awaiting&&E.message_type=="user_question"&&(this.agentawaiting=!0),E.streaming&&E.streaming==!0){var H=await this.toTitleCase2(N);if(this.sourcelang!="en"){var T=await this.googletranslate(await this.toTitleCase2(N),this.sourcelang,this.targetlang);H=T.data.translations[0].translatedText}await this.callbacks.addAIText({text:H,container:this.container}),E.stream_status&&E.stream_status=="ended"&&(this.callbacks.emitter.emit("endStream"),this.callbacks.enableInput(),await this.callbacks.addAIText({text:`

`,container:this.container}))}else if(E.status=="Agent ended"){this.workflowID="",this.awaiting=!1,this.callbacks.enableInput();return}else if(E.awaiting){console.log("awaiting:"+E.message_type),console.log("mtext:"+N),this.workflowID=E.session_id,this.awaiting=!0;var H=await this.toTitleCase2(N);if(console.log("AIAnswer:"+H),this.sourcelang!="en"){var T=await this.googletranslate(await this.toTitleCase2(N),this.sourcelang,this.targetlang);H=T.data.translations[0].translatedText}await this.callbacks.addAIText({text:H,container:this.container}),this.callbacks.emitter.emit("endStream"),this.domain=="RAG_CHAT"?(console.log("here RAG_CHAT:"+this.RAG_CHAT),this.getGucciUI(),this.domain="",this.RAG_CHAT=""):this.domain=="MovieSearch"&&(this.getMovies(),this.domain="",this.MovieSearchResults="",this.MovieSearch=""),this.callbacks.enableInput()}else if(E.status=="central finished")this.domain=="MovieSearch"?(this.getMovies(),this.domain="",this.MovieSearchResults="",this.MovieSearch=""):this.domain=="TaxiSearch"?(this.getTaxiUI(),this.TaxiSearchResults="",this.TaxiSearch="",this.domain=""):this.domain=="FlightSearch"&&(this.getFlightUI(),this.FlightSearch="",this.domain="",this.FlightSearchResults="");else if(E.message_type=="status"&&N!=""){var H=await this.toTitleCase2(N);if(this.sourcelang!="en"){var T=await this.googletranslate(H,this.sourcelang,this.targetlang);H=T.data.translations[0].translatedText}H+=`

`,await this.callbacks.addAIText({text:H,container:this.container,type:"status"})}D.ack()}_.drain()});ra(this,"getdevstream",a=>new Promise(async(_,b)=>{let x=await o0({servers:["wss://ai.iamplus.services/tasks:8443"],user:"acc",pass:"user@123"});const B=await x.jetstreamManager(),E={name:a,subjects:["DEV_STREAM"]};await B.streams.add(E),console.log("created the stream"),await B.consumers.add(a,{durable_name:a,ack_policy:Pi.Explicit}),l0();const N=x.jetstream();this.pushstramingdata(N),_("")}));ra(this,"translate",(a,_)=>new Promise(async(b,x)=>{var B=JSON.stringify([{text:a}]);console.log("text:"+a);var E=new XMLHttpRequest;E.addEventListener("readystatechange",function(){if(this.readyState===4){console.log(this.responseText);var N=JSON.parse(this.responseText);b(N)}}),E.open("POST","https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to="+_),E.setRequestHeader("Ocp-Apim-Subscription-Key","dd0450eaa72d4b628c901af99e551c8a"),E.setRequestHeader("Ocp-Apim-Subscription-Region","centralindia"),E.setRequestHeader("Content-Type","application/json"),E.addEventListener("error",function(N){console.log("error: "+N),x(N)}),E.send(B)}));ra(this,"googletranslate",(a,_,b)=>new Promise(async(x,B)=>{var E=new XMLHttpRequest,N="https://translation.googleapis.com/language/translate/v2",H="AIzaSyC1I58b1AR5z5V0b32ROnw55iFUjVso5dY";E.open("POST",`${N}?key=${H}`,!0),E.setRequestHeader("Content-Type","application/json"),E.onreadystatechange=function(){if(E.readyState===4&&E.status===200){console.log("google:"+E.responseText);var D=JSON.parse(E.responseText);D.data&&D.data.translations&&x(D)}else E.readyState===4&&E.status!==200&&console.error("Error:",E.responseText)};var T=JSON.stringify({q:a,target:_,source:b});E.send(T)}));this.callbacks=a,this.autodetect=null,this.targetlang="en",this.sourcelang="en",this.location="US",this.sessionID="",this.workflowID="",this.awaiting=!1,this.agentawaiting=!1,this.domain="",this.FlightSearch="",this.FlightSearchResults="",this.TaxiSearch="",this.TaxiSearchResults="",this.container=null,this.RAG_CHAT="",this.MovieSearch="",this.MovieSearchResults="",this.user=this.getUser(),this.deploy_ID=""}getUser(){if(localStorage.getItem("googleToken")){const a=Jn(localStorage.getItem("googleToken"));return new er(a.sub,a.name,a.picture,a.email)}else return null}delay(a){return new Promise(_=>{setTimeout(_,a)})}async pushstramingdata(a){const _=l0();await a.publish("DEV_STREAM",_.encode({session_id:"wf-personal_assistant-7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405-a7d3f581-8a9f-44fa-b77b-5ead185531d8",task_name:"Conversation with user",data:" Hello! It's great to hear from you.",uuid:"7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405",status:"active",message_type:"conversation_question",ui_params:{},awaiting:!0,streaming:!0,stream_status:"started"})),await a.publish("DEV_STREAM",_.encode({session_id:"wf-personal_assistant-7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405-a7d3f581-8a9f-44fa-b77b-5ead185531d8",task_name:"Conversation with user",data:" How can I assist you today?",uuid:"7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405",status:"active",message_type:"conversation_question",ui_params:{},awaiting:!0,streaming:!0,stream_status:"started"})),await a.publish("DEV_STREAM",_.encode({session_id:"wf-personal_assistant-7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405-a7d3f581-8a9f-44fa-b77b-5ead185531d8",task_name:"Conversation with user",data:" Is there anything on your mind that you'd like to talk about?",uuid:"7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405",status:"active",message_type:"conversation_question",ui_params:{},awaiting:!0,streaming:!0,stream_status:"started"})),await a.publish("DEV_STREAM",_.encode({session_id:"wf-personal_assistant-7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405-a7d3f581-8a9f-44fa-b77b-5ead185531d8",task_name:"Conversation with user",data:" ",uuid:"7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405",status:"active",message_type:"conversation_question",ui_params:{},awaiting:!0,streaming:!0,stream_status:"ended"}))}async pushlightdata(a){const _=l0();await a.publish("DEV_STREAM",_.encode({session_id:"wf-personal_assistant-7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405-a7d3f581-8a9f-44fa-b77b-5ead185531d8",task_name:"Status Push",data:`Working on it! Searching the web for the dates you need. . .
`,uuid:"7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405",status:"Status Push started",message_type:"status",ui_params:{},awaiting:!1,streaming:!1,stream_status:""})),await this.delay(4e3),await a.publish("DEV_STREAM",_.encode({session_id:"wf-personal_assistant-7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405-a7d3f581-8a9f-44fa-b77b-5ead185531d8",task_name:"Status Push",data:`Finding the date for this Thursday. Stay tuned! . .
`,uuid:"7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405",status:"Status Push started",message_type:"status",ui_params:{},awaiting:!1,streaming:!1,stream_status:""})),await this.delay(4e3),await a.publish("DEV_STREAM",_.encode({session_id:"wf-personal_assistant-7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405-a7d3f581-8a9f-44fa-b77b-5ead185531d8",task_name:"Status Push",data:`Searching for the date of the following Monday, please wait. . .
`,uuid:"7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405",status:"Status Push started",message_type:"status",ui_params:{},awaiting:!1,streaming:!1,stream_status:""})),await this.delay(4e3),await a.publish("DEV_STREAM",_.encode({session_id:"wf-personal_assistant-7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405-a7d3f581-8a9f-44fa-b77b-5ead185531d8",task_name:"Status Push",data:`Wrapping up the task, all plans executed and completed, task resolved. . .
`,uuid:"7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405",status:"Status Push started",message_type:"status",ui_params:{},awaiting:!1,streaming:!1,stream_status:""})),await this.delay(4e3),await a.publish("DEV_STREAM",_.encode({session_id:"wf-personal_assistant-7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405-a7d3f581-8a9f-44fa-b77b-5ead185531d8",task_name:"Status Push",data:`I'm currently searching for the best round-trip flights from Singapore to Bali on your preferred dates. . .
`,uuid:"7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405",status:"Status Push started",message_type:"status",ui_params:{},awaiting:!1,streaming:!1,stream_status:""})),await this.delay(4e3),await a.publish("DEV_STREAM",_.encode({session_id:"wf-personal_assistant-7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405-a7d3f581-8a9f-44fa-b77b-5ead185531d8",task_name:"Status Push",data:`Analyzing travel details for flights from Singapore to Bali on Dec 14-18, 2023. . .
`,uuid:"7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405",status:"Status Push started",message_type:"status",ui_params:{},awaiting:!1,streaming:!1,stream_status:""})),await this.delay(4e3),await a.publish("DEV_STREAM",_.encode({session_id:"wf-personal_assistant-7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405-a7d3f581-8a9f-44fa-b77b-5ead185531d8",task_name:"Status Push",data:`Finding the best flights for your Singapore-Bali trip, stay tuned! . .
`,uuid:"7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405",status:"Status Push started",message_type:"status",ui_params:{},awaiting:!1,streaming:!1,stream_status:""})),await this.delay(4e3),await a.publish("DEV_STREAM",_.encode({session_id:"wf-personal_assistant-7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405-a7d3f581-8a9f-44fa-b77b-5ead185531d8",task_name:"Search for round-trip flights from Singapore to Bali on December 14, 2023, returning on December 18, 2023, including the cheapest options",data:"",uuid:"7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405",status:"flight_search_booking_tool params and results",message_type:"ui",ui_params:{domain:"FlightSearch",FlightSearch:'{"departure_start_date": "", "departure_end_date": "2024-12-14", "departure_start_time": "", "departure_end_time": "", "return_start_date": "", "return_end_date": "2023-12-18", "return_start_time": "", "return_end_time": "", "source": "Singapore", "source_airport_name": "Changi Airport", "source_airport_code": "SIN", "destination": "Bali", "destination_airport_name": "Ngurah Rai International Airport", "destination_airport_code": "DPS", "class": "", "num_of_tickets": 1, "sort": "Price", "round_trip": "True", "preferred_airline": null}',FlightSearchResults:'{"Outbound": [], "Return": [{"website": "skyscanner", "currency": "USD", "price": "$95.0", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.skyscanner.com/transport/flights/DPS/SIN/231218/?adultsv2=1&childrenv2=&inboundaltsenabled=false&outboundaltsenabled=false&preferdirects=false&ref=home&rtn=1&cabinclass=economy", "travel_date": "18-12-2023", "travel": {"airlines": "LionAir Indonesia", "airlines_logo": "http://www.skyscanner.net/images/airlines/small/JT.png", "start_time": "13:50", "end_time": "16:25", "duration": "2h 35", "stops": 0}}, {"website": "kayak", "currency": "USD", "price": "$96.0", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.kayak.com/flights/DPS-SIN/2023-12-18/economy/1adults?fs=fdDir=true;stops=~0&sort=price_a", "travel_date": "18-12-2023", "travel": {"airlines": "KLM", "airlines_logo": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/KL.png?crop=false&width=108&height=92&fallback=default2.png&_v=c00721138846ce25f134390de9e21708", "start_time": "21:40", "end_time": "00:10", "duration": "2h 30m", "stops": 0}}, {"website": "skyscanner", "currency": "USD", "price": "$96.0", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.skyscanner.com/transport/flights/DPS/SIN/231218/?adultsv2=1&childrenv2=&inboundaltsenabled=false&outboundaltsenabled=false&preferdirects=false&ref=home&rtn=1&cabinclass=economy", "travel_date": "18-12-2023", "travel": {"airlines": "Indonesia AirAsia", "airlines_logo": "http://www.skyscanner.net/images/airlines/small/QZ.png", "start_time": "07:10", "end_time": "09:55", "duration": "2h 45", "stops": 0}}, {"website": "airasia", "currency": "USD", "price": "$96", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.airasia.com/flights/search/?origin=DPS&destination=SIN&departDate=18/12/2023&child=0&infant=0&locale=en-gb&currency=USD&airlineProfile=k,g&type=bundled&isOC=false&isDC=false&uce=false&ancillaryAbTest=true&adult=1&cabinClass=economy&tripType=O", "travel_date": "18-12-2023", "travel": {"airlines": " Batik Air", "airlines_logo": "https://static.airasia.com/flights/images/airlines/logos/64/ID.png?default=airline.png&key=0.18836108081040548_1702572090186", "start_time": "13:50", "end_time": "16:25", "duration": "2h 35m", "stops": 0}}, {"website": "skyscanner", "currency": "USD", "price": "$97.0", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.skyscanner.com/transport/flights/DPS/SIN/231218/?adultsv2=1&childrenv2=&inboundaltsenabled=false&outboundaltsenabled=false&preferdirects=false&ref=home&rtn=1&cabinclass=economy", "travel_date": "18-12-2023", "travel": {"airlines": "KLM", "airlines_logo": "http://www.skyscanner.net/images/airlines/small/KL.png", "start_time": "21:40", "end_time": "00:10", "duration": "2h 30", "stops": 0}}, {"website": "skyscanner", "currency": "USD", "price": "$97.0", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.skyscanner.com/transport/flights/DPS/SIN/231218/?adultsv2=1&childrenv2=&inboundaltsenabled=false&outboundaltsenabled=false&preferdirects=false&ref=home&rtn=1&cabinclass=economy", "travel_date": "18-12-2023", "travel": {"airlines": "Jetstar", "airlines_logo": "http://www.skyscanner.net/images/airlines/small/JQ.png", "start_time": "10:45", "end_time": "13:25", "duration": "2h 40", "stops": 0}}, {"website": "kayak", "currency": "USD", "price": "$99.0", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.kayak.com/flights/DPS-SIN/2023-12-18/economy/1adults?fs=fdDir=true;stops=~0&sort=price_a", "travel_date": "18-12-2023", "travel": {"airlines": "Indonesia AirAsia", "airlines_logo": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/QZ.png?crop=false&width=108&height=92&fallback=default1.png&_v=2b88720c140bed98f0c9fc7a63612fed", "start_time": "07:10", "end_time": "09:55", "duration": "2h 45m", "stops": 0}}, {"website": "expedia", "currency": "USD", "price": "$100.0", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.expedia.com/Flights-Search?flight-type=on&leg1=from:DPS,to:SIN,departure:12/18/2023TANYT&mode=search&passengers=adults:1,infantinlap:N&trip=oneway&sortOrder=INCREASING&sortType=CHEAPEST&options=cabinclass:economy", "travel_date": "18-12-2023", "travel": {"airlines": "Indonesia AirAsia", "airlines_logo": "https://images.trvl-media.com/media/content/expus/graphics/static_content/fusion/v0.1b/images/airlines/vector/s/QZ_sq.svg", "start_time": "07:10", "end_time": "09:55", "duration": "2h 45m ", "stops": 0}}, {"website": "kayak", "currency": "USD", "price": "$101.0", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.kayak.com/flights/DPS-SIN/2023-12-18/economy/1adults?fs=fdDir=true;stops=~0&sort=price_a", "travel_date": "18-12-2023", "travel": {"airlines": "Batik Air", "airlines_logo": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/ID.png?crop=false&width=108&height=92&fallback=default1.png&_v=8bb7f65340e1b6513de5f3e58f53a4b9", "start_time": "13:50", "end_time": "16:25", "duration": "2h 35m", "stops": 0}}, {"website": "skyscanner", "currency": "USD", "price": "$101.0", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.skyscanner.com/transport/flights/DPS/SIN/231218/?adultsv2=1&childrenv2=&inboundaltsenabled=false&outboundaltsenabled=false&preferdirects=false&ref=home&rtn=1&cabinclass=economy", "travel_date": "18-12-2023", "travel": {"airlines": "BatikAir Indonesia", "airlines_logo": "http://www.skyscanner.net/images/airlines/small/ID.png", "start_time": "13:50", "end_time": "16:25", "duration": "2h 35", "stops": 0}}, {"website": "expedia", "currency": "USD", "price": "$101.0", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.expedia.com/Flights-Search?flight-type=on&leg1=from:DPS,to:SIN,departure:12/18/2023TANYT&mode=search&passengers=adults:1,infantinlap:N&trip=oneway&sortOrder=INCREASING&sortType=CHEAPEST&options=cabinclass:economy", "travel_date": "18-12-2023", "travel": {"airlines": "Jetstar Asia", "airlines_logo": "https://images.trvl-media.com/media/content/expus/graphics/static_content/fusion/v0.1b/images/airlines/vector/s/3K_sq.svg", "start_time": "10:45", "end_time": "13:25", "duration": "2h 40m ", "stops": 0}}, {"website": "airasia", "currency": "USD", "price": "$103", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.airasia.com/flights/search/?origin=DPS&destination=SIN&departDate=18/12/2023&child=0&infant=0&locale=en-gb&currency=USD&airlineProfile=k,g&type=bundled&isOC=false&isDC=false&uce=false&ancillaryAbTest=true&adult=1&cabinClass=economy&tripType=O", "travel_date": "18-12-2023", "travel": {"airlines": " KLM Royal Dutch Airlines", "airlines_logo": "https://static.airasia.com/flights/images/airlines/logos/64/KL.png?default=airline.png&key=0.18836108081040548_1702572090186", "start_time": "21:40", "end_time": "00:10", "duration": "2h 30m", "stops": 0}}, {"website": "booking", "currency": "USD", "price": "$103.38", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://flights.booking.com/flights/DPS.AIRPORT-SIN.AIRPORT/?adults=1&children=&from=DPS.AIRPORT&to=SIN.AIRPORT&depart=2023-12-18&sort=CHEAPEST&cabinClass=ECONOMY&type=ONEWAY", "travel_date": "18-12-2023", "travel": {"airlines": "Batik Air Indonesia", "airlines_logo": "https://r-xx.bstatic.com/data/airlines_logo/ID.png", "start_time": "13:50", "end_time": "16:25", "duration": "2h 35m", "stops": 0}}, {"website": "booking", "currency": "USD", "price": "$104.17", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://flights.booking.com/flights/DPS.AIRPORT-SIN.AIRPORT/?adults=1&children=&from=DPS.AIRPORT&to=SIN.AIRPORT&depart=2023-12-18&sort=CHEAPEST&cabinClass=ECONOMY&type=ONEWAY", "travel_date": "18-12-2023", "travel": {"airlines": "KLM", "airlines_logo": "https://r-xx.bstatic.com/data/airlines_logo/KL.png", "start_time": "21:40", "end_time": "00:10", "duration": "2h 30m", "stops": 0}}, {"website": "kayak", "currency": "USD", "price": "$107.0", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.kayak.com/flights/DPS-SIN/2023-12-18/economy/1adults?fs=fdDir=true;stops=~0&sort=price_a", "travel_date": "18-12-2023", "travel": {"airlines": "Jetstar Asia", "airlines_logo": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/3K.png?crop=false&width=108&height=92&fallback=default1.png&_v=8afe46d7f75c92f0bff8ca0d36ea9be9", "start_time": "10:45", "end_time": "13:25", "duration": "2h 40m", "stops": 0}}, {"website": "airasia", "currency": "USD", "price": "$108", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.airasia.com/flights/search/?origin=DPS&destination=SIN&departDate=18/12/2023&child=0&infant=0&locale=en-gb&currency=USD&airlineProfile=k,g&type=bundled&isOC=false&isDC=false&uce=false&ancillaryAbTest=true&adult=1&cabinClass=economy&tripType=O", "travel_date": "18-12-2023", "travel": {"airlines": " Jetstar Asia Airways", "airlines_logo": "https://static.airasia.com/flights/images/airlines/logos/64/3K.png?default=airline.png&key=0.18836108081040548_1702572090186", "start_time": "10:45", "end_time": "13:25", "duration": "2h 40m", "stops": 0}}, {"website": "kayak", "currency": "USD", "price": "$109.0", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.kayak.com/flights/DPS-SIN/2023-12-18/economy/1adults?fs=fdDir=true;stops=~0&sort=price_a", "travel_date": "18-12-2023", "travel": {"airlines": "Jetstar Asia", "airlines_logo": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/3K.png?crop=false&width=108&height=92&fallback=default1.png&_v=8afe46d7f75c92f0bff8ca0d36ea9be9", "start_time": "19:25", "end_time": "22:10", "duration": "2h 45m", "stops": 0}}, {"website": "skyscanner", "currency": "USD", "price": "$110.0", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.skyscanner.com/transport/flights/DPS/SIN/231218/?adultsv2=1&childrenv2=&inboundaltsenabled=false&outboundaltsenabled=false&preferdirects=false&ref=home&rtn=1&cabinclass=economy", "travel_date": "18-12-2023", "travel": {"airlines": "Jetstar", "airlines_logo": "http://www.skyscanner.net/images/airlines/small/JQ.png", "start_time": "19:25", "end_time": "22:10", "duration": "2h 45", "stops": 0}}, {"website": "booking", "currency": "USD", "price": "$112.72", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://flights.booking.com/flights/DPS.AIRPORT-SIN.AIRPORT/?adults=1&children=&from=DPS.AIRPORT&to=SIN.AIRPORT&depart=2023-12-18&sort=CHEAPEST&cabinClass=ECONOMY&type=ONEWAY", "travel_date": "18-12-2023", "travel": {"airlines": "Jetstar Asia", "airlines_logo": "https://r-xx.bstatic.com/data/airlines_logo/3K.png", "start_time": "10:45", "end_time": "13:25", "duration": "2h 40m", "stops": 0}}, {"website": "expedia", "currency": "USD", "price": "$114.0", "airport1_code": "DPS", "airport2_code": "SIN", "airport1_name": "Ngurah Rai (Bali) International Airport", "airport2_name": "Singapore Changi International Airport", "number_of_tickets": 1, "travel_type": "Return", "cabin_type": "economy", "link_url": "https://www.expedia.com/Flights-Search?flight-type=on&leg1=from:DPS,to:SIN,departure:12/18/2023TANYT&mode=search&passengers=adults:1,infantinlap:N&trip=oneway&sortOrder=INCREASING&sortType=CHEAPEST&options=cabinclass:economy", "travel_date": "18-12-2023", "travel": {"airlines": "Jetstar Asia", "airlines_logo": "https://images.trvl-media.com/media/content/expus/graphics/static_content/fusion/v0.1b/images/airlines/vector/s/3K_sq.svg", "start_time": "19:25", "end_time": "22:10", "duration": "2h 45m ", "stops": 0}}]}'},awaiting:!1,streaming:!1,stream_status:""})),await this.delay(4e3),await a.publish("DEV_STREAM",_.encode({session_id:"wf-personal_assistant-7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405-a7d3f581-8a9f-44fa-b77b-5ead185531d8",task_name:"Status Push",data:`Finalizing the planner flow, all plans are complete. Task is resolved. . .
`,uuid:"7d5f4251-02e6-43a2-9770-17c7c13a9834_117821391875821748405",status:"Status Push started",message_type:"status",ui_params:{},awaiting:!1,streaming:!1,stream_status:""}))}toTitleCase(a){return a=a.replace(/\w\S*/g,function(_){return _.charAt(0).toUpperCase()+_.substr(1).toLowerCase()}),a=a.replaceAll(`
`,"<br>"),a}toTitleCase2(a){return a=a.replaceAll(`
`,"<br>"),a}truncate(a){var _=200;return a&&a.length>_?a.slice(0,_-1)+"&hellip;":a}submituserreply(a,_,b){var x="";b&&b.length>0?x=JSON.stringify({message_type:"user_reply",user:"User",message:{type:"text",json:{},text:a},user_data:{type:"image",url:b[0]}}):x=JSON.stringify({message_type:"user_reply",user:"User",message:{type:"text",json:{},text:a}});var B=new XMLHttpRequest;B.addEventListener("readystatechange",function(){this.readyState===4&&console.log(this.responseText)}),B.open("POST","https://ai.iamplus.services/workflow/message/"+_),B.setRequestHeader("Content-Type","application/json"),B.send(x)}getMovies(){const a=document.createElement("div"),_=document.createElement("div");_.className="moviescard-container",this.MovieSearchResults.forEach(x=>{const B=document.createElement("div");B.className="movies-card",B.setAttribute("data-info","movies-details"),B.setAttribute("data-details",JSON.stringify(x).replace(/'/g,"&#39;")),B.addEventListener("click",H=>this.showMovieDetail(H));const E=document.createElement("img");E.className="movies-image",E.setAttribute("alt",x.MovieTitle.replace(/'/g,"&#39;")),E.setAttribute("src",x.MoviePoster),B.appendChild(E);const N=document.createElement("p");N.className="movies-title",N.innerText=x.MovieTitle,B.appendChild(N),_.appendChild(B)}),a.appendChild(_);const b=document.createElement("div");b.setAttribute("id","movie-details"),a.appendChild(b),this.container.appendChild(a)}showMovieDetail(a){let _=a.target,b=_.parentElement.parentElement.parentElement.querySelector("#movie-details"),x=JSON.parse(_.parentElement.getAttribute("data-details").replace("&#39;",/'/g));x.Theatre.forEach(B=>{const E=document.createElement("div");E.className="movie-details-card";const N=document.createElement("div");N.className="movie-details-theater-header",N.innerHTML=B.Name,E.appendChild(N);const H=document.createElement("div");H.className="movie-details-dates",H.setAttribute("data-details",JSON.stringify(B).replace(/'/g,"&#39;")),this.getMoviesDateShowtime(x.MovieTitle,B,B.DateTime[0].Date,H),console.log(x.MovieTitle),E.appendChild(H),b.innerHTML="",b.appendChild(E)})}getMoviesDateShowtime(a,_,b,x){const B=document.createElement("div");B.className="movie-details-date-selector";const E=document.createElement("button");E.className="arrow left-arrow",E.innerHTML="&lt;&nbsp;&nbsp;",E.addEventListener("click",T=>this.getmovieshowtimes(T,-1,a)),_.DateTime[0].Date==b&&(E.disabled=!0),B.appendChild(E);const N=document.createElement("span");N.innerText=b,B.appendChild(N);const H=document.createElement("button");H.className="arrow right-arrow",H.innerHTML="&nbsp;&nbsp;&gt;",H.addEventListener("click",T=>this.getmovieshowtimes(T,1,a)),_.DateTime[_.DateTime.length-1].Date==b&&(H.disabled=!0),B.appendChild(H),x.appendChild(B),_.DateTime.forEach(T=>{if(T.Date==b){const D=document.createElement("div");D.className="movie-details-showtimes",T.Show.forEach(w=>{const G=document.createElement("button");G.className="movie-details-showtime",G.innerHTML=w.Time.slice(0,-3),G.addEventListener("click",$=>this.submitmovieselection(a,_.Name,T.Date,w.Time.slice(0,-3),w.BookingUrl)),D.appendChild(G)}),x.appendChild(D)}})}getmovieshowtimes(a,_,b){let x=a.target,B=x.parentElement.parentElement.parentElement.querySelector(".movie-details-dates"),E=JSON.parse(B.getAttribute("data-details").replace("&#39;",/'/g));if(_==1){const N=x.previousElementSibling.tagName==="SPAN"?x.previousElementSibling:null;let H=new Date(N.innerHTML);H.setDate(H.getDate()+1),B.innerHTML="",this.getMoviesDateShowtime(b,E,H.toISOString().slice(0,10),B)}else{const N=x.nextElementSibling.tagName==="SPAN"?x.nextElementSibling:null;let H=new Date(N.innerHTML);H.setDate(H.getDate()-1),B.innerHTML="",this.getMoviesDateShowtime(b,E,H.toISOString().slice(0,10),B)}}async submitmovieselection(a,_,b,x,B){if(a=a.replace("’","'"),this.agentawaiting){var E="book movie ticket for "+JSON.stringify({movie_name:a,theatre_name:_,movie_date:b,movie_time:x}),N=JSON.stringify({message_type:"user_reply",user:"User",message:{type:"text",json:{},text:E}}),H=new XMLHttpRequest;H.withCredentials=!0,H.addEventListener("readystatechange",function(){this.readyState===4&&console.log(this.responseText)}),H.open("POST","https://ai.iamplus.services/workflow/message/"+this.workflowID),H.setRequestHeader("Content-Type","application/json"),H.send(N),this.agentawaiting=!1}else{var E="book movie ticket for "+JSON.stringify({movie_name:a,theatre_name:_,movie_date:b,movie_time:x});console.log("texttosend:"+E),this.callsubmit(E,"",this.container)}}getTaxiUI(){const a=document.createElement("div");a.className="rides-list-wrapper";let _=this.TaxiSearchResults;for(let b=0;b<_.services.length;b++){let x=_.services[b];if(x){const B=document.createElement("div");B.className="rides-list-item",a.appendChild(B);const E=document.createElement("div");E.className="rides-list-item-header",B.appendChild(E);const N=document.createElement("figure");N.className="rides-list-item-header-logo",E.appendChild(N);const H=document.createElement("img");H.setAttribute("src","./images/logo/"+x.provider+"-logo.svg"),H.setAttribute("alt",x.provider),N.appendChild(H);const T=document.createElement("div");T.className="rides-list-item-header-info";const D=document.createElement("p");x.name.includes("TAXI_HAILING")?D.innerHTML="Taxi Hailing":D.innerHTML=x.name,T.appendChild(D);const w=document.createElement("p");w.innerHTML=x.description,T.appendChild(w);const G=document.createElement("p");if(G.innerHTML=x.seats,T.appendChild(G),x.deeplink){const q=document.createElement("a");q.setAttribute("href",x.deeplink),q.setAttribute("target","_blank"),q.innerHTML="Link",T.appendChild(q)}E.appendChild(T);const $=document.createElement("div");$.className="rides-list-item-content";const K=document.createElement("div");if(K.className="rides-list-item-content-prices",x.price)if(x.price.length>1){const q=document.createElement("span");q.innerText="$",K.appendChild(q);const U=document.createElement("span");if(U.innerText=x.price[0]+"-"+x.price[1],K.appendChild(U),b==0){const L=document.createElement("span");L.className="rides-list-item-content-sticker",L.innerText="cheapest",$.appendChild(L)}}else{const q=document.createElement("span");q.innerText="$",K.appendChild(q);const U=document.createElement("span");if(U.innerText=x.price,K.appendChild(U),b==0){const L=document.createElement("span");L.className="rides-list-item-content-sticker",L.innerText="cheapest",$.appendChild(L)}}else{const q=document.createElement("span"),U=document.createElement("span");K.appendChild(q),K.appendChild(U)}$.appendChild(K),B.appendChild($),a.appendChild(B),this.container.appendChild(a)}}}getFlightUI(){const a=document.createElement("div");if(a.className="FlightContainer Flight-Container",a.setAttribute("name","flightResult"),this.FlightSearch.departure_end_date.length>0&&this.FlightSearch.return_end_date.length>0){const b=document.createElement("div");b.className="flight-toggle-button-container",a.appendChild(b);const x=document.createElement("button");x.className="flight-toggle-button active",x.addEventListener("click",E=>this.toggleflights(E)),x.innerHTML="Outbound",x.id="Outbound",b.appendChild(x);const B=document.createElement("button");B.className="flight-toggle-button",B.addEventListener("click",E=>this.toggleflights(E)),B.id="Return",B.innerHTML="Return",b.appendChild(B)}let _=this.FlightSearchResults.Outbound;for(let b=0;b<2;b++)if(b==1&&(_=this.FlightSearchResults.Return),_.length>0){const x=document.createElement("div");x.className="flightResult",b==0&&(x.className="flightResult",x.setAttribute("id","flightResultOutbound"),a.appendChild(x)),b==1&&(x.setAttribute("id","flightResultReturn"),x.setAttribute("style","display:None"),a.appendChild(x));let B=0;_.forEach(E=>{const N=document.createElement("div");N.className="flightCard",N.setAttribute("onclick","window.open('"+E.link_url+"', '_blank');"),x.appendChild(N);const H=document.createElement("div");H.className="rowFlightCard",N.appendChild(H);const T=document.createElement("div");T.className="logoFight",H.appendChild(T);const D=document.createElement("div");T.appendChild(D);const w=document.createElement("img");w.setAttribute("src",E.travel.airlines_logo?E.travel.airlines_logo:"./images/flight.jpg"),w.setAttribute("style","height: 40px;mix-blend-mode: multiply;"),D.appendChild(w);const G=document.createElement("div");G.className="flghtCost",H.appendChild(G);const $=document.createElement("span");$.className="currency",$.innerHTML="USD",G.appendChild($);const K=document.createElement("p");K.className="big",K.innerHTML=E.price.split("$")[1],G.appendChild(K);const q=document.createElement("div");q.className="rowFlightCard",N.appendChild(q);const U=document.createElement("div");U.className="start",q.appendChild(U);const L=document.createElement("span");L.innerHTML=E.airport1_code,U.appendChild(L);const c=document.createElement("p");c.className="big",c.innerHTML=E.travel.start_time.split(`
`)[0]+(E.travel.start_time.split(`
`)[1]?'<span class="small">'+E.travel.start_time.split(`
`)[1]+"</span>":""),U.appendChild(c);const m=document.createElement("div");m.className="duration",q.appendChild(m);const y=document.createElement("p");y.className="timeHourMin",y.innerHTML=E.travel.duration.split("h")[0]+'<span style="color: rgba(0, 0, 0, 0.40);">h</span> '+E.travel.duration.substring(E.travel.duration.indexOf(" "),E.travel.duration.indexOf("m"))+'<span style="color: rgba(0, 0, 0, 0.40);">m</span>',m.appendChild(y);const e=document.createElement("div");e.className="dDirection",m.appendChild(e);let v='<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.053 15.5789L12 24L10 24L12.526 15.5789L7.166 15.5789L5.5 18.7368L4 18.7368L5 14L4 9.26316L5.5 9.26316L7.167 12.4211L12.527 12.4211L10 4L12 4L17.053 12.4211L22.5 12.4211C22.8978 12.4211 23.2794 12.5874 23.5607 12.8835C23.842 13.1796 24 13.5812 24 14C24 14.4188 23.842 14.8204 23.5607 15.1165C23.2794 15.4126 22.8978 15.5789 22.5 15.5789L17.053 15.5789Z" fill="black" fill-opacity="0.4"/></svg>';E.travel.stops==0?(v+='<svg xmlns="http://www.w3.org/2000/svg" width="152" height="28" viewBox="0 0 152 28" fill="none">',v+='<line x1="0.6" y1="13.4" x2="151.4" y2="13.4" stroke="black" stroke-opacity="0.4" stroke-width="1.2"',v+='stroke-linecap="round" stroke-dasharray="0.1 4" />',v+="</svg>"):(v+='<svg width="136" height="28" viewBox="0 0 136 28" fill="none" xmlns="http://www.w3.org/2000/svg">',v+='<line x1="0.6" y1="13.4" x2="58.4" y2="13.4" stroke="black" stroke-opacity="0.4" stroke-width="1.2" stroke-linecap="round" stroke-dasharray="0.1 4"/>',v+='<g clip-path="url(#clip0_10855_133720)">',v+='<circle cx="68" cy="14" r="3.00002" stroke="black" stroke-opacity="0.4" stroke-width="1.50001"/>',v+="</g>",v+='<line x1="77.1" y1="13.4" x2="134.9" y2="13.4" stroke="black" stroke-opacity="0.4" stroke-width="1.2" stroke-linecap="round" stroke-dasharray="0.1 4"/>',v+="<defs>",v+='<clipPath id="clip0_10855_133720">',v+='<rect width="18" height="28" fill="white" transform="translate(58.5)"/>',v+="</clipPath>",v+="</defs>",v+="</svg>"),v+='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="20" viewBox="0 0 18 20" fill="none">',v+='<circle cx="9.50002" cy="10.0001" r="3.75002" fill="black" fill-opacity="0.4" />',v+="</svg>",m.innerHTML=v;const f=document.createElement("p");f.className="dDirection",E.travel.stops==0?f.innerHTML="Direct":E.travel.stops==1?f.innerHTML=E.travel.stops+" connection":f.innerHTML=E.travel.stops+" connections",m.appendChild(f);const R=document.createElement("div");R.className="destination",q.appendChild(R);const u=document.createElement("span");u.innerHTML=E.airport2_code,R.appendChild(u);const n=document.createElement("p");if(n.className="big",n.innerHTML=E.travel.end_time.split(`
`)[0]+(E.travel.end_time.split(`
`)[1]?'<span class="small">'+E.travel.end_time.split(`
`)[1]+"</span>":""),R.appendChild(n),B==0){const h=document.createElement("div");h.className="recommand",h.innerHTML="CHEAPEST",N.appendChild(h)}const s=document.createElement("div");s.className="site",s.innerHTML=E.website,N.appendChild(s),B++})}this.container.appendChild(a)}toggleflights(a){let _=a.target;_.id=="Outbound"?(_.classList.add("active"),_.parentElement.querySelector("#Return").classList.remove("active"),_.parentElement.parentElement.querySelector("#flightResultOutbound").style.display="flex",_.parentElement.parentElement.querySelector("#flightResultReturn").style.display="none"):(_.classList.add("active"),_.parentElement.querySelector("#Outbound").classList.remove("active"),_.parentElement.parentElement.querySelector("#flightResultOutbound").style.display="none",_.parentElement.parentElement.querySelector("#flightResultReturn").style.display="flex")}getGucciUI(){const a=document.createElement("div"),_=document.createElement("div");_.className="productcard-container",a.appendChild(_),this.RAG_CHAT.forEach(x=>{const B=document.createElement("div");B.className="product-card",B.setAttribute("data-info","product-details"),B.setAttribute("data-details",JSON.stringify(x).replace(/'/g,"&#39;")),B.addEventListener("click",D=>this.showProductDetail(D)),_.appendChild(B);const E=document.createElement("img");E.className="product-image",E.setAttribute("src",x.image_url),E.setAttribute("alt",x.name),B.appendChild(E);const N=document.createElement("h3");N.className="product-name",N.innerHTML=x.name,B.appendChild(N);const H=document.createElement("p");H.className="product-price",H.innerHTML=x.price,B.appendChild(H);const T=document.createElement("div");T.className="product-overlay",B.appendChild(T)});const b=document.createElement("div");b.id="product-details",a.appendChild(b),this.container.appendChild(a)}showProductDetail(a){let _=a.target;var b=JSON.parse(_.parentElement.getAttribute("data-details")),x=_.parentElement.parentElement.parentElement.querySelector("#product-details");const B=document.createElement("div");B.className="product-details-card";const E=document.createElement("div");E.className="product-details-image",B.appendChild(E);const N=document.createElement("div");N.className="carousel",E.appendChild(N),b.image_urls.forEach(q=>{const U=document.createElement("div");U.className="carouselitem";const L=document.createElement("img");L.setAttribute("src",q),L.setAttribute("alt",b.name),U.appendChild(L),N.appendChild(U)});const H=document.createElement("div");H.className="product-details",B.appendChild(H);const T=document.createElement("h1");T.className="product-details-title",T.innerHTML=b.name,H.appendChild(T);const D=document.createElement("div");D.className="product-details-price",D.innerHTML=b.price,H.appendChild(D);const w=document.createElement("button");w.className="product-details-add-btn",H.appendChild(w);const G=document.createElement("a");G.setAttribute("href",b.link_url),G.setAttribute("target","_blank"),w.appendChild(G);const $=document.createElement("img");$.setAttribute("src","./images/buy.svg"),G.appendChild($);const K=document.createElement("p");K.className="product-details-description",K.innerHTML=b.desc.replaceAll(`
`,"<br>"),H.appendChild(K),x.innerHTML="",x.appendChild(B)}formatDateToString(a){const _=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];a=new Date(a);const x=_[a.getDay()],B=a.getDate(),E=b[a.getMonth()];return`${x}, ${B} ${E}`}}const ar=["finding","checking","searching","analyzing","scanning","finalizing","processing"],ir="searching";function sr(p){for(let a of ar)if(p.toLowerCase().includes(a))return a;return ir}class nr{constructor({toPageGrey:a,emitter:_}){this.emitter=_,this.toPageGrey=a,this.page=document.querySelector(".page-grey"),this.mainEl=this.page.querySelector("main"),this.inputText=this.page.querySelector(".input-text"),this.discussionContainer=document.querySelector(".discussion__container"),this.addUserElement=this.addUserElement.bind(this),this.currentTopStatus=null,this.lastStatus=null,this.Chat=new tr({addAIText:this.addAIText.bind(this),disableInput:this.disableInput.bind(this),enableInput:this.enableInput.bind(this),emitter:_}),this.addListeners()}disableInput(){this.inputText.disabled=!0}enableInput(){this.inputText.disabled=!1,this.inputText.focus()}getAiAnswer({text:a,img:_}){const b=document.createElement("div");b.classList.add("discussion__ai"),this.discussionContainer.appendChild(b),this.scrollToBottom(),this.typingText=new M0({text:"",container:b,backgroundColor:$0,marginLeft:16}),this.typingText.blink(),this.Chat.callsubmit(a,_,b)}addUserElement({text:a,img:_,debug:b=!1}={}){if(_){const B=document.createElement("div");B.classList.add("discussion__user"),B.appendChild(_),this.discussionContainer.appendChild(B)}const x=document.createElement("div");if(x.classList.add("discussion__user"),x.innerHTML=a.replace(/\n/g,"<br>"),this.discussionContainer.appendChild(x),this.scrollToBottom(),this.disableInput(),b){setTimeout(()=>{this.addAIText({text:"Hello test Lorem ipsum dolor sit amet consectetur adipisicing elit. Quo pariatur sapiente, aliquam velit consectetur soluta esse cupiditate alias illo deleniti earum vel! Consequuntur ipsam quisquam nemo voluptatem id molestiae, reprehenderit illum natus omnis nobis porro sit sint veniam earum sapiente dolorem eum non deserunt! Saepe nostrum reprehenderit modi voluptatem corporis culpa accusantium. Maxime fuga, aliquam laboriosam culpa ipsum, minus officiis quasi aperiam ratione, vel beatae. Repellat, iusto placeat? Architecto sequi nam ullam numquam odio. Soluta dolore quas vel quaerat doloribus, vitae explicabo assumenda sunt fugiat consequatur illo, ipsa nam quia sit! Praesentium aliquid animi ex libero necessitatibus modi voluptas! Consequatur?",container:x})},1e3);return}this.getAiAnswer({text:a,img:_})}async updateTopStatus({status:a,container:_}){this.typingStatus?(await this.typingStatus.reverse(),this.typingStatus.blink(),this.typingStatus.updateText(a),await this.typingStatus.writing(),this.typingStatus.blink()):(this.typingStatus=new M0({text:a,container:this.topStatus,backgroundColor:$0}),this.typingStatus.blink(),this.typingStatus.writing(),this.typingStatus.blink())}async addStatus({text:a,textEl:_,container:b}){const x=sr(a);this.lastStatus?b.removeChild(this.lastStatus):(this.topStatus=document.createElement("div"),this.topStatus.className="top-status",b.appendChild(this.topStatus)),x&&(x!==this.currentTopStatus||!this.currentTopStatus)&&(this.updateTopStatus({status:x,container:this.topStatus}),this.currentTopStatus=x),b.appendChild(_),this.lastStatus=_}removeStatus({container:a}){a.removeChild(this.topStatus),a.removeChild(this.lastStatus),this.typingStatus=null,this.lastStatus=null,this.currentTopStatus=null}async addAIText({text:a,container:_,type:b=null}={}){var B;this.emitter.emit("addAIText",a),(B=this.typingText)==null||B.fadeOut();const x=document.createElement("span");return b==="status"?(x.className="AIstatus",this.addStatus({text:a,textEl:x,container:_})):this.lastStatus&&this.removeStatus({container:_}),_.appendChild(x),a=a.replace(/<br\/?>\s*/g,`
`),await zn(x,a)}scrollToBottom(){this.mainEl.scrollTo({top:this.discussionContainer.scrollHeight,behavior:"smooth"})}async onLoad(){var a=window.location.search,_=new URLSearchParams(a),b=_.get("q");const x=_.get("session_id"),B=_.get("deploy_id");_.get("location")&&_.get("location")!=""&&(this.Chat.location=_.get("location")),_.get("lang")&&_.get("lang")!=""&&(this.Chat.sourcelang=_.get("lang"),this.Chat.sourcelang=="ad"&&(this.Chat.sourcelang=""),this.Chat.autodetect=!0),b&&b!=""&&this.getAiAnswer({text:""}),x&&x!=""&&(this.toPageGrey(),this.Chat.sessionID=x,this.Chat.deploy_ID=B,this.getAiAnswer({text:""}))}addListeners(){window.addEventListener("load",this.onLoad()),new ResizeObserver(this.scrollToBottom.bind(this)).observe(this.discussionContainer)}}let rr=()=>({emit(p,...a){for(let _=0,b=this.events[p]||[],x=b.length;_<x;_++)b[_](...a)},events:{},on(p,a){var _;return((_=this.events)[p]||(_[p]=[])).push(a),()=>{var b;this.events[p]=(b=this.events[p])==null?void 0:b.filter(x=>a!==x)}}});function or(p){var a=p.split(".")[1],_=a.replace(/-/g,"+").replace(/_/g,"/"),b=decodeURIComponent(window.atob(_).split("").map(function(x){return"%"+("00"+x.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(b)}class lr{constructor(a,_,b,x){this.uuid=a,this.name=_,this.picture=b,this.email=x}}class _r{constructor(){this.pageBlue=document.querySelector(".page-blue"),this.pageGrey=document.querySelector(".page-grey"),this.navbarEl=document.querySelector(".nav"),this.cancelBtn=document.querySelector(".cancel-btn"),this.emitter=rr(),this.user=this.getUser(),this.addListeners(),this.resetScroll(),this.user||this.redirectToLogin()}getUser(){if(localStorage.getItem("googleToken")){const a=or(localStorage.getItem("googleToken"));return new lr(a.sub,a.name,a.picture,a.email)}else return null}redirectToLogin(){console.log("notloggedin"),window.location.href="./login/index.html"}toPageGrey({duration:a=0}={}){this.pageBlue.style.transitionDuration=a+"ms",this.pageGrey.style.transitionDuration=a+"ms",this.pageBlue.classList.add("hidden"),this.pageGrey.classList.add("show"),this.navbarEl.classList.add("dark"),this.cancelBtn.classList.add("dark"),setTimeout(()=>{this.inputBluePage.isActive=!1,this.inputGreyPage.isActive=!0})}initApp(){this.initNavbar(),this.initCaroussel(),this.initDiscussion(),this.initInput()}initNavbar(){new jn}initCaroussel(){this.caroussel=new Xi,this.caroussel.init()}initDiscussion(){this.discussion=new nr({emitter:this.emitter,toPageGrey:this.toPageGrey.bind(this)})}initInput(){const a={discussion:this.discussion,toPageGrey:this.toPageGrey.bind(this),emitter:this.emitter};this.inputBluePage=new fi({pageEl:this.pageBlue,isActive:!0,...a}),this.inputGreyPage=new fi({pageEl:this.pageGrey,isActive:!1,...a})}resetScroll(){window.scrollTo(0,0)}addListeners(){window.addEventListener("load",()=>{document.body.classList.remove("preload")}),document.fonts.ready.then(()=>{this.initApp()})}}new _r;
