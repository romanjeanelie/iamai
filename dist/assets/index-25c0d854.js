(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();function L({element:n,expression:t=" ",append:e=!0}){const s=C(n.innerHTML.toString().trim(),t);let i="";s.forEach(r=>{r.indexOf("<br>")>-1?r.split("<br>").forEach((d,l)=>{i+=l>0?"<br>"+h(d):h(d)}):i+=h(r)}),n.innerHTML=i;const o=n.querySelectorAll("span");return e&&o.forEach(r=>{const c=r.textContent.length===1,d=r.innerHTML.trim()!=="",l=r.textContent!=="&",E=r.textContent!=="-";c&&d&&l&&E&&(r.innerHTML=`${r.textContent}&nbsp;`)}),o}function x(n){const t=[];let e=[],s=n[0].offsetTop;return n.forEach((i,o)=>{i.offsetTop===s&&e.push(i),i.offsetTop!==s&&(t.push(e),e=[],e.push(i),s=i.offsetTop),o+1===n.length&&t.push(e)}),t}function C(n,t){const e=n.split("<br>");let s=[];return e.forEach((i,o)=>{o>0&&s.push("<br>"),s=s.concat(i.split(t));let r=!1,c="";const d=[];s.forEach(l=>{!r&&(l.includes("<a")||l.includes("<strong"))&&(c="",r=!0),r&&(c+=` ${l}`),r&&(l.includes("/a>")||l.includes("/strong>"))&&(d.push(c),c=""),!r&&c===""&&d.push(l),r&&(l.includes("/a>")||l.includes("/strong>"))&&(r=!1)}),s=d}),s}function h(n){return n=n.trim(),n===""||n===" "?n:n==="<br>"?"<br>":`<span>${n}</span>`+(n.length>1?" ":"")}function T(n){let t=[],e=Math.floor(n.length/2);t.push(n[e]);for(let s=1;s<=e;s++)n[e+s]!==void 0?(t.push(n[e-s]),t.push(n[e+s])):n[e-s]!==void 0&&t.push(n[e-s]);return t}function a(n,t,e){return Array.isArray(n)?n.forEach(s=>s.animate(t,e)):n.animate(t,e)}const m="#fff",g="#648ff2";const f=["Book me a flight from Singapore to Kuala Lumpur on  flight from Singapore to Kuala Lumpur","Book me a flight from Paris to Kuala Lumpur on  flight from Singapore to Kuala Lumpur","Book me a flight from London to Kuala Lumpur on  flight from Singapore to Kuala Lumpur"];function u(n,t,e){const s=e?"translateX(0%)":`translateX(${t})`,i=e?`translateX(${t})`:"translateX(0%)";return a(n,[{color:g,transform:s,offset:0},{color:m,offset:.5},{color:m,offset:.95},{color:g,transform:i,offset:1},{opacity:1}],{duration:500,fill:"forwards",ease:"ease-in-out"})}class k{constructor(){this.carousselEl=document.querySelector(".caroussel__container"),this.carousselTextEl=this.carousselEl.querySelector(".caroussel__text"),this.nextBtn=this.carousselEl.querySelector("#btn-next"),this.prevBtn=this.carousselEl.querySelector("#btn-prev"),this.markerEl=this.carousselEl.querySelector(".caroussel__markers")}init(){this.currentIndex=0,this.startAnimIndex=0,this.isComplete=!1,this.addText(),this.createMarkers(),this.updateButtons(),this.createLines(),this.addListeners(),this.showLines()}createMarkers(){for(let t=0;t<f.length;t++){let e=document.createElement("span");e.classList.add("marker"),t===this.currentIndex&&e.classList.add("active"),this.markerEl.appendChild(e)}}addText(){this.carousselTextEl.innerHTML="",this.carousselTextEl.textContent=f[this.currentIndex]}createLines(){this.splitLines=x(L({element:this.carousselTextEl})),this.nbLines=this.splitLines.length,this.middleLineIndex=this.nbLines%2===1?Math.floor(this.nbLines/2):null,this.carousselTextEl.innerHTML="",this.linesEls=this.getLines(this.splitLines),this.linesSorted=T(this.linesEls),this.addClasses(),this.addMasks()}getLines(t){return t.map((e,s)=>{const i=e.map(r=>r.outerHTML).join(" "),o=document.createElement("div");return o.innerHTML=i,this.carousselTextEl.appendChild(o),o})}addClasses(){this.linesEls.forEach((t,e)=>{if(this.middleLineIndex!==null&&e===this.middleLineIndex)t.classList.add("caroussel__line--middle");else{const i=(e-this.middleLineIndex)%2===0?"caroussel__line--even":"caroussel__line--odd";t.classList.add("caroussel__line"),t.classList.add(i)}})}addMasks(){for(let t=0;t<this.linesSorted.length;){const e=this.linesSorted[t];if(e.classList.contains("caroussel__line--middle")){const s=document.createElement("span"),i=document.createElement("span");s.classList.add("mask","mask-left"),i.classList.add("mask","mask-right"),s.textContent="/",i.textContent="/",e.appendChild(s),e.appendChild(i),t++}else{const s=this.linesSorted[t],i=this.linesSorted[t+1],o=document.createElement("span"),r=document.createElement("span");o.classList.add("mask","mask-left"),r.classList.add("mask","mask-right"),o.textContent="/",r.textContent="/",i.appendChild(o),s.appendChild(r),t+=2}}}onHideComplete(){this.isComplete||(this.isComplete=!0,this.carousselTextEl.style.opacity=0,this.addText(),this.createLines(),this.carousselTextEl.style.opacity=1,this.updateMarkers(),this.animLines(!0))}onShowComplete(){this.startAnimIndex=0,this.isAnimating=!1}animLines(t){if(this.startAnimIndex>this.nbLines-1){this.startAnimIndex=0,t?this.onShowComplete():(this.startAnimIndex=0,this.onHideComplete());return}if(this.middleLineIndex!==null&&this.startAnimIndex===0){const e=this.linesSorted[this.startAnimIndex],s=e.querySelector(".mask-left"),i=e.querySelector(".mask-right");u(i,"100%",t);const o=u(s,"-100%",t);o.onfinish=()=>{this.startAnimIndex=1,this.animLines(t)}}else{const e=this.linesSorted[this.startAnimIndex],s=this.linesSorted[this.startAnimIndex+1],i=e.querySelector(".mask"),o=s.querySelector(".mask");u(i,"100%",t);const r=u(o,"-100%",t);r.onfinish=()=>{this.startAnimIndex+=2,this.animLines(t)}}}showLines(){this.carousselTextEl.querySelectorAll(".mask").forEach(e=>{e.classList.contains("mask-left")?e.style.transform="translateX(-100%)":e.style.transform="translateX(100%)"})}updateMarkers(){const t=this.markerEl.querySelectorAll(".marker");t.forEach(e=>e.classList.remove("active")),t[this.currentIndex].classList.add("active")}updateButtons(){this.nextBtn.disabled=this.currentIndex===f.length-1,this.prevBtn.disabled=this.currentIndex===0}prev(){this.isAnimating||(this.isAnimating=!0,this.isComplete=!1,this.currentIndex-=1,this.updateButtons(),this.animLines(!1))}next(){this.isAnimating||(this.isAnimating=!0,this.isComplete=!1,this.currentIndex+=1,this.updateButtons(),this.animLines(!1))}addListeners(){this.nextBtn.addEventListener("click",()=>{this.next()}),this.prevBtn.addEventListener("click",()=>{this.prev()})}}class S{constructor(t){this.callbacks=t,this.gumStream=null,this.recorder=null,this.input=null,this.audioContext=window.AudioContext||window.webkitAudioContext,this.encodingType="mp3"}startRecording(){console.log("startRecording() called");const t={audio:!0,video:!1};navigator.mediaDevices.getUserMedia(t).then(e=>{console.log("getUserMedia() success, stream created, initializing WebAudioRecorder..."),this.audioContext=new this.audioContext,this.gumStream=e,this.input=this.audioContext.createMediaStreamSource(e),console.log("production"),this.recorder=new WebAudioRecorder(this.input,{workerDir:"app/audios/libAudioRecorder/",encoding:this.encodingType,numChannels:2,onEncoderLoading:(s,i)=>{console.log("Loading "+i+" encoder...")},onEncoderLoaded:(s,i)=>{console.log(i+" encoder loaded")}}),this.recorder.onComplete=(s,i)=>{console.log("Encoding complete"),this.blob=i,this.createDownloadLink(i,s.encoding),this.callbacks.onComplete(i)},this.recorder.setOptions({timeLimit:120,encodeAfterRecord:!0,ogg:{quality:.5},mp3:{bitRate:160}}),this.recorder.startRecording(),console.log("Recording started")}).catch(e=>{console.log(e)})}onUpdate(t){function e(){const s=this.recorder.recordingTime()|0;t(s)}this.timeInterval=window.setInterval(e.bind(this),200)}stopRecording(){console.log("stopRecording() called"),this.gumStream.getAudioTracks()[0].stop(),this.recorder.finishRecording(),clearInterval(this.timeInterval),console.log("Recording stopped")}createDownloadLink(t,e){const s=URL.createObjectURL(t),i=document.createElement("audio"),o=document.createElement("a");i.controls=!0,i.src=s,o.href=s,o.download=new Date().toISOString()+"."+e}}function y(n){return(n<10?"0":"")+n}function p(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}class b{constructor(){this.inputEl=document.querySelector(".input-text__container"),this.inputFrontEl=this.inputEl.querySelector(".input-text__front"),this.inputBackEl=this.inputEl.querySelector(".input-text__back"),this.centerBtn=this.inputFrontEl.querySelector(".center-btn"),this.frontCameraBtn=this.inputFrontEl.querySelector(".camera-btn"),this.frontMicBtn=this.inputFrontEl.querySelector(".mic-btn"),this.frontCenterBtn=this.inputFrontEl.querySelector(".center-btn"),this.inputFrontHeight=this.inputFrontEl.offsetHeight,this.audioRecorder=new S({onComplete:this.onCompleteRecording}),this.recordCounter=this.inputEl.querySelector(".record-counter"),this.transcriptingEl=this.inputEl.querySelector(".transcripting__container"),this.transcriptingCursor=this.transcriptingEl.querySelector(".transcripting__container--cursor"),this.inputText=this.inputBackEl.querySelector(".input-text"),this.logoEl=document.querySelector(".logo__main"),this.logoMobileEl=document.querySelector(".logo__mobile"),this.navEl=document.querySelector(".nav"),this.categoriesListEl=document.querySelector(".categories__list--container"),this.carousselEl=document.querySelector(".caroussel__container"),this.infoTextEl=document.querySelector(".info-text"),this.addListeners(),this.onClickOutside={stopAudio:!1,animInitial:!1},this.transcriptingTime=2e3,this.textRecorded="text recorded"}onClickOutside(t){}startRecording(){this.animToStartRecording(),this.audioRecorder.startRecording(),this.audioRecorder.onUpdate(t=>{const e=y(t/60|0)+":"+y(t%60);this.recordCounter.textContent=e})}stopRecording(){this.audioRecorder.stopRecording()}onCompleteRecording(t){console.log("TODO add url endpoint to send audio file:",t)}animToInitial(){this.inputFrontEl.style.pointerEvents="auto",this.inputBackEl.style.pointerEvents="none",a(this.inputFrontEl,[{height:"110px"},{height:`${this.inputFrontHeight}px`}],{duration:700,fill:"forwards",ease:"ease-in-out"}),a(this.inputBackEl,[{opacity:1},{opacity:0}],{duration:200,fill:"forwards",ease:"ease-in-out"}),a([this.frontMicBtn,this.frontCameraBtn,this.frontCenterBtn],[{opacity:0},{opacity:1}],{duration:500,fill:"forwards",ease:"ease-in-out"}),p()&&(a(this.logoMobileEl,[{opacity:1},{opacity:0}],{duration:300,fill:"forwards",ease:"ease-in-out"}),a(this.logoEl,[{opacity:0},{opacity:1}],{delay:300,duration:300,fill:"forwards",ease:"ease-in-out"}))}animToWrite({delay:t=0,animButtons:e=!0,animLogos:s=!1,text:i=""}){this.onClickOutside.animInitial=!0,this.inputText.textContent=i,this.inputFrontEl.style.pointerEvents="none",this.inputBackEl.style.pointerEvents="auto",p()&&s&&(a(this.logoEl,[{opacity:1},{opacity:0}],{duration:300,fill:"forwards",ease:"ease-in-out"}),a(this.logoMobileEl,[{opacity:0},{opacity:1}],{delay:300,duration:300,fill:"forwards",ease:"ease-in-out"})),a(this.inputFrontEl,[{height:`${this.inputFrontHeight}px`},{height:"110px"}],{delay:t,duration:700,fill:"forwards",ease:"ease-in-out"}),e&&a([this.frontMicBtn,this.frontCameraBtn,this.frontCenterBtn],[{opacity:1},{opacity:0}],{delay:t,duration:500,fill:"forwards",ease:"ease-in-out"}),a(this.inputBackEl,[{opacity:0},{opacity:1}],{delay:t,duration:500,delay:t?t+700:700,fill:"forwards",ease:"ease-in-out"}),this.inputText.focus(),this.inputText.setSelectionRange(this.inputText.value.length,this.inputText.value.length)}animToStartRecording(){this.onClickOutside.stopAudio=!0,this.navEl.classList.remove("active"),this.inputEl.style.overflow="unset",this.inputEl.style.pointerEvents="none",p()&&(a(this.logoEl,[{opacity:1},{opacity:0}],{duration:300,fill:"forwards",ease:"ease-in-out"}),a(this.logoMobileEl,[{opacity:0},{opacity:1}],{delay:300,duration:300,fill:"forwards",ease:"ease-in-out"})),a([this.frontMicBtn,this.frontCenterBtn,this.frontCameraBtn],[{opacity:1},{opacity:0}],{duration:200,fill:"forwards",ease:"ease-in-out"}),a([this.logoEl],[{transform:"translateY(0)"},{transform:"translateY(-50%)"}],{duration:200,fill:"forwards",ease:"ease-in-out"});const t=a(this.inputFrontEl,[{width:`${this.inputFrontHeight}px`,offset:.45},{width:`${this.inputFrontHeight}px`,offset:1}],{duration:800,fill:"forwards",ease:"ease-out"}),e=a(this.inputFrontEl,[{transform:"translate3d(-50%, -50%, 0) scale(1)",offset:0},{transform:"translate3d(-50%, -50%, 0) scale(3)",offset:1}],{delay:400,duration:400,fill:"forwards",ease:"ease-out"});this.animCircleYoyo=a(this.inputFrontEl,[{transform:"translate3d(-50%, -50%, 0) scale(3)"},{transform:"translate3d(-50%, -50%, 0) scale(2.4)"},{transform:"translate3d(-50%, -50%, 0) scale(3)"}],{delay:t.effect.getComputedTiming().duration+e.effect.getComputedTiming().duration*.2,duration:1e3,iterations:1/0,ease:"ease-in-out"}),a([this.recordCounter,this.infoTextEl],[{opacity:0,visibility:"visible"},{opacity:1,visibility:"visible"}],{delay:t.effect.getComputedTiming().duration,duration:700,fill:"forwards",ease:"ease-in-out"})}animToStopRecording(){this.animCircleYoyo.cancel(),a([this.recordCounter,this.infoTextEl],[{opacity:1,visibility:"visible"},{opacity:0,visibility:"visible"}],{duration:300,fill:"forwards",ease:"ease-in-out"});const t=a(this.inputFrontEl,[{transform:"translate3d(-50%, -50%, 0) scale(3)"},{transform:"translate3d(-50%, -50%, 0) scale(1)"}],{duration:300,ease:"ease-in-out",fill:"forwards"}),e=a(this.inputFrontEl,[{width:`${this.inputFrontHeight}px`},{width:"100%"}],{delay:t.effect.getComputedTiming().duration+500,duration:400,ease:"ease-in-out",fill:"forwards"});e.onfinish=()=>{this.animToStartTranscripting()}}animToStartTranscripting(){this.timeoutTranscripting=setTimeout(()=>{this.animToStopTranscripting()},this.transcriptingTime),this.animShowTranscripting=a(this.transcriptingEl,[{opacity:0,visibility:"visible"},{opacity:1,visibility:"visible"}],{duration:700,fill:"forwards",ease:"ease-in-out"}),this.translateCursor=a(this.transcriptingCursor,[{transform:"translateX(0%)"},{transform:"translateX(105%)"}],{delay:this.animShowTranscripting.effect.getComputedTiming().duration,duration:400,fill:"forwards",ease:"ease-in-out"}),this.blinkCursor=a(this.transcriptingCursor,[{opacity:1},{opacity:0},{opacity:1}],{delay:this.animShowTranscripting.effect.getComputedTiming().duration+this.translateCursor.effect.getComputedTiming().duration,duration:500,iterations:1/0,ease:"ease-in-out"})}animToStopTranscripting(){this.inputEl.style.overflow="hidden",this.blinkCursor.cancel(),this.translateCursor.reverse(),a(this.transcriptingEl,[{opacity:1,visibility:"visible"},{opacity:0,visibility:"hidden"}],{delay:500,duration:700,fill:"forwards",ease:"ease-in-out"}),this.animToWrite({delay:1200,animButtons:!1,text:this.textRecorded})}addListeners(){this.centerBtn.addEventListener("click",()=>{this.animToWrite({animLogos:!0})}),this.frontMicBtn.addEventListener("click",()=>{this.startRecording()}),document.body.addEventListener("click",t=>{this.inputEl.contains(t.target)||(this.onClickOutside.stopAudio&&(this.stopRecording(),this.animToStopRecording(),this.onClickOutside.stopAudio=!1),this.onClickOutside.animInitial&&(this.animToInitial(),this.onClickOutside.animInitial=!1))},{capture:!0})}}class v{constructor(){this.addListeners()}initApp(){this.initCaroussel(),this.initInputText()}initCaroussel(){this.caroussel=new k,this.caroussel.init()}initInputText(){new b}addListeners(){window.addEventListener("load",()=>{document.body.classList.remove("preload")}),document.fonts.ready.then(()=>{this.initApp()})}}new v;
