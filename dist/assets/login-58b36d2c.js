import"./index-cca9f430.js";function a(){return localStorage.getItem("googleToken")}window.onload=async function(){if(a()){const t=d(a());console.log(t);const e=new r(t.sub,t.name,t.picture,t.email);await e.setuseraddress(),console.log(e),divgoogle.style.display="none",l(e)}else console.log("no logged in")};class r{constructor(e,o,n,s){this.uuid=e,this.name=o,this.picture=n,this.email=s,this.timezone=u(),this.area_name="",this.country_name="",this.pincode="",this.iso_2d_country_code="",this.administrative_area_level_1="",this.administrative_area_level_2=""}async setuseraddress(){let e=await g();this.area_name=e.area_name,this.country_name=e.country_name,this.pincode=e.pincode,this.iso_2d_country_code=e.iso_2d_country_code,this.administrative_area_level_1=e.administrative_area_level_1,this.administrative_area_level_2=e.administrative_area_level_2}}async function l(t){console.log("redirect to home");let e=await c(t);window.location.href="../index.html?lang=ad&session_id="+e.SessionID+"&deploy_id="+e.deploy_id}window.handleCredentialResponse=async t=>{console.log(t);const e=d(t.credential);console.log(e);const o=new r(e.sub,e.name,e.picture,e.email);await o.setuseraddress(),console.log(o),divgoogle.style.display="none",localStorage.setItem("googleToken",t.credential),l(o)};function d(t){var e=t.split(".")[1],o=e.replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(window.atob(o).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}const c=t=>new Promise(function(e,o){var n=new XMLHttpRequest;n.addEventListener("readystatechange",function(){this.readyState===4&&(console.log(this.responseText),e(JSON.parse(this.responseText)))}),n.open("POST","https://ai.iamplus.services/deploy_pa/getstreamname?userid="+t.uuid+"&assistantID=pa_prompt_2023"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t))});function u(){return Intl.DateTimeFormat().resolvedOptions().timeZone}function g(){return new Promise(async(t,e)=>{let o=await p();o=JSON.parse(o);var n=new XMLHttpRequest;n.addEventListener("readystatechange",function(){this.readyState===4&&(console.log(this.responseText),t(JSON.parse(this.responseText)))});let s="https://ai.iamplus.services/location/getaddress?latitude="+o.lat+"&longitude="+o.long;console.log("URL:"+s),n.open("GET",s),n.send()})}function p(){return new Promise((t,e)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(o=>{console.log("got geo location"),t(JSON.stringify({lat:o.coords.latitude,long:o.coords.longitude}))},o=>{console.log("Geolocation permission denied"),t(i())}):(console.log("Geolocation is not supported by your browser"),t(i()))})}const i=()=>new Promise((t,e)=>{var o=new XMLHttpRequest;o.open("GET","https://api.ipdata.co/?api-key=edadfa1ba2f38b1066342735ae303338478afada8e5eeb770929fafd"),o.setRequestHeader("Accept","application/json"),o.onreadystatechange=function(){if(this.readyState===4){var n=JSON.parse(this.responseText);console.log(`ip lat: ${n.latitude} long: ${n.longitude}`),t(JSON.stringify({lat:n.latitude,long:n.longitude}))}},o.send()});
